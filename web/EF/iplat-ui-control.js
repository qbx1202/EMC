/*
 * EF
 * Copyright(c) 2006, Jack Slocum.
 * 
 * This code is licensed under BSD license. Use it as you wish, 
 * but keep this copyright intact.
 */


$.fn.Tab=function(opt){var cfg={items:[{'id':1,'title':'tab','closed':true,'icon':'','html':'',load:'',domNode:'',share:false,'callback':function(){}}],width:540,tabcontentWidth:538,tabWidth:80,tabHeight:25,tabScroll:false,tabScrollWidth:19,tabClassDiv:'benma_ui_tab',tabClass:'benma_ui_tab_div',tabClassClose:'tab_close',tabClassOn:'tab_item',tabClassInner:'tab_item',tabClassInnerLeft:'tab_item1',tabClassInnerMiddle:'tab_item2',tabClassInnerRight:'tab_item3',tabClassText:'text',tabClassScrollLeft:'scroll-left',tabClassScrollRight:'scroll-right',tabContentClass:'tab-div-content',tabClassHtmlDiv:'tab-div-html',tabHtml:'',tabWidthSame:false};var newIframe=function(){var iframe=$("<iframe />").addClass("benma_ui_tab_iframe").attr({'scrolling':'no','marginHeight':0,'marginWidth':0,'frameBorder':0});return iframe[0];};var tabDiv=null;var sharedIframe=newIframe();var displayLINum=0;$.extend(cfg,opt);var tW=cfg.tabWidth*cfg.items.length;cfg.tabScroll?tW-=cfg.tabScrollWidth*2:null;var tab=$('<div />').attr('id','jquery_tab_div').addClass(cfg.tabClass).append('<ul />');var tabContent=$('<div />').attr('id','jquery_tab_div_content').width(cfg.tabcontentWidth-2).height("auto").addClass(cfg.tabContentClass);for(var i=0;i<cfg.items.length;i++)
{var item=cfg.items[i];addContentDiv(item,i);}
var ccW=(cfg.items.length*cfg.tabWidth)-cfg.width;var tabH='';var tabHeadItem=$("<table />").addClass(cfg.tabClassInner).attr({'id':'{0}','border':'0','cellpadding':'0','cellspacing':'0'}).append($("<tr />").append($("<td />").addClass(cfg.tabClassInnerLeft).css('background-image','url('+efico.get("eftab.tab1")+')')).append($("<td />").addClass(cfg.tabClassInnerMiddle).css('background-image','url('+efico.get("eftab.tab2")+')').append($("<span />").addClass(cfg.tabClassText).addClass('tabTitleText').html('{1}'))).append($("<td />").addClass(cfg.tabClassInnerMiddle).css('background-image','url('+efico.get("eftab.tab2")+')').append($("<div />").addClass(cfg.tabClassClose+' '+cfg.tabClassClose+'_noselected'))).append($("<td />").addClass(cfg.tabClassInnerRight).css('background-image','url('+efico.get("eftab.tab2")+')')));var tabTemplate=$("<div />").append(tabHeadItem).html();var scrollTab=function(o,flag){var tabchildren=tab.find('li');for(var ch=0;ch<tabchildren.length;ch++){if(tabchildren.eq(ch).css('display')!="none"){displayLINum=ch;break;}}
if(flag){if(displayLINum<=0)return;var firstshowli=tabchildren.eq(displayLINum-1);firstshowli.css('display','block');displayLINum--;}
else{if(displayLINum>=tabchildren.length-1)return;var lastli=tab.find('li:last');if(lastli.offset().top==tab.offset().top)return;var firstshowli=tabchildren.eq(displayLINum);firstshowli.css('display','none');displayLINum++;}};function getContentPanel(){return tabContent;}
function removeTab(item,force){if(!force){var ifr=$('#'+item.id+' iframe');var subwin=null;if(ifr.length>0){subwin=ifr[0].contentWindow;if(subwin.onbeforeunload){var msg=subwin.onbeforeunload();if(msg&&!confirm(msg+'\n确定关闭？'))
return false;}}}
if(!item.index){item.index=item.dom.index();}
item.dom.remove();$('#'+item.id).remove();if(item.index==obj.data('NowNode').index)
{obj.data('NowNode',cfg.items[item.index-1]);tab.find('li:eq('+(item.index-1)+') td:eq(1)').click();}
for(var i=item.index+1;i<cfg.items.length;i++)
{cfg.items[i].index-=1;}
cfg.items.splice(item.index,1);if(subwin&&subwin.onunload)
subwin.onunload();return true;}
function addTab(item){var innerString=tabTemplate.replace("{0}",'eftab_title_'+item.id).replace("{1}",item.title);var liObj=$('<li />');item.dom=liObj;liObj.append(innerString).appendTo(tab.find('ul')).find('table td:eq(1)').click(function(){if(!item.index){item.index=item.dom.index();}
obj.data('NowNode',item);var _self=liObj;if(_self.hasClass(cfg.tabClassOn))return;if(item.callback){if(item.callback(item)==false)return;}
_self.find('td:first').addClass(cfg.tabClassInnerLeft+'_selected');_self.find('td:last').addClass(cfg.tabClassInnerRight+'_selected');_self.find('td:eq(1)').addClass(cfg.tabClassInnerMiddle+'_selected');_self.find('td:eq(2)').addClass(cfg.tabClassInnerMiddle+'_selected');var activeLi=_self.parent().find('li.'+cfg.tabClassOn);activeLi.find('td:first').removeClass().addClass(cfg.tabClassInnerLeft);activeLi.find('td:first').style="background-image:url("+efico.get("eftab.tab1")+")";activeLi.find('td:last').removeClass().addClass(cfg.tabClassInnerRight);activeLi.find('td:last').style="background-image:url("+efico.get("eftab.tab3")+")";activeLi.find('td:eq(1)').removeClass().addClass(cfg.tabClassInnerMiddle);activeLi.find('td:eq(1)').style="background-image:url("+efico.get("eftab.tab2")+")";activeLi.find('td:eq(2)').removeClass().addClass(cfg.tabClassInnerMiddle).find('div').addClass(cfg.tabClassClose+'_noselected');activeLi.find('td:eq(2)').style="background-image:url("+efico.get("eftab.tab2")+")";activeLi.removeClass().addClass(cfg.tabClassOff);$(this).next().find('div').removeClass().addClass(cfg.tabClassClose);_self.removeClass().addClass(cfg.tabClassOn);setAlldisplayNone(tabContent,item);}).hover(function(){var _self=liObj;if(_self.hasClass(cfg.tabClassOn))return;_self.find('td:first').addClass(cfg.tabClassInnerLeft+'_mouseover');_self.find('td:last').addClass(cfg.tabClassInnerRight+'_mouseover');_self.find('td:eq(1)').addClass(cfg.tabClassInnerMiddle+'_mouseover');_self.find('td:eq(2)').addClass(cfg.tabClassInnerMiddle+'_mouseover');},function(){var _self=liObj;if(_self.hasClass(cfg.tabClassOn))return;_self.find('td:first').removeClass(cfg.tabClassInnerLeft+'_mouseover');_self.find('td:last').removeClass(cfg.tabClassInnerRight+'_mouseover');_self.find('td:eq(1)').removeClass(cfg.tabClassInnerMiddle+'_mouseover');_self.find('td:eq(2)').removeClass(cfg.tabClassInnerMiddle+'_mouseover');});if(item.closed){liObj.find('td:eq(2)').find('div').click(function(){removeTab(item);}).hover(function(){if(liObj.hasClass(cfg.tabClassOn))return;var _self=$(this);_self.removeClass().addClass(cfg.tabClassClose);},function(){if(liObj.hasClass(cfg.tabClassOn))return;var _self=$(this);_self.addClass(cfg.tabClassClose+'_noselected');});}
else{liObj.find('td:eq(2)').html('');}
return liObj;}
function getItemWithId(_id)
{for(var i=0;i<cfg.items.length;i++)
{var _item=cfg.items[i];if(_item.id==_id)
{return _item;}}}
function getItemWithNum(_num)
{return cfg.items[_num];}
function setAlldisplayNone(jqTab,_item)
{var tabDivs=jqTab.children().filter('div');for(var i=0;i<tabDivs.length;i++){var tabDiv=tabDivs[i];if(tabDiv.id!=_item.id)
{tabDiv.style.display="none";}else
{tabDiv.style.display="block";if(!(_item.load==null||_item.load=='')&&!_item.share)
{_item.iframe=newIframe();if(_item.height==null){_item.height="100%";}
$(_item.iframe).height(_item.height);_item.iframe.src=_item.load;if($(">iframe",tabDiv).length>0){$(tabDiv).empty();}
tabDiv.appendChild(_item.iframe);}
if(_item.share&&!$(tabDiv).data('ONCE')){$(tabDiv).data('ONCE',true);$(_item.iframe).contents().find('div[id*=sumDataDivForFloat]').each(function()
{var end=$(this).attr('id').indexOf('sumDataDivForFloat');var gridId=$(this).attr('id').substr(0,end);var grid=$(this).parent().find('#'+gridId+'__grid_table')[0].efgrid;grid.paint();});}
if(!!_item.switchAffterCallBack){eval(_item.switchAffterCallBack)(_item);}}}}
function addContentDiv(item,i)
{if(!item.id)item.id="ef_tab_"+i;if(item.load){var iframediv=$("<div />").attr({'id':item.id,'title':item.title,'eftabsrc':item.load,'eftabheight':item.height,'efRemember':(item.share?"yes":"no")}).css('display','none');tabContent.append(iframediv);if(item.share){if(item.iframe==null){item.iframe=newIframe();}
if(item.height==null){item.height="100%";}else{$(document).ready(function(){$(item.iframe).load(function(){$(this).contents().find("form").height('100%');});});}
$(item.iframe).height(item.height);item.iframe.src=item.load;iframediv.append(item.iframe);}}else if(item.domNode){if(item.height==null){item.height="100%";}
item.domNode.style.height=item.height;tabContent.get(0).appendChild(item.domNode);}else{var htmldiv=$("<div  id= "+item.id+" />").css("display","none").append(item.html);tabContent.append(htmldiv);}}
function setDivNode(nd){tabDiv=nd;}
function getIframe(idx){var item=cfg.items[idx];if(item==null)
return null;if(item.load){if(item.iframe==null){item.iframe=newIframe();}
return item.iframe;}
return null;}
function hideItem(idx){var item=cfg.items[idx];var itemDom=item.dom;itemDom.hide();total=cfg.items.length;indexI=idx;indexT=idx;var ifChange=false;if(itemDom.hasClass(cfg.tabClassOn)){if(!!tabDiv&&(tabDiv.data("NowNode").index==idx||tabDiv.get(0).NowNode.index==idx)){for(indexI=indexI+1;indexI<total;indexI++){if(cfg.items[indexI].dom.get(0).style.display!="none"){clickTab(indexI);ifChange=true;break;}}
if(!ifChange)
for(indexT=indexT-1;0<=indexT;indexT--){if(cfg.items[indexT].dom.get(0).style.display!="none"){clickTab(indexT);ifChange=true;break;}}
if(!ifChange){tabDiv.hide();}}}}
function showItem(idx){var item=cfg.items[idx];var itemDom=item.dom;itemDom.show();clickTab(idx);}
function clickTab(idx,_noCallback){var item=cfg.items[idx];if(!_noCallback)
{if(item.callback)
{if(item.callback(item)==false)
return;}}
var _self=item.dom;if(!_self.hasClass(cfg.tabClassOn))
{_self.find('td:first').addClass(cfg.tabClassInnerLeft+'_selected');_self.find('td:last').addClass(cfg.tabClassInnerRight+'_selected');_self.find('td:eq(1)').addClass(cfg.tabClassInnerMiddle+'_selected');_self.find('td:eq(2)').addClass(cfg.tabClassInnerMiddle+'_selected');var activeLi=_self.parent().find('li.'+cfg.tabClassOn);activeLi.find('td:first').removeClass().addClass(cfg.tabClassInnerLeft);activeLi.find('td:first').style="background-image:url("+efico.get("eftab.tab1")+")";activeLi.find('td:last').removeClass().addClass(cfg.tabClassInnerRight);activeLi.find('td:last').style="background-image:url("+efico.get("eftab.tab3")+")";activeLi.find('td:eq(1)').removeClass().addClass(cfg.tabClassInnerMiddle);activeLi.find('td:eq(1)').style="background-image:url("+efico.get("eftab.tab2")+")";activeLi.find('td:eq(2)').removeClass().addClass(cfg.tabClassInnerMiddle).find('div').addClass(cfg.tabClassClose+'_noselected');activeLi.find('td:eq(2)').style="background-image:url("+efico.get("eftab.tab2")+")";activeLi.removeClass().addClass(cfg.tabClassOff);$(this).next().find('div').removeClass().addClass(cfg.tabClassClose);_self.removeClass().addClass(cfg.tabClassOn);}
setAlldisplayNone(tabContent,item);}
function newTab(item){addContentDiv(item,cfg.items.length);var liLength=tab.find('li').length;if(liLength>0){var showli=tab.find('li').eq(liLength-1);while(showli.offset().top!=tab.offset().top){scrollTab("newTab",false);showli=tab.find('li').eq(liLength-1);}}
var newObjli=addTab(item);tabliWidth+=newObjli.width()+3;if(tabliWidth>tab.width()&&!cfg.tabScroll){cfg.tabScroll=true;scrollLeft=$('<div class="'+cfg.tabClassScrollLeft+'"></div>').click(function(){scrollTab(scrollLeft,true);});srcollRight=$('<div class="'+cfg.tabClassScrollRight+'"></div>').click(function(){scrollTab(srcollRight,false);});cW=tabContenter.width()-cfg.tabScrollWidth*2;container.prepend(srcollRight).prepend(scrollLeft);tabContenter.css('width',cW);obj.width(obj.width());}
scrollTab("newTab",false);cfg.items.push(item);}
function forEachTab(tabHandler){for(var i=0;i<cfg.items.length;i++){if(!tabHandler(cfg.items[i]))
return false;}
return true;}
function updateTitle(item,title){item.title=title;var $dom=$(item.dom);$('.tabTitleText',$dom).text(title);}
$.each(cfg.items,function(i,o){addTab(o);});var cW=cfg.width;var container=$('<div />').css({'overflow':'hidden','position':'relative','width':cfg.width,'height':cfg.tabHeight}).addClass(cfg.tabClassDiv);var tabContenter=$('<div />').css({'overflow':'hidden','width':cW,'height':cfg.tabHeight,'float':'left'}).append(tab);var obj=$(this).append(tabH).append(container.append(tabContenter));obj.get(0).appendChild(tabContent.get(0));var scrollLeft,srcollRight;var tablis=tab.find('li');var pstatus=true;tab.parents().each(function(){if($(this).css('display')=='none'){pstatus=false;return false;}});if(pstatus){var tabliWidth=0;for(var i=0;i<tablis.length;i++){tabliWidth+=tablis.eq(i).width()+3;}
if(tabliWidth>tab.width()){scrollLeft=$('<div class="'+cfg.tabClassScrollLeft+'"></div>').click(function(){scrollTab($(this),true);});srcollRight=$('<div class="'+cfg.tabClassScrollRight+'"></div>').click(function(){scrollTab($(this),false);});cW=tabContenter.width()-cfg.tabScrollWidth*2;container.prepend(srcollRight).prepend(scrollLeft);tabContenter.css('width',cW);obj.width(obj.width());}}
tab.find('li:first td:eq(1)').click();return obj.extend({'addTab':addTab,'newTab':newTab,'getContentPanel':getContentPanel,'getIframe':getIframe,'hideItem':hideItem,'showItem':showItem,'setDivNode':setDivNode,'clickTab':clickTab,'getItemWithNum':getItemWithNum,'getItemWithId':getItemWithId,forEachTab:forEachTab,removeTab:removeTab,updateTitle:updateTitle});};

(function($){var options;var defaultPaddingLeft;$.fn.treeTable=function(opts){options=$.extend({},$.fn.treeTable.defaults,opts);return this.each(function(){$(this).addClass("treeTable").find("tbody tr").each(function(){if(!options.expandable||$(this)[0].className.search(options.childPrefix)==-1){if(isNaN(defaultPaddingLeft)){defaultPaddingLeft=parseInt($($(this).children("td")[options.treeColumn]).css('padding-left'),10);}
initialize($(this));}else if(options.initialState=="collapsed"){this.style.display="none";}});});};$.fn.treeTable.defaults={childPrefix:"child-of-",clickableNodeNames:false,expandable:true,indent:19,initialState:"collapsed",treeColumn:0};$.fn.collapse=function(){$(this).addClass("collapsed");childrenOf($(this)).each(function(){if(!$(this).hasClass("collapsed")){$(this).collapse();}
this.style.display="none";});return this;};$.fn.expand=function(){$(this).removeClass("collapsed").addClass("expanded");childrenOf($(this)).each(function(){initialize($(this));if($(this).is(".expanded.parent")){$(this).expand();}
$(this).show();});return this;};$.fn.reveal=function(){$(ancestorsOf($(this)).reverse()).each(function(){initialize($(this));$(this).expand().show();});return this;};$.fn.appendBranchTo=function(destination){var node=$(this);var parent=parentOf(node);var ancestorNames=$.map(ancestorsOf($(destination)),function(a){return a.id;});if($.inArray(node[0].id,ancestorNames)==-1&&(!parent||(destination.id!=parent[0].id))&&destination.id!=node[0].id){indent(node,ancestorsOf(node).length*options.indent*-1);if(parent){node.removeClass(options.childPrefix+parent[0].id);}
node.addClass(options.childPrefix+destination.id);move(node,destination);indent(node,ancestorsOf(node).length*options.indent);}
return this;};$.fn.reverse=function(){return this.pushStack(this.get().reverse(),arguments);};$.fn.toggleBranch=function(){if($(this).hasClass("collapsed")){$(this).expand();}else{$(this).removeClass("expanded").collapse();}
return this;};function ancestorsOf(node){var ancestors=[];while(node=parentOf(node)){ancestors[ancestors.length]=node[0];}
return ancestors;};function childrenOf(node){return $("table.treeTable tbody tr."+options.childPrefix+node[0].id);};function getPaddingLeft(node){var paddingLeft=parseInt(node[0].style.paddingLeft,10);return(isNaN(paddingLeft))?defaultPaddingLeft:paddingLeft;}
function indent(node,value){var cell=$(node.children("td")[options.treeColumn]);cell[0].style.paddingLeft=getPaddingLeft(cell)+value+"px";childrenOf(node).each(function(){indent($(this),value);});};function initialize(node){if(!node.hasClass("initialized")){node.addClass("initialized");var childNodes=childrenOf(node);if(!node.hasClass("parent")&&childNodes.length>0){node.addClass("parent");}
if(node.hasClass("parent")){var cell=$(node.children("td")[options.treeColumn]);var padding=getPaddingLeft(cell)+options.indent;childNodes.each(function(){$(this).children("td")[options.treeColumn].style.paddingLeft=padding+"px";});if(options.expandable){cell.prepend('<span style="margin-left: -'+options.indent+'px; padding-left: '+options.indent+'px" class="expander"></span>');$(cell[0].firstChild).click(function(){node.toggleBranch();});if(options.clickableNodeNames){cell[0].style.cursor="pointer";$(cell).click(function(e){if(e.target.className!='expander'){node.toggleBranch();}});}
if(!(node.hasClass("expanded")||node.hasClass("collapsed"))){node.addClass(options.initialState);}
if(node.hasClass("expanded")){node.expand();}}}}};function move(node,destination){node.insertAfter(destination);childrenOf(node).reverse().each(function(){move($(this),node[0]);});};function parentOf(node){var classNames=node[0].className.split(' ');for(key in classNames){if(classNames[key].match(options.childPrefix)){return $("#"+classNames[key].substring(9));}}};})(jQuery);

(function($){$.flexbox=function(div,o){var timeout=false,cache=[],cacheData=[],cacheSize=0,delim='\u25CA',scrolling=false,pageSize=o.paging&&o.paging.pageSize?o.paging.pageSize:0,retrievingRemoteData=false,$div=$(div).css('z-index',0);var $hdn=$('<input type="hidden"/>').attr('id',$div.attr('sid')).attr('name',$div.attr('sid')).val(o.initialKey).appendTo($div);var $input=$('<input/>').attr('id',$div.attr('sid')+'_input').attr('autocomplete','off').attr('value',o.initialValue).addClass(o.inputClass).css('width',o.width+'px').appendTo($div).click(function(e){if(o.watermark!==''&&this.value===o.watermark)
this.value='';else
this.select();}).focus(function(e){$(this).removeClass('watermark');}).blur(function(e){if(this.value==='')$hdn.val('');setTimeout(function(){if(!$input.data('active'))hideResults();},200);}).keydown(processKeyDown);if(o.initialValue!=='')
$input.val(o.initialValue).removeClass('watermark');else
$input.val(o.watermark).addClass('watermark');var arrowWidth=0;if(o.showArrow&&o.showResults){var arrowClick=function(){if($ctr.is(':visible')){hideResults();}else{$input.focus();if(o.watermark!==''&&$input.val()===o.watermark){$input.val('');}else{$input.select();}
if(timeout){clearTimeout(timeout);}
timeout=setTimeout(function(){flexbox(1,true,o.arrowQuery);},o.queryDelay);}};var $arrow=$('<span></span>').attr('id',$div.attr('id')+'_arrow').addClass(o.arrowClass).addClass('out').hover(function(){$(this).removeClass('out').addClass('over');},function(){$(this).removeClass('over').addClass('out');}).mousedown(function(){$(this).removeClass('over').addClass('active');}).mouseup(function(){$(this).removeClass('active').addClass('over');}).click(arrowClick).appendTo($div);arrowWidth=$arrow.width();$input.css('width',(o.width-arrowWidth)+'px');}
if(!o.allowInput){o.selectFirstMatch=false;$input.click(arrowClick);}
var inputPad=$input.outerHeight()-$input.height()-2;var inputWidth=$input.outerWidth()-2;var top=$input.outerHeight();if(inputPad===0){inputWidth+=4;top+=4;}
else if(inputPad!==4){inputWidth+=inputPad;top+=inputPad;}
var $ctr=$('<div></div>');$ctr.attr('id',$div.attr('id')+'_ctr');$ctr.css('width',inputWidth+arrowWidth);$ctr.css('top',top);$ctr.css('left',0);$ctr.attr('style','clear:both');$ctr.addClass(o.containerClass);$ctr.appendTo($div);$ctr.mousedown(function(e){$input.data('active',true);});$ctr.hide();var $content=$('<div></div>').addClass(o.contentClass).appendTo($ctr).scroll(function(){scrolling=true;});var $paging=$('<div></div>').appendTo($ctr);$div.css('height',$input.outerHeight());function processKeyDown(e){var mod=0;if(typeof(e.ctrlKey)!=='undefined'){if(e.ctrlKey)mod|=1;if(e.shiftKey)mod|=2;}else{if(e.modifiers&Event.CONTROL_MASK)mod|=1;if(e.modifiers&Event.SHIFT_MASK)mod|=2;}
if(/16$|17$/.test(e.keyCode))return;var tab=e.keyCode===9,esc=e.keyCode===27;var tabWithModifiers=e.keyCode===9&&mod>0;var backspace=e.keyCode===8;if(tab)if(getCurr())selectCurr();if((/27$|38$|33$|34$/.test(e.keyCode)&&$ctr.is(':visible'))||(/13$|40$/.test(e.keyCode))||!o.allowInput){if(e.preventDefault)e.preventDefault();if(e.stopPropagation)e.stopPropagation();e.cancelBubble=true;e.returnValue=false;switch(e.keyCode){case 38:prevResult();break;case 40:if($ctr.is(':visible'))nextResult();else flexboxDelay(true);break;case 13:if(getCurr())selectCurr();else flexboxDelay(true);break;case 27:hideResults();break;case 34:if(!retrievingRemoteData){if(o.paging)$('#'+$div.attr('id')+'n').click();else nextPage();}
break;case 33:if(!retrievingRemoteData){if(o.paging)$('#'+$div.attr('id')+'p').click();else prevPage();}
break;default:if(!o.allowInput){return;}}}else if(!esc&&!tab&&!tabWithModifiers){flexboxDelay(false,backspace);}}
function flexboxDelay(simulateArrowClick,increaseDelay){if(timeout)clearTimeout(timeout);var delay=increaseDelay?o.queryDelay*5:o.queryDelay;timeout=setTimeout(function(){flexbox(1,simulateArrowClick,'');},delay);}
function flexbox(p,arrowOrPagingClicked,prevQuery){var q=prevQuery&&prevQuery.length>0?prevQuery:$.trim($input.val());if(q.length>=o.minChars||arrowOrPagingClicked){if($content.outerHeight()>0)
$content.css('height',$content.outerHeight());$content.html('').attr('scrollTop',0);var cached=checkCache(q,p);if(cached){$content.css('height','auto');displayItems(cached.data,q);showPaging(p,cached.t);}else{var params={q:q,p:p,s:pageSize,contentType:'application/json; charset=utf-8'};var callback=function(data,overrideQuery){var dataValue=new Array();var ajaxEi=Json2EiInfo.prototype.parseJsonObject(data);if(overrideQuery===true)q=overrideQuery;var totalResults=parseInt(ajaxEi.get(o.totalProperty));var blocks=ajaxEi.blocks;var dataBlock=null;if(blocks!=null){dataBlock=blocks[o.dataBlockId];}else{dataBlock=blocks;}
if(dataBlock==null||dataBlock==undefined){alert('未取得数据定义!');return;}
for(var i=0;i<dataBlock.getRows().length;i++){var pos=dataBlock.getBlockMeta().getMeta(o.displayValue).pos;var pos1=dataBlock.getBlockMeta().getMeta(o.hiddenValue).pos;var label=dataBlock.rows[i][pos];var value=dataBlock.rows[i][pos1];if(typeof(o.detailInfo)!=='undefined'&&o.detailInfo!==''){var pos2=dataBlock.getBlockMeta().getMeta(o.detailInfo).pos;var detailvalue=dataBlock.rows[i][pos2];if(typeof(detailvalue)!=='undefined')
label=label+"<br>"+"<font class='flexbox_detail' >"+detailvalue+"</font>";}
dataValue[i]={"id":value,name:label};data={};data[o.totalProperty]=dataValue.length;data[o.resultsProperty]=dataValue;}
if(o.allowInput){data=filter(data,params);}
dataValue=data[o.resultsProperty];totalResults=data[o.totalProperty];if(isNaN(totalResults)&&o.paging&&dataValue!=null){if(o.maxCacheBytes<=0){alert('The "maxCacheBytes" configuration option must be greater\nthan zero when implementing client-side paging.');}
totalResults=data[o.resultsProperty].length;var pages=totalResults/pageSize;if(totalResults%pageSize>0)pages=parseInt(++pages);for(var i=1;i<=pages;i++){var pageData={};pageData[o.totalProperty]=totalResults;pageData[o.resultsProperty]=dataValue;if(i===1)totalSize=displayItems(pageData,q);updateCache(q,i,pageSize,totalResults,pageData,totalSize);}}else{var pageData={};pageData[o.totalProperty]=totalResults;pageData[o.resultsProperty]=dataValue;var totalSize=displayItems(pageData,q);updateCache(q,p,pageSize,totalResults,pageData,totalSize);}
showPaging(p,totalResults);$content.css('height','auto');retrievingRemoteData=false;};if(typeof(o.source)==='object'){callback(o.source);}else{retrievingRemoteData=true;var eiinfo=new EiInfo();eiinfo.set("p",params.p);eiinfo.set("q",params.q);eiinfo.set("s",params.s);var jsonEi=EiInfo2Json.prototype.EiInfo2JsonString(eiinfo);var eiparams={eiinfo:jsonEi};if(o.method.toUpperCase()=='POST'){$.post(o.source,eiparams,callback,'json');}else{$.getJSON(o.source,eiparams,callback);}}}}else{hideResults();}}
function filter(data,params){var filtered={};filtered[o.resultsProperty]=[];filtered[o.totalProperty]=0;var index=0;if(typeof(data[o.resultsProperty])!=='undefined')
for(var i=0;i<data[o.resultsProperty].length;i++){var indexOfMatch=data[o.resultsProperty][i][o.displayValue].toLowerCase().indexOf(params.q.toLowerCase());if((o.matchAny&&indexOfMatch!==-1)||(!o.matchAny&&indexOfMatch===0)){filtered[o.resultsProperty][index++]=data[o.resultsProperty][i];filtered[o.totalProperty]+=1;}}
if(o.paging){var start=(params.p-1)*params.s;var howMany=(start+params.s)>filtered[o.totalProperty]?filtered[o.totalProperty]-start:params.s;filtered[o.resultsProperty]=filtered[o.resultsProperty].splice(start,howMany);}
return filtered;}
function showPaging(p,totalResults){$paging.html('').removeClass(o.paging.cssClass);if(o.showResults&&o.paging&&totalResults>pageSize){var pages=totalResults/pageSize;if(totalResults%pageSize>0)pages=parseInt(++pages);outputPagingLinks(pages,p,totalResults);}}
function handleKeyPress(e,page,totalPages){if(/^13$|^39$|^37$/.test(e.keyCode)){if(e.preventDefault)
e.preventDefault();if(e.stopPropagation)
e.stopPropagation();e.cancelBubble=true;e.returnValue=false;switch(e.keyCode){case 13:if(/^\d+$/.test(page)&&page>0&&page<=totalPages)
flexbox(page,true);else
alert('请输入页码范围:1至'+totalPages+'!');break;case 39:$('#'+$div.attr('id')+'n').click();break;case 37:$('#'+$div.attr('id')+'p').click();break;}}}
function handlePagingClick(e){flexbox(parseInt($(this).attr('page')),true,$input.attr('pq'));return false;}
function outputPagingLinks(totalPages,currentPage,totalResults){var first='&lt;&lt;',prev='&lt;',next='&gt;',last='&gt;&gt;',more='...';$paging.addClass(o.paging.cssClass);var $link=$('<a/>').attr('href','#').addClass('page').click(handlePagingClick),$span=$('<span></span>').addClass('page'),divId=$div.attr('id');if(currentPage>1){$link.clone(true).attr('id',divId+'f').attr('page',1).html(first).appendTo($paging);$link.clone(true).attr('id',divId+'p').attr('page',currentPage-1).html(prev).appendTo($paging);}
else{$span.clone(true).html(first).appendTo($paging);$span.clone(true).html(prev).appendTo($paging);}
if(o.paging.style==='links'){var maxPageLinks=o.paging.maxPageLinks;if(totalPages<=maxPageLinks){for(var i=1;i<=totalPages;i++){if(i===currentPage){$span.clone(true).html(currentPage).appendTo($paging);}
else{$link.clone(true).attr('page',i).html(i).appendTo($paging);}}}
else{if((currentPage+parseInt(maxPageLinks/2))>totalPages){startPage=totalPages-maxPageLinks+1;}
else{startPage=currentPage-parseInt(maxPageLinks/2);}
if(startPage>1){$link.clone(true).attr('page',startPage-1).html(more).appendTo($paging);}
else{startPage=1;}
for(var i=startPage;i<startPage+maxPageLinks;i++){if(i===currentPage){$span.clone(true).html(i).appendTo($paging);}
else{$link.clone(true).attr('page',i).html(i).appendTo($paging);}}
if(totalPages>(startPage+maxPageLinks)){$link.clone(true).attr('page',i).html(more).appendTo($paging);}}}
else if(o.paging.style==='input'){var $pagingBox=$('<input/>').addClass('box').click(function(e){this.select();}).keypress(function(e){return handleKeyPress(e,this.value,totalPages);}).val(currentPage).appendTo($paging);}
if(currentPage<totalPages){$link.clone(true).attr('id',divId+'n').attr('page',+currentPage+1).html(next).appendTo($paging);$link.clone(true).attr('id',divId+'l').attr('page',totalPages).html(last).appendTo($paging);}
else{$span.clone(true).html(next).appendTo($paging);$span.clone(true).html(last).appendTo($paging);}
var startingResult=(currentPage-1)*pageSize+1;var endingResult=(startingResult>(totalResults-pageSize))?totalResults:startingResult+pageSize-1;if(o.paging.showSummary){var summaryData={"start":startingResult,"end":endingResult,"total":totalResults,"page":currentPage,"pages":totalPages};var html=o.paging.summaryTemplate.applyTemplate(summaryData);$('<br/>').appendTo($paging);$('<span></span>').addClass(o.paging.summaryClass).html(html).appendTo($paging);}}
function checkCache(q,p){var key=q+delim+p;if(cacheData[key]){for(var i=0;i<cache.length;i++){if(cache[i]===key){cache.unshift(cache.splice(i,1)[0]);return cacheData[key];}}}
return false;}
function updateCache(q,p,s,t,data,size){if(o.maxCacheBytes>0){while(cache.length&&(cacheSize+size>o.maxCacheBytes)){var cached=cache.pop();cacheSize-=cached.size;}
var key=q+delim+p;cacheData[key]={q:q,p:p,s:s,t:t,size:size,data:data};cache.push(key);cacheSize+=size;}}
function displayItems(d,q){var totalSize=0,itemCount=0;if(!d)
return;$hdn.val($input.val());if(parseInt(d[o.totalProperty])===0&&o.noResultsText&&o.noResultsText.length>0){$content.addClass(o.noResultsClass).html(o.noResultsText);$ctr.show();return;}else $content.removeClass(o.noResultsClass);for(var i=0;i<d[o.resultsProperty].length;i++){var data=d[o.resultsProperty][i],result=o.resultTemplate.applyTemplate(data),exactMatch=q===result,selectedMatch=false,hasHtmlTags=false,match=data[o.displayValue];if(!exactMatch&&o.highlightMatches&&q!==''){var pattern=q,highlightStart=match.toLowerCase().indexOf(q.toLowerCase()),replaceString='<span class="'+o.matchClass+'">'+match.substr(highlightStart,q.length)+'</span>';if(result.match('<(.|\n)*?>')){hasHtmlTags=true;pattern='(>)([^<]*?)('+q+')((.|\n)*?)(<)';replaceString='$1$2<span class="'+o.matchClass+'">$3</span>$4$6';}
result=result.replace(new RegExp(pattern,o.highlightMatchesRegExModifier),replaceString);}
if(o.autoCompleteFirstMatch&&!hasHtmlTags&&i===0){if(q.length>0&&match.toLowerCase().indexOf(q.toLowerCase())===0){$input.attr('pq',q);$hdn.val(data[o.hiddenValue]);$input.val(data[o.displayValue]);selectedMatch=selectRange(q.length,$input.val().length);}}
if(!o.showResults)return;$row=$('<div></div>').attr('id',data[o.hiddenValue]).attr('val',data[o.displayValue]).addClass('row').html(result).appendTo($content);if(exactMatch||(++itemCount==1&&o.selectFirstMatch)||selectedMatch){$row.addClass(o.selectClass);}
totalSize+=result.length;}
if(totalSize===0){hideResults();return;}
$ctr.parent().css('z-index',1000);$ctr.show();$content.children('div').mouseover(function(){$content.children('div').removeClass(o.selectClass);$(this).addClass(o.selectClass);}).mouseup(function(e){e.preventDefault();e.stopPropagation();selectCurr();});if(o.maxVisibleRows>0){var maxHeight=$row.outerHeight()*o.maxVisibleRows;$content.css('max-height',maxHeight);}
return totalSize;}
function selectRange(s,l){var tb=$input[0];if(tb.createTextRange){var r=tb.createTextRange();r.moveStart('character',s);r.moveEnd('character',l-tb.value.length);r.select();}else if(tb.setSelectionRange){tb.setSelectionRange(s,l);}
tb.focus();return true;}
String.prototype.applyTemplate=function(d){try{if(d==='')return this;return this.replace(/{([^{}]*)}/g,function(a,b){var r;if(b.indexOf('.')!==-1){var ary=b.split('.');var obj=d;for(var i=0;i<ary.length;i++)
obj=obj[ary[i]];r=obj;}
else
r=d[b];if(typeof r==='string'||typeof r==='number')return r;else throw(a);});}catch(ex){alert('设置paging.summaryTemplate时发现无效的JSON属性['+ex+'].\n请检查代码并重试!');}};function hideResults(){$input.data('active',false);$div.css('z-index',0);$ctr.hide();}
function getCurr(){if(!$ctr.is(':visible'))
return false;var $curr=$content.children('div.'+o.selectClass);if(!$curr.length)
$curr=false;return $curr;}
function selectCurr(){$curr=getCurr();if($curr){$hdn.val($curr.attr('id'));var detailvalue=$curr.attr('val');var idx=detailvalue.indexOf("<br>");if(idx!=-1){detailvalue=detailvalue.substr(0,idx);}
$input.val(detailvalue).focus();hideResults();eval(o.onSelect);}}
function supportsGetBoxObjectFor(){try{document.getBoxObjectFor(document.body);return true;}
catch(e){return false;}}
function supportsGetBoundingClientRect(){try{document.body.getBoundingClientRect();return true;}
catch(e){return false;}}
function nextPage(){$curr=getCurr();if($curr&&$curr.next().length>0){$curr.removeClass(o.selectClass);for(var i=0;i<o.maxVisibleRows;i++){if($curr.next().length>0){$curr=$curr.next();}}
$curr.addClass(o.selectClass);var scrollPos=$content.attr('scrollTop');$content.attr('scrollTop',scrollPos+$content.height());}
else if(!$curr)
$content.children('div:first-child').addClass(o.selectClass);}
function prevPage(){$curr=getCurr();if($curr&&$curr.prev().length>0){$curr.removeClass(o.selectClass);for(var i=0;i<o.maxVisibleRows;i++){if($curr.prev().length>0){$curr=$curr.prev();}}
$curr.addClass(o.selectClass);var scrollPos=$content.attr('scrollTop');$content.attr('scrollTop',scrollPos-$content.height());}
else if(!$curr)
$content.children('div:last-child').addClass(o.selectClass);}
function nextResult(){$curr=getCurr();if($curr&&$curr.next().length>0){$curr.removeClass(o.selectClass).next().addClass(o.selectClass);var scrollPos=$content.attr('scrollTop'),curr=$curr[0],parentBottom,bottom,height;if(supportsGetBoxObjectFor()){parentBottom=document.getBoxObjectFor($content[0]).y+$content.attr('offsetHeight');bottom=document.getBoxObjectFor(curr).y+$curr.attr('offsetHeight');height=document.getBoxObjectFor(curr).height;}
else if(supportsGetBoundingClientRect()){parentBottom=$content[0].getBoundingClientRect().bottom;var rect=curr.getBoundingClientRect();bottom=rect.bottom;height=bottom-rect.top;}
if(bottom>=parentBottom)
$content.attr('scrollTop',scrollPos+height);}
else if(!$curr)
$content.children('div:first-child').addClass(o.selectClass);}
function prevResult(){$curr=getCurr();if($curr&&$curr.prev().length>0){$curr.removeClass(o.selectClass).prev().addClass(o.selectClass);var scrollPos=$content.attr('scrollTop'),curr=$curr[0],parent=$curr.parent()[0],parentTop,top,height;if(supportsGetBoxObjectFor()){height=document.getBoxObjectFor(curr).height;parentTop=document.getBoxObjectFor($content[0]).y-(height*2);top=document.getBoxObjectFor(curr).y-document.getBoxObjectFor($content[0]).y;}
else if(supportsGetBoundingClientRect()){parentTop=parent.getBoundingClientRect().top;var rect=curr.getBoundingClientRect();top=rect.top;height=rect.bottom-top;}
if(top<=parentTop)
$content.attr('scrollTop',scrollPos-height);}
else if(!$curr)
$content.children('div:last-child').addClass(o.selectClass);}};$.fn.flexbox=function(source,options){if(!source)
return;try{var defaults=$.fn.flexbox.defaults;var o=$.extend({},defaults,options);for(var prop in o){if(defaults[prop]===undefined)throw('无效的属性配置: '+prop+'\n请检查代码，并重试!');}
o.source=source;if(options){o.paging=(options.paging||options.paging==null)?$.extend({},defaults.paging,options.paging):false;for(var prop in o.paging){if(defaults.paging[prop]===undefined)throw('无效的属性配置: '+prop+'\n请检查代码，并重试!');}
if(options.displayValue&&!options.hiddenValue){o.hiddenValue=options.displayValue;}}
this.each(function(){new $.flexbox(this,o);});return this;}catch(ex){if(typeof ex==='object')alert(ex.message);else alert(ex);}};$.fn.flexbox.defaults={method:'GET',queryDelay:100,allowInput:true,containerClass:'ffb',contentClass:'content',selectClass:'ffb-sel',inputClass:'ffb-input',arrowClass:'ffb-arrow',matchClass:'ffb-match',noResultsText:'No matching results',noResultsClass:'ffb-no-results',showResults:true,selectFirstMatch:true,autoCompleteFirstMatch:false,highlightMatches:true,highlightMatchesRegExModifier:'i',matchAny:true,minChars:1,showArrow:true,arrowQuery:'',onSelect:false,maxCacheBytes:32768,resultTemplate:'<font class=\'flexbox_value\' >{name}</font>',displayValue:'name',hiddenValue:'id',detailInfo:'',initialKey:'',initialValue:'',watermark:'',width:200,resultsProperty:'results',totalProperty:'totalResult',maxVisibleRows:0,dataBlockId:'',displayAll:'',paging:{style:'input',cssClass:'paging',pageSize:10,maxPageLinks:5,showSummary:true,summaryClass:'summary',summaryTemplate:'总记录{total}条,当前显示 {start}-{end}.'}};$.fn.setValue=function(val){var id='#'+this.attr('id');var sid='#'+this.attr('sid');$(sid+','+id+'_input').val(val).removeClass('watermark');};$.fn.getValue=function(){return $('#'+this.attr('sid')).val();}})(jQuery);

(function($,document,window){var
defaults={transition:"elastic",speed:300,width:false,initialWidth:"600",innerWidth:false,maxWidth:false,height:false,initialHeight:"450",innerHeight:false,maxHeight:false,scalePhotos:true,scrolling:true,inline:false,html:false,iframe:false,fastIframe:true,photo:false,href:false,title:false,rel:false,opacity:0.9,preloading:true,current:"image {current} of {total}",previous:"previous",next:"next",close:"",open:false,returnFocus:true,loop:true,slideshow:false,slideshowAuto:true,slideshowSpeed:2500,slideshowStart:"start slideshow",slideshowStop:"stop slideshow",onOpen:false,onLoad:false,onComplete:false,onCleanup:false,onClosed:false,overlayClose:true,escKey:true,arrowKey:true,top:false,bottom:false,left:false,right:false,fixed:false,data:false},colorbox='colorbox',prefix='cbox',boxElement=prefix+'Element',event_open=prefix+'_open',event_load=prefix+'_load',event_complete=prefix+'_complete',event_cleanup=prefix+'_cleanup',event_closed=prefix+'_closed',event_purge=prefix+'_purge',isIE=$.browser.msie&&!$.support.opacity,isIE6=isIE&&$.browser.version<7,event_ie6=prefix+'_IE6',$overlay,$box,$wrap,$content,$topBorder,$leftBorder,$rightBorder,$bottomBorder,$related,$window,$loaded,$loadingBay,$loadingOverlay,$title,$current,$slideshow,$next,$prev,$close,$groupControls,settings,interfaceHeight,interfaceWidth,loadedHeight,loadedWidth,element,index,photo,open,active,closing,handler,loadingTimer,publicMethod;function $div(id,cssText,div){div=document.createElement('div');if(id){div.id=prefix+id;}
div.style.cssText=cssText||'';return $(div);}
function setSize(size,dimension){return Math.round((/%/.test(size)?((dimension==='x'?$window.width():$window.height())/100):1)*parseInt(size,10));}
function isImage(url){return settings.photo||/\.(gif|png|jpg|jpeg|bmp)(?:\?([^#]*))?(?:#(\.*))?$/i.test(url);}
function makeSettings(i){settings=$.extend({},$.data(element,colorbox));for(i in settings){if($.isFunction(settings[i])&&i.substring(0,2)!=='on'){settings[i]=settings[i].call(element);}}
settings.rel=settings.rel||element.rel||'nofollow';settings.href=settings.href||$(element).attr('href');settings.title=settings.title||element.title;if(typeof settings.href==="string"){settings.href=$.trim(settings.href);}}
function trigger(event,callback){if(callback){callback.call(element);}
$.event.trigger(event);}
function slideshow(){var
timeOut,className=prefix+"Slideshow_",click="click."+prefix,start,stop,clear;if(settings.slideshow&&$related[1]){start=function(){$slideshow.text(settings.slideshowStop).unbind(click).bind(event_complete,function(){if(index<$related.length-1||settings.loop){timeOut=setTimeout(publicMethod.next,settings.slideshowSpeed);}}).bind(event_load,function(){clearTimeout(timeOut);}).one(click+' '+event_cleanup,stop);$box.removeClass(className+"off").addClass(className+"on");timeOut=setTimeout(publicMethod.next,settings.slideshowSpeed);};stop=function(){clearTimeout(timeOut);$slideshow.text(settings.slideshowStart).unbind([event_complete,event_load,event_cleanup,click].join(' ')).one(click,start);$box.removeClass(className+"on").addClass(className+"off");};if(settings.slideshowAuto){start();}else{stop();}}else{$box.removeClass(className+"off "+className+"on");}}
function launch(target){if(!closing){element=target;makeSettings();$related=$(element);index=0;if(settings.rel!=='nofollow'){$related=$('.'+boxElement).filter(function(){var relRelated=$.data(this,colorbox).rel||this.rel;return(relRelated===settings.rel);});index=$related.index(element);if(index===-1){$related=$related.add(element);index=$related.length-1;}}
if(!open){open=active=true;$box.show();if(settings.returnFocus){try{element.blur();$(element).one(event_closed,function(){try{this.focus();}catch(e){}});}catch(e){}}
$overlay.css({position:isIE6?"fixed":"absolute","opacity":+settings.opacity,"cursor":settings.overlayClose?"pointer":"auto",width:Math.min(document.body.scrollWidth,document.documentElement.scrollWidth)+"px"}).show();settings.w=setSize(settings.initialWidth,'x');settings.h=setSize(settings.initialHeight,'y');publicMethod.position();if(isIE6){$window.bind('resize.'+event_ie6+' scroll.'+event_ie6,function(){$overlay.css({width:$window.width(),height:$window.height(),top:$window.scrollTop(),left:$window.scrollLeft()});}).trigger('resize.'+event_ie6);}else{$window.bind('resize',function(){$overlay.css({position:isIE6?"fixed":"absolute","opacity":+settings.opacity,"cursor":settings.overlayClose?"pointer":"auto",width:Math.max(Math.min(document.body.scrollWidth,document.documentElement.scrollWidth),$box.width())+"px"});});}
trigger(event_open,settings.onOpen);$groupControls.add($title).hide();$close.html(settings.close).show();}
publicMethod.load(true);}}
publicMethod=$.fn[colorbox]=$[colorbox]=function(options,callback){var $this=this;options=options||{};if(!$this[0]){if($this.selector){return $this;}
$this=$('<a/>');options.open=true;}
if(callback){options.onComplete=callback;}
$this.each(function(){$.data(this,colorbox,$.extend({},$.data(this,colorbox)||defaults,options));$(this).addClass(boxElement);});if(($.isFunction(options.open)&&options.open.call($this))||options.open){launch($this[0]);}
return $this;};publicMethod.init=function(){$window=$(window);$box=$div().attr({id:colorbox,'class':isIE?prefix+(isIE6?'IE6':'IE'):''});$overlay=$div("Overlay",isIE6?'position:absolute':'').hide();$wrap=$div("Wrapper");$content=$div("Content").append($loaded=$div("LoadedContent",'width:0; height:0; overflow:hidden'),$loadingOverlay=$div("LoadingOverlay").add($div("LoadingGraphic")),$title=$div("Title"),$current=$div("Current"),$next=$div("Next"),$prev=$div("Previous"),$slideshow=$div("Slideshow").bind(event_open,slideshow),$close=$div("Close"));$wrap.append($div().append($div("TopLeft"),$topBorder=$div("TopCenter"),$div("TopRight")),$div(false,'clear:left').append($leftBorder=$div("MiddleLeft"),$content,$rightBorder=$div("MiddleRight")),$div(false,'clear:left').append($div("BottomLeft"),$bottomBorder=$div("BottomCenter"),$div("BottomRight"))).children().children().css({'float':'left'});$loadingBay=$div(false,'position:absolute; width:9999px; visibility:hidden; display:none');$('body').prepend($overlay,$box.append($wrap,$loadingBay));$content.children().hover(function(){$(this).addClass('hover');},function(){$(this).removeClass('hover');}).addClass('hover');interfaceHeight=$topBorder.height()+$bottomBorder.height()+$content.outerHeight(true)-$content.height();interfaceWidth=$leftBorder.width()+$rightBorder.width()+$content.outerWidth(true)-$content.width();loadedHeight=$loaded.outerHeight(true);loadedWidth=$loaded.outerWidth(true);$box.css({"padding-bottom":interfaceHeight,"padding-right":interfaceWidth}).hide();$next.click(function(){publicMethod.next();});$prev.click(function(){publicMethod.prev();});$close.click(function(){publicMethod.close();});$groupControls=$next.add($prev).add($current).add($slideshow);$content.children().removeClass('hover');$overlay.click(function(){if(settings.overlayClose){publicMethod.close();}});$(document).bind('keydown.'+prefix,function(e){var key=e.keyCode;if(open&&settings.escKey&&key===27){e.preventDefault();publicMethod.close();}
if(open&&settings.arrowKey&&$related[1]){if(key===37){e.preventDefault();$prev.click();}else if(key===39){e.preventDefault();$next.click();}}});};publicMethod.remove=function(){$box.add($overlay).remove();$('.'+boxElement).removeData(colorbox).removeClass(boxElement);};publicMethod.position=function(speed,loadedCallback){var top=0,left=0;$window.unbind('resize.'+prefix);$box.hide();if(settings.fixed&&!isIE6){$box.css({position:'fixed'});}else{top=$window.scrollTop();left=$window.scrollLeft();$box.css({position:'absolute'});}
if(settings.right!==false){left+=Math.max($window.width()-settings.w-loadedWidth-interfaceWidth-setSize(settings.right,'x'),0);}else if(settings.left!==false){left+=setSize(settings.left,'x');}else{left+=Math.round(Math.max($window.width()-settings.w-loadedWidth-interfaceWidth,0)/2);}
if(settings.bottom!==false){top+=Math.max(document.documentElement.clientHeight-settings.h-loadedHeight-interfaceHeight-setSize(settings.bottom,'y'),0);}else if(settings.top!==false){top+=setSize(settings.top,'y');}else{top+=Math.round(Math.max(document.documentElement.clientHeight-settings.h-loadedHeight-interfaceHeight,0)/2);}
$box.show();speed=($box.width()===settings.w+loadedWidth&&$box.height()===settings.h+loadedHeight)?0:speed||0;$wrap[0].style.width=$wrap[0].style.height="9999px";function modalDimensions(that){$topBorder[0].style.width=$bottomBorder[0].style.width=$content[0].style.width=that.style.width;$loadingOverlay[0].style.height=$loadingOverlay[1].style.height=$content[0].style.height=$leftBorder[0].style.height=$rightBorder[0].style.height=that.style.height;}
$box.dequeue().animate({width:settings.w+loadedWidth,height:settings.h+loadedHeight,top:top,left:left},{duration:speed,complete:function(){modalDimensions(this);active=false;$wrap[0].style.width=(settings.w+loadedWidth+interfaceWidth)+"px";$wrap[0].style.height=(settings.h+loadedHeight+interfaceHeight)+"px";if(loadedCallback){loadedCallback();}
setTimeout(function(){$window.bind('resize.'+prefix,publicMethod.position);},1);},step:function(){modalDimensions(this);}});};publicMethod.resize=function(options){if(open){options=options||{};if(options.width){settings.w=setSize(options.width,'x')-loadedWidth-interfaceWidth;}
if(options.innerWidth){settings.w=setSize(options.innerWidth,'x');}
$loaded.css({width:settings.w});if(options.height){settings.h=setSize(options.height,'y')-loadedHeight-interfaceHeight;}
if(options.innerHeight){settings.h=setSize(options.innerHeight,'y');}
if(!options.innerHeight&&!options.height){var $child=$loaded.wrapInner("<div style='overflow:auto'></div>").children();settings.h=$child.height();$child.replaceWith($child.children());}
$loaded.css({height:settings.h});publicMethod.position(settings.transition==="none"?0:settings.speed);}};publicMethod.prep=function(object){if(!open){return;}
var callback,speed=settings.transition==="none"?0:settings.speed;$loaded.remove();$loaded=$div('LoadedContent').append(object);function getWidth(){settings.w=settings.w||$loaded.width();settings.w=settings.mw&&settings.mw<settings.w?settings.mw:settings.w;return settings.w;}
function getHeight(){settings.h=settings.h||$loaded.height();settings.h=settings.mh&&settings.mh<settings.h?settings.mh:settings.h;return settings.h;}
$loaded.hide().appendTo($loadingBay.show()).css({width:getWidth(),overflow:settings.scrolling?'auto':'hidden'}).css({height:getHeight()}).prependTo($content);$loadingBay.hide();$(photo).css({'float':'none'});if(isIE6){$('select').not($box.find('select')).filter(function(){return this.style.visibility!=='hidden';}).css({'visibility':'hidden'}).one(event_cleanup,function(){this.style.visibility='inherit';});}
callback=function(){var prev,prevSrc,next,nextSrc,total=$related.length,iframe,complete;if(!open){return;}
function removeFilter(){if(isIE){$box[0].style.removeAttribute('filter');}}
complete=function(){clearTimeout(loadingTimer);$loadingOverlay.hide();trigger(event_complete,settings.onComplete);};if(isIE){if(photo){$loaded.fadeIn(100);}}
$title.html(settings.title).add($loaded).show();if(total>1){if(typeof settings.current==="string"){$current.html(settings.current.replace('{current}',index+1).replace('{total}',total)).show();}
$next[(settings.loop||index<total-1)?"show":"hide"]().html(settings.next);$prev[(settings.loop||index)?"show":"hide"]().html(settings.previous);prev=index?$related[index-1]:$related[total-1];next=index<total-1?$related[index+1]:$related[0];if(settings.slideshow){$slideshow.show();}
if(settings.preloading){nextSrc=$.data(next,colorbox).href||next.href;prevSrc=$.data(prev,colorbox).href||prev.href;nextSrc=$.isFunction(nextSrc)?nextSrc.call(next):nextSrc;prevSrc=$.isFunction(prevSrc)?prevSrc.call(prev):prevSrc;if(isImage(nextSrc)){$('<img/>')[0].src=nextSrc;}
if(isImage(prevSrc)){$('<img/>')[0].src=prevSrc;}}}else{$groupControls.hide();}
if(settings.iframe){iframe=$('<iframe/>').addClass(prefix+'Iframe')[0];if(settings.fastIframe){complete();}else{$(iframe).one('load',complete);}
iframe.name=prefix+(+new Date());iframe.src=settings.href;if(!settings.scrolling){iframe.scrolling="no";}
if(isIE){iframe.frameBorder=0;iframe.allowTransparency="true";}
$(iframe).appendTo($loaded).one(event_purge,function(){iframe.src="//about:blank";});}else{complete();}
if(settings.transition==='fade'){$box.fadeTo(speed,1,removeFilter);}else{removeFilter();}};if(settings.transition==='fade'){$box.fadeTo(speed,0,function(){publicMethod.position(0,callback);});}else{publicMethod.position(speed,callback);}};publicMethod.load=function(launched){var href,setResize,prep=publicMethod.prep;active=true;photo=false;element=$related[index];if(!launched){makeSettings();}
trigger(event_purge);trigger(event_load,settings.onLoad);settings.h=settings.height?setSize(settings.height,'y')-loadedHeight-interfaceHeight:settings.innerHeight&&setSize(settings.innerHeight,'y');settings.w=settings.width?setSize(settings.width,'x')-loadedWidth-interfaceWidth:settings.innerWidth&&setSize(settings.innerWidth,'x');settings.mw=settings.w;settings.mh=settings.h;if(settings.maxWidth){settings.mw=setSize(settings.maxWidth,'x')-loadedWidth-interfaceWidth;settings.mw=settings.w&&settings.w<settings.mw?settings.w:settings.mw;}
if(settings.maxHeight){settings.mh=setSize(settings.maxHeight,'y')-loadedHeight-interfaceHeight;settings.mh=settings.h&&settings.h<settings.mh?settings.h:settings.mh;}
href=settings.href;loadingTimer=setTimeout(function(){$loadingOverlay.show();},100);if(settings.inline){$div().hide().insertBefore($(href)[0]).one(event_purge,function(){$(this).replaceWith($loaded.children());});prep($(href));}else if(settings.iframe){prep(" ");}else if(settings.html){prep(settings.html);}else if(isImage(href)){$(photo=new Image()).addClass(prefix+'Photo').error(function(){settings.title=false;prep($div('Error').text('This image could not be loaded'));}).load(function(){var percent;photo.onload=null;if(settings.scalePhotos){setResize=function(){photo.height-=photo.height*percent;photo.width-=photo.width*percent;};if(settings.mw&&photo.width>settings.mw){percent=(photo.width-settings.mw)/photo.width;setResize();}
if(settings.mh&&photo.height>settings.mh){percent=(photo.height-settings.mh)/photo.height;setResize();}}
if(settings.h){photo.style.marginTop=Math.max(settings.h-photo.height,0)/2+'px';}
if($related[1]&&(index<$related.length-1||settings.loop)){photo.style.cursor='pointer';photo.onclick=function(){publicMethod.next();};}
if(isIE){photo.style.msInterpolationMode='bicubic';}
setTimeout(function(){prep(photo);},1);});setTimeout(function(){photo.src=href;},1);}else if(href){$loadingBay.load(href,settings.data,function(data,status,xhr){prep(status==='error'?$div('Error').text('Request unsuccessful: '+xhr.statusText):$(this).contents());});}};publicMethod.next=function(){if(!active&&$related[1]&&(index<$related.length-1||settings.loop)){index=index<$related.length-1?index+1:0;publicMethod.load();}};publicMethod.prev=function(){if(!active&&$related[1]&&(index||settings.loop)){index=index?index-1:$related.length-1;publicMethod.load();}};publicMethod.close=function(){if(open&&!closing){closing=true;open=false;trigger(event_cleanup,settings.onCleanup);$window.unbind('.'+prefix+' .'+event_ie6);$overlay.fadeTo(200,0);$box.stop().fadeTo(300,0,function(){$box.add($overlay).css({'opacity':1,cursor:'auto'}).hide();trigger(event_purge);$loaded.remove();setTimeout(function(){closing=false;trigger(event_closed,settings.onClosed);},1);});}};publicMethod.element=function(){return $(element);};publicMethod.settings=defaults;handler=function(e){if(!((e.button!==0&&typeof e.button!=='undefined')||e.ctrlKey||e.shiftKey||e.altKey)){e.preventDefault();launch(this);}};if($.fn.delegate){$(document).delegate('.'+boxElement,'click',handler);}else{$('.'+boxElement).live('click',handler);}
$(publicMethod.init);EFColorbox=function(options,callback){$.fn.colorbox(options,callback);};}(jQuery,document,this));

var SWFUpload;if(SWFUpload==undefined){SWFUpload=function(settings){this.initSWFUpload(settings);};}
SWFUpload.prototype.initSWFUpload=function(settings){try{this.customSettings={};this.settings=settings;this.eventQueue=[];this.movieName="SWFUpload_"+SWFUpload.movieCount++;this.movieElement=null;SWFUpload.instances[this.movieName]=this;this.initSettings();this.loadFlash();this.displayDebugInfo();}catch(ex){delete SWFUpload.instances[this.movieName];throw ex;}};SWFUpload.instances={};SWFUpload.movieCount=0;SWFUpload.version="2.2.0 2009-03-25";SWFUpload.QUEUE_ERROR={QUEUE_LIMIT_EXCEEDED:-100,FILE_EXCEEDS_SIZE_LIMIT:-110,ZERO_BYTE_FILE:-120,INVALID_FILETYPE:-130};SWFUpload.UPLOAD_ERROR={HTTP_ERROR:-200,MISSING_UPLOAD_URL:-210,IO_ERROR:-220,SECURITY_ERROR:-230,UPLOAD_LIMIT_EXCEEDED:-240,UPLOAD_FAILED:-250,SPECIFIED_FILE_ID_NOT_FOUND:-260,FILE_VALIDATION_FAILED:-270,FILE_CANCELLED:-280,UPLOAD_STOPPED:-290};SWFUpload.FILE_STATUS={QUEUED:-1,IN_PROGRESS:-2,ERROR:-3,COMPLETE:-4,CANCELLED:-5};SWFUpload.BUTTON_ACTION={SELECT_FILE:-100,SELECT_FILES:-110,START_UPLOAD:-120};SWFUpload.CURSOR={ARROW:-1,HAND:-2};SWFUpload.WINDOW_MODE={WINDOW:"window",TRANSPARENT:"transparent",OPAQUE:"opaque"};SWFUpload.completeURL=function(url){if(typeof(url)!=="string"||url.match(/^https?:\/\//i)||url.match(/^\//)){return url;}
var currentURL=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"");var indexSlash=window.location.pathname.lastIndexOf("/");if(indexSlash<=0){path="/";}else{path=window.location.pathname.substr(0,indexSlash)+"/";}
return path+url;};SWFUpload.prototype.initSettings=function(){this.ensureDefault=function(settingName,defaultValue){this.settings[settingName]=(this.settings[settingName]==undefined)?defaultValue:this.settings[settingName];};this.ensureDefault("upload_url","");this.ensureDefault("preserve_relative_urls",false);this.ensureDefault("file_post_name","Filedata");this.ensureDefault("post_params",{});this.ensureDefault("use_query_string",false);this.ensureDefault("requeue_on_error",false);this.ensureDefault("http_success",[]);this.ensureDefault("assume_success_timeout",0);this.ensureDefault("file_types","*.*");this.ensureDefault("file_types_description","All Files");this.ensureDefault("file_size_limit",0);this.ensureDefault("file_upload_limit",0);this.ensureDefault("file_queue_limit",0);this.ensureDefault("flash_url","swfupload.swf");this.ensureDefault("prevent_swf_caching",true);this.ensureDefault("button_image_url","");this.ensureDefault("button_width",1);this.ensureDefault("button_height",1);this.ensureDefault("button_text","");this.ensureDefault("button_text_style","color: #000000; font-size: 16pt;");this.ensureDefault("button_text_top_padding",0);this.ensureDefault("button_text_left_padding",0);this.ensureDefault("button_action",SWFUpload.BUTTON_ACTION.SELECT_FILES);this.ensureDefault("button_disabled",false);this.ensureDefault("button_placeholder_id","");this.ensureDefault("button_placeholder",null);this.ensureDefault("button_cursor",SWFUpload.CURSOR.ARROW);this.ensureDefault("button_window_mode",SWFUpload.WINDOW_MODE.WINDOW);this.ensureDefault("debug",false);this.settings.debug_enabled=this.settings.debug;this.settings.return_upload_start_handler=this.returnUploadStart;this.ensureDefault("swfupload_loaded_handler",null);this.ensureDefault("file_dialog_start_handler",null);this.ensureDefault("file_queued_handler",null);this.ensureDefault("file_queue_error_handler",null);this.ensureDefault("file_dialog_complete_handler",null);this.ensureDefault("upload_start_handler",null);this.ensureDefault("upload_progress_handler",null);this.ensureDefault("upload_error_handler",null);this.ensureDefault("upload_success_handler",null);this.ensureDefault("upload_complete_handler",null);this.ensureDefault("debug_handler",this.debugMessage);this.ensureDefault("custom_settings",{});this.customSettings=this.settings.custom_settings;if(!!this.settings.prevent_swf_caching){this.settings.flash_url=this.settings.flash_url+(this.settings.flash_url.indexOf("?")<0?"?":"&")+"preventswfcaching="+new Date().getTime();}
if(!this.settings.preserve_relative_urls){this.settings.upload_url=SWFUpload.completeURL(this.settings.upload_url);this.settings.button_image_url=SWFUpload.completeURL(this.settings.button_image_url);}
delete this.ensureDefault;};SWFUpload.prototype.loadFlash=function(){var targetElement,tempParent;if(document.getElementById(this.movieName)!==null){throw"ID "+this.movieName+" is already in use. The Flash Object could not be added";}
targetElement=document.getElementById(this.settings.button_placeholder_id)||this.settings.button_placeholder;if(targetElement==undefined){throw"Could not find the placeholder element: "+this.settings.button_placeholder_id;}
tempParent=document.createElement("div");tempParent.innerHTML=this.getFlashHTML();targetElement.parentNode.replaceChild(tempParent.firstChild,targetElement);if(window[this.movieName]==undefined){window[this.movieName]=this.getMovieElement();}};SWFUpload.prototype.getFlashHTML=function(){return['<object id="',this.movieName,'" type="application/x-shockwave-flash" data="',this.settings.flash_url,'" width="',this.settings.button_width,'" height="',this.settings.button_height,'" class="swfupload">','<param name="wmode" value="',this.settings.button_window_mode,'" />','<param name="movie" value="',this.settings.flash_url,'" />','<param name="quality" value="high" />','<param name="menu" value="false" />','<param name="allowScriptAccess" value="always" />','<param name="flashvars" value="'+this.getFlashVars()+'" />','</object>'].join("");};SWFUpload.prototype.getFlashVars=function(){var paramString=this.buildParamString();var httpSuccessString=this.settings.http_success.join(",");return["movieName=",encodeURIComponent(this.movieName),"&amp;uploadURL=",encodeURIComponent(this.settings.upload_url),"&amp;useQueryString=",encodeURIComponent(this.settings.use_query_string),"&amp;requeueOnError=",encodeURIComponent(this.settings.requeue_on_error),"&amp;httpSuccess=",encodeURIComponent(httpSuccessString),"&amp;assumeSuccessTimeout=",encodeURIComponent(this.settings.assume_success_timeout),"&amp;params=",encodeURIComponent(paramString),"&amp;filePostName=",encodeURIComponent(this.settings.file_post_name),"&amp;fileTypes=",encodeURIComponent(this.settings.file_types),"&amp;fileTypesDescription=",encodeURIComponent(this.settings.file_types_description),"&amp;fileSizeLimit=",encodeURIComponent(this.settings.file_size_limit),"&amp;fileUploadLimit=",encodeURIComponent(this.settings.file_upload_limit),"&amp;fileQueueLimit=",encodeURIComponent(this.settings.file_queue_limit),"&amp;debugEnabled=",encodeURIComponent(this.settings.debug_enabled),"&amp;buttonImageURL=",encodeURIComponent(this.settings.button_image_url),"&amp;buttonWidth=",encodeURIComponent(this.settings.button_width),"&amp;buttonHeight=",encodeURIComponent(this.settings.button_height),"&amp;buttonText=",encodeURIComponent(this.settings.button_text),"&amp;buttonTextTopPadding=",encodeURIComponent(this.settings.button_text_top_padding),"&amp;buttonTextLeftPadding=",encodeURIComponent(this.settings.button_text_left_padding),"&amp;buttonTextStyle=",encodeURIComponent(this.settings.button_text_style),"&amp;buttonAction=",encodeURIComponent(this.settings.button_action),"&amp;buttonDisabled=",encodeURIComponent(this.settings.button_disabled),"&amp;buttonCursor=",encodeURIComponent(this.settings.button_cursor)].join("");};SWFUpload.prototype.getMovieElement=function(){if(this.movieElement==undefined){this.movieElement=document.getElementById(this.movieName);}
if(this.movieElement===null){throw"Could not find Flash element";}
return this.movieElement;};SWFUpload.prototype.buildParamString=function(){var postParams=this.settings.post_params;var paramStringPairs=[];if(typeof(postParams)==="object"){for(var name in postParams){if(postParams.hasOwnProperty(name)){paramStringPairs.push(encodeURIComponent(name.toString())+"="+encodeURIComponent(postParams[name].toString()));}}}
return paramStringPairs.join("&amp;");};SWFUpload.prototype.destroy=function(){try{this.cancelUpload(null,false);var movieElement=null;movieElement=this.getMovieElement();if(movieElement&&typeof(movieElement.CallFunction)==="unknown"){for(var i in movieElement){try{if(typeof(movieElement[i])==="function"){movieElement[i]=null;}}catch(ex1){}}
try{movieElement.parentNode.removeChild(movieElement);}catch(ex){}}
window[this.movieName]=null;SWFUpload.instances[this.movieName]=null;delete SWFUpload.instances[this.movieName];this.movieElement=null;this.settings=null;this.customSettings=null;this.eventQueue=null;this.movieName=null;return true;}catch(ex2){return false;}};SWFUpload.prototype.displayDebugInfo=function(){this.debug(["---SWFUpload Instance Info---\n","Version: ",SWFUpload.version,"\n","Movie Name: ",this.movieName,"\n","Settings:\n","\t","upload_url:               ",this.settings.upload_url,"\n","\t","flash_url:                ",this.settings.flash_url,"\n","\t","use_query_string:         ",this.settings.use_query_string.toString(),"\n","\t","requeue_on_error:         ",this.settings.requeue_on_error.toString(),"\n","\t","http_success:             ",this.settings.http_success.join(", "),"\n","\t","assume_success_timeout:   ",this.settings.assume_success_timeout,"\n","\t","file_post_name:           ",this.settings.file_post_name,"\n","\t","post_params:              ",this.settings.post_params.toString(),"\n","\t","file_types:               ",this.settings.file_types,"\n","\t","file_types_description:   ",this.settings.file_types_description,"\n","\t","file_size_limit:          ",this.settings.file_size_limit,"\n","\t","file_upload_limit:        ",this.settings.file_upload_limit,"\n","\t","file_queue_limit:         ",this.settings.file_queue_limit,"\n","\t","debug:                    ",this.settings.debug.toString(),"\n","\t","prevent_swf_caching:      ",this.settings.prevent_swf_caching.toString(),"\n","\t","button_placeholder_id:    ",this.settings.button_placeholder_id.toString(),"\n","\t","button_placeholder:       ",(this.settings.button_placeholder?"Set":"Not Set"),"\n","\t","button_image_url:         ",this.settings.button_image_url.toString(),"\n","\t","button_width:             ",this.settings.button_width.toString(),"\n","\t","button_height:            ",this.settings.button_height.toString(),"\n","\t","button_text:              ",this.settings.button_text.toString(),"\n","\t","button_text_style:        ",this.settings.button_text_style.toString(),"\n","\t","button_text_top_padding:  ",this.settings.button_text_top_padding.toString(),"\n","\t","button_text_left_padding: ",this.settings.button_text_left_padding.toString(),"\n","\t","button_action:            ",this.settings.button_action.toString(),"\n","\t","button_disabled:          ",this.settings.button_disabled.toString(),"\n","\t","custom_settings:          ",this.settings.custom_settings.toString(),"\n","Event Handlers:\n","\t","swfupload_loaded_handler assigned:  ",(typeof this.settings.swfupload_loaded_handler==="function").toString(),"\n","\t","file_dialog_start_handler assigned: ",(typeof this.settings.file_dialog_start_handler==="function").toString(),"\n","\t","file_queued_handler assigned:       ",(typeof this.settings.file_queued_handler==="function").toString(),"\n","\t","file_queue_error_handler assigned:  ",(typeof this.settings.file_queue_error_handler==="function").toString(),"\n","\t","upload_start_handler assigned:      ",(typeof this.settings.upload_start_handler==="function").toString(),"\n","\t","upload_progress_handler assigned:   ",(typeof this.settings.upload_progress_handler==="function").toString(),"\n","\t","upload_error_handler assigned:      ",(typeof this.settings.upload_error_handler==="function").toString(),"\n","\t","upload_success_handler assigned:    ",(typeof this.settings.upload_success_handler==="function").toString(),"\n","\t","upload_complete_handler assigned:   ",(typeof this.settings.upload_complete_handler==="function").toString(),"\n","\t","debug_handler assigned:             ",(typeof this.settings.debug_handler==="function").toString(),"\n"].join(""));};SWFUpload.prototype.addSetting=function(name,value,default_value){if(value==undefined){return(this.settings[name]=default_value);}else{return(this.settings[name]=value);}};SWFUpload.prototype.getSetting=function(name){if(this.settings[name]!=undefined){return this.settings[name];}
return"";};SWFUpload.prototype.callFlash=function(functionName,argumentArray){argumentArray=argumentArray||[];var movieElement=this.getMovieElement();var returnValue,returnString;try{returnString=movieElement.CallFunction('<invoke name="'+functionName+'" returntype="javascript">'+__flash__argumentsToXML(argumentArray,0)+'</invoke>');returnValue=eval(returnString);}catch(ex){throw"Call to "+functionName+" failed";}
if(returnValue!=undefined&&typeof returnValue.post==="object"){returnValue=this.unescapeFilePostParams(returnValue);}
return returnValue;};SWFUpload.prototype.selectFile=function(){this.callFlash("SelectFile");};SWFUpload.prototype.selectFiles=function(){this.callFlash("SelectFiles");};SWFUpload.prototype.startUpload=function(fileID){this.callFlash("StartUpload",[fileID]);};SWFUpload.prototype.cancelUpload=function(fileID,triggerErrorEvent){if(triggerErrorEvent!==false){triggerErrorEvent=true;}
this.callFlash("CancelUpload",[fileID,triggerErrorEvent]);};SWFUpload.prototype.stopUpload=function(){this.callFlash("StopUpload");};SWFUpload.prototype.getStats=function(){return this.callFlash("GetStats");};SWFUpload.prototype.setStats=function(statsObject){this.callFlash("SetStats",[statsObject]);};SWFUpload.prototype.getFile=function(fileID){if(typeof(fileID)==="number"){return this.callFlash("GetFileByIndex",[fileID]);}else{return this.callFlash("GetFile",[fileID]);}};SWFUpload.prototype.addFileParam=function(fileID,name,value){return this.callFlash("AddFileParam",[fileID,name,value]);};SWFUpload.prototype.removeFileParam=function(fileID,name){this.callFlash("RemoveFileParam",[fileID,name]);};SWFUpload.prototype.setUploadURL=function(url){this.settings.upload_url=url.toString();this.callFlash("SetUploadURL",[url]);this.loadFlash();};SWFUpload.prototype.setPostParams=function(paramsObject){this.settings.post_params=paramsObject;this.callFlash("SetPostParams",[paramsObject]);};SWFUpload.prototype.addPostParam=function(name,value){this.settings.post_params[name]=value;this.callFlash("SetPostParams",[this.settings.post_params]);};SWFUpload.prototype.removePostParam=function(name){delete this.settings.post_params[name];this.callFlash("SetPostParams",[this.settings.post_params]);};SWFUpload.prototype.setFileTypes=function(types,description){this.settings.file_types=types;this.settings.file_types_description=description;this.callFlash("SetFileTypes",[types,description]);};SWFUpload.prototype.setFileSizeLimit=function(fileSizeLimit){this.settings.file_size_limit=fileSizeLimit;this.callFlash("SetFileSizeLimit",[fileSizeLimit]);};SWFUpload.prototype.setFileUploadLimit=function(fileUploadLimit){this.settings.file_upload_limit=fileUploadLimit;this.callFlash("SetFileUploadLimit",[fileUploadLimit]);};SWFUpload.prototype.setFileQueueLimit=function(fileQueueLimit){this.settings.file_queue_limit=fileQueueLimit;this.callFlash("SetFileQueueLimit",[fileQueueLimit]);};SWFUpload.prototype.setFilePostName=function(filePostName){this.settings.file_post_name=filePostName;this.callFlash("SetFilePostName",[filePostName]);};SWFUpload.prototype.setUseQueryString=function(useQueryString){this.settings.use_query_string=useQueryString;this.callFlash("SetUseQueryString",[useQueryString]);};SWFUpload.prototype.setRequeueOnError=function(requeueOnError){this.settings.requeue_on_error=requeueOnError;this.callFlash("SetRequeueOnError",[requeueOnError]);};SWFUpload.prototype.setHTTPSuccess=function(http_status_codes){if(typeof http_status_codes==="string"){http_status_codes=http_status_codes.replace(" ","").split(",");}
this.settings.http_success=http_status_codes;this.callFlash("SetHTTPSuccess",[http_status_codes]);};SWFUpload.prototype.setAssumeSuccessTimeout=function(timeout_seconds){this.settings.assume_success_timeout=timeout_seconds;this.callFlash("SetAssumeSuccessTimeout",[timeout_seconds]);};SWFUpload.prototype.setDebugEnabled=function(debugEnabled){this.settings.debug_enabled=debugEnabled;this.callFlash("SetDebugEnabled",[debugEnabled]);};SWFUpload.prototype.setButtonImageURL=function(buttonImageURL){if(buttonImageURL==undefined){buttonImageURL="";}
this.settings.button_image_url=buttonImageURL;this.callFlash("SetButtonImageURL",[buttonImageURL]);};SWFUpload.prototype.setButtonDimensions=function(width,height){this.settings.button_width=width;this.settings.button_height=height;var movie=this.getMovieElement();if(movie!=undefined){movie.style.width=width+"px";movie.style.height=height+"px";}
this.callFlash("SetButtonDimensions",[width,height]);};SWFUpload.prototype.setButtonText=function(html){this.settings.button_text=html;this.callFlash("SetButtonText",[html]);};SWFUpload.prototype.setButtonTextPadding=function(left,top){this.settings.button_text_top_padding=top;this.settings.button_text_left_padding=left;this.callFlash("SetButtonTextPadding",[left,top]);};SWFUpload.prototype.setButtonTextStyle=function(css){this.settings.button_text_style=css;this.callFlash("SetButtonTextStyle",[css]);};SWFUpload.prototype.setButtonDisabled=function(isDisabled){this.settings.button_disabled=isDisabled;this.callFlash("SetButtonDisabled",[isDisabled]);};SWFUpload.prototype.setButtonAction=function(buttonAction){this.settings.button_action=buttonAction;this.callFlash("SetButtonAction",[buttonAction]);};SWFUpload.prototype.setButtonCursor=function(cursor){this.settings.button_cursor=cursor;this.callFlash("SetButtonCursor",[cursor]);};SWFUpload.prototype.queueEvent=function(handlerName,argumentArray){if(argumentArray==undefined){argumentArray=[];}else if(!(argumentArray instanceof Array)){argumentArray=[argumentArray];}
var self=this;if(typeof this.settings[handlerName]==="function"){this.eventQueue.push(function(){this.settings[handlerName].apply(this,argumentArray);});setTimeout(function(){self.executeNextEvent();},0);}else if(this.settings[handlerName]!==null){throw"Event handler "+handlerName+" is unknown or is not a function";}};SWFUpload.prototype.executeNextEvent=function(){var f=this.eventQueue?this.eventQueue.shift():null;if(typeof(f)==="function"){f.apply(this);}};SWFUpload.prototype.unescapeFilePostParams=function(file){var reg=/[$]([0-9a-f]{4})/i;var unescapedPost={};var uk;if(file!=undefined){for(var k in file.post){if(file.post.hasOwnProperty(k)){uk=k;var match;while((match=reg.exec(uk))!==null){uk=uk.replace(match[0],String.fromCharCode(parseInt("0x"+match[1],16)));}
unescapedPost[uk]=file.post[k];}}
file.post=unescapedPost;}
return file;};SWFUpload.prototype.testExternalInterface=function(){try{return this.callFlash("TestExternalInterface");}catch(ex){return false;}};SWFUpload.prototype.flashReady=function(){var movieElement=this.getMovieElement();if(!movieElement){this.debug("Flash called back ready but the flash movie can't be found.");return;}
this.cleanUp(movieElement);this.queueEvent("swfupload_loaded_handler");};SWFUpload.prototype.cleanUp=function(movieElement){try{if(this.movieElement&&typeof(movieElement.CallFunction)==="unknown"){this.debug("Removing Flash functions hooks (this should only run in IE and should prevent memory leaks)");for(var key in movieElement){try{if(typeof(movieElement[key])==="function"){movieElement[key]=null;}}catch(ex){}}}}catch(ex1){}
window["__flash__removeCallback"]=function(instance,name){try{if(instance){instance[name]=null;}}catch(flashEx){}};};SWFUpload.prototype.fileDialogStart=function(){this.queueEvent("file_dialog_start_handler");};SWFUpload.prototype.fileQueued=function(file){file=this.unescapeFilePostParams(file);this.queueEvent("file_queued_handler",file);};SWFUpload.prototype.fileQueueError=function(file,errorCode,message){file=this.unescapeFilePostParams(file);this.queueEvent("file_queue_error_handler",[file,errorCode,message]);};SWFUpload.prototype.fileDialogComplete=function(numFilesSelected,numFilesQueued,numFilesInQueue){this.queueEvent("file_dialog_complete_handler",[numFilesSelected,numFilesQueued,numFilesInQueue]);};SWFUpload.prototype.uploadStart=function(file){file=this.unescapeFilePostParams(file);this.queueEvent("return_upload_start_handler",file);};SWFUpload.prototype.returnUploadStart=function(file){var returnValue;if(typeof this.settings.upload_start_handler==="function"){file=this.unescapeFilePostParams(file);returnValue=this.settings.upload_start_handler.call(this,file);}else if(this.settings.upload_start_handler!=undefined){throw"upload_start_handler must be a function";}
if(returnValue===undefined){returnValue=true;}
returnValue=!!returnValue;this.callFlash("ReturnUploadStart",[returnValue]);};SWFUpload.prototype.uploadProgress=function(file,bytesComplete,bytesTotal){file=this.unescapeFilePostParams(file);this.queueEvent("upload_progress_handler",[file,bytesComplete,bytesTotal]);};SWFUpload.prototype.uploadError=function(file,errorCode,message){file=this.unescapeFilePostParams(file);this.queueEvent("upload_error_handler",[file,errorCode,message]);};SWFUpload.prototype.uploadSuccess=function(file,serverData,responseReceived){file=this.unescapeFilePostParams(file);this.queueEvent("upload_success_handler",[file,serverData,responseReceived]);};SWFUpload.prototype.uploadComplete=function(file){file=this.unescapeFilePostParams(file);this.queueEvent("upload_complete_handler",file);};SWFUpload.prototype.debug=function(message){this.queueEvent("debug_handler",message);};SWFUpload.prototype.debugMessage=function(message){if(this.settings.debug){var exceptionMessage,exceptionValues=[];if(typeof message==="object"&&typeof message.name==="string"&&typeof message.message==="string"){for(var key in message){if(message.hasOwnProperty(key)){exceptionValues.push(key+": "+message[key]);}}
exceptionMessage=exceptionValues.join("\n")||"";exceptionValues=exceptionMessage.split("\n");exceptionMessage="EXCEPTION: "+exceptionValues.join("\nEXCEPTION: ");SWFUpload.Console.writeLine(exceptionMessage);}else{SWFUpload.Console.writeLine(message);}}};SWFUpload.Console={};SWFUpload.Console.writeLine=function(message){var console,documentForm;try{console=document.getElementById("SWFUpload_Console");if(!console){documentForm=document.createElement("form");document.getElementsByTagName("body")[0].appendChild(documentForm);console=document.createElement("textarea");console.id="SWFUpload_Console";console.style.fontFamily="monospace";console.setAttribute("wrap","off");console.wrap="off";console.style.overflow="auto";console.style.width="700px";console.style.height="350px";console.style.margin="5px";documentForm.appendChild(console);}
console.value+=message+"\n";console.scrollTop=console.scrollHeight-console.clientHeight;}catch(ex){alert("Exception: "+ex.name+" Message: "+ex.message);}};

var SWFUpload;if(typeof(SWFUpload)==="function"){SWFUpload.queue={};SWFUpload.prototype.initSettings=(function(oldInitSettings){return function(){if(typeof(oldInitSettings)==="function"){oldInitSettings.call(this);}
this.queueSettings={};this.queueSettings.queue_cancelled_flag=false;this.queueSettings.queue_upload_count=0;this.queueSettings.user_upload_complete_handler=this.settings.upload_complete_handler;this.queueSettings.user_upload_start_handler=this.settings.upload_start_handler;this.settings.upload_complete_handler=SWFUpload.queue.uploadCompleteHandler;this.settings.upload_start_handler=SWFUpload.queue.uploadStartHandler;this.settings.queue_complete_handler=this.settings.queue_complete_handler||null;};})(SWFUpload.prototype.initSettings);SWFUpload.prototype.startUpload=function(fileID){this.queueSettings.queue_cancelled_flag=false;this.callFlash("StartUpload",[fileID]);};SWFUpload.prototype.cancelQueue=function(){this.queueSettings.queue_cancelled_flag=true;this.stopUpload();var stats=this.getStats();while(stats.files_queued>0){this.cancelUpload();stats=this.getStats();}};SWFUpload.queue.uploadStartHandler=function(file){var returnValue;if(typeof(this.queueSettings.user_upload_start_handler)==="function"){returnValue=this.queueSettings.user_upload_start_handler.call(this,file);}
returnValue=(returnValue===false)?false:true;this.queueSettings.queue_cancelled_flag=!returnValue;return returnValue;};SWFUpload.queue.uploadCompleteHandler=function(file){var user_upload_complete_handler=this.queueSettings.user_upload_complete_handler;var continueUpload;if(file.filestatus===SWFUpload.FILE_STATUS.COMPLETE){this.queueSettings.queue_upload_count++;}
if(typeof(user_upload_complete_handler)==="function"){continueUpload=(user_upload_complete_handler.call(this,file)===false)?false:true;}else if(file.filestatus===SWFUpload.FILE_STATUS.QUEUED){continueUpload=false;}else{continueUpload=true;}
if(continueUpload){var stats=this.getStats();if(stats.files_queued>0&&this.queueSettings.queue_cancelled_flag===false){this.startUpload();}else if(this.queueSettings.queue_cancelled_flag===false){this.queueEvent("queue_complete_handler",[this.queueSettings.queue_upload_count]);this.queueSettings.queue_upload_count=0;}else{this.queueSettings.queue_cancelled_flag=false;this.queueSettings.queue_upload_count=0;}}};}

function cancelQueue(instance){document.getElementById(instance.customSettings.cancelButtonId).disabled=true;instance.stopUpload();var stats;do{stats=instance.getStats();instance.cancelUpload();}while(stats.files_queued!==0);}
function fileDialogStart(){}
function fileQueued(file){try{var progress=new FileProgress(file,this.grid);progress.setStatus("Pending...");progress.toggleCancel(true,this);}catch(ex){this.debug(ex);}}
function tableFileQueued(file){try{var progress;if(progressType.isColumn){progress=new ColumnProgress(file,this.settings.grid);}else{progress=new TableProgress(file,this.settings.grid);}
progress.setStatus("Pending...");progress.toggleCancel(true,this);}catch(ex){this.debug(ex);}}
function tableQueueError(file,errorCode,message){try{if(errorCode===SWFUpload.QUEUE_ERROR.QUEUE_LIMIT_EXCEEDED){alert("You have attempted to queue too many files.\n"+(message===0?"You have reached the upload limit.":"You may select "+(message>1?"up to "+message+" files.":"one file.")));return;}
var progress;if(progressType.isColumn){progress=new ColumnProgress(file,this.settings.grid);}else{progress=new TableProgress(file,this.settings.grid);}
progress.setError();progress.toggleCancel(false);dealErrorCode(file,progress,errorCode)}catch(ex){this.debug(ex);}}
function tableUploadStart(file){try{var id=$("#"+$(".fileUpload").attr("cellName")).val();if(id!=""&&id!="0"){if(this.settings.upload_url.indexOf("document_ID")<0){this.settings.upload_url+="&document_ID"+"="+id;}else{this.settings.upload_url=this.settings.upload_url.substring(0,this.settings.upload_url.indexOf("document_ID"));this.settings.upload_url+="document_ID="+id;}
this.setUploadURL(this.settings.upload_url);}else{if(this.settings.upload_url.indexOf("document_ID")>=0){this.settings.upload_url=this.settings.upload_url.substring(0,this.settings.upload_url.indexOf("document_ID"));}
this.setUploadURL(this.settings.upload_url);}
var progress;if(progressType.isColumn){progress=new ColumnProgress(file,this.settings.grid);}else{progress=new TableProgress(file,this.settings.grid);}
progress.setStatus("上传中...");progress.toggleCancel(true,this);}
catch(ex){}
return true;}
function tableUploadProgress(file,bytesLoaded,bytesTotal){try{var percent=Math.ceil((bytesLoaded/bytesTotal)*100);var progress;if(progressType.isColumn){progress=new ColumnProgress(file,this.settings.grid);}else{progress=new TableProgress(file,this.settings.grid);}
progress.setProgress(percent);progress.setStatus("上传中...");}catch(ex){this.debug(ex);}}
function tableUploadError(file,errorCode,message){try{var progress;if(progressType.isColumn){progress=new ColumnProgress(file,this.settings.grid);}else{progress=new TableProgress(file,this.settings.grid);}
progress.setError();progress.toggleCancel(false);dealUploadError(file,errorCode,message,progress);}catch(ex){this.debug(ex);}}
function tableUploadSuccess(file,serverData){try{var progress;if(progressType.isColumn){progress=new ColumnProgress(file,this.settings.grid);}else{progress=new TableProgress(file,this.settings.grid);}
var returnValue=eval("("+serverData+")");if(returnValue["attachmentID"]){progress.setComplete(returnValue["attachmentID"],this.settings.delete_url,this.settings.download_url,createTableTr,returnValue["documentID"]);}else{progress.setComplete(null);}
ef.get($(".fileUpload").attr("cellName")).value=returnValue["documentID"];if(returnValue["documentID"]&&this.settings.upload_url.indexOf(this.settings.documentId)<0){this.settings.upload_url+="&document_ID"+"="+returnValue["documentID"];this.setUploadURL(this.settings.upload_url);}
progress.toggleCancel(false);}catch(ex){this.debug(ex);}}
function fileQueueError(file,errorCode,message){try{if(errorCode===SWFUpload.QUEUE_ERROR.QUEUE_LIMIT_EXCEEDED){alert("You have attempted to queue too many files.\n"+(message===0?"You have reached the upload limit.":"You may select "+(message>1?"up to "+message+" files.":"one file.")));return;}
var progress=new FileProgress(file,this.customSettings.progressTarget);progress.setError();progress.toggleCancel(false);dealErrorCode(file,progress,errorCode)}catch(ex){this.debug(ex);}}
function dealErrorCode(file,progress,errorCode){switch(errorCode){case SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT:progress.setStatus("File is too big.");this.debug("Error Code: File too big, File name: "+file.name+", File size: "+file.size+", Message: "+message);break;case SWFUpload.QUEUE_ERROR.ZERO_BYTE_FILE:progress.setStatus("Cannot upload Zero Byte files.");this.debug("Error Code: Zero byte file, File name: "+file.name+", File size: "+file.size+", Message: "+message);break;case SWFUpload.QUEUE_ERROR.INVALID_FILETYPE:progress.setStatus("Invalid File Type.");this.debug("Error Code: Invalid File Type, File name: "+file.name+", File size: "+file.size+", Message: "+message);break;case SWFUpload.QUEUE_ERROR.QUEUE_LIMIT_EXCEEDED:alert("You have selected too many files.  "+(message>1?"You may only add "+message+" more files":"You cannot add any more files."));break;default:if(file!==null){progress.setStatus("Unhandled Error");}
this.debug("Error Code: "+errorCode+", File name: "+file.name+", File size: "+file.size+", Message: "+message);break;}}
function fileDialogComplete(numFilesSelected,numFilesQueued){try{if(this.getStats().files_queued>0){document.getElementById(this.customSettings.cancelButtonId).disabled=false;}
this.startUpload();}catch(ex){this.debug(ex);}}
function uploadStart(file){if(document.getElementById(this.customSettings.progressTarget).style.display=='none'){document.getElementById(this.customSettings.progressTarget).style.display='block';}
try{var progress=new FileProgress(file,this.customSettings.progressTarget);progress.setStatus("上传中...");progress.toggleCancel(true,this);}
catch(ex){}
return true;}
function uploadProgress(file,bytesLoaded,bytesTotal){try{var percent=Math.ceil((bytesLoaded/bytesTotal)*100);var progress=new FileProgress(file,this.customSettings.progressTarget);progress.setProgress(percent);progress.setStatus("上传中...");}catch(ex){this.debug(ex);}}
function uploadSuccess(file,serverData){try{var progress=new FileProgress(file,this.customSettings.progressTarget);var returnValue=eval("("+serverData+")");if(returnValue["attachmentID"]){progress.setComplete(returnValue["attachmentID"],this.settings.delete_url,this.settings.download_url,createFileDiv);}else{progress.setComplete(null);}
if(returnValue["documentID"]&&this.settings.upload_url.indexOf(this.settings.documentId)<0){this.settings.upload_url+="&document_ID="+returnValue["documentID"];this.setUploadURL(this.settings.upload_url);if($("#documentId")){$("#documentId").attr("value",returnValue["documentID"]);}}
progress.toggleCancel(false);}catch(ex){this.debug(ex);}}
function uploadComplete(file){try{if(this.getStats().files_queued===0){document.getElementById(this.customSettings.cancelButtonId).disabled=true;}else{this.startUpload();}}catch(ex){this.debug(ex);}}
function uploadError(file,errorCode,message){try{var progress=new FileProgress(file,this.customSettings.progressTarget);progress.setError();progress.toggleCancel(false);dealUploadError(file,errorCode,message,progress);}catch(ex){this.debug(ex);}}
function dealUploadError(file,errorCode,message,progress){switch(errorCode){case SWFUpload.UPLOAD_ERROR.HTTP_ERROR:progress.setStatus("Upload Error: "+message);this.debug("Error Code: HTTP Error, File name: "+file.name+", Message: "+message);break;case SWFUpload.UPLOAD_ERROR.MISSING_UPLOAD_URL:progress.setStatus("Configuration Error");this.debug("Error Code: No backend file, File name: "+file.name+", Message: "+message);break;case SWFUpload.UPLOAD_ERROR.UPLOAD_FAILED:progress.setStatus("Upload Failed.");this.debug("Error Code: Upload Failed, File name: "+file.name+", File size: "+file.size+", Message: "+message);break;case SWFUpload.UPLOAD_ERROR.IO_ERROR:progress.setStatus("Server (IO) Error");this.debug("Error Code: IO Error, File name: "+file.name+", Message: "+message);break;case SWFUpload.UPLOAD_ERROR.SECURITY_ERROR:progress.setStatus("Security Error");this.debug("Error Code: Security Error, File name: "+file.name+", Message: "+message);break;case SWFUpload.UPLOAD_ERROR.UPLOAD_LIMIT_EXCEEDED:progress.setStatus("Upload limit exceeded.");this.debug("Error Code: Upload Limit Exceeded, File name: "+file.name+", File size: "+file.size+", Message: "+message);break;case SWFUpload.UPLOAD_ERROR.SPECIFIED_FILE_ID_NOT_FOUND:progress.setStatus("File not found.");this.debug("Error Code: The file was not found, File name: "+file.name+", File size: "+file.size+", Message: "+message);break;case SWFUpload.UPLOAD_ERROR.FILE_VALIDATION_FAILED:progress.setStatus("Failed Validation.  Upload skipped.");this.debug("Error Code: File Validation Failed, File name: "+file.name+", File size: "+file.size+", Message: "+message);break;case SWFUpload.UPLOAD_ERROR.FILE_CANCELLED:if(this.getStats().files_queued===0){document.getElementById(this.customSettings.cancelButtonId).disabled=true;}
progress.setStatus("Cancelled");progress.setCancelled();break;case SWFUpload.UPLOAD_ERROR.UPLOAD_STOPPED:progress.setStatus("Stopped");break;default:progress.setStatus("Unhandled Error: "+error_code);this.debug("Error Code: "+errorCode+", File name: "+file.name+", File size: "+file.size+", Message: "+message);break;}}
function createFileDiv(settings){var fileProgressElement=document.createElement("ul");fileProgressElement.id=settings.attachmentId;var item=document.createElement("li");item.className="Attachment";var downloadDiv=document.createElement("a");downloadDiv.href=settings.downloadUrl+"?attachmentId="+settings.attachmentId;downloadDiv.innerHTML=settings.fileName;downloadDiv.className="progressName";var deleDiv=document.createElement("img");deleDiv.className="Remove a_remove";deleDiv.src="./EF/Images/clear.gif";deleDiv.title="删除";deleDiv.onclick=function deleteFile(){$.ajax({type:"post",url:settings.deleteUrl,data:{attachmentId:settings.attachmentId},success:function(){var parentNode=fileProgressElement.parentNode;$(fileProgressElement).remove();if(parentNode.childNodes.length<=0){parentNode.style.display="none";}}});};item.appendChild(downloadDiv);item.appendChild(deleDiv);fileProgressElement.appendChild(item);return fileProgressElement;}

function FileProgress(file,targetID){this.fileProgressID=file.id;this.opacity=100;this.height=0;this.fileProgressWrapper=document.getElementById(this.fileProgressID);if(!this.fileProgressWrapper){this.fileProgressWrapper=document.createElement("div");this.fileProgressWrapper.className="progressWrapper";this.fileProgressWrapper.id=this.fileProgressID;this.fileProgressElement=document.createElement("div");this.fileProgressElement.className="progressContainer";var progressCancel=document.createElement("a");progressCancel.className="progressCancel";progressCancel.href="#";progressCancel.style.visibility="hidden";progressCancel.appendChild(document.createTextNode(" "));var progressText=document.createElement("div");progressText.className="progressName";progressText.appendChild(document.createTextNode(file.name));var progressBar=document.createElement("div");progressBar.className="progressBarInProgress";var progressStatus=document.createElement("div");progressStatus.className="progressBarStatus";progressStatus.innerHTML="&nbsp;";this.fileProgressElement.appendChild(progressCancel);this.fileProgressElement.appendChild(progressText);this.fileProgressElement.appendChild(progressStatus);this.fileProgressElement.appendChild(progressBar);this.fileProgressWrapper.appendChild(this.fileProgressElement);if(targetID){document.getElementById(targetID).appendChild(this.fileProgressWrapper);}else{return this.fileProgressWrapper;}}else{this.fileProgressElement=this.fileProgressWrapper.firstChild;this.reset();}
this.height=this.fileProgressWrapper.offsetHeight;this.setTimer(null);}
FileProgress.prototype.setTimer=function(timer){this.fileProgressElement["FP_TIMER"]=timer;};FileProgress.prototype.getTimer=function(timer){return this.fileProgressElement["FP_TIMER"]||null;};FileProgress.prototype.reset=function(){this.fileProgressElement.className="progressContainer";this.fileProgressElement.childNodes[2].innerHTML="&nbsp;";this.fileProgressElement.childNodes[2].className="progressBarStatus";this.fileProgressElement.childNodes[3].className="progressBarInProgress";this.fileProgressElement.childNodes[3].style.width="0%";this.appear();};FileProgress.prototype.setProgress=function(percentage){this.fileProgressElement.className="progressContainer green";this.fileProgressElement.childNodes[3].className="progressBarInProgress";this.fileProgressElement.childNodes[3].style.width=percentage+"%";this.appear();};FileProgress.prototype.setComplete=function(value,deleteUrl,downloadUrl,callBack){var parentNode=this.fileProgressElement.parentNode;var grandNode=this.fileProgressElement.parentNode.parentNode;var fileName=this.fileProgressElement.childNodes[1].innerHTML;if(value!=null){var settings={attachmentId:value,fileName:fileName,deleteUrl:deleteUrl,downloadUrl:downloadUrl};grandNode.removeChild(parentNode);grandNode.appendChild(callBack.call(this,settings));}};FileProgress.prototype.setError=function(){this.fileProgressElement.className="progressContainer red";this.fileProgressElement.childNodes[3].className="progressBarError";this.fileProgressElement.childNodes[3].style.width="";var oSelf=this;this.setTimer(setTimeout(function(){oSelf.disappear();},5000));};FileProgress.prototype.setCancelled=function(){this.fileProgressElement.className="progressContainer";this.fileProgressElement.childNodes[3].className="progressBarError";this.fileProgressElement.childNodes[3].style.width="";var oSelf=this;this.setTimer(setTimeout(function(){oSelf.disappear();},2000));};FileProgress.prototype.setStatus=function(status){this.fileProgressElement.childNodes[2].innerHTML=status;};FileProgress.prototype.toggleCancel=function(show,swfUploadInstance){this.fileProgressElement.childNodes[0].style.visibility=show?"visible":"hidden";if(swfUploadInstance){var fileID=this.fileProgressID;this.fileProgressElement.childNodes[0].onclick=function(){swfUploadInstance.cancelUpload(fileID);return false;};}};FileProgress.prototype.appear=function(){if(this.getTimer()!==null){clearTimeout(this.getTimer());this.setTimer(null);}
if(this.fileProgressWrapper.filters){try{this.fileProgressWrapper.filters.item("DXImageTransform.Microsoft.Alpha").opacity=100;}catch(e){this.fileProgressWrapper.style.filter="progid:DXImageTransform.Microsoft.Alpha(opacity=100)";}}else{this.fileProgressWrapper.style.opacity=1;}
this.fileProgressWrapper.style.height="";this.height=this.fileProgressWrapper.offsetHeight;this.opacity=100;this.fileProgressWrapper.style.display="";};FileProgress.prototype.disappear=function(){var reduceOpacityBy=15;var reduceHeightBy=4;var rate=30;if(this.opacity>0){this.opacity-=reduceOpacityBy;if(this.opacity<0){this.opacity=0;}
if(this.fileProgressWrapper.filters){try{this.fileProgressWrapper.filters.item("DXImageTransform.Microsoft.Alpha").opacity=this.opacity;}catch(e){this.fileProgressWrapper.style.filter="progid:DXImageTransform.Microsoft.Alpha(opacity="+this.opacity+")";}}else{this.fileProgressWrapper.style.opacity=this.opacity/100;}}
if(this.height>0){this.height-=reduceHeightBy;if(this.height<0){this.height=0;}
this.fileProgressWrapper.style.height=this.height+"px";}
if(this.height>0||this.opacity>0){var oSelf=this;this.setTimer(setTimeout(function(){oSelf.disappear();},rate));}else{this.fileProgressWrapper.style.display="none";this.setTimer(null);}};

efresource=function(){this.international=true;this.resource={};this.prototype=new Object();}
efresource.prototype.setResource=function(resource){this.resource=resource;}
efresource.prototype.get=function(key){return this.resource[key];}
efresource.prototype.set=function(key,value){this.resource[key]=value;}
efresource.prototype.getInternationalValue=function(key,defaultvalue){var value=this.get(key);if(value!=undefined){return value;}
var info=new EiInfo();info.set("interkey",key);info.set("defaultvalue",defaultvalue);EiCommunicator.send("ED11","getI18nMessages",info,resourcecallback,false);}
efresource.prototype.getInternationalValues=function(keys){var info=new EiInfo();info.set("keys",keys);EiCommunicator.send("ED11","getMultiResources",info,multicallback,false);}
var resource=new efresource();resourcecallback={onSuccess:function(eiInfo){var key=eiInfo.get("interkey");var value=eiInfo.get("value");resource.set(key,value);},onFail:function(eMsg){}}
multicallback={onSuccess:function(eiInfo){var i18n=eiInfo.getBlock("i18nResources").getAttr();for(var key in i18n){resource.set(key,i18n[key]);}},onFail:function(eMsg){}}
getI18nMessages=function(){if(arguments.length>0&&arguments.length<3){var key=arguments[0];var defaultvalue=arguments[1];if(defaultvalue==undefined){defaultvalue="";}
if(efresource.config!=undefined&&efresource.config.INTERNATIONAL!=undefined&&efresource.config.INTERNATIONAL=="true"){resource.getInternationalValue(key,defaultvalue);return resource.get(key);}
else{return defaultvalue;}}else if(arguments.length==3){var key=arguments[0];var args=arguments[1];var defaultvalue=arguments[2];if(defaultvalue==undefined){defaultvalue="";}
if(efresource.config!=undefined&&efresource.config.INTERNATIONAL!=undefined&&efresource.config.INTERNATIONAL=="true"){resource.getInternationalValue(key,defaultvalue);return replaceParams(resource.get(key),args);}
else{return defaultvalue;}}else{alert("Incorrect arguments in getI18nMessages()");}}
function replaceParams(string,replacements){return string.replace(/\{(\d+)\}/g,function(){return replacements[arguments[1]];});}

function JSON2String(obj){if(typeof obj=="number"){return isFinite(obj)?String(obj):"null";}
if(typeof obj=="boolean"){return String(obj);}
if(typeof obj=="date"){function f(n){return n<10?'0'+n:n;}
return'"'+obj.getFullYear()+'-'+
f(obj.getMonth()+1)+'-'+
f(obj.getDate())+'T'+
f(obj.getHours())+':'+
f(obj.getMinutes())+':'+
f(obj.getSeconds())+'"';}
if(typeof obj=="array"||obj instanceof Array){var a=['['],b,i,l=obj.length,v;function pa(s){if(b){a.push(',');}
a.push(s);b=true;}
for(i=0;i<l;i+=1){v=obj[i];switch(typeof v){case'undefined':case'function':case'unknown':break;case'object':default:pa(JSON2String(v));}}
a.push(']');return a.join('');}
if(typeof obj=="string"||obj instanceof String){var m={'\b':'\\b','\t':'\\t','\n':'\\n','\f':'\\f','\r':'\\r','"':'\\"','\\':'\\\\'};if(/["\\\x00-\x1f]/.test(obj)){return'"'+obj.replace(/([\x00-\x1f\\"])/g,function(a,b){var c=m[b];if(c){return c;}
c=b.charCodeAt();return'\\u00'+
Math.floor(c/16).toString(16)+
(c%16).toString(16);})+'"';}
return'"'+obj+'"';}
if(typeof obj=="object"){var a=['{'],b,k,v;function p(s){if(b){a.push(',');}
a.push(JSON2String(k),':',s);b=true;}
for(k in obj){if(obj.hasOwnProperty(k)){v=obj[k];switch(typeof v){case'undefined':case'function':case'unknown':break;case'object':default:p(JSON2String(v));}}}
a.push('}');return a.join('');}}
function IsInteger(strInteger){var newPar=/^(-|\+)?\d+$/;return newPar.test(strInteger);}
function GetServiceUrl(tar){return"/POR/"+tar;}
function GetJSONBlock(eiinfo,name){return eiinfo.getBlock(name);}
function GetJSONData(eiinfo,name){return GetJSONBlock(eiinfo,name).getRows();}
function GetJSONColDefine(eiinfo,name){var metas=eiinfo.getBlock(name).getBlockMeta().getMetas();columns=[];for(var key in metas){var eiCol=metas[key];var col={};col.key=key;col.name=eiCol.getName();col.descName=eiCol.getDescName();col.primaryKey=eiCol.isPrimaryKey();col.isNotNull=eiCol.isNotNull();col.maxLength=eiCol.getMaxLength();col.editor=eiCol.getEditor();col.regex=eiCol.getRegex();col.formatter=eiCol.getFormatter();col.type=eiCol.getType();col.multiService=eiCol.get("multiselectservice");col.multiCol=eiCol.get("multiselectcol");col.list=eiCol.get("list");col.helpMessage=eiCol.get("HELP");this.columns.push(col);}
return columns;}
function GetJSONParam(eiinfo,name){return GetJSONBlock(eiinfo,name).attributes;}

var CONTEXT_PATH=CONTEXT_PATH?CONTEXT_PATH:".";function AbstractEi(){this.extAttr={};};AbstractEi.prototype.get=function(prop){return this.extAttr[prop];};AbstractEi.prototype.set=function(prop,value){this.extAttr[prop]=value;};AbstractEi.prototype.getAttr=function(){return this.extAttr;};AbstractEi.prototype.setAttr=function(sAttr){this.extAttr=sAttr;};function EiColumn(name){this.pos=-1;this.name=name;this.descName="";this.type="C";this.regex=null;this.formatter=null;this.editor="text";this.minLength=0;this.maxLength=Number.MAX_VALUE;this.primaryKey=false;this.nullable=true;this.visible=true;this.readonly=false;this.displayType="text";this.errorPrompt=null;this.dateFormat=null;this.defaultValue="";this.validateType=null;this.width=96;this.height=18;this.align="left";this.blockName=null;this.sourceName=null;this.labelProperty=null;this.valueProperty=null;this.extAttr={};};EiColumn.prototype=new AbstractEi;function EiBlockMeta(sBlockId){this.blockId=sBlockId;this.metas={};this.extAttr={};this.colCount=0;}
EiBlockMeta.prototype=new AbstractEi;EiBlockMeta.prototype.setDesc=function(sDesc){this.desc=sDesc;};EiBlockMeta.prototype.getDesc=function(){return this.desc;};EiBlockMeta.prototype.addMeta=function(sEiColumn){if(sEiColumn instanceof EiColumn){this.metas[sEiColumn.name]=sEiColumn;if(sEiColumn.pos<0)
sEiColumn.pos=this.colCount;this.colCount++;}else{throw new Error("Can NOT add as an EiColumn");}};EiBlockMeta.prototype.getMeta=function(sName){return this.metas[sName];};EiBlockMeta.prototype.removeMeta=function(sName){delete this.metas[sName];};EiBlockMeta.prototype.getBlockId=function(){return this.blockId;};EiBlockMeta.prototype.getMetas=function(){return this.metas;};function EiBlock(blockId){if(typeof blockId=="string"){this.meta=new EiBlockMeta(blockId);}else if(blockId instanceof EiBlockMeta){this.meta=blockId;}else{throw new Error("Can NOT create block");};this.rows=new Array();this.colCount=0;this.extAttr={};};EiBlock.prototype=new AbstractEi;EiBlock.prototype.getBlockMeta=function(){return this.meta;};EiBlock.prototype.setBlockMeta=function(sBlockMeta){this.meta=sBlockMeta;};EiBlock.prototype.addRow=function(sRow){if(sRow==null){this.rows.push({});}else{this.rows.push(sRow);}};EiBlock.prototype.getRows=function(){return this.rows;};EiBlock.prototype.setCell=function(sRowNo,sColName,sValue){var pos=this.getBlockMeta().getMeta(sColName).pos;while(typeof(this.rows[sRowNo])=="undefined")this.addRow(null);this.rows[sRowNo][pos]=sValue;};EiBlock.prototype.getCell=function(sRowNo,sColName){var column=this.getBlockMeta().getMeta(sColName);if(column){var pos=this.getBlockMeta().getMeta(sColName).pos;return this.rows[sRowNo][pos];}else{return"";}};EiBlock.prototype.getCellByPos=function(sRowNo,sColPos){return this.rows[sRowNo][sColPos];};EiBlock.prototype.getMappedArray=function(obj){var cols=this.getBlockMeta().getMetas();var row=new Array();for(var col in cols){var pos=this.getBlockMeta().getMeta(col).pos;row[pos]=obj[col];}
return row;};EiBlock.prototype.getMappedObject=function(row){var cols=this.getBlockMeta().getMetas();var t=new Object();for(var key in cols){var col=cols[key];t[col.name]=row[col.pos];}
return t;};EiBlock.prototype.getMappedRows=function(){var ret=new Array();for(var i=0;i<this.rows.length;i++){var row=this.rows[i];var m=this.getMappedObject(row);ret.push(m);}
return ret;};EiBlock.prototype.clone=function(){return this;}
function EiInfo(sName){this.name=null;this.msg=null;this.msgKey=null;this.status=null;this.descName=null;this.blocks={};this.extAttr={};if(typeof sName=="string"){this.name=sName;}}
EiInfo.prototype=new AbstractEi;EiInfo.prototype.getName=function(){return this.name;};EiInfo.prototype.setName=function(sName){this.name=sName;};EiInfo.prototype.setMsg=function(sMsg){this.msg=sMsg;};EiInfo.prototype.getMsg=function(){return this.msg;};EiInfo.prototype.setMsgKey=function(sMsgKey){this.msgKey=sMsgKey;};EiInfo.prototype.getMsgKey=function(){return this.msgKey;};EiInfo.prototype.setDetailMsg=function(sMsg){this.detailMsg=sMsg;};EiInfo.prototype.getDetailMsg=function(){return this.detailMsg;};EiInfo.prototype.setStatus=function(s){this.status=s;};EiInfo.prototype.getStatus=function(){return this.status;};EiInfo.prototype.setDescName=function(sDescName){this.descName=sDescName;};EiInfo.prototype.getDescName=function(){return this.descName;};EiInfo.prototype.addBlock=function(sBlock){this.blocks[sBlock.getBlockMeta().getBlockId()]=sBlock;};EiInfo.prototype.getBlock=function(sBlockId){return this.blocks[sBlockId];};EiInfo.prototype.getBlocks=function(){return this.blocks;};EiInfo.prototype.set=function(){if(arguments.length==2){AbstractEi.prototype.set.apply(this,arguments);return;}
var sBlock=arguments[0];if(typeof(this.blocks[sBlock])=="undefined"){this.blocks[sBlock]=new EiBlock(sBlock);}
if(arguments.length==3){this.blocks[sBlock].set(arguments[1],arguments[2]);return;}
if(arguments.length==4){if(typeof(this.blocks[sBlock].getBlockMeta().getMeta(arguments[2]))=="undefined"){var cc=new EiColumn(arguments[2]);cc.pos=this.blocks[sBlock].colCount++;this.blocks[sBlock].getBlockMeta().addMeta(cc);}
this.blocks[sBlock].setCell(arguments[1],arguments[2],arguments[3]);return;}}
EiInfo.prototype.setById=function(id_in){this.setByNameValue(id_in,ef.get(id_in).value);}
EiInfo.prototype.setByNameValue=function(id_in,v){var idArray=id_in.split("-");if(idArray.length==3)return this.set(idArray[0],idArray[1],idArray[2],v);if(idArray.length==2)return this.set(idArray[0],idArray[1],v);if(idArray.length==1)return this.set(idArray[0],v);}
EiInfo.prototype.setByNode=function(node_id_in)
{this.setByNodeObject(ef.get(node_id_in));}
EiInfo.prototype.setByNodeObject=function(node_in)
{var cbs=new Object();var nodes=node_in.getElementsByTagName("input");for(var i=0;i<nodes.length;i++)
{if(nodes[i].type=="radio"&&!nodes[i].checked)
continue;if(nodes[i].type=="checkbox"){if(cbs[nodes[i].name]===undefined)
cbs[nodes[i].name]='';if(nodes[i].checked)
if(cbs[nodes[i].name].length==0)
cbs[nodes[i].name]=nodes[i].value;else
cbs[nodes[i].name]=cbs[nodes[i].name]+','+nodes[i].value;continue;}
this.setByNameValue(nodes[i].name,nodes[i].value);}
for(var cbname in cbs)
this.setByNameValue(cbname,cbs[cbname]);nodes=node_in.getElementsByTagName("select");for(var i=0;i<nodes.length;i++)
{if(nodes[i].options.length>0)
this.setByNameValue(nodes[i].name,nodes[i].options[nodes[i].selectedIndex].value);}
var nodes=node_in.getElementsByTagName("textarea");for(var i=0;i<nodes.length;i++){this.setByNameValue(nodes[i].name,nodes[i].value);}}
var EiInfoJsonConstants={ATTRIBUTES:"attr",EIINFO_NAME:"name",EIINFO_DESC_NAME:"descName",EIINFO_MESSAGE:"msg",EIINFO_MESSAGE_KEY:"msgKey",EIINFO_DETAIL_MESSAGE:"detailMsg",EIINFO_STATUS:"status",EIINFO_BLOCKS:"blocks",BLOCK_META:"meta",BLOCK_META_DESC:"desc",BLOCK_META_COLUMNLIST:"columns",BLOCK_META_COLUMNPOS:"columnPos",BLOCK_DATA:"rows"};function formatNative(obj){var str=JSON2String(obj);return str;}
function isAvailable(obj)
{if(obj===undefined){return false;};if(obj===null){return false;}
if(obj===""){return false;};return true;}
function EiInfo2Json(){};EiInfo2Json.prototype.EiInfo2JsonString=function(sEiInfo){var a=['{'];var appendComma;if(isAvailable(sEiInfo.getName())){a.push(EiInfoJsonConstants.EIINFO_NAME,':',formatNative(sEiInfo.getName()));appendComma=true;}
if(isAvailable(sEiInfo.getDescName())){if(appendComma){a.push(',');};a.push(EiInfoJsonConstants.EIINFO_DESC_NAME,':',formatNative(sEiInfo.getDescName()));appendComma=true;}
if(isAvailable(sEiInfo.getAttr())){if(appendComma){a.push(',');};a.push(EiInfoJsonConstants.ATTRIBUTES,':',formatNative(sEiInfo.getAttr()));appendComma=true;}
if(appendComma){a.push(',');};a.push(EiInfoJsonConstants.EIINFO_BLOCKS,':{');var blocks=sEiInfo.getBlocks();var b;for(var iKey in blocks){var block=blocks[iKey];if(b){a.push(',');}
a.push(iKey,':',EiInfo2Json.prototype.EiBlock2JsonString(block));b=true;}
a.push('}}');return a.join('');};EiInfo2Json.prototype.EiBlock2JsonString=function(sBlock){var a=['{'];a.push(EiInfoJsonConstants.ATTRIBUTES,':',formatNative(sBlock.getAttr()));a.push(',',EiInfoJsonConstants.BLOCK_META,':',EiInfo2Json.prototype.EiBlockMeta2JsonString(sBlock.getBlockMeta()));a.push(',',EiInfoJsonConstants.BLOCK_DATA,':[');var rows=sBlock.getRows();var b;for(var i=0;i<rows.length;i++){var row=rows[i];if(b){a.push(',');}
a.push('[');var columns=sBlock.getBlockMeta().getMetas();var c;for(var jKey in columns){var column=columns[jKey];if(c){a.push(',');};a.push(formatNative(row[column.pos]));c=true;}
b=true;c=false
a.push(']');}
a.push(']}');return a.join('');};EiInfo2Json.prototype.EiBlockMeta2JsonString=function(sBlockMeta){var a=['{'];var appendComma;if(isAvailable(sBlockMeta.getDesc())){a.push(EiInfoJsonConstants.BLOCK_META_DESC,':',formatNative(sBlockMeta.getDesc()));appendComma=true;}
if(isAvailable(sBlockMeta.getAttr())){if(appendComma){a.push(',');};a.push(EiInfoJsonConstants.ATTRIBUTES,':',formatNative(sBlockMeta.getAttr()));appendComma=true;}
if(appendComma){a.push(',');};a.push(EiInfoJsonConstants.BLOCK_META_COLUMNLIST,':[');var columns=sBlockMeta.getMetas();var b;for(var iKey in columns){var column=columns[iKey];if(b){a.push(',');}
a.push(EiInfo2Json.prototype.EiColumn2JsonString(column));b=true;}
a.push(']}');return a.join('');};EiInfo2Json.prototype.EiColumn2JsonString=function(sColumn){var a=['{'];a.push('name',':',formatNative(sColumn.name));a.push(',');a.push('descName',':',formatNative(sColumn.descName));a.push('}');return a.join('');}
function Json2EiInfo(){};Json2EiInfo.prototype.parseString=function(sJson){var eiJson=eval("("+sJson+")");Json2EiInfo.prototype.parseJson(eiJson);}
Json2EiInfo.prototype.parseJsonObject=function(eiJson){var eiInfo=new EiInfo();var value=eiJson[EiInfoJsonConstants.EIINFO_NAME];if(isAvailable(value)){eiInfo.setName(value);}
var value=eiJson[EiInfoJsonConstants.EIINFO_DESC_NAME];if(isAvailable(value)){eiInfo.setDescName(value);}
var value=eiJson[EiInfoJsonConstants.EIINFO_MESSAGE];if(isAvailable(value)){eiInfo.setMsg(value);}
var value=eiJson[EiInfoJsonConstants.EIINFO_MESSAGE_KEY];if(isAvailable(value)){eiInfo.setMsgKey(value);}
var value=eiJson[EiInfoJsonConstants.EIINFO_DETAIL_MESSAGE];if(isAvailable(value)){eiInfo.setDetailMsg(value);}
var value=eiJson[EiInfoJsonConstants.EIINFO_STATUS];if(isAvailable(value)){eiInfo.setStatus(value);}
var value=eiJson[EiInfoJsonConstants.ATTRIBUTES];if(isAvailable(value)){eiInfo.setAttr(value);}
var value=eiJson[EiInfoJsonConstants.EIINFO_BLOCKS];if(isAvailable(value)){for(var bIds in value){var block=Json2EiInfo.prototype.parseBlock(bIds,value[bIds]);eiInfo.addBlock(block);}}
return eiInfo;};Json2EiInfo.prototype.parseBlock=function(sId,blockJson){var block;var value=blockJson[EiInfoJsonConstants.BLOCK_META];if(isAvailable(value)){var blockMeta=Json2EiInfo.prototype.parseBlockMeta(sId,value);block=new EiBlock(blockMeta);}else{block=new EiBlock(sId);}
var value=blockJson[EiInfoJsonConstants.ATTRIBUTES];if(isAvailable(value)){block.setAttr(value);}
var value=blockJson[EiInfoJsonConstants.BLOCK_DATA];if(isAvailable(value)){block.rows=value;}
return block;}
Json2EiInfo.prototype.parseBlockMeta=function(sId,blockJson){var blockMeta=new EiBlockMeta(sId);var value=blockJson[EiInfoJsonConstants.BLOCK_META_DESC];if(isAvailable(value)){blockMeta.setDesc(value);}
var value=blockJson[EiInfoJsonConstants.ATTRIBUTES];if(isAvailable(value)){blockMeta.setAttr(value);}
var value=blockJson[EiInfoJsonConstants.BLOCK_META_COLUMNLIST];if(isAvailable(value)){for(var i=0;i<value.length;i++){var column=Json2EiInfo.prototype.parseColumn(value[i]);blockMeta.addMeta(column);}}
return blockMeta;}
Json2EiInfo.prototype.parseColumn=function(blockJson){var column=new EiColumn(blockJson.name);for(var iKey in blockJson){var columnValue=blockJson[iKey];if(columnValue.replace)
columnValue=columnValue.replace(/'/g,"&#39;");eval("column."+iKey+"='"+columnValue+"'");}
return column;}
var ajaxEi=new EiInfo();var EiCommunicator={send:function(sService,sMethod,sEiInfo,sCallback,hasForm,ajaxMode,noloading){if(efgrid.config!=undefined&&efgrid.config.SESSION_TIMEOUT!=undefined){if('function'==typeof(checkTimeOut))
{if(checkTimeOut())
{if(sCallback!=null&&typeof(sCallback)=="object"){if(typeof(sCallback.onFail)=="function")
sCallback.onFail("前台操作超时",-2);}
return;}}}
var modalWin=null;var resizeFunc=null;if(document.forms.length>0&&!noloading){resizeFunc=window.onresize;window.onresize=null;modalWin=new EFModalWindow('iplat-progressWindow');modalWin.showProgressBar();}
if(hasForm!=false){efform.setStatus(999,"["+sService+"."+sMethod+"]调用执行中...");}
if(ajaxMode!=true)ajaxMode=false;var jsonEi=EiInfo2Json.prototype.EiInfo2JsonString(sEiInfo);$.ajax({type:"POST",async:ajaxMode,url:CONTEXT_PATH+"/EiService",data:{service:sService,method:sMethod,eiinfo:jsonEi},dataType:"json",success:function(msg)
{ajaxEi=Json2EiInfo.prototype.parseJsonObject(msg);var r=ajaxEi.get("redirect");if(r!=null){self.location=r;}else{if(hasForm!=false){efform.setStatus(ajaxEi.status,ajaxEi.msg,ajaxEi.msgKey);efform.setDetailMsg(ajaxEi.detailMsg);}
if((typeof(sCallback)=="object")&&(sCallback!=null)){if(typeof(sCallback.onSuccess)=="function")sCallback.onSuccess(ajaxEi);}}
if(modalWin!=null){modalWin.hide();window.onresize=resizeFunc;}},error:function(xmlR,status,e)
{ajaxEi=null;var detailMsg=xmlR.responseText.split("$$$")[1];if(hasForm!=false){efform.setStatus(-1,"["+sService+"."+sMethod+"]"+getI18nMessages("ef.CallFailed","调用失败，原因")+"["+xmlR.responseText.split("$$$")[0]+"]");efform.setDetailMsg(detailMsg);}else{if(sCallback!=null&&typeof(sCallback)=="object"){if(typeof(sCallback.onFail)=="function")
sCallback.onFail(xmlR.responseText.split("$$$")[0],status,e);}}
if(modalWin!=null){modalWin.hide();window.onresize=resizeFunc;}}});},sendFuncCall:function(funcId,inInfo,callback){inInfo.set("funcId",funcId);EiCommunicator.send("EPFunc","call",inInfo,callback,false);},$send:function(sUrl,sContent,sCallback){if('function'==typeof(checkTimeOut))
{if(checkTimeOut())
{return;}}
$.ajax({type:"POST",async:false,url:sUrl,data:sContent,dataType:"json",success:function(msg){ajaxEi=Json2EiInfo.prototype.parseJsonObject(msg);sCallback.onSuccess(ajaxEi);},error:function(xmlR,status,e){sCallback.onFail(xmlR,status,e);}});}};

function cookie(ctx){this.context=ctx;}
cookie.prototype.setCookie=function(key,value){var uKey=this.context+key;cookie.setCookie(uKey,value);}
cookie.prototype.getCookie=function(key){var uKey=this.context+key;return cookie.getCookie(uKey);}
cookie.setCookie=function(name,value,expiredays,path,domain,secure){var curCookie=name+"="+escape(value)+
((expiredays)?"; expires="+expiredays.toGMTString():"")+
((path)?"; path="+path:"")+
((domain)?"; domain="+domain:"")+
((secure)?"; secure":"");if((name+"="+escape(value)).length<=4000)
document.cookie=curCookie;else{if(confirm("Cookie exceeds 4KB and will be cut!"))
document.cookie=curCookie;}}
cookie.getCookie=function(name){var prefix=name+"=";var startIndex=document.cookie.indexOf(prefix);if(startIndex==-1)
return null;var endIndex=document.cookie.indexOf(";",startIndex+prefix.length);if(endIndex==-1)
endIndex=document.cookie.length;return unescape(document.cookie.substring(startIndex+prefix.length,endIndex));}
cookie.deleteCookie=function(name,path,domain){if(cookie.getCookie(name)){document.cookie=name+"="+
((path)?"; path="+path:"")+
((domain)?"; domain="+domain:"")+"; expires=Thu, 01-Jan-70 00:00:01 GMT";}}
cookie.getVisitForms=function(){var cookiesForms=document.cookie.split(";");var visitForms=new Array();for(var i=0;i<cookiesForms.length;i++){if(cookiesForms[i].trim().substr(0,14)!='iplat-counter-')continue;var visits=cookiesForms[i].trim().split("=");if(visits.length!=2)continue;var tempObj=new Object();tempObj.name=visits[0];tempObj.value=visits[1];visitForms.push(tempObj);}
return bubbleSort(visitForms);}
cookie.statofVisits=function(name){var now=new Date();var keyname="iplat-counter-"+name;now.setDate(now.getDate()+365);var visits=cookie.getCookie(keyname);if(!visits)
visits=1;else
visits=parseInt(visits)+1;cookie.setCookie(keyname,visits,now);return visits;}
bubbleSort=function(visitForms)
{for(var i=visitForms.length-1;i>0;--i){for(var j=0;j<i;++j){var value1=parseInt(visitForms[j].value);var value2=parseInt(visitForms[j+1].value);if(value1<value2){var temp=visitForms[j];visitForms[j]=visitForms[j+1];visitForms[j+1]=temp;}}}
return visitForms;}

var ef_version="2.0.10";var isNS=(typeof document.implementation!='undefined')&&(typeof document.implementation.createDocument!='undefined');var isIE=(typeof window.ActiveXObject!='undefined');var EF_SPLIT="__";var EF_FORMDATA_SPLIT="-";var EF_CR_IDENTIFIER="??";var EF_CR_HTML_IDENTIFIER="&para;&para;";var EF_IMAGES_PATH=CONTEXT_PATH+"/EF/Images/";var ef_validator_regexes=new Object();var ef_validator_errormsg=new Object();var EF_MSG={ROW:"ef.Row",COL:"ef.Col",FIX_COLUMN:"ef.FixColumn",DATA_COLUMN:"ef.DataColumn",SUBMIT_CONFIRM:"ef.SubmitConfirm",FROM:"ef.From",TO:"ef.To",TOGETHER:"ef.Together"};var EF_ERROR_MSG={VALIDATE_ERROR:"ef.DataCheckError",GRID_DIV_NOT_FOUND:"ef.GridDivNotFound",CELL_NOT_EDITABLE:"ef.UnitNotEdited"};var winMap=new Object();var winCount=0;efError=function(c,m){Error(m);this.errorCode=c;this.errorMsg=m;}
efError.prototype=new Error;efError.prototype.getCode=function(){return this.errorCode;}
efError.prototype.getMessage=function(){return this.errorMsg;}
if(![].indexOf){Array.prototype.indexOf=function(obj){for(var i=this.length;i--&&this[i]!==obj;);return i;}}
if(!"".trim){String.prototype.trim=function(){return this.replace(/(^\s*)|(\s*$)/g,"");}}

efico=function(){}
efico.get=function(ico_name)
{str=ico_name.split(".");model=str[0];name=str[1];return efico[model][name][0]+efico[model][name][1];}
efico.getName=function(ico_name){str=ico_name.split(".");model=str[0];name=str[1];return efico[model][name][1];}
efico.setNodeIcoUrl=function(node_id,ico_name){var node=$('#'+node_id)[0];node.style.background='url('+efico.get(ico_name)+')';}
efico.setImageSrc=function(node_id,ico_name){var node;if(typeof node_id=="object")
node=node_id;else
node=window.document.getElementById(node_id);node.onload=null;node.src=efico.get(ico_name);}
efico.addImgClass=function(node_id,ico_class){var node;if(typeof node_id=="object")
node=node_id;else
node=window.document.getElementById(node_id);node.onload=null;$(node).addClass(ico_class);}
efico.efregion={"expand":[EF_IMAGES_PATH,"efregion_expand.png"],"collapse":[EF_IMAGES_PATH,"efregion_collapse.png"],"clear":[EF_IMAGES_PATH,"efregion_clear.png"],"save":[EF_IMAGES_PATH,"efregion_save.gif"],"load":[EF_IMAGES_PATH,"efregion_load.gif"],"delete":[EF_IMAGES_PATH,"efregion_clear.png"]}
efico.efpage={"divHeadLine":[EF_IMAGES_PATH,"bgline01.gif"],"menuDivBgImg":[EF_IMAGES_PATH,"bgline02.gif"],"topDivBgImg":[EF_IMAGES_PATH,"ef_top_bg.gif"],"changePwd":[EF_IMAGES_PATH,"ChangePwd.png"],"changePwdOn":[EF_IMAGES_PATH,"ChangePwd-on.png"],"logOut":[EF_IMAGES_PATH,"LogOut.png"],"logOutOn":[EF_IMAGES_PATH,"LogOut-on.png"],"popUpWinInact":[EF_IMAGES_PATH,"pop_up_win_inact.gif"],"popUpWindow":[EF_IMAGES_PATH,"pop_up_window.gif"],"popUpWinInactOn":[EF_IMAGES_PATH,"pop_up_win_inact-on.gif"],"popUpWindowOn":[EF_IMAGES_PATH,"pop_up_window-on.gif"],"changeStyle":[EF_IMAGES_PATH,"changeStyle.png"],"changeStyleOn":[EF_IMAGES_PATH,"changeStyleOn.png"],"middleSplitter":[EF_IMAGES_PATH,"splitter_bg.jpg"]}
efico.efgrid={"pageSum":[EF_IMAGES_PATH,"efgrid_sum_page.png"],"totalSum":[EF_IMAGES_PATH,"efgrid_sum_total.png"],"pagingCount":[EF_IMAGES_PATH,"efgrid_paging_count.gif"],"addRow":[EF_IMAGES_PATH,"efgrid_add_row.png"],"jumpPage":[EF_IMAGES_PATH,"efgrid_jump_page.gif"],"pageFirst":[EF_IMAGES_PATH,"efgrid_page_first_normal.png"],"pagePrevious":[EF_IMAGES_PATH,"efgrid_page_previous_normal.png"],"pageNext":[EF_IMAGES_PATH,"efgrid_page_next_normal.png"],"pageLast":[EF_IMAGES_PATH,"efgrid_page_last_normal.png"],"pageFirstDisabled":[EF_IMAGES_PATH,"efgrid_page_first_disable.png"],"pagePreviousDisabled":[EF_IMAGES_PATH,"efgrid_page_previous_disable.png"],"pageNextDisabled":[EF_IMAGES_PATH,"efgrid_page_next_disable.png"],"pageLastDisabled":[EF_IMAGES_PATH,"efgrid_page_last_disable.png"],"newForm":[EF_IMAGES_PATH,"ef_new_form.png"],"blueDivider":[EF_IMAGES_PATH,"efbuttonbar_blue_divider.gif"],"gridBlueDivider":[EF_IMAGES_PATH,"efgrid_blue_divider.jpg"],"gridBlueDivider2":[EF_IMAGES_PATH,"efgrid_blue_divider2.gif"],"columnSortAscend":[EF_IMAGES_PATH,"efcolumn_sort_ascend.gif"],"columnSortDecend":[EF_IMAGES_PATH,"efcolumn_sort_decend.gif"],"customColumn":[EF_IMAGES_PATH,"efgrid_custom_column.gif"],"frontAsc":[EF_IMAGES_PATH,"efgrid_front_asc.gif"],"frontBlank":[EF_IMAGES_PATH,"efgrid_front_blank.gif"],"frontDesc":[EF_IMAGES_PATH,"efgrid_front_desc.gif"]}
efico.eftab={"tab1":[EF_IMAGES_PATH,""],"tab1Bottom":[EF_IMAGES_PATH,""],"tab2":[EF_IMAGES_PATH,""],"tab2Bottom":[EF_IMAGES_PATH,""],"tab3":[EF_IMAGES_PATH,""],"tab3Bottom":[EF_IMAGES_PATH,""],"tabHouseBg":[EF_IMAGES_PATH,"tag_house_bg.gif"],"tabBtn":[EF_IMAGES_PATH,"btn.gif"],"tabBtnLeft":[EF_IMAGES_PATH,"btnleft.gif"],"tabBtnRight":[EF_IMAGES_PATH,"btnright.gif"],"efformClose":[EF_IMAGES_PATH,"close.gif"]}
efico.efmenu={"arrowDown":[EF_IMAGES_PATH,"efmenu_arrowdown.png"],"arrowRight":[EF_IMAGES_PATH,"efmenu_arrowright.png"],"arrowRight2":[EF_IMAGES_PATH,"efmenu_arrowright2.png"]}
efico.eftree={"blank":[EF_IMAGES_PATH,"eftree_blank.png"],"cu":[EF_IMAGES_PATH,"eftree_cu.gif"],"file":[EF_IMAGES_PATH,"eftree_file.png"],"folderIcon":[EF_IMAGES_PATH,"eftree_foldericon.png"],"treeImgI":[EF_IMAGES_PATH,"eftree_i.png"],"treeImgL":[EF_IMAGES_PATH,"eftree_l.png"],"treeImgLminus":[EF_IMAGES_PATH,"eftree_lminus.png"],"treeImgLplus":[EF_IMAGES_PATH,"eftree_lplus.png"],"openFolderIcon":[EF_IMAGES_PATH,"eftree_openfoldericon.png"],"treeImgT":[EF_IMAGES_PATH,"eftree_t.png"],"treeImgTminus":[EF_IMAGES_PATH,"eftree_tminus.png"],"treeImgTplus":[EF_IMAGES_PATH,"eftree_tplus.png"],"treeImgForum":[EF_IMAGES_PATH,"forum.gif"],"treeImgGroup":[EF_IMAGES_PATH,"group.gif"],"treeImgActv":[EF_IMAGES_PATH,"shw_tree_actv.gif"],"treeImgInActv":[EF_IMAGES_PATH,"shw_tree_inactv.gif"],"padUp":[EF_IMAGES_PATH,"eftree_padUp.gif"],"padDown":[EF_IMAGES_PATH,"eftree_padDown.gif"]}
efico.efportlet={"close":[EF_IMAGES_PATH,"eview_close.gif"],"closeHover":[EF_IMAGES_PATH,"eview_close_hover.gif"],"config":[EF_IMAGES_PATH,"eview_config.gif"],"configHover":[EF_IMAGES_PATH,"eview_config_hover.gif"],"expand":[EF_IMAGES_PATH,"eview_expand.gif"],"expandHover":[EF_IMAGES_PATH,"eview_expand_hover.gif"],"maximize":[EF_IMAGES_PATH,"eview_maximize.gif"],"maximizeHover":[EF_IMAGES_PATH,"eview_maximize_hover.gif"],"minimize":[EF_IMAGES_PATH,"eview_minimize.gif"],"minimizeHover":[EF_IMAGES_PATH,"eview_minimize_hover.gif"],"noexpand":[EF_IMAGES_PATH,"eview_noexpand.gif"],"noexpandHover":[EF_IMAGES_PATH,"eview_noexpand_hover.gif"]}
efico.efcalendar={"closeImg":[EF_IMAGES_PATH,"efcalendar_close.gif"],"dividerImg":[EF_IMAGES_PATH,"efcalendar_divider.gif"],"drop1Img":[EF_IMAGES_PATH,"efcalendar_drop1.gif"],"drop2Img":[EF_IMAGES_PATH,"efcalendar_drop2.gif"],"iconImg":[EF_IMAGES_PATH,"efcalendar_icon.png"],"left1Img":[EF_IMAGES_PATH,"efcalendar_left1.gif"],"left2Img":[EF_IMAGES_PATH,"efcalendar_left2.gif"],"right1Img":[EF_IMAGES_PATH,"efcalendar_right1.gif"],"right2Img":[EF_IMAGES_PATH,"efcalendar_right2.gif"]}
efico.efform={"normal":[EF_IMAGES_PATH,"efform_status_green.png"],"alert":[EF_IMAGES_PATH,"efform_status_yellow.gif"],"error":[EF_IMAGES_PATH,"efform_status_red.gif"],"loading":[EF_IMAGES_PATH,"efform_status_loading.gif"],"close":[EF_IMAGES_PATH,"efform_close.png"],"help":[EF_IMAGES_PATH,"efform_help.png"],"print":[EF_IMAGES_PATH,"efform_prnt_avail.png"],"full":[EF_IMAGES_PATH,"efform_full_screen.gif"],"tofull":[EF_IMAGES_PATH,"efform_tofull_screen.gif"],"dev":[EF_IMAGES_PATH,"efform_ico_dev.png"],"run":[EF_IMAGES_PATH,"efform_ico_run.gif"],"ajaxLoader":[EF_IMAGES_PATH,"ajax-loader.gif"],"ajaxLoading":[EF_IMAGES_PATH,"ajax-loading.gif"],"bg01":[EF_IMAGES_PATH,"bg01.jpg"],"btn":[EF_IMAGES_PATH,"btn.gif"],"btnAfresh":[EF_IMAGES_PATH,"btn_afresh.gif"],"btnLogin":[EF_IMAGES_PATH,"btn_login.gif"],"closeDialog":[EF_IMAGES_PATH,"close_dialog.gif"],"closeWindow":[EF_IMAGES_PATH,"close_window.jpg"],"efBbgline01":[EF_IMAGES_PATH,"ef_b_bgline01.jpg"],"efExportPdf":[EF_IMAGES_PATH,"ef_export_pdf.jpg"],"efExportXls":[EF_IMAGES_PATH,"ef_export_xls.png"],"efImgList":[EF_IMAGES_PATH,"ef_list.png"],"efLogoCommon":[EF_IMAGES_PATH,"ef_logo_common.jpg"],"efLogoIplat":[EF_IMAGES_PATH,"ef_logo_iplat.jpg"],"efPopupWindow":[EF_IMAGES_PATH,"ef_pop_up_window.png"],"efQueryDynamic":[EF_IMAGES_PATH,"ef_query_dynamic.gif"],"efQuerySimple":[EF_IMAGES_PATH,"ef_query_simple.gif"],"return":[EF_IMAGES_PATH,"efform_return.gif"],"statusLoading":[EF_IMAGES_PATH,"efform_status_loading.gif"],"bottomLeft":[EF_IMAGES_PATH,"efframe_bottom_left.jpg"],"templateBottom":[EF_IMAGES_PATH,"template-bottom.jpg"],"efframeLeft":[EF_IMAGES_PATH,"efframe_left.jpg"],"efframeRight":[EF_IMAGES_PATH,"efframe_right.jpg"],"efframeBottomMiddle":[EF_IMAGES_PATH,"efframe_bottom_middle.jpg"],"efframeBottomRight":[EF_IMAGES_PATH,"efframe_bottom_right.jpg"],"efframeMenuDown":[EF_IMAGES_PATH,"efframe_menudown.gif"],"efframeMenuUp":[EF_IMAGES_PATH,"efframe_menuup.gif"],"imgSpacer":[EF_IMAGES_PATH,"spacer.gif"],"templateBottom":[EF_IMAGES_PATH,"template-bottom.gif"],"templateTop":[EF_IMAGES_PATH,"template-top.gif"],"imgUser":[EF_IMAGES_PATH,"user.gif"],"imgVgrabber":[EF_IMAGES_PATH,"vgrabber.gif"]}
efico.efreport={"efFalseClear":[EF_IMAGES_PATH,"ef_false.png"],"efImgFunction":[EF_IMAGES_PATH,"ef_function.png"],"efDetail":[EF_IMAGES_PATH,"ef_detail.png"],"efImgFind":[EF_IMAGES_PATH,"ef_find.png"],"efImgHelp":[EF_IMAGES_PATH,"ef_help.png"],"efCommand":[EF_IMAGES_PATH,"ef_command.png"],"efDefine":[EF_IMAGES_PATH,"ef_define.png"],"efPageDistanceDown":[EF_IMAGES_PATH,"ef_pageDistance_down.jpg"],"efPageDistanceTop":[EF_IMAGES_PATH,"ef_pageDistance_top.jpg"],"efImgPrint":[EF_IMAGES_PATH,"ef_print.png"],"efImgPrintConfig":[EF_IMAGES_PATH,"ef_print_config.png"],"efImgPrintHorizontal":[EF_IMAGES_PATH,"ef_print_horizontal.jpg"],"efImgPrintVertical":[EF_IMAGES_PATH,"ef_print_vertical.jpg"],"efImgRight":[EF_IMAGES_PATH,"ef_right.png"],"efImgSave":[EF_IMAGES_PATH,"ef_save.png"]}
efico.personalStyle={"imgFootBg07":[EF_IMAGES_PATH,"foot_bg07.gif"],"imgBtnBg":[EF_IMAGES_PATH,"btn_bg.gif"],"imgMainBg07":[EF_IMAGES_PATH,"main_bg07.gif"],"imgThbg07":[EF_IMAGES_PATH,"thbg07.png"],"imgTitBg07":[EF_IMAGES_PATH,"tit_bg07.gif"]}

var reloginPopup=false;efutils=function(){}
efutils.getValidateRegex=function(name){return ef_validator_regexes[name];}
efutils.getTotalBytes=function(str){if(str==null||str=="")return 0;var totalCount=0;for(i=0;i<str.length;i++){if(str.charCodeAt(i)>127)
totalCount+=2;else
totalCount++;}
return totalCount;}
efutils.trimString=function(str){if(str instanceof Array||str instanceof Object){return JSON2String(str);}
return(str==null)?"":(str+'').trim();}
efutils.formatHtmlCharacter=function(str){str=efutils.trimString(str);str=str.replace(/\#/g,"&#35;");str=str.replace(/\&/g,"&#38;");str=str.replace(/\</g,"&#60;");str=str.replace(/\>/g,"&#62;");str=str.replace(/\?/g,"&#63;");return str;}
efutils.replaceString=function(str,regx1,value1,regx2,value2){var temp=str.split(regx1);for(var i=0;i<temp.length;i++)
temp[i]=temp[i].replace(regx2,value2);return temp.join(value1);}
efutils.isEmpty=function(m){for(var key in m)
return false;return true;}
efutils.getImageUrl=function(name){return EF_IMAGES_PATH+name;}
efutils.copyArray=function(a){var copy=[];for(var i=0;i<a.length;i++)
copy.push(a[i]);return copy;}
efutils.replaceCR=function(str_value,replace_str){if(!isAvailable(replace_str))
replace_str=EF_CR_IDENTIFIER;str_value=efutils.trimString(str_value);var index=str_value.indexOf("\r\n");while(index!=-1){str_value=str_value.substring(0,index)+replace_str+str_value.substring(index+2);index=str_value.indexOf("\r\n");}
return str_value;}
efutils.maxInGrid=function(gridID,columnName){var grid=efgrid.getGridObject(gridID);var length=grid.blockData.rows.length;var t=grid.blockData.getBlockMeta().getMeta(columnName).type;var max=grid.blockData.getCell(0,columnName);var current;for(var i=1;i<length;i++){current=grid.blockData.getCell(i,columnName);if(efutils.compareContent(current,max,t)>0){max=current;}}
return max;}
efutils.minInGrid=function(gridID,columnName){var grid=efgrid.getGridObject(gridID);var length=grid.blockData.rows.length;var t=grid.blockData.getBlockMeta().getMeta(columnName).type;var min=grid.blockData.getCell(0,columnName);var current;for(var i=1;i<length;i++){current=grid.blockData.getCell(i,columnName);if(efutils.compareContent(current,min,t)<0){min=current;}}
return min;}
efutils.sortGird=function(gridID,columnName,isAsceding){var grid=efgrid.getGridObject(gridID);var length=grid.blockData.rows.length;isAsceding=(isAsceding.toLowerCase()==='true');var t=grid.blockData.getBlockMeta().getMeta(columnName).type;efutils.quicksort(grid,columnName,t,0,length-1,isAsceding);grid.refresh();}
efutils.quicksort=function(grid,columnName,columnType,start,end,isAsceding){if(start<end){var pos=efutils.partition(grid,columnName,columnType,start,end,isAsceding);efutils.quicksort(grid,columnName,columnType,start,pos-1,isAsceding);efutils.quicksort(grid,columnName,columnType,pos+1,end,isAsceding);}}
efutils.partition=function(grid,columnName,columnType,start,end,isAsceding){var pivot=grid.blockData.getCell(start,columnName);var j=start;var iTemp;var compareTemp;for(var i=start+1;i<=end;i++){iTemp=grid.blockData.getCell(i,columnName);compareTemp=efutils.compareContent(iTemp,pivot,columnType);if(compareTemp<0&&isAsceding||compareTemp>0&&(!isAsceding))
efutils.swapLine(grid,++j,i);}
efutils.swapLine(grid,j,start);return j;}
efutils.swapLine=function(grid,i,j){var temp=grid.blockData.rows[i];grid.blockData.rows[i]=grid.blockData.rows[j];grid.blockData.rows[j]=temp;var tempStatus=grid.rowStatus[i];grid.rowStatus[i]=grid.rowStatus[j];grid.rowStatus[j]=tempStatus;}
efutils.compareContent=function(i,j,t){if(t.toLowerCase()==='c'){return i.localeCompare(j);}else if(t.toLowerCase()==='n'){i=parseFloat(i);j=parseFloat(j);return i-j;}else{alert('Comparison not support this type: '+t);return undefined;}}
efutils.getCssStyle=function(rulsName){for(var i=document.styleSheets.length-1;i>=0;i--){var rules;if(document.styleSheets[i].cssRules){rules=document.styleSheets[i].cssRules;}else{rules=document.styleSheets[i].rules;}
for(var j=0;j<rules.length;j++){if(rules[j].selectorText==rulsName){return rules[j].style;}}}}
efutils.showPageButton=function(buttonData){for(i=0;t=buttonData[i];i++){button_ename=t[0];button_cname=t[1];button_status=t[2];button_node=ef.get("button_"+button_ename);if(!button_node)
continue;var _cname=button_node.getAttribute("cname");if(!!_cname&&_cname!="")
button_cname=_cname;button_node.setAttribute("buttonStatus",button_status);efbutton.newButton(button_node,button_ename,button_cname,null);}}
getTopWnd=function(){var _wnd=window;try{while(isAvailable(_wnd)&&!isAvailable(_wnd.lastActivity)){try{if(isAvailable(_wnd.opener)&&_wnd!=_wnd.opener){_wnd=_wnd.opener;continue;}
if(isAvailable(_wnd.top)&&_wnd!=_wnd.top){_wnd=_wnd.top;continue;}}catch(ex){_wnd=null;break;}
_wnd=null;break;}}catch(_ex){return null;}
return _wnd;}
checkTimeOut=function(sCallback){if(document.readyState=='complete')
{var topWnd=getTopWnd();if(isAvailable(topWnd)&&isAvailable(topWnd.lastActivity))
{if(new Date().getTime()>topWnd.lastActivity+efgrid.config.SESSION_TIMEOUT){if(reloginPopup)
{return true;}
EFColorbox({href:"relogin.jsp?loginType='popup'",title:"登录",overlayClose:false,innerWidth:600,innerHeight:300,iframe:true,scrolling:false,onClosed:function(){reloginPopup=false;}});reloginPopup=true;return true;}else{topWnd.lastActivity=new Date().getTime();return false;}}}
return false;}
function buildInfo()
{var eiinfo=_getEi();if(!isAvailable(window)||!isAvailable(window.opener)||!isAvailable(window.opener._DESIGNER_PAGE))
return;var jspCode=window.opener.getCompleteCode();if(!isAvailable(jspCode.match(/<\s*body/gi))||!isAvailable(jspCode.match(/body\s*>/gi)))
{alert('页面内容不合法，请重新编辑');return;}
var jspCodePreview="";var formSPos=jspCode.indexOf(jspCode.match(/<\s*body/gi)[0]);var bodyTail=jspCode.match(/body\s*>/gi)[0];var formEPos=jspCode.indexOf(bodyTail)+bodyTail.length;jspCodePreview+=jspCode.substring(formSPos,formEPos);renderPageInfo(eiinfo,jspCodePreview);}
function renderPageInfo(eiinfo,jspCodePreview)
{var tagNodes=$(jspCodePreview).children();for(var i=0;i<tagNodes.length;i++)
{var child=tagNodes[i];var attrs=child.attributes;if(attrs.getNamedItem('blockId')!=null)
{var blockId=attrs.getNamedItem('blockId').value;var block=new EiBlock(blockId);eiinfo.addBlock(block);}else if(attrs.getNamedItem('blockName')!=null){var blockId=attrs.getNamedItem('blockName').value;var block=new EiBlock(blockId);eiinfo.addBlock(block);}
renderPageInfo(eiinfo,child);}}

var domLayout={_isIE:navigator.appName=="Microsoft Internet Explorer",_isFF:navigator.appName=="Netscape",getBorderLeft:function(el){if(domLayout._isIE){return el.clientLeft};return parseInt(window.getComputedStyle(el,null).getPropertyValue("border-left-width"));},getInnerLeft:function(el){if(el==null)return 0;if(domLayout._isIE&&el==document.body||domLayout._isFF&&el==document.documentElement)return 0;return domLayout.getLeft(el)+domLayout.getBorderLeft(el);},getLeft:function(el){if(el==null)return 0;return el.offsetLeft+domLayout.getInnerLeft(el.offsetParent);},getBorderTop:function(el){if(domLayout._isIE){return el.clientTop};return parseInt(window.getComputedStyle(el,null).getPropertyValue("border-top-width"));},getInnerTop:function(el){if(el==null)return 0;if(domLayout._isIE&&el==document.body||domLayout._isFF&&el==document.documentElement)return 0;return domLayout.getTop(el)+domLayout.getBorderTop(el);},getTop:function(el){if(el==null)return 0;return el.offsetTop+domLayout.getInnerTop(el.offsetParent);},getOuterRect:function(el){return{left:domLayout.getLeft(el),top:domLayout.getTop(el),width:el.offsetWidth,height:el.offsetHeight};},getDocumentRect:function(){var _width=0;var _height=0;if(domLayout._isIE){_width=document.body.clientWidth;_height=document.body.clientHeight;}else{_width=window.innerWidth;_height=window.innerHeight;};return{left:0,top:0,width:_width,height:_height};},getScrollPos:function(el){var _left=0;var _top=0;if(domLayout._isIE){_left=document.body.scrollLeft;_top=document.body.scrollTop;}else{_left=window.pageXOffset;_top=window.pageYOffset;};return{left:_left,top:_top};},_border:{borderLeft:1,borderRight:1,borderTop:1,borderBottom:1},_padding:{paddingLeft:-5,paddingRight:-6,paddingTop:-2,paddingBottom:-2},_shaddow:{shadowLeft:0,shadowRight:0,shadowTop:0,shadowBottom:0},postionWithRel:function(el,relEl,hor,sBorder,sPadding,sShaddow){var border=(sBorder==undefined)?domLayout._border:sBorder;var padding=(sPadding==undefined)?domLayout._padding:sPadding;var shaddow=(sShaddow==undefined)?domLayout._shaddow:sShaddow;var _left=0;var _top=0;var piRect=relEl;if(relEl.left==null||relEl.top==null||relEl.width==null||relEl.height==null){piRect=domLayout.getOuterRect(relEl);}
var menuRect=domLayout.getOuterRect(el);var docRect=domLayout.getDocumentRect();var scrollPos=domLayout.getScrollPos();if(!hor){if(piRect.left+menuRect.width-scrollPos.left<=docRect.width)
_left=piRect.left;else if(docRect.width>=menuRect.width)
_left=docRect.width+scrollPos.left-menuRect.width;else
_left=scrollPos.left;if(piRect.top+piRect.height+menuRect.height<=docRect.height+scrollPos.top)
_top=piRect.top+piRect.height;else if(piRect.top-menuRect.height>=scrollPos.top)
_top=piRect.top-menuRect.height;else if(docRect.height>=menuRect.height)
_top=docRect.height+scrollPos.top-menuRect.height;else
_top=scrollPos.top;}else{if(piRect.top+menuRect.height-border.borderTop-padding.paddingTop<=docRect.height+scrollPos.top)
_top=piRect.top-border.borderTop-padding.paddingTop;else if(piRect.top+piRect.height-menuRect.height+border.borderTop+padding.paddingTop>=0)
_top=piRect.top+piRect.height-menuRect.height+border.borderBottom+padding.paddingBottom+shaddow.shadowBottom;else if(docRect.height>=menuRect.height)
_top=docRect.height+scrollPos.top-menuRect.height;else
_top=scrollPos.top;if(piRect.left+piRect.width+menuRect.width+padding.paddingRight+border.borderRight-border.borderLeft+shaddow.shadowRight<=docRect.width+scrollPos.left)
_left=piRect.left+piRect.width+padding.paddingRight+border.borderRight-border.borderLeft;else if(piRect.left-menuRect.width-padding.paddingLeft-border.borderLeft+border.borderRight+shaddow.shadowRight>=0)
_left=piRect.left-menuRect.width-padding.paddingLeft-border.borderLeft+border.borderRight+shaddow.shadowRight;else if(docRect.width>=menuRect.width)
_left=docRect.width+scrollPos.left-menuRect.width;else
_left=scrollPos.left;}
el.style.left=_left+"px";el.style.top=_top+"px";return{left:_left,top:_top};}}

var ef_form_init_time=new Date();var ef_form_validate_message=new Object();var ef_grids=new Object();var ef_config=new Object();var __DEBUG=false;var __DEBUG_MSG=[];var hidemsg=false;ef=function(){}
ef.getNodeById=function(node_id){var node_get=ef.get(node_id);if(!node_get)
alert("ID["+node_id+"] not exist");return node_get;}
ef.get=function(node_id){var node_get=document.getElementById(node_id);if(!node_get){var nodelist=document.getElementsByName(node_id);if(nodelist.length>0)
node_get=nodelist[0];}
return node_get;}
ef.debug=function(msg){ef.log("[DEBUG] - "+msg);}
ef.toggleDivDisplay=function(divId){var node=ef.get(divId);if(node.style.display=="none")
node.style.display="block";else
node.style.display="none";}
ef.info=function(msg){ef.log("[INFO] - "+msg);}
ef.log=function(msg){if(__DEBUG)
__DEBUG_MSG.push(msg);}
efform=function(){}
var efform_submit_flag=false;efform.submit=function(formSubmit){if(efgrid.config!=undefined&&efgrid.config.SESSION_TIMEOUT!=undefined){if(checkTimeOut())
{return;}}
efform_submit_flag=true;formSubmit.submit();}
efform.onload=function(){var ef_form_load_time=new Date();ef.debug("ef("
+ef_version
+") form took: "
+(ef_form_load_time.getTime()-ef_form_init_time.getTime()).toString()+"ms to load");efform.setFormTitle();efform._clientWidth=document.body.clientWidth;efform.__loadSuccessFlag=true;if(typeof efform_onload=="function"){try{efform_onload();}catch(ex){efform.__loadSuccessFlag=false;var showErrorException=true;
if(__eiInfo)
{
var runAutoTestFlag=__eiInfo.get("efRunAutoTestFlag");
if(runAutoTestFlag=="1")
showErrorException=false;
}
if(showErrorException)
efgrid.processException(ex,"Callback to efform_onload failed");}}
try{if(__eiInfo!=undefined&&__eiInfo.status<0&&efform.msgDisplayStyle=="alert")
EFAlert("status_code:"+$("#_eiMsgKey")[0].innerHTML+"\nmsg:"
+$("#_eiMsg")[0].innerHTML);}catch(ex){}}
efform.setFormTitle=function(){try{if(efutils.trimString(window.document.title)==""){window.document.title=ef.get("efFormEname").value+"/"
+ef.get("efFormCname").value+"["+window.location.host
+"]";}}catch(ex){}}
efform.setPageTitle=function(title){ef.get("pageTitle").innerText=title;}
efform.hideFormHead=function(hide){ef.get("ef_form_head").style.display='none';if(hide==undefined){hidemsg=true;}
else{hidemsg=hide;}}
efform.repaint=function(){ef_form_init_time=new Date();for(var key in ef_grids){if(key!="_ef_grid_subgrid"&&(typeof ef_grids[key].paint!='undefined'))
ef_grids[key].paint();}
var ef_form_load_time=new Date();ef.debug("ef("+ef_version+") form took: "
+(ef_form_load_time.getTime()-ef_form_init_time.getTime())
+"ms to load");}
efform.alertTime=function(msg_info){var ef_form_load_time=new Date();ef.debug(msg_info
+(ef_form_load_time.getTime()-ef_form_init_time.getTime()));}
if(isIE){efform.RESIZE_INTERVAL=300;}
efform.RESIZE_SCALE=1;efform.init=function(){window.onload=efform.onload;window.onresize=function(){if(!efform._clientWidth||Math.abs(document.body.clientWidth-efform._clientWidth)<efform.RESIZE_SCALE)
return;efform._clientWidth=document.body.clientWidth;efform.repaint();}}
efform._resize=function(){if(new Date()-efform._resizeTime>efform.RESIZE_INTERVAL){clearInterval(efform._resizeInterval);efform._resizeInterval=undefined;efform.repaint();}}
efform._statusInfoCount=0;efform.setStatus=function(status_code,msg,msgKey,ef_form_ename){msg=efutils.trimString(msg);if(msg==""){return;}
if($(document.body).hasClass("ef-form-iframe-body")){var msgBody=$('#efFormStatus',window.parent.parent.document);if(msgBody){parent.efform.setStatus(status_code,msg,msgKey,ef.get("efFormEname").value);return;};}
var status_img=$("#_eiStatusImg");if(!status_img||status_img.length==0){return;}
var old_status_code=$("#efFormStatus").attr("statusCode");var exist_time_id=$("#efFormStatus").attr("timeId");efform._statusInfoCount++;if(!old_status_code){}else{if(old_status_code==0){$("#efFormStatus").removeClass("ui-state-default");}else if(old_status_code<0){$("#efFormStatus").removeClass("ui-state-error");}else if(old_status_code>0){$("#efFormStatus").removeClass("ui-state-highlight");}}
if(status_code==0){$("#efFormStatus").addClass("ui-state-default");status_img.removeClass().addClass('ui-icon  ui-icon-info');}else if(status_code<0){$("#efFormStatus").addClass("ui-state-error");status_img.removeClass().addClass('ui-icon  ui-icon-alert');}else if(status_code>0){$("#efFormStatus").addClass("ui-state-highlight");status_img.removeClass().addClass('ui-icon  ui-icon-notice');}
if(status_code<0&&efform.msgDisplayStyle=="alert")
EFAlert("status_code:"+status_code+"\n msg:"+msg);if(!msgKey)msgKey="";ef.get("_eiMsgKey").innerText=msgKey;if(ef_form_ename!=null){ef.get("_efFormEname").innerText=ef_form_ename;}else{ef.get("_efFormEname").innerText=ef.get("efFormEname").value;}
var msgAcc="false";if(efform.config!=undefined&&efform.config.MSG_ACCUMULATE!=undefined)
{msgAcc=efform.config.MSG_ACCUMULATE;}
if(msgAcc=="false"||typeof($("#efFormStatus").attr("statusCode"))=='undefined'||$("#efFormStatus").attr("statusCode")>=0||!$("#efFormStatus").dialog('isOpen'))
{ef.get("_eiMsg").innerHTML=msg;$("#efFormStatus").attr("statusCode",status_code);}
else{ef.get("_eiMsg").innerHTML=ef.get("_eiMsg").innerHTML+"<br/>"+msg;status_code=$("#efFormStatus").attr("statusCode");}
if(!hidemsg)
{$("#efFormDetailDiv").hide();$("#efFormStatus").css('overflow','hidden').dialog({create:function(event,ui){$(".ui-widget-header").hide();},open:function()
{$('#efFormStatus a').blur();},dialogClass:"ef-form-status-bar",position:["auto",0],width:"500",minHeight:"auto",resizable:false});}
if(exist_time_id){clearTimeout(exist_time_id);}
if(status_code==0){var showtime="3000";if(efform.config!=undefined&&efform.config.MSG_SHOWTIME!=undefined){showtime=efform.config.MSG_SHOWTIME;}
if($('#'+'_stickStatus').attr("stickStatus")=="w"){var new_time_id=setTimeout("$('#efFormStatus').slideUp()",showtime);$("#efFormStatus").attr("timeId",new_time_id);}}};efform.getAllGridIDs=function(){var grid_ids=[];for(var key in ef_grids){if(key!="_ef_grid_subgrid")
grid_ids.push(key);}
return grid_ids;}
efform.addGrid=function(grid){ef_grids[grid.gridId]=grid;}
efform.getGrid=function(grid_id){var grid=ef_grids[grid_id];if(!isAvailable(grid))
throw new Error("Grid with id ["+grid_id+"] not exists!");return grid;}
efform._removeGrid=function(grid_id){delete ef_grids[grid_id];}
efform.clearDiv=function(div_id){try{var div_node=$("#"+div_id)[0];efform.clearInputField(div_node);}catch(exception){alert(exception.message);}}
efform.clearInputField=function(node){if(node.tagName=="SELECT")
node.selectedIndex=node.options.length>0?0:-1;switch(node.tagName){case"INPUT":switch(node.type){case"text":case"file":case"password":break;case"checkbox":case"radio":node.checked=false;default:return;}
case"TEXTAREA":node.value="";break;case"SELECT":node.selectedIndex=(node.options.length>0)?0:-1;break;default:for(var i=0;i<node.childNodes.length;i++)
efform.clearInputField(node.childNodes[i]);}}
efform.hasErrorMessage=function(){for(var key in ef_form_validate_message)
return true;return false;}
efform.showErrorMessage=function(){if(efform.hasErrorMessage()){var message=[];for(var key in ef_form_validate_message){message.push("* "+ef_form_validate_message[key]);}
efform.setStatus(-1,message.join('\t'));}}
efform.setSelectDiv=function(selectID)
{if($.browser.msie)
{try{var selectWidth=document.getElementById(selectID).style.width;var containedDivID="div_"+selectID;$('#'+containedDivID).css('width',selectWidth.toString());}catch(ex)
{}}}
efform.setErrorStyle=function(node,msg,status){if(node==null)
return;if(!status)
{if(node.type=="select-one")
{if($.browser.msie)
{var selectDivId="div_"+node.id;var selectDiv=$("#"+selectDivId);var width=node.style.width;selectDiv.css({'border':'red solid 1px','width':width.toString()});}
else
{$(node).addClass('ef-state-error');}}
else
{$(node).addClass('ef-state-error');}
node.title=msg;}
else
{if(node.type=="select-one")
{if($.browser.msie)
{var selectDivId="div_"+node.id;var selectDiv=$("#"+selectDivId);var width=node.style.width;selectDiv.css({'borderColor':'','borderStyle':''});node.style.backgroundColor="";}
else
{$(node).removeClass('ef-state-error');}}
else
{$(node).removeClass('ef-state-error');}
node.title=msg;}}
efform.getErrorMessage=function(){if(efform.hasErrorMessage()){var message=[];var i=0;for(var key in ef_form_validate_message){if(i!=0)
message.push("\n");else
i=1;message.push("* "+ef_form_validate_message[key]);}
return message.join('');}
return"";}
efform.clearErrorMessage=function(){for(var key in ef_form_validate_message)
delete ef_form_validate_message[key];}
efform.windowOnError=function(msg,url,line){if(__DEBUG){throw new Error(msg);}else{alert("javascript exception: "+msg);return true;}}
efform.togglenav=function(nav){try{if(isAvailable(__DEBUG))
efdebugger.show();}catch(ex){}}
efform.formRefresh=function(){}
efform.formPrint=function(){}
efform.getSubGridDiv=function(title,divid){var div_id="ef_subgrid";if(!!divid)div_id=divid;var div_node=$("#"+div_id);if(div_node.length==0){div_node=efform.createDivWindow(div_id,"efwindow",title);return div_node;}
div_node.find("script").remove();return div_node[0];}
efform.getSubDiv=function(div_id,title){if(div_id==null||div_id==undefined||div_id=="")
return;var div_node=$("#"+div_id);if(div_node.length==0){div_node=efform.createDivWindow(div_id,"efwindow",title);return div_node;}
div_node.find("script").remove();return div_node[0];}
efform.createDivWindow=function(div_id,styleClassName,title){var ef_subwindow=$("#"+div_id)[0];if(ef_subwindow)
throw new Error("Element with id ["+div_id+"] already exists!");ef_subwindow=document.createElement("div");ef_subwindow.id=div_id;if(!title)
ef_subwindow.title=getI18nMessages("ef.Select","请选择");else
ef_subwindow.title=title;ef_subwindow.innerHTML="&nbsp;"
document.forms[0].appendChild(ef_subwindow);var dlgDiv=$("#"+div_id);dlgDiv.dialog({autoOpen:false,height:200,width:300});return ef_subwindow;}
efform.showSubGridWindow=function(component_id,eiInfo){var component=$("#"+component_id)[0];if(!component)
return;var div_node=efform.getSubGridDiv();var column_new=div_node.efDisplayCol;var column_old=div_node.efDisplayingCol;if(column_old!=null&&column_old==column_new){efwindow.show(component,div_node.id,"fixed");return;}
if(!(column_new instanceof efSubgridColumn))
return;div_node.efDisplayingCol=column_new;var title=getI18nMessages("ef.Select","请选择");var inner_html=[];inner_html.push("<div id='_ef_grid_subgrid' title='"
+column_new.getCname()
+"' style='overflow:hidden;width:400px;height:280px;'></div>");var button_json=[{text:getI18nMessages("ef.Save","保存"),click:function(){efform.subgrid_save_onclick();}}];div_node.innerHTML=inner_html.join("");var style_config=new Object();style_config["operationBar"]="false";var sub_grid=new efgrid(column_new.getBlockName(),"_ef_grid_subgrid");var custom_cols={"index":{},"metas":[]};sub_grid.setEnable(false);sub_grid.setReadonly(false);sub_grid.setAjax(true);sub_grid.setAutoDraw(true);sub_grid.setServiceName(column_new.getServiceName());sub_grid.setQueryMethod(column_new.getQueryMethod());sub_grid.setCustomColumns(custom_cols);sub_grid.setIsSubGrid(true);sub_grid.onRowDblClicked=function(){efform.subgrid_save_onclick();}
if(typeof(eiInfo)=="undefined"){sub_grid.setData(_getEi());}else{sub_grid.setData(eiInfo);}
sub_grid.setStyle(style_config);sub_grid.paint();efwindow.show(component,div_node.id,"fixed",title,button_json);}
efform.showTextAreaWindow=function(component_id){var component=$("#"+component_id)[0];if(!component)
return;var title=getI18nMessages("ef.Detail","详情");var div_node=efform.getSubGridDiv(title);var show_value=component.value;var index=show_value.indexOf(EF_CR_IDENTIFIER);while(index!=-1){show_value=show_value.substring(0,index)+"\r\n"
+show_value.substring(index+2);index=show_value.indexOf(EF_CR_IDENTIFIER);}
var inner_html=[];inner_html.push("<div style='width:320px;text-align:center'>");inner_html.push("<textarea wrap=\"hard\" rows=10 cols=50 style='width:100%;height:140px;margin-top:1px;margin-bottom:0px' id=\"subwindow_textarea\" >"
+show_value+"</textarea>");inner_html.push("</div>");div_node.innerHTML=inner_html.join("");var button_json=[{text:getI18nMessages("ef.Save","保存"),click:function(){efform.textarea_save_onclick();}}];efwindow.show(component,div_node.id,"fixed",title,button_json);}
efform.showSubTreeWindow=function(component_id,treeModel,treeDivId,sText,refresh,configFunc){if((typeof component_id)=="string")
var component=$("#"+component_id)[0];else
component=component_id;if(!component)
return;var title=getI18nMessages("ef.Detail","详情");var div_node=efform.getSubDiv("ef_subTree"+treeDivId,title);if((refresh==true)||(div_node.innerHTML=="&nbsp;")){var inner_html=[];inner_html.push("<TABLE cellspacing='0'  cellpadding='1'>");inner_html.push("<TR><TD colspan=2>");inner_html.push("<DIV style='overflow:auto;height:280px;width:250px;'id='"
+treeDivId+"'/>");inner_html.push("</TD></TR>");inner_html.push("</TABLE>");div_node.innerHTML=inner_html.join("");var tree=new EFTree(treeModel,treeDivId,sText);eval(configFunc+"(tree)");var skeleton=tree.render();if(treeModel.status()==-1)
{return;}
$('#'+treeDivId).append(skeleton);}
efwindow.show(component,div_node.id,"fixed",title);}
efform.showPopupWindow=function(popupContentId,input_id){var component=$("#"+input_id)[0];if(!component)
return;var div_node=efform.getSubDiv(popupContentId);div_node.relativePopupParent=component;efwindow.show(component,div_node.id,"fixed");addButtonEffect();}
efform.showPopupGridWindow=function(popupContentId,input_id,visibleColumnNames,visibleColumnDisplayNames,valueProperty,labelProperty,popType,backFillColumnIds,backFillFieldIds){var component=$("#"+input_id)[0];if(!component)
return;var div_node=efform.getSubDiv(popupContentId);var fieldId=popupContentId.substring(9);var button_json=[{text:getI18nMessages("ef.Save","保存"),click:function(){efform.popGrid_save_onclick('ef_grid_'+fieldId,valueProperty,labelProperty,popType,backFillColumnIds,backFillFieldIds);}}];var ajax_callback={onSuccess:function(eiInfo){var currentEiinfo=_getEi();currentEiinfo.addBlock(eiInfo.getBlock(fieldId))
sub_grid.setData(currentEiinfo);sub_grid.paint();div_node.relativePopupParent=component;efwindow.show(component,div_node.id,"fixed",null,button_json);showComponent=component;},onFail:function(eMsg){alert("failure："+eMsg);}}
var sub_grid;if(div_node.innerHTML=="&nbsp;"){var inner_html=[];inner_html.push("<TABLE cellspacing='0' cellpadding='1'>");inner_html.push("<TR onmouseover='efform.nullfunction();' onclick='efform.nullfunction();' onmousemove='efform.nullfunction();'><TD colspan=2>");inner_html.push("<div id=ef_grid_"+fieldId
+" style='overflow:hidden;width:400px;height:280px;'></div>");inner_html.push("</TD></TR>");inner_html.push("</TABLE>");div_node.innerHTML=inner_html.join("");var style_config=new Object();sub_grid=new efgrid(fieldId,"ef_grid_"+fieldId);div_node.gridObject=sub_grid;var custom_cols={"index":{},"metas":[]};var columns=visibleColumnNames.split(",");var columndescs=visibleColumnDisplayNames.split(",");for(var i=0;i<columns.length;i++){custom_cols["index"][columns[i]]=i;custom_cols["metas"][i]=new Object();custom_cols["metas"][i]["name"]=columns[i];custom_cols["metas"][i]["descName"]=columns[i];if(columndescs!=null&&columndescs!=""&&columndescs.length>i)
custom_cols["metas"][i]["descName"]=columndescs[i];custom_cols["metas"][i]["primaryKey"]=false;custom_cols["metas"][i]["sort"]=false;custom_cols["metas"][i]["pos"]=i;}
sub_grid.setEnable(false);sub_grid.setReadonly(false);sub_grid.setAjax(true);sub_grid.setAutoDraw(false);sub_grid.setCustomColumns(custom_cols);sub_grid.setStyle(style_config);sub_grid.setServiceName("EDCMUtils");sub_grid.setQueryMethod("getCodesetEiInfo");sub_grid.onGridSubmit=function(info){info.set("codesetCode",fieldId)
if(typeof(popupGrid_beforeDisplay)=="function")
popupGrid_beforeDisplay(fieldId,popType,info,sub_grid);};sub_grid.onRowDblClicked=function(){efform.popGrid_save_onclick("ef_grid_"+fieldId,valueProperty,labelProperty,popType,backFillColumnIds,backFillFieldIds);}
var ei_info=new EiInfo();ei_info.set("codesetCode",fieldId);if(typeof(popupGrid_beforeDisplay)=="function")
popupGrid_beforeDisplay(fieldId,popType,ei_info,sub_grid);EiCommunicator.send("EDCMUtils","getCodesetEiInfo",ei_info,ajax_callback);}else{sub_grid=div_node.gridObject;sub_grid.onRowDblClicked=function(){efform.popGrid_save_onclick("ef_grid_"+fieldId,valueProperty,labelProperty,popType,backFillColumnIds,backFillFieldIds);}
var ei_info=new EiInfo();ei_info.set("codesetCode",fieldId);var needRefresh=false;if(typeof(popupGrid_beforeDisplay)=="function")
needRefresh=popupGrid_beforeDisplay(fieldId,popType,ei_info,sub_grid);if(needRefresh)
EiCommunicator.send("EDCMUtils","getCodesetEiInfo",ei_info,ajax_callback);else{efwindow.show(component,div_node.id,"fixed",null,button_json);}}
addButtonEffect();}
efform.popGrid_save_onclick=function(gridId,valueProperty,labelProperty,popType,backFillColumnIds,backFillFieldIds){var sub_grid=efform.getGrid(gridId);var index=sub_grid.getCurrentRowIndex();if(index<0){alert(getI18nMessages("ef.NotSelect","未选择记录"));return;}
var row=sub_grid.getBlockData().getRows()[index];var cell_value=sub_grid.getBlockData().getCell(index,valueProperty);if(labelProperty!=undefined||labelProperty!=""&&showComponent.tagName=='INPUT'){var cell_label=sub_grid.getBlockData().getCell(index,labelProperty);showComponent.nextSibling.value=cell_label;showComponent.value=cell_value;}
var columnIds=backFillColumnIds.split(",");var fieldIds=backFillFieldIds.split(",");if(columnIds.length>0&&fieldIds.length>0){var ef_grid=null;var block=null;row_index=null;if(popType=="popupGrid"){var ef_grid=efgrid.getEfGridNode(showComponent).efgrid;var block=ef_grid.blockData;var pos=efgrid.getCellPos(showComponent);var row_index=pos.row;}
for(var i=0;i<fieldIds.length;i++){if(columnIds.length<i+1)
continue;if(popType=="popupInput"){var field=$("#"+fieldIds[i])[0];if(field!=null){field.value=sub_grid.getBlockData().getCell(index,columnIds[i]);}}else if(popType=="popupGrid"){var sValue=sub_grid.getBlockData().getCell(index,columnIds[i]);block.setCell(row_index,fieldIds[i],sValue);}}
if(popType=="popupGrid"){for(var i=1;i<ef_grid.getColCount(TYPE_FIX);i++){var column=ef_grid.getColumn(i,TYPE_DATA);for(var j=0;j<fieldIds.length;j++){if(fieldIds[j].equals(column.customSetting.name))
ef_grid.refreshCell(row_index,i,TYPE_FIX);}}
for(var i=0;i<ef_grid.getColCount(TYPE_DATA);i++){var column=ef_grid.getColumn(i,TYPE_DATA);for(var j=0;j<fieldIds.length;j++){if(fieldIds[j]==column.customSetting.name)
ef_grid.refreshCell(row_index,i,TYPE_DATA);}}}}
if(typeof(popupGrid_afterDisplay)=="function")
popupGrid_afterDisplay(gridId.substring(8),popType,sub_grid);var dlgId="#ef_Popup_"+gridId.substring(8);$(dlgId).dialog("close");}
efform.subgrid_onmouseover=function(){if(event.srcElement.tagName!='TD')
return;var td_node=event.srcElement;if(td_node&&efgrid.getRowIndex(td_node.parentNode)>0)
td_node.parentNode.className='ef-grid-tableRow-Highlight';}
efform.subgrid_onmouseout=function(){if(event.srcElement.tagName!='TD')
return;var td_node=event.srcElement;if(td_node&&efgrid.getRowIndex(td_node.parentNode)>0)
td_node.parentNode.className='tableRow'
+(efgrid.getRowIndex(td_node.parentNode)&1);}
efform.textarea_save_onclick=function(){var text_area=$("#subwindow_textarea");var cell_value="";if(text_area.length!=0)
cell_value=text_area.val();efwindow.setValue(cell_value);}
efform.subgrid_save_onclick=function(){var sub_grid=efform.getGrid("_ef_grid_subgrid");var index=sub_grid.getCurrentRowIndex();if(index<0){alert(getI18nMessages("ef.NotSelect","未选择记录"));return;}
var div_node=efform.getSubGridDiv();var column=div_node.efDisplayingCol;var cell_value=sub_grid.getBlockData().getCell(index,column.getValueProperty());var labelProperty=column.getLabelProperty();if(labelProperty!=undefined&&labelProperty!=""&&showComponent.tagName=='INPUT'){var cell_label=sub_grid.getBlockData().getCell(index,labelProperty);showComponent.nextSibling.value=cell_label;var pos=efgrid.getCellPos(showComponent);var row_index=pos.row;var block=efgrid.getEfGridNode(showComponent).efgrid.blockData;if(block.meta.metas[labelProperty]!=undefined)
block.rows[row_index][block.meta.metas[labelProperty].pos]=cell_label;}
efwindow.setValue(cell_value);if(typeof subgrid_save_onclick=="function"){try{subgrid_save_onclick(sub_grid.gridId,cell_value);}catch(ex){efgrid.processException(ex,"Callback to subgrid_save_onclick failed");}}
$("#ef_subgrid").dialog("close");}
efform.subgrid_rebuild=function(){var div_node=efform.getSubGridDiv();div_node.efDisplayingCol=null;}
efform.showMultiselectWindow=function(component_id,columnEname){var component=$("#"+component_id)[0];var grid_node=efgrid.getEfGridNode(component);var ef_grid=grid_node.efgrid;var column=ef_grid.getColumnByName(columnEname);if(!isAvailable(component))
return;var title=getI18nMessages("ef.Detail","详情");var div_node=efform.getSubGridDiv(title);var show_value=component.value;var selectedItems=show_value.split(",");for(var i=0;i<selectedItems.length;i++){selectedItems[i]=selectedItems[i].trim();}
var index=show_value.indexOf(EF_CR_IDENTIFIER);while(index!=-1){show_value=show_value.substring(0,index)+"\r\n"
+show_value.substring(index+2);index=show_value.indexOf(EF_CR_IDENTIFIER);}
var labels=[];var columnListValue=column.columnListValue;var columnListLabel=column.columnListLabel;if(columnListValue&&columnListValue.length>0){for(var i=0;i<columnListValue.length;i++){var checked=" ";var label=columnListLabel[i];var value=columnListValue[i];var display_value=getDisplayValue(column,label,value);if(contains(selectedItems,columnListValue[i])){checked="checked";}
labels.push("<li style='list-style:none;border-bottom:1px solid #EEE;'><label><input rel='"
+columnListValue[i]
+"' type='checkbox' "
+checked+"/>"+display_value+"</label></li>");}}else{for(var i=0;i<selectedItems.length;i++){labels.push("<li style='list-style:none;'><label><input rel='"
+selectedItems[i]+"' type='checkbox' checked/>"
+selectedItems[i]+"</label></li>");}}
var inner_html=[];inner_html.push("<TABLE cellspacing='0' cellpadding='1' width='300px'>");inner_html.push("<TR onmouseover='efform.nullfunction();' onclick='efform.nullfunction();' onmousemove='efform.nullfunction();' ><TD colspan=2>");var multiSelectOption="<ul id='gridCellMultiSelectUl' style='margin:0;padding-left:0;border-bottom:1px solid #DDD;height:150px;'>"
+labels.join("")+"</ul>";inner_html.push(multiSelectOption);inner_html.push("</TD></TR>");inner_html.push("</TABLE>");div_node.innerHTML=inner_html.join("");var button_json=[{text:getI18nMessages("ef.Save","保存"),click:function(){efform.multiselect_save_onclick();}}];efwindow.show(component,div_node.id,"fixed",title,button_json);}
function getDisplayValue(column,label,value){var format_str=column.getFormatString();if(isAvailable(format_str)){if(!isAvailable(label)){for(var i=0;i<columnListValue.length;i++){if(columnListValue[i]==value){label=columnListLabel[i];break;}}
if(i>=columnListValue.length){value=columnListValue[0];label=columnListLabel[0];}}
return efutils.replaceString(format_str,"#valueString#",value,/\#labelString#/g,label);}else{if(label==null){for(var i=0;i<columnListValue.length;i++){if(columnListValue[i]==value){label=columnListLabel[i];break;}}
if(i>=columnListValue.length)
label=columnListLabel[0];}
return label;}}
function contains(arr,obj){var i=arr.length;while(i--){if(arr[i]===obj){return true;}}
return false;}
efform.multiselect_save_onclick=function(){var cell_value=[];$("#gridCellMultiSelectUl li label input:checked").each(function(){cell_value.push($(this).attr("rel"));});efwindow.setValue(cell_value.join(","));};efform.nullfunction=function(){}
efform.evalFunction=function(functionName){try{var func=eval(functionName);if(typeof(func)=="function"){var args=[];for(var i=1;i<arguments.length;i++)
args.push(arguments[i]);func.apply(this,args);}}catch(ex){}}
efform.setNewWindowStyle=function(style_string){ef_config["NEW_WINDOW"]=style_string;}
efform.setGridCurrentRowStyle=function(style_string){ef_config["GRID_CURRENT_ROW"]=style_string;}
efform.getGridCurrentRowStyle=function(){var style_string=ef_config["GRID_CURRENT_ROW"];return isAvailable(style_string)?style_string:'ef-grid-tableRow-CurrentRow';}
efform.newWindow=function(input_id,grid_id,row_index,col_index){var component=$("#"+input_id)[0];if(!component)
return;var url="about:blank";try{url=efgrid_getNewWindowUrl(grid_id,row_index,col_index,component.value);}catch(exception){alert("efgrid_getNewWindowUrl"
+getI18nMessages("ef.FormNotDefineAndInvalid","未定义或参数错误"));return;}
var style_string=isAvailable(ef_config["NEW_WINDOW"])?ef_config["NEW_WINDOW"]:"dialogWidth:400px; dialogHeight:300px;resizable:yes";var returnValue=window.showModalDialog(url,"",style_string);if(!returnValue||!returnValue["value"]){alert(getI18nMessages("ef.FormNotDefine","返回值未定义!"));return;}
efgrid.setCellValue(input_id,returnValue["value"],returnValue["label"]);}
efform.openNewForm=function(form_ename,para_list,is_maximum){var _wnd=window;while(isAvailable(_wnd.top)&&_wnd!=_wnd.top){_wnd=_wnd.top;}
if(_wnd!=null){_wnd.winMap[_wnd.winCount]=efform.openForm(form_ename,para_list,is_maximum);return _wnd.winMap[_wnd.winCount++];}}
efform.getParentWindow=function(){var _wnd=window;try{if(isAvailable(_wnd.RootWndID))
return _wnd;if(isAvailable(_wnd.opener)&&_wnd!=_wnd.opener)
_wnd=_wnd.opener;while(isAvailable(_wnd.top)&&_wnd!=_wnd.top){_wnd=_wnd.top;}}catch(ex){_wnd=null;return _wnd;}
return _wnd;}
efform.openForm=function(form_ename,para_list,is_maximum){var load_time=new Date();var load_label=form_ename.trim()+load_time.getTime();para_list=efutils.trimString(para_list);var url=CONTEXT_PATH+"/DispatchAction.do?efFormEname="+form_ename.trim();if(para_list!="")
url+="&"+para_list;var openPara="toolbar=no,location=yes,directories=no,status=yes,menubar=yes,resizable=yes,scrollbars=yes,";if(is_maximum==true){openPara+="width="+(screen.availWidth-10)+",height="
+(screen.availHeight-30)+",top=0,"+"left=0";}else{openPara+="width=900,height=600,top="
+((screen.availHeight-600)/2)+",left="
+((screen.availWidth-900)/2);}
if(checkTimeOut())
return;var reg=/^\w+$/;if(!reg.test(load_label.trim())){alert("输入的页面号中含有无效字符！");return false;}
return window.open(url,load_label,openPara);}
efform._getMessageBoxDiv=function(title){var div_id="ef_msgbox";var div_node=$("#"+div_id)[0];if(!div_node)
div_node=efform.createDivWindow(div_id,"efwindow",title);return div_node;}
efform.showMessageBox=function(msg){var title=getI18nMessages("ef.Error","错误");var div_node=efform._getMessageBoxDiv(title);var inner_html=[];inner_html.push("<div style='width:120px'>");inner_html.push("<textarea wrap='soft' readonly rows=5 cols=21 style='margin:0px;height:74px'>"+msg
+"</textarea>");inner_html.push("</div>");div_node.innerHTML=inner_html.join('');if(typeof event!="undefined"){efwindow.show(event.srcElement,div_node.id,true);if(typeof efform_messageBox_endShow=="function"){try{efform_messageBox_endShow(event.srcElement,div_node);}catch(ex){efgrid.processException(ex,"Callback to efform_messageBox_endShow failed");}}}}
efform.hideDiv=function(div_id){var div_node=$("#"+div_id)[0];if(isAvailable(div_node)&&div_node.tagName=="DIV"){div_node.style.display='none';}else{efform.showMessageBox("Div with id["+div_id+"] not found!");}}
efform.showDiv=function(div_id){var div_node=$("#"+div_id)[0];if(isAvailable(div_node)&&div_node.tagName=="DIV"){div_node.style.display='block';}else{efform.showMessageBox("Div with id["+div_id+"] not found!");}}
efform.getSystemAjaxCallback=function(node_id){return{onSuccess:function(eiInfo){efform.fillDiv(node_id,eiInfo);},onFail:function(eMsg){alert(getI18nMessages("ef.ServiceFailed","服务调用失败: ")+eMsg);}};}
efform.fillDiv=function(div_id,eiInfo,isAllNode){var node=$("#"+div_id)[0];if(!isAvailable(node)){alert("Node with id["+node_id+"] not found!");return;}
efform.fillNode(node,eiInfo,isAllNode);}
efform.fillNode=function(node,eiInfo,isAllNode){if(!node.childNodes||node.childNodes.length<=0){var cell_value=efform._getValue(node,eiInfo,isAllNode);if(cell_value===null){return;}
if((node.tagName=="INPUT"&&node.type!="button")){node.value=cell_value;}
if(node.tagName=="TEXTAREA"){node.value=cell_value;}
return;}
else if(node.tagName=="TEXTAREA"){var cell_value=efform._getValue(node,eiInfo,isAllNode);if(cell_value===null){return;}
node.value=cell_value;return;}else if(node.tagName=="SELECT"){var cell_value=efform._getValue(node,eiInfo,isAllNode);if(cell_value===null){return;}
node.selectedIndex=0;for(var i=0;i<node.options.length;i++){if(node.options[i].value==cell_value){node.selectedIndex=i;break;}}}else{for(var i=0;i<node.childNodes.length;i++){try{efform.fillNode(node.childNodes[i],eiInfo,isAllNode);}catch(exception){}}}}
efform._getValue=function(node,eiInfo,isAllNode){if(!isAvailable(node.name))
return null;var idArray=node.name.split("-");if(idArray.length==3){try{var block=eiInfo.getBlock(idArray[0]);if(!isAvailable(block))
return"";return efutils.trimString(block.getCell(idArray[1],idArray[2]));}catch(exception){return"";}}
if(true==isAllNode){if(2==idArray.length){var block=eiInfo.getBlock(idArray[0]);if(!isAvailable(block))
return"";return efutils.trimString(block.get(idArray[1]));}else if(1==idArray.length){return efutils.trimString(eiInfo.get(idArray[0]));}}}
efform.getNavigationBar=function(bar_id){var bar=ef_nav_bars[bar_id];if(!isAvailable(bar))
throw new Error("Navigation bar with id ["+bar_id+"] not exists!");return bar;}
function efgrid_onExport_modleXls(gridId){window.showModalDialog("DispatchAction.do?efFormEname=EDFA7002",[window,gridId],"dialogWidth:320px;dialogHeight:393px;resizable:yes;help:no;");}
efform.getFormStatus=function(){return ef.get("_eiStatusImg").getAttribute("efFormStatus");}
efform.getMsgKey=function(){return ef.get("_eiMsgKey").innerText;}
efform.getMsg=function(){return ef.get("_eiMsg").innerText;}
efform.getDetailMsg=function(){return ef.get("_eiDetailMsg").innerText;}
efform.setDetailMsg=function(detailMsg){if(!ef.get("_eiDetailMsg"))
return;ef.get("_eiDetailMsg").innerText=detailMsg;}
efform.EFPopupInput_onDeleteButtonClick=function(cellLabelName,cellName){if(typeof(popupInput_onClickDeleteButton)=="function"){popupInput_onClickDeleteButton(cellLabelName,cellName);return;}
ef.get(cellLabelName).value="";ef.get(cellName).value="";}
function efgrid_onRowDblClicked(gridId,row_index){}

var button_functions=new Object();efbutton=function(){};efbutton.newButton=function(in_node,button_ename,button_cname,image_name){var button_node_id="button_"+button_ename;var temp_html="";if(button_ename!=null){temp_html+="<a id='"+button_node_id+"' title='"+button_cname+"'>"+button_cname+"</a>";}
if(image_name!=null){temp_html+="&nbsp<IMG src='"+efico.get(image_name)+"'>&nbsp";}
$(in_node).append(temp_html);$(document).ready(function(){$('[id='+button_node_id+']').each(function(){$(this).button().attr("ename",button_ename).attr("cname",button_cname).addClass("ef-widget");});});if(image_name==null){button_functions[button_ename.toLowerCase()]=$("#"+button_node_id).button().click;}
var buttonAuthStatus=in_node.getAttribute("buttonStatus");var bnode=ef.get(button_node_id);bnode.setAttribute("buttonStatus",buttonAuthStatus);efbutton.setButtonStatusByNode(bnode,button_ename,true);};efbutton.onClickButton=function(button_ename,button_cname,path){var button_id=path=="efbutton"?button_ename:button_ename.toLowerCase();var func_name="button_"+button_id+"_onclick";try{ef.get("efCurButtonEname").value=button_id.toUpperCase();}catch(ex){}
if(eval("typeof "+func_name)=="function"){efbutton.setButtonStatus(button_id,false,path);efform.setStatus(999,getI18nMessages("ef.RunButton","执行按钮")+"["
+button_cname+"]...");eval(func_name+"(); ");if(efform_submit_flag==false){efbutton.resetButton(button_id,button_cname,path);}}else{alert(getI18nMessages("ef.ButtonNoEvent","没有为按钮定义事件！"));}};efbutton.resetButton=function(button_ename,button_cname,path){efbutton.setButtonStatus(button_ename,true,path);var msgStatus=$("#efFormStatus");if(msgStatus.length==0)
return;var efform_status=$("#efFormStatus").attr("statusCode");if(efform_status==999){efform.setStatus(0,getI18nMessages("ef.FinishRunButton","结束执行按钮")
+"["+button_cname+"]");}};efbutton.setButtonStatus=function(button_id,button_status,path){var button_name=path=="efbutton"?button_id:button_id.toUpperCase();var in_node=ef.get("button_"+button_name);efbutton.setButtonStatusByNode(in_node,button_id,button_status,path);};efbutton.setButtonStatusByNode=function(in_node,button_id,button_status,path){if(!isAvailable(in_node)){return;}
var buttonAuthStatus=in_node.getAttribute("buttonStatus");var jButtonObj=$(in_node);if(button_status==false){if(efbutton.config!=undefined&&efbutton.config.HIDE_FORBIDDEN!=undefined&&efbutton.config.HIDE_FORBIDDEN=="true"){jButtonObj.hide();}else{jButtonObj.button("disable").attr("title",getI18nMessages("ef.ButtonForbid","按钮被禁用！"));jButtonObj.unbind("click");}}else{if(buttonAuthStatus=="0"){if(efbutton.config!=undefined&&efbutton.config.HIDE_NOAUTH!=undefined&&efbutton.config.HIDE_NOAUTH=="true"){jButtonObj.hide();}else{jButtonObj.button("disable").attr("title",getI18nMessages("ef.ButtonNoAuth","您没有权限使用！"));jButtonObj.unbind("click");}}else{jButtonObj.button("enable").attr("title",jButtonObj.attr("cname"));jButtonObj.unbind("click");jButtonObj.click(function(){var button_cname=jButtonObj.attr("cname");efbutton.onClickButton(button_id,button_cname,path);return false;});}}};efbutton.newNavButton=function(grid,action,in_node,image_name,image_id){in_node.align="center";in_node.noWrap=true;var temp_html="<IMG id='"+image_id+"' src='"
+efico.get(image_name)+"' class='NavButton'";temp_html+=" onmouseover=\"this.style.cursor='pointer';\" onclick='"
+action+"(\""+grid.gridId+"\");'";temp_html+=">";in_node.innerHTML=temp_html;};efbutton.newDisabledNavButton=function(in_node,image_name,image_id){in_node.align="center";in_node.noWrap=true;in_node.innerHTML="<IMG id='"+image_id+"' src='"
+efico.get(image_name)+"' class='disabledNavButton'>";};efbutton.newNavTextButton=function(grid,action,in_node,button_text,disabled){in_node.align="center";in_node.noWrap=true;if(disabled){in_node.innerHTML="<span>&nbsp;"+button_text+"&nbsp;</span>";}else{var temp_html="<A href='#' onclick='"+action+"(\""+grid.gridId
+"\");'>";temp_html+="&nbsp;"+button_text+"&nbsp;</A>";in_node.innerHTML=temp_html;}};efbutton.newImgButton=function(img_id,img_name,img_title,action,para){var inner_html="<IMG id=\""+img_id+"\" title=\""+img_title
+"\" onmouseover=\"this.style.cursor='pointer';\" "+"onclick=\""
+action+"('"+para+"')\" "+"src=\""+efico.get(img_name)
+"\" >";return inner_html;};efbutton.newIconButton=function(img_id,img_class,img_title,action,para){var inner_html="<span id=\""+img_id+"\" title=\""+img_title
+"\" onmouseover=\"this.style.cursor='pointer';\" ";if(action!=null||para!=null){inner_html+="onclick=\""+"efbutton.onClickIconButton('"
+img_title+"','"+action+"','"+para+"')\" ";}
inner_html+="class='ef-icon "+img_class+" ' >"+"</span>";return inner_html;};efbutton.onClickIconButton=function(img_title,action,para){efform.setStatus(999,getI18nMessages("ef.RunButton","执行按钮")+"["
+img_title+"]...");eval(action+"('"+para+"');");addButtonEffect();};function addButtonEffect(){var lastActive;$('.ef-state-default.ef-grid-funcImgButtonTD').addClass('ef-cornerredius-all');$('.ef-button-disabled').addClass('ef-cornerredius-all ef-state-disabled');$('.ef-button').addClass('ef-cornerredius-all ef-state-default');$('.ef-grid-tableHeaderColumn').addClass('ef-state-default');$('.ef-grid-functable').addClass('ef-cornerredius-all');$('.ef-state-default').bind("mouseenter.button",function(){if($(this).is(".ef-state-disabled")||($(this).is(".ui-state-disabled"))){return;}
$(this).addClass("ef-state-hover");if(this===lastActive){$(this).addClass("ef-state-active");}}).bind("mouseleave.button",function(){$(this).removeClass("ef-state-hover");$(this).removeClass("ef-state-active");}).bind("mousedown.button",function(){if($(this).is(".ef-state-disabled"))
return;$(this).addClass("ef-state-active");lastActive=this;$(document).one("mouseup",function(){lastActive=null;});}).bind("mouseup.button",function(){$(this).removeClass("ef-state-active");});$('.ef-button-disabled button').button("option","disabled",true);$('.ef-button button').button("option","disabled",false);};

function efbuttonbar()
{this.buttonId=null;this.buttonData=null;this.buttonCount=0;this.paint=function(paint_div_id){this.buttonId=paint_div_id;var paintDivElement=ef.get(paint_div_id);if(!paintDivElement)return;for(var i=0;i<this.buttonCount;i++){var button_ename=this.buttonData[i][0];var button_cname=this.buttonData[i][1];if(this.buttonData[i][0]==" ")continue;if(this.buttonData[i][2]=="0")
paintDivElement.setAttribute("buttonStatus","0");else
paintDivElement.setAttribute("buttonStatus","1");efbutton.newButton(paintDivElement,button_ename,button_cname,null);}}}

efcalendar_show=function(control_source,id)
{if(typeof efcalendar_click=='function')
{efcalendar_click(control_source,id);}
$("#"+id).datepicker("show");$("#calendarNowBtn").hide();}
function localizeCalendar()
{$.datepicker.regional['']={showMonthAfterYear:true,showButtonPanel:true,closeText:getI18nMessages("ef.CalendarClose","关闭"),prevText:'',nextText:'',changeMonth:true,changeYear:true,currentText:getI18nMessages("ef.CalendarToday","今天"),monthNames:['01','02','03','04','05','06','07','08','09','10','11','12'],monthNamesShort:['01','02','03','04','05','06','07','08','09','10','11','12'],dayNames:[getI18nMessages("ef.CalendarSunTip","周日"),getI18nMessages("ef.CalendarMon","周一"),getI18nMessages("ef.CalendarTues","周二"),getI18nMessages("ef.CalendarWed","周三"),getI18nMessages("ef.CalendarThurs","周四"),getI18nMessages("ef.CalendarFriday","周五"),getI18nMessages("ef.CalendarSat","周六")],dayNamesShort:['Sun','Mon','Tue','Wed','Thu','Fri','Sat'],dayNamesMin:[getI18nMessages("ef.CalendarSun","日"),getI18nMessages("ef.CalendarMon","一"),getI18nMessages("ef.CalendarTues","二"),getI18nMessages("ef.CalendarWed","三"),getI18nMessages("ef.CalendarThurs","四"),getI18nMessages("ef.CalendarFriday","五"),getI18nMessages("ef.CalendarSat","六")],weekHeader:getI18nMessages("ef.CalendarWeek","周"),dateFormat:'yy-mm-dd',firstDay:1,isRTL:false,yearSuffix:'',showClearButton:true,duration:'fast',showAnim:'fadeIn',showOtherMonths:true};$.datepicker.setDefaults($.datepicker.regional[""]);}
function efcalendar(ctl,ctl2,ft,rightPosition,show){var id=ctl2.id;var value=$("#"+id).attr("value");if(null==$("#"+id).data("datepicker"))
{$("#"+id).datepicker({onSelect:function(date){var callback=$("#"+id)[0].callback;if(callback){try{eval(callback)(date);}catch(exception){}}}});localizeCalendar();addBtnToDatepicker(id);$("#"+id).click(function(){$("#calendarNowBtn").hide();});$('#calendarTodayBtn').data("inputID",id);}
$("#"+id).datepicker("option","dateFormat",validateFormat(ft));$("#"+id).attr("value",value);if($("#"+id).data("hide"))
return;$("#calendarNowBtn").hide();$("#"+id).datepicker("show");}
function validateFormat(format)
{format=format.replace("yyyy","yy");format=format.replace("YYYY","yy");return format;}
function createCalendar(id)
{$("#"+id).removeAttr('onclick');if(typeof efcalendar_click=='function')
{$("#"+id).data("hide",true);efcalendar_click(null,id);}
else
{newCalendar(id);}}
function newCalendar(id)
{$("#"+id).datepicker({onSelect:function(date){var divNode=$("#"+id).parent();if(divNode.is("div[class='efgrid-cell']")||divNode.is("div[class='ef-state-error']"))
{efgrid.setCurrentValue($("#"+id).parent()[0],$("#"+id).attr("value"),null);}
var callback=$("#"+id)[0].callback;if(callback){try{eval(callback)(date);}catch(exception){}}}});localizeCalendar();addBtnToDatepicker(id);$("#"+id).click(function(){$("#calendarNowBtn").hide();});$('#calendarTodayBtn').data("inputID",id);}
function bindAndShow(ctl,ctl2,ft)
{var id=ctl2.id;newCalendar(id);var oldVal=$('#'+id).val();$("#"+id).datepicker("option","dateFormat",validateFormat(ft));$("#"+id).datepicker("show");$('#'+id).val(oldVal);$("#calendarNowBtn").hide();}
function createDateTimePicker(id)
{$("#"+id).datetimepicker({showSecond:true,timeFormat:'hh:mm:ss',onSelect:function(date){var divNode=$("#"+id).parent();if(divNode.is("div[class='efgrid-cell']")||divNode.is("div[class='ef-state-error']"))
{efgrid.setCurrentValue($("#"+id).parent()[0],$("#"+id).attr("value"),null);}}});localizeCalendar();addBtnToDatepicker(id);addBtnToDatetimepicker(id);}
function showDatetimePicker(id)
{createDateTimePicker(id);$("#"+id).datetimepicker("show");}
function efDatetimeCalendar_show(id)
{$("#"+id).datetimepicker("show");}
function addBtnToDatepicker(id){var old_fn=$.datepicker._updateDatepicker;$.datepicker._updateDatepicker=function(inst){old_fn.call(this,inst);var buttonPane=$(this).datepicker("widget").find(".ui-datepicker-buttonpane");var clearBtnFlag=($('#calendarClearBtn').length>0);if(!clearBtnFlag)
{$("<button id='calendarClearBtn' type='button' class='ui-datepicker-clean ui-state-default ui-priority-primary ui-corner-all'></button>").html(getI18nMessages("ef.CalendarClear","清空")).appendTo(buttonPane).click(function(ev){$("#"+inst.id).attr("value","");var divNode=$("#"+inst.id).parent();if(divNode.is("div[class='efgrid-cell']")||divNode.is("div[class='ef-state-error']"))
{efgrid.setCurrentValue($("#"+inst.id).parent()[0],$("#"+inst.id).attr("value"),null);}});}
var todayBtnFlag=($('#calendarTodayBtn').length>0);if(!todayBtnFlag)
{$("<button id='calendarTodayBtn' type='button' class='ui-datepicker-today ui-state-default ui-priority-primary ui-corner-all'></button>").html(getI18nMessages("ef.CalendarCurday","今天")).appendTo(buttonPane).click(function(ev){var now=new Date();$.datepicker._setDate(inst,now);var divNode=$("#"+inst.id).parent();if(divNode.is("div[class='efgrid-cell']")||divNode.is("div[class='ef-state-error']"))
{efgrid.setCurrentValue($("#"+inst.id).parent()[0],$("#"+inst.id).attr("value"),null);}
$.datepicker._hideDatepicker();var callback=$("#"+id)[0].callback;if(callback){try{eval(callback)($("#"+id).attr("value"));}catch(exception){}}});}}}
function addBtnToDatetimepicker(id){var old_fn=$.datepicker._updateDatepicker;$.datepicker._updateDatepicker=function(inst){old_fn.call(this,inst);var buttonPane=$(this).datepicker("widget").find(".ui-datepicker-buttonpane");var nowBtnFlag=($('#calendarNowBtn').length>0);if(!nowBtnFlag)
{$("<button id='calendarNowBtn' type='button' class='ui-datepicker-now ui-state-default ui-priority-primary ui-corner-all'></button>").html(getI18nMessages("ef.CalendarNow","现在")).appendTo(buttonPane).click(function(ev){$("#"+inst.id).datepicker('setDate',(new Date()));var divNode=$("#"+inst.id).parent();if(divNode.is("div[class='efgrid-cell']")||divNode.is("div[class='ef-state-error']"))
{efgrid.setCurrentValue($("#"+inst.id).parent()[0],$("#"+inst.id).attr("value"),null);}});}}}
function doubleCalendar(startName,endName)
{$("#"+startName+", "+"#"+endName).daterangepicker();}
function equalsIgnoreCase(str1,str2)
{if(str1.toUpperCase()==str2.toUpperCase())
{return true;}
return false;}

(function($){$.ui.timepicker=$.ui.timepicker||{};if($.ui.timepicker.version){return;}
$.extend($.ui,{timepicker:{version:"1.0.1"}});function Timepicker(){this.regional=[];this.regional['']={currentText:getI18nMessages("ef.CalendarNow","现在"),closeText:getI18nMessages("ef.CalendarClose","关闭"),ampm:false,amNames:['AM','A'],pmNames:['PM','P'],timeFormat:'hh:mm tt',timeSuffix:'',timeOnlyTitle:getI18nMessages("ef.CalendarChooseTime","选择时间"),timeText:'时间',hourText:getI18nMessages("ef.CalendarHour","时"),minuteText:getI18nMessages("ef.CalendarMinute","分"),secondText:getI18nMessages("ef.CalendarSecond","秒"),millisecText:getI18nMessages("ef.CalendarMillsecond","毫秒"),timezoneText:getI18nMessages("ef.CalendarTimezone","时区")};this._defaults={showButtonPanel:true,timeOnly:false,showHour:true,showMinute:true,showSecond:false,showMillisec:false,showTimezone:false,showTime:true,stepHour:1,stepMinute:1,stepSecond:1,stepMillisec:1,hour:0,minute:0,second:0,millisec:0,timezone:null,useLocalTimezone:false,defaultTimezone:"+0000",hourMin:0,minuteMin:0,secondMin:0,millisecMin:0,hourMax:23,minuteMax:59,secondMax:59,millisecMax:999,minDateTime:null,maxDateTime:null,onSelect:null,hourGrid:0,minuteGrid:0,secondGrid:0,millisecGrid:0,alwaysSetTime:true,separator:' ',altFieldTimeOnly:true,showTimepicker:true,timezoneIso8601:false,timezoneList:null,addSliderAccess:false,sliderAccessArgs:null};$.extend(this._defaults,this.regional['']);}
$.extend(Timepicker.prototype,{$input:null,$altInput:null,$timeObj:null,inst:null,hour_slider:null,minute_slider:null,second_slider:null,millisec_slider:null,timezone_select:null,hour:0,minute:0,second:0,millisec:0,timezone:null,defaultTimezone:"+0000",hourMinOriginal:null,minuteMinOriginal:null,secondMinOriginal:null,millisecMinOriginal:null,hourMaxOriginal:null,minuteMaxOriginal:null,secondMaxOriginal:null,millisecMaxOriginal:null,ampm:'',formattedDate:'',formattedTime:'',formattedDateTime:'',timezoneList:null,setDefaults:function(settings){extendRemove(this._defaults,settings||{});return this;},_newInst:function($input,o){var tp_inst=new Timepicker(),inlineSettings={};for(var attrName in this._defaults){var attrValue=$input.attr('time:'+attrName);if(attrValue){try{inlineSettings[attrName]=eval(attrValue);}catch(err){inlineSettings[attrName]=attrValue;}}}
tp_inst._defaults=$.extend({},this._defaults,inlineSettings,o,{beforeShow:function(input,dp_inst){if($.isFunction(o.beforeShow)){return o.beforeShow(input,dp_inst,tp_inst);}},onChangeMonthYear:function(year,month,dp_inst){tp_inst._updateDateTime(dp_inst);if($.isFunction(o.onChangeMonthYear)){o.onChangeMonthYear.call($input[0],year,month,dp_inst,tp_inst);}},onClose:function(dateText,dp_inst){if(tp_inst.timeDefined===true&&$input.val()!==''){tp_inst._updateDateTime(dp_inst);}
if($.isFunction(o.onClose)){o.onClose.call($input[0],dateText,dp_inst,tp_inst);}},timepicker:tp_inst});tp_inst.amNames=$.map(tp_inst._defaults.amNames,function(val){return val.toUpperCase();});tp_inst.pmNames=$.map(tp_inst._defaults.pmNames,function(val){return val.toUpperCase();});if(tp_inst._defaults.timezoneList===null){var timezoneList=[];for(var i=-11;i<=12;i++){timezoneList.push((i>=0?'+':'-')+('0'+Math.abs(i).toString()).slice(-2)+'00');}
if(tp_inst._defaults.timezoneIso8601){timezoneList=$.map(timezoneList,function(val){return val=='+0000'?'Z':(val.substring(0,3)+':'+val.substring(3));});}
tp_inst._defaults.timezoneList=timezoneList;}
tp_inst.timezone=tp_inst._defaults.timezone;tp_inst.hour=tp_inst._defaults.hour;tp_inst.minute=tp_inst._defaults.minute;tp_inst.second=tp_inst._defaults.second;tp_inst.millisec=tp_inst._defaults.millisec;tp_inst.ampm='';tp_inst.$input=$input;if(o.altField){tp_inst.$altInput=$(o.altField).css({cursor:'pointer'}).focus(function(){$input.trigger("focus");});}
if(tp_inst._defaults.minDate===0||tp_inst._defaults.minDateTime===0)
{tp_inst._defaults.minDate=new Date();}
if(tp_inst._defaults.maxDate===0||tp_inst._defaults.maxDateTime===0)
{tp_inst._defaults.maxDate=new Date();}
if(tp_inst._defaults.minDate!==undefined&&tp_inst._defaults.minDate instanceof Date){tp_inst._defaults.minDateTime=new Date(tp_inst._defaults.minDate.getTime());}
if(tp_inst._defaults.minDateTime!==undefined&&tp_inst._defaults.minDateTime instanceof Date){tp_inst._defaults.minDate=new Date(tp_inst._defaults.minDateTime.getTime());}
if(tp_inst._defaults.maxDate!==undefined&&tp_inst._defaults.maxDate instanceof Date){tp_inst._defaults.maxDateTime=new Date(tp_inst._defaults.maxDate.getTime());}
if(tp_inst._defaults.maxDateTime!==undefined&&tp_inst._defaults.maxDateTime instanceof Date){tp_inst._defaults.maxDate=new Date(tp_inst._defaults.maxDateTime.getTime());}
return tp_inst;},_addTimePicker:function(dp_inst){var currDT=(this.$altInput&&this._defaults.altFieldTimeOnly)?this.$input.val()+' '+this.$altInput.val():this.$input.val();this.timeDefined=this._parseTime(currDT);this._limitMinMaxDateTime(dp_inst,false);this._injectTimePicker();},_parseTime:function(timeString,withDate){if(!this.inst){this.inst=$.datepicker._getInst(this.$input[0]);}
if(withDate||!this._defaults.timeOnly)
{var dp_dateFormat=$.datepicker._get(this.inst,'dateFormat');try{var parseRes=parseDateTimeInternal(dp_dateFormat,this._defaults.timeFormat,timeString,$.datepicker._getFormatConfig(this.inst),this._defaults);if(!parseRes.timeObj){return false;}
$.extend(this,parseRes.timeObj);}catch(err)
{return false;}
return true;}
else
{var timeObj=$.datepicker.parseTime(this._defaults.timeFormat,timeString,this._defaults);if(!timeObj){return false;}
$.extend(this,timeObj);return true;}},_injectTimePicker:function(){var $dp=this.inst.dpDiv,o=this._defaults,tp_inst=this,hourMax=parseInt((o.hourMax-((o.hourMax-o.hourMin)%o.stepHour)),10),minMax=parseInt((o.minuteMax-((o.minuteMax-o.minuteMin)%o.stepMinute)),10),secMax=parseInt((o.secondMax-((o.secondMax-o.secondMin)%o.stepSecond)),10),millisecMax=parseInt((o.millisecMax-((o.millisecMax-o.millisecMin)%o.stepMillisec)),10),dp_id=this.inst.id.toString().replace(/([^A-Za-z0-9_])/g,'');if($dp.find("div#ui-timepicker-div-"+dp_id).length===0&&o.showTimepicker){var noDisplay=' style="display:none;"',html='<div class="ui-timepicker-div" id="ui-timepicker-div-'+dp_id+'"><dl>'+'<dt class="ui_tpicker_time_label" id="ui_tpicker_time_label_'+dp_id+'"'+
((o.showTime)?'':noDisplay)+'>'+o.timeText+'</dt>'+'<dd class="ui_tpicker_time" id="ui_tpicker_time_'+dp_id+'"'+
((o.showTime)?'':noDisplay)+'></dd>'+'<dt class="ui_tpicker_hour_label" id="ui_tpicker_hour_label_'+dp_id+'"'+
((o.showHour)?'':noDisplay)+'>'+o.hourText+'</dt>',hourGridSize=0,minuteGridSize=0,secondGridSize=0,millisecGridSize=0,size=null;html+='<dd class="ui_tpicker_hour"><div id="ui_tpicker_hour_'+dp_id+'"'+
((o.showHour)?'':noDisplay)+'></div>';if(o.showHour&&o.hourGrid>0){html+='<div style="padding-left: 1px"><table class="ui-tpicker-grid-label"><tr>';for(var h=o.hourMin;h<=hourMax;h+=parseInt(o.hourGrid,10)){hourGridSize++;var tmph=(o.ampm&&h>12)?h-12:h;if(tmph<10){tmph='0'+tmph;}
if(o.ampm){if(h===0){tmph=12+'a';}else{if(h<12){tmph+='a';}
else{tmph+='p';}}}
html+='<td>'+tmph+'</td>';}
html+='</tr></table></div>';}
html+='</dd>';html+='<dt class="ui_tpicker_minute_label" id="ui_tpicker_minute_label_'+dp_id+'"'+
((o.showMinute)?'':noDisplay)+'>'+o.minuteText+'</dt>'+'<dd class="ui_tpicker_minute"><div id="ui_tpicker_minute_'+dp_id+'"'+
((o.showMinute)?'':noDisplay)+'></div>';if(o.showMinute&&o.minuteGrid>0){html+='<div style="padding-left: 1px"><table class="ui-tpicker-grid-label"><tr>';for(var m=o.minuteMin;m<=minMax;m+=parseInt(o.minuteGrid,10)){minuteGridSize++;html+='<td>'+((m<10)?'0':'')+m+'</td>';}
html+='</tr></table></div>';}
html+='</dd>';html+='<dt class="ui_tpicker_second_label" id="ui_tpicker_second_label_'+dp_id+'"'+
((o.showSecond)?'':noDisplay)+'>'+o.secondText+'</dt>'+'<dd class="ui_tpicker_second"><div id="ui_tpicker_second_'+dp_id+'"'+
((o.showSecond)?'':noDisplay)+'></div>';if(o.showSecond&&o.secondGrid>0){html+='<div style="padding-left: 1px"><table><tr>';for(var s=o.secondMin;s<=secMax;s+=parseInt(o.secondGrid,10)){secondGridSize++;html+='<td>'+((s<10)?'0':'')+s+'</td>';}
html+='</tr></table></div>';}
html+='</dd>';html+='<dt class="ui_tpicker_millisec_label" id="ui_tpicker_millisec_label_'+dp_id+'"'+
((o.showMillisec)?'':noDisplay)+'>'+o.millisecText+'</dt>'+'<dd class="ui_tpicker_millisec"><div id="ui_tpicker_millisec_'+dp_id+'"'+
((o.showMillisec)?'':noDisplay)+'></div>';if(o.showMillisec&&o.millisecGrid>0){html+='<div style="padding-left: 1px"><table><tr>';for(var l=o.millisecMin;l<=millisecMax;l+=parseInt(o.millisecGrid,10)){millisecGridSize++;html+='<td>'+((l<10)?'0':'')+l+'</td>';}
html+='</tr></table></div>';}
html+='</dd>';html+='<dt class="ui_tpicker_timezone_label" id="ui_tpicker_timezone_label_'+dp_id+'"'+
((o.showTimezone)?'':noDisplay)+'>'+o.timezoneText+'</dt>';html+='<dd class="ui_tpicker_timezone" id="ui_tpicker_timezone_'+dp_id+'"'+
((o.showTimezone)?'':noDisplay)+'></dd>';html+='</dl></div>';var $tp=$(html);if(o.timeOnly===true){$tp.prepend('<div class="ui-widget-header ui-helper-clearfix ui-corner-all">'+'<div class="ui-datepicker-title">'+o.timeOnlyTitle+'</div>'+'</div>');$dp.find('.ui-datepicker-header, .ui-datepicker-calendar').hide();}
this.hour_slider=$tp.find('#ui_tpicker_hour_'+dp_id).slider({orientation:"horizontal",value:this.hour,min:o.hourMin,max:hourMax,step:o.stepHour,slide:function(event,ui){tp_inst.hour_slider.slider("option","value",ui.value);tp_inst._onTimeChange();}});this.minute_slider=$tp.find('#ui_tpicker_minute_'+dp_id).slider({orientation:"horizontal",value:this.minute,min:o.minuteMin,max:minMax,step:o.stepMinute,slide:function(event,ui){tp_inst.minute_slider.slider("option","value",ui.value);tp_inst._onTimeChange();}});this.second_slider=$tp.find('#ui_tpicker_second_'+dp_id).slider({orientation:"horizontal",value:this.second,min:o.secondMin,max:secMax,step:o.stepSecond,slide:function(event,ui){tp_inst.second_slider.slider("option","value",ui.value);tp_inst._onTimeChange();}});this.millisec_slider=$tp.find('#ui_tpicker_millisec_'+dp_id).slider({orientation:"horizontal",value:this.millisec,min:o.millisecMin,max:millisecMax,step:o.stepMillisec,slide:function(event,ui){tp_inst.millisec_slider.slider("option","value",ui.value);tp_inst._onTimeChange();}});this.timezone_select=$tp.find('#ui_tpicker_timezone_'+dp_id).append('<select></select>').find("select");$.fn.append.apply(this.timezone_select,$.map(o.timezoneList,function(val,idx){return $("<option />").val(typeof val=="object"?val.value:val).text(typeof val=="object"?val.label:val);}));if(typeof(this.timezone)!="undefined"&&this.timezone!==null&&this.timezone!==""){var local_date=new Date(this.inst.selectedYear,this.inst.selectedMonth,this.inst.selectedDay,12);var local_timezone=timeZoneString(local_date);if(local_timezone==this.timezone){selectLocalTimeZone(tp_inst);}else{this.timezone_select.val(this.timezone);}}else{if(typeof(this.hour)!="undefined"&&this.hour!==null&&this.hour!==""){this.timezone_select.val(o.defaultTimezone);}else{selectLocalTimeZone(tp_inst);}}
this.timezone_select.change(function(){tp_inst._defaults.useLocalTimezone=false;tp_inst._onTimeChange();});if(o.showHour&&o.hourGrid>0){size=100*hourGridSize*o.hourGrid/(hourMax-o.hourMin);$tp.find(".ui_tpicker_hour table").css({width:size+"%",marginLeft:(size/(-2*hourGridSize))+"%",borderCollapse:'collapse'}).find("td").each(function(index){$(this).click(function(){var h=$(this).html();if(o.ampm){var ap=h.substring(2).toLowerCase(),aph=parseInt(h.substring(0,2),10);if(ap=='a'){if(aph==12){h=0;}
else{h=aph;}}else if(aph==12){h=12;}
else{h=aph+12;}}
tp_inst.hour_slider.slider("option","value",h);tp_inst._onTimeChange();tp_inst._onSelectHandler();}).css({cursor:'pointer',width:(100/hourGridSize)+'%',textAlign:'center',overflow:'hidden'});});}
if(o.showMinute&&o.minuteGrid>0){size=100*minuteGridSize*o.minuteGrid/(minMax-o.minuteMin);$tp.find(".ui_tpicker_minute table").css({width:size+"%",marginLeft:(size/(-2*minuteGridSize))+"%",borderCollapse:'collapse'}).find("td").each(function(index){$(this).click(function(){tp_inst.minute_slider.slider("option","value",$(this).html());tp_inst._onTimeChange();tp_inst._onSelectHandler();}).css({cursor:'pointer',width:(100/minuteGridSize)+'%',textAlign:'center',overflow:'hidden'});});}
if(o.showSecond&&o.secondGrid>0){$tp.find(".ui_tpicker_second table").css({width:size+"%",marginLeft:(size/(-2*secondGridSize))+"%",borderCollapse:'collapse'}).find("td").each(function(index){$(this).click(function(){tp_inst.second_slider.slider("option","value",$(this).html());tp_inst._onTimeChange();tp_inst._onSelectHandler();}).css({cursor:'pointer',width:(100/secondGridSize)+'%',textAlign:'center',overflow:'hidden'});});}
if(o.showMillisec&&o.millisecGrid>0){$tp.find(".ui_tpicker_millisec table").css({width:size+"%",marginLeft:(size/(-2*millisecGridSize))+"%",borderCollapse:'collapse'}).find("td").each(function(index){$(this).click(function(){tp_inst.millisec_slider.slider("option","value",$(this).html());tp_inst._onTimeChange();tp_inst._onSelectHandler();}).css({cursor:'pointer',width:(100/millisecGridSize)+'%',textAlign:'center',overflow:'hidden'});});}
var $buttonPanel=$dp.find('.ui-datepicker-buttonpane');if($buttonPanel.length){$buttonPanel.before($tp);}
else{$dp.append($tp);}
this.$timeObj=$tp.find('#ui_tpicker_time_'+dp_id);if(this.inst!==null){var timeDefined=this.timeDefined;this._onTimeChange();this.timeDefined=timeDefined;}
var onSelectDelegate=function(){tp_inst._onSelectHandler();};this.hour_slider.bind('slidestop',onSelectDelegate);this.minute_slider.bind('slidestop',onSelectDelegate);this.second_slider.bind('slidestop',onSelectDelegate);this.millisec_slider.bind('slidestop',onSelectDelegate);if(this._defaults.addSliderAccess){var sliderAccessArgs=this._defaults.sliderAccessArgs;setTimeout(function(){if($tp.find('.ui-slider-access').length===0){$tp.find('.ui-slider:visible').sliderAccess(sliderAccessArgs);var sliderAccessWidth=$tp.find('.ui-slider-access:eq(0)').outerWidth(true);if(sliderAccessWidth){$tp.find('table:visible').each(function(){var $g=$(this),oldWidth=$g.outerWidth(),oldMarginLeft=$g.css('marginLeft').toString().replace('%',''),newWidth=oldWidth-sliderAccessWidth,newMarginLeft=((oldMarginLeft*newWidth)/oldWidth)+'%';$g.css({width:newWidth,marginLeft:newMarginLeft});});}}},0);}}},_limitMinMaxDateTime:function(dp_inst,adjustSliders){var o=this._defaults,dp_date=new Date(dp_inst.selectedYear,dp_inst.selectedMonth,dp_inst.selectedDay);if(!this._defaults.showTimepicker){return;}
if($.datepicker._get(dp_inst,'minDateTime')!==null&&$.datepicker._get(dp_inst,'minDateTime')!==undefined&&dp_date){var minDateTime=$.datepicker._get(dp_inst,'minDateTime'),minDateTimeDate=new Date(minDateTime.getFullYear(),minDateTime.getMonth(),minDateTime.getDate(),0,0,0,0);if(this.hourMinOriginal===null||this.minuteMinOriginal===null||this.secondMinOriginal===null||this.millisecMinOriginal===null){this.hourMinOriginal=o.hourMin;this.minuteMinOriginal=o.minuteMin;this.secondMinOriginal=o.secondMin;this.millisecMinOriginal=o.millisecMin;}
if(dp_inst.settings.timeOnly||minDateTimeDate.getTime()==dp_date.getTime()){this._defaults.hourMin=minDateTime.getHours();if(this.hour<=this._defaults.hourMin){this.hour=this._defaults.hourMin;this._defaults.minuteMin=minDateTime.getMinutes();if(this.minute<=this._defaults.minuteMin){this.minute=this._defaults.minuteMin;this._defaults.secondMin=minDateTime.getSeconds();}else if(this.second<=this._defaults.secondMin){this.second=this._defaults.secondMin;this._defaults.millisecMin=minDateTime.getMilliseconds();}else{if(this.millisec<this._defaults.millisecMin){this.millisec=this._defaults.millisecMin;}
this._defaults.millisecMin=this.millisecMinOriginal;}}else{this._defaults.minuteMin=this.minuteMinOriginal;this._defaults.secondMin=this.secondMinOriginal;this._defaults.millisecMin=this.millisecMinOriginal;}}else{this._defaults.hourMin=this.hourMinOriginal;this._defaults.minuteMin=this.minuteMinOriginal;this._defaults.secondMin=this.secondMinOriginal;this._defaults.millisecMin=this.millisecMinOriginal;}}
if($.datepicker._get(dp_inst,'maxDateTime')!==null&&$.datepicker._get(dp_inst,'maxDateTime')!==undefined&&dp_date){var maxDateTime=$.datepicker._get(dp_inst,'maxDateTime'),maxDateTimeDate=new Date(maxDateTime.getFullYear(),maxDateTime.getMonth(),maxDateTime.getDate(),0,0,0,0);if(this.hourMaxOriginal===null||this.minuteMaxOriginal===null||this.secondMaxOriginal===null){this.hourMaxOriginal=o.hourMax;this.minuteMaxOriginal=o.minuteMax;this.secondMaxOriginal=o.secondMax;this.millisecMaxOriginal=o.millisecMax;}
if(dp_inst.settings.timeOnly||maxDateTimeDate.getTime()==dp_date.getTime()){this._defaults.hourMax=maxDateTime.getHours();if(this.hour>=this._defaults.hourMax){this.hour=this._defaults.hourMax;this._defaults.minuteMax=maxDateTime.getMinutes();if(this.minute>=this._defaults.minuteMax){this.minute=this._defaults.minuteMax;this._defaults.secondMax=maxDateTime.getSeconds();}else if(this.second>=this._defaults.secondMax){this.second=this._defaults.secondMax;this._defaults.millisecMax=maxDateTime.getMilliseconds();}else{if(this.millisec>this._defaults.millisecMax){this.millisec=this._defaults.millisecMax;}
this._defaults.millisecMax=this.millisecMaxOriginal;}}else{this._defaults.minuteMax=this.minuteMaxOriginal;this._defaults.secondMax=this.secondMaxOriginal;this._defaults.millisecMax=this.millisecMaxOriginal;}}else{this._defaults.hourMax=this.hourMaxOriginal;this._defaults.minuteMax=this.minuteMaxOriginal;this._defaults.secondMax=this.secondMaxOriginal;this._defaults.millisecMax=this.millisecMaxOriginal;}}
if(adjustSliders!==undefined&&adjustSliders===true){var hourMax=parseInt((this._defaults.hourMax-((this._defaults.hourMax-this._defaults.hourMin)%this._defaults.stepHour)),10),minMax=parseInt((this._defaults.minuteMax-((this._defaults.minuteMax-this._defaults.minuteMin)%this._defaults.stepMinute)),10),secMax=parseInt((this._defaults.secondMax-((this._defaults.secondMax-this._defaults.secondMin)%this._defaults.stepSecond)),10),millisecMax=parseInt((this._defaults.millisecMax-((this._defaults.millisecMax-this._defaults.millisecMin)%this._defaults.stepMillisec)),10);if(this.hour_slider){this.hour_slider.slider("option",{min:this._defaults.hourMin,max:hourMax}).slider('value',this.hour);}
if(this.minute_slider){this.minute_slider.slider("option",{min:this._defaults.minuteMin,max:minMax}).slider('value',this.minute);}
if(this.second_slider){this.second_slider.slider("option",{min:this._defaults.secondMin,max:secMax}).slider('value',this.second);}
if(this.millisec_slider){this.millisec_slider.slider("option",{min:this._defaults.millisecMin,max:millisecMax}).slider('value',this.millisec);}}},_onTimeChange:function(){var hour=(this.hour_slider)?this.hour_slider.slider('value'):false,minute=(this.minute_slider)?this.minute_slider.slider('value'):false,second=(this.second_slider)?this.second_slider.slider('value'):false,millisec=(this.millisec_slider)?this.millisec_slider.slider('value'):false,timezone=(this.timezone_select)?this.timezone_select.val():false,o=this._defaults;if(typeof(hour)=='object'){hour=false;}
if(typeof(minute)=='object'){minute=false;}
if(typeof(second)=='object'){second=false;}
if(typeof(millisec)=='object'){millisec=false;}
if(typeof(timezone)=='object'){timezone=false;}
if(hour!==false){hour=parseInt(hour,10);}
if(minute!==false){minute=parseInt(minute,10);}
if(second!==false){second=parseInt(second,10);}
if(millisec!==false){millisec=parseInt(millisec,10);}
var ampm=o[hour<12?'amNames':'pmNames'][0];var hasChanged=(hour!=this.hour||minute!=this.minute||second!=this.second||millisec!=this.millisec||(this.ampm.length>0&&(hour<12)!=($.inArray(this.ampm.toUpperCase(),this.amNames)!==-1))||timezone!=this.timezone);if(hasChanged){if(hour!==false){this.hour=hour;}
if(minute!==false){this.minute=minute;}
if(second!==false){this.second=second;}
if(millisec!==false){this.millisec=millisec;}
if(timezone!==false){this.timezone=timezone;}
if(!this.inst){this.inst=$.datepicker._getInst(this.$input[0]);}
this._limitMinMaxDateTime(this.inst,true);}
if(o.ampm){this.ampm=ampm;}
this.formattedTime=$.datepicker.formatTime(this._defaults.timeFormat,this,this._defaults);if(this.$timeObj){this.$timeObj.text(this.formattedTime+o.timeSuffix);}
this.timeDefined=true;if(hasChanged){this._updateDateTime();}},_onSelectHandler:function(){var onSelect=this._defaults.onSelect;var inputEl=this.$input?this.$input[0]:null;if(onSelect&&inputEl){onSelect.apply(inputEl,[this.formattedDateTime,this]);}},_formatTime:function(time,format){time=time||{hour:this.hour,minute:this.minute,second:this.second,millisec:this.millisec,ampm:this.ampm,timezone:this.timezone};var tmptime=(format||this._defaults.timeFormat).toString();tmptime=$.datepicker.formatTime(tmptime,time,this._defaults);if(arguments.length){return tmptime;}
else{this.formattedTime=tmptime;}},_updateDateTime:function(dp_inst){dp_inst=this.inst||dp_inst;var dt=$.datepicker._daylightSavingAdjust(new Date(dp_inst.selectedYear,dp_inst.selectedMonth,dp_inst.selectedDay)),dateFmt=$.datepicker._get(dp_inst,'dateFormat'),formatCfg=$.datepicker._getFormatConfig(dp_inst),timeAvailable=dt!==null&&this.timeDefined;this.formattedDate=$.datepicker.formatDate(dateFmt,(dt===null?new Date():dt),formatCfg);var formattedDateTime=this.formattedDate;if(this._defaults.timeOnly===true){formattedDateTime=this.formattedTime;}else if(this._defaults.timeOnly!==true&&(this._defaults.alwaysSetTime||timeAvailable)){formattedDateTime+=this._defaults.separator+this.formattedTime+this._defaults.timeSuffix;}
this.formattedDateTime=formattedDateTime;if(!this._defaults.showTimepicker){this.$input.val(this.formattedDate);}else if(this.$altInput&&this._defaults.altFieldTimeOnly===true){this.$altInput.val(this.formattedTime);this.$input.val(this.formattedDate);}else if(this.$altInput){this.$altInput.val(formattedDateTime);this.$input.val(formattedDateTime);}else{this.$input.val(formattedDateTime);}
this.$input.trigger("change");}});$.fn.extend({timepicker:function(o){o=o||{};var tmp_args=arguments;if(typeof o=='object'){tmp_args[0]=$.extend(o,{timeOnly:true});}
return $(this).each(function(){$.fn.datetimepicker.apply($(this),tmp_args);});},datetimepicker:function(o){o=o||{};var tmp_args=arguments;if(typeof(o)=='string'){if(o=='getDate'){return $.fn.datepicker.apply($(this[0]),tmp_args);}
else{return this.each(function(){var $t=$(this);$t.datepicker.apply($t,tmp_args);});}}
else{return this.each(function(){var $t=$(this);$t.datepicker($.timepicker._newInst($t,o)._defaults);});}}});$.datepicker.parseDateTime=function(dateFormat,timeFormat,dateTimeString,dateSettings,timeSettings){var parseRes=parseDateTimeInternal(dateFormat,timeFormat,dateTimeString,dateSettings,timeSettings);if(parseRes.timeObj)
{var t=parseRes.timeObj;parseRes.date.setHours(t.hour,t.minute,t.second,t.millisec);}
return parseRes.date;};$.datepicker.parseTime=function(timeFormat,timeString,options){var getPatternAmpm=function(amNames,pmNames){var markers=[];if(amNames){$.merge(markers,amNames);}
if(pmNames){$.merge(markers,pmNames);}
markers=$.map(markers,function(val){return val.replace(/[.*+?|()\[\]{}\\]/g,'\\$&');});return'('+markers.join('|')+')?';};var getFormatPositions=function(timeFormat){var finds=timeFormat.toLowerCase().match(/(h{1,2}|m{1,2}|s{1,2}|l{1}|t{1,2}|z)/g),orders={h:-1,m:-1,s:-1,l:-1,t:-1,z:-1};if(finds){for(var i=0;i<finds.length;i++){if(orders[finds[i].toString().charAt(0)]==-1){orders[finds[i].toString().charAt(0)]=i+1;}}}
return orders;};var o=extendRemove(extendRemove({},$.timepicker._defaults),options||{});var regstr='^'+timeFormat.toString().replace(/h{1,2}/ig,'(\\d?\\d)').replace(/m{1,2}/ig,'(\\d?\\d)').replace(/s{1,2}/ig,'(\\d?\\d)').replace(/l{1}/ig,'(\\d?\\d?\\d)').replace(/t{1,2}/ig,getPatternAmpm(o.amNames,o.pmNames)).replace(/z{1}/ig,'(z|[-+]\\d\\d:?\\d\\d)?').replace(/\s/g,'\\s?')+o.timeSuffix+'$',order=getFormatPositions(timeFormat),ampm='',treg;treg=timeString.match(new RegExp(regstr,'i'));var resTime={hour:0,minute:0,second:0,millisec:0};if(treg){if(order.t!==-1){if(treg[order.t]===undefined||treg[order.t].length===0){ampm='';resTime.ampm='';}else{ampm=$.inArray(treg[order.t],o.amNames)!==-1?'AM':'PM';resTime.ampm=o[ampm=='AM'?'amNames':'pmNames'][0];}}
if(order.h!==-1){if(ampm=='AM'&&treg[order.h]=='12'){resTime.hour=0;}else{if(ampm=='PM'&&treg[order.h]!='12'){resTime.hour=parseInt(treg[order.h],10)+12;}
else{resTime.hour=Number(treg[order.h]);}}}
if(order.m!==-1){resTime.minute=Number(treg[order.m]);}
if(order.s!==-1){resTime.second=Number(treg[order.s]);}
if(order.l!==-1){resTime.millisec=Number(treg[order.l]);}
if(order.z!==-1&&treg[order.z]!==undefined){var tz=treg[order.z].toUpperCase();switch(tz.length){case 1:tz=o.timezoneIso8601?'Z':'+0000';break;case 5:if(o.timezoneIso8601){tz=tz.substring(1)=='0000'?'Z':tz.substring(0,3)+':'+tz.substring(3);}
break;case 6:if(!o.timezoneIso8601){tz=tz=='Z'||tz.substring(1)=='00:00'?'+0000':tz.replace(/:/,'');}else{if(tz.substring(1)=='00:00'){tz='Z';}}
break;}
resTime.timezone=tz;}
return resTime;}
return false;};$.datepicker.formatTime=function(format,time,options){options=options||{};options=$.extend($.timepicker._defaults,options);time=$.extend({hour:0,minute:0,second:0,millisec:0,timezone:'+0000'},time);var tmptime=format;var ampmName=options.amNames[0];var hour=parseInt(time.hour,10);if(options.ampm){if(hour>11){ampmName=options.pmNames[0];if(hour>12){hour=hour%12;}}
if(hour===0){hour=12;}}
tmptime=tmptime.replace(/(?:hh?|mm?|ss?|[tT]{1,2}|[lz])/g,function(match){switch(match.toLowerCase()){case'hh':return('0'+hour).slice(-2);case'h':return hour;case'mm':return('0'+time.minute).slice(-2);case'm':return time.minute;case'ss':return('0'+time.second).slice(-2);case's':return time.second;case'l':return('00'+time.millisec).slice(-3);case'z':return time.timezone;case't':case'tt':if(options.ampm){if(match.length==1){ampmName=ampmName.charAt(0);}
return match.charAt(0)=='T'?ampmName.toUpperCase():ampmName.toLowerCase();}
return'';}});tmptime=$.trim(tmptime);return tmptime;};$.datepicker._base_selectDate=$.datepicker._selectDate;$.datepicker._selectDate=function(id,dateStr){var inst=this._getInst($(id)[0]),tp_inst=this._get(inst,'timepicker');if(tp_inst){tp_inst._limitMinMaxDateTime(inst,true);inst.inline=inst.stay_open=true;this._base_selectDate(id,dateStr);inst.inline=inst.stay_open=false;this._notifyChange(inst);this._updateDatepicker(inst);}
else{this._base_selectDate(id,dateStr);}};$.datepicker._base_updateDatepicker=$.datepicker._updateDatepicker;$.datepicker._updateDatepicker=function(inst){var input=inst.input[0];if($.datepicker._curInst&&$.datepicker._curInst!=inst&&$.datepicker._datepickerShowing&&$.datepicker._lastInput!=input){return;}
if(typeof(inst.stay_open)!=='boolean'||inst.stay_open===false){this._base_updateDatepicker(inst);var tp_inst=this._get(inst,'timepicker');if(tp_inst){tp_inst._addTimePicker(inst);if(tp_inst._defaults.useLocalTimezone){var date=new Date(inst.selectedYear,inst.selectedMonth,inst.selectedDay,12);selectLocalTimeZone(tp_inst,date);tp_inst._onTimeChange();}}}};$.datepicker._base_doKeyPress=$.datepicker._doKeyPress;$.datepicker._doKeyPress=function(event){var inst=$.datepicker._getInst(event.target),tp_inst=$.datepicker._get(inst,'timepicker');if(tp_inst){if($.datepicker._get(inst,'constrainInput')){var ampm=tp_inst._defaults.ampm,dateChars=$.datepicker._possibleChars($.datepicker._get(inst,'dateFormat')),datetimeChars=tp_inst._defaults.timeFormat.toString().replace(/[hms]/g,'').replace(/TT/g,ampm?'APM':'').replace(/Tt/g,ampm?'AaPpMm':'').replace(/tT/g,ampm?'AaPpMm':'').replace(/T/g,ampm?'AP':'').replace(/tt/g,ampm?'apm':'').replace(/t/g,ampm?'ap':'')+" "+
tp_inst._defaults.separator+
tp_inst._defaults.timeSuffix+
(tp_inst._defaults.showTimezone?tp_inst._defaults.timezoneList.join(''):'')+
(tp_inst._defaults.amNames.join(''))+
(tp_inst._defaults.pmNames.join(''))+
dateChars,chr=String.fromCharCode(event.charCode===undefined?event.keyCode:event.charCode);return event.ctrlKey||(chr<' '||!dateChars||datetimeChars.indexOf(chr)>-1);}}
return $.datepicker._base_doKeyPress(event);};$.datepicker._base_doKeyUp=$.datepicker._doKeyUp;$.datepicker._doKeyUp=function(event){var inst=$.datepicker._getInst(event.target),tp_inst=$.datepicker._get(inst,'timepicker');if(tp_inst){if(tp_inst._defaults.timeOnly&&(inst.input.val()!=inst.lastVal)){try{$.datepicker._updateDatepicker(inst);}
catch(err){$.datepicker.log(err);}}}
return $.datepicker._base_doKeyUp(event);};$.datepicker._base_gotoToday=$.datepicker._gotoToday;$.datepicker._gotoToday=function(id){var inst=this._getInst($(id)[0]),$dp=inst.dpDiv;this._base_gotoToday(id);var tp_inst=this._get(inst,'timepicker');selectLocalTimeZone(tp_inst);var now=new Date();this._setTime(inst,now);$('.ui-datepicker-today',$dp).click();};$.datepicker._disableTimepickerDatepicker=function(target){var inst=this._getInst(target);if(!inst){return;}
var tp_inst=this._get(inst,'timepicker');$(target).datepicker('getDate');if(tp_inst){tp_inst._defaults.showTimepicker=false;tp_inst._updateDateTime(inst);}};$.datepicker._enableTimepickerDatepicker=function(target){var inst=this._getInst(target);if(!inst){return;}
var tp_inst=this._get(inst,'timepicker');$(target).datepicker('getDate');if(tp_inst){tp_inst._defaults.showTimepicker=true;tp_inst._addTimePicker(inst);tp_inst._updateDateTime(inst);}};$.datepicker._setTime=function(inst,date){var tp_inst=this._get(inst,'timepicker');if(tp_inst){var defaults=tp_inst._defaults,hour=date?date.getHours():defaults.hour,minute=date?date.getMinutes():defaults.minute,second=date?date.getSeconds():defaults.second,millisec=date?date.getMilliseconds():defaults.millisec;var hourEq=hour===defaults.hourMin,minuteEq=minute===defaults.minuteMin,secondEq=second===defaults.secondMin;var reset=false;if(hour<defaults.hourMin||hour>defaults.hourMax)
reset=true;else if((minute<defaults.minuteMin||minute>defaults.minuteMax)&&hourEq)
reset=true;else if((second<defaults.secondMin||second>defaults.secondMax)&&hourEq&&minuteEq)
reset=true;else if((millisec<defaults.millisecMin||millisec>defaults.millisecMax)&&hourEq&&minuteEq&&secondEq)
reset=true;if(reset){hour=defaults.hourMin;minute=defaults.minuteMin;second=defaults.secondMin;millisec=defaults.millisecMin;}
tp_inst.hour=hour;tp_inst.minute=minute;tp_inst.second=second;tp_inst.millisec=millisec;if(tp_inst.hour_slider)tp_inst.hour_slider.slider('value',hour);if(tp_inst.minute_slider)tp_inst.minute_slider.slider('value',minute);if(tp_inst.second_slider)tp_inst.second_slider.slider('value',second);if(tp_inst.millisec_slider)tp_inst.millisec_slider.slider('value',millisec);tp_inst._onTimeChange();tp_inst._updateDateTime(inst);}};$.datepicker._setTimeDatepicker=function(target,date,withDate){var inst=this._getInst(target);if(!inst){return;}
var tp_inst=this._get(inst,'timepicker');if(tp_inst){this._setDateFromField(inst);var tp_date;if(date){if(typeof date=="string"){tp_inst._parseTime(date,withDate);tp_date=new Date();tp_date.setHours(tp_inst.hour,tp_inst.minute,tp_inst.second,tp_inst.millisec);}
else{tp_date=new Date(date.getTime());}
if(tp_date.toString()=='Invalid Date'){tp_date=undefined;}
this._setTime(inst,tp_date);}}};$.datepicker._base_setDateDatepicker=$.datepicker._setDateDatepicker;$.datepicker._setDateDatepicker=function(target,date){var inst=this._getInst(target);if(!inst){return;}
var tp_date=(date instanceof Date)?new Date(date.getTime()):date;this._updateDatepicker(inst);this._base_setDateDatepicker.apply(this,arguments);this._setTimeDatepicker(target,tp_date,true);};$.datepicker._base_getDateDatepicker=$.datepicker._getDateDatepicker;$.datepicker._getDateDatepicker=function(target,noDefault){var inst=this._getInst(target);if(!inst){return;}
var tp_inst=this._get(inst,'timepicker');if(tp_inst){this._setDateFromField(inst,noDefault);var date=this._getDate(inst);if(date&&tp_inst._parseTime($(target).val(),tp_inst.timeOnly)){date.setHours(tp_inst.hour,tp_inst.minute,tp_inst.second,tp_inst.millisec);}
return date;}
return this._base_getDateDatepicker(target,noDefault);};$.datepicker._base_parseDate=$.datepicker.parseDate;$.datepicker.parseDate=function(format,value,settings){var splitRes=splitDateTime(format,value,settings);return $.datepicker._base_parseDate(format,splitRes[0],settings);};$.datepicker._base_formatDate=$.datepicker._formatDate;$.datepicker._formatDate=function(inst,day,month,year){var tp_inst=this._get(inst,'timepicker');if(tp_inst){tp_inst._updateDateTime(inst);return tp_inst.$input.val();}
return this._base_formatDate(inst);};$.datepicker._base_optionDatepicker=$.datepicker._optionDatepicker;$.datepicker._optionDatepicker=function(target,name,value){var inst=this._getInst(target);if(!inst){return null;}
var tp_inst=this._get(inst,'timepicker');if(tp_inst){var min=null,max=null,onselect=null;if(typeof name=='string'){if(name==='minDate'||name==='minDateTime'){min=value;}
else{if(name==='maxDate'||name==='maxDateTime'){max=value;}
else{if(name==='onSelect'){onselect=value;}}}}else{if(typeof name=='object'){if(name.minDate){min=name.minDate;}else{if(name.minDateTime){min=name.minDateTime;}else{if(name.maxDate){max=name.maxDate;}else{if(name.maxDateTime){max=name.maxDateTime;}}}}}}
if(min){if(min===0){min=new Date();}else{min=new Date(min);}
tp_inst._defaults.minDate=min;tp_inst._defaults.minDateTime=min;}else if(max){if(max===0){max=new Date();}else{max=new Date(max);}
tp_inst._defaults.maxDate=max;tp_inst._defaults.maxDateTime=max;}else if(onselect){tp_inst._defaults.onSelect=onselect;}}
if(value===undefined){return this._base_optionDatepicker(target,name);}
return this._base_optionDatepicker(target,name,value);};function extendRemove(target,props){$.extend(target,props);for(var name in props){if(props[name]===null||props[name]===undefined){target[name]=props[name];}}
return target;}
var splitDateTime=function(dateFormat,dateTimeString,dateSettings)
{try{var date=$.datepicker._base_parseDate(dateFormat,dateTimeString,dateSettings);}catch(err){if(err.indexOf(":")>=0){var dateStringLength=dateTimeString.length-(err.length-err.indexOf(':')-2);var timeString=dateTimeString.substring(dateStringLength);return[dateTimeString.substring(0,dateStringLength),dateTimeString.substring(dateStringLength)];}else{throw err;}}
return[dateTimeString,''];};var parseDateTimeInternal=function(dateFormat,timeFormat,dateTimeString,dateSettings,timeSettings)
{var date;var splitRes=splitDateTime(dateFormat,dateTimeString,dateSettings);date=$.datepicker._base_parseDate(dateFormat,splitRes[0],dateSettings);if(splitRes[1]!=='')
{var timeString=splitRes[1];var separator=timeSettings&&timeSettings.separator?timeSettings.separator:$.timepicker._defaults.separator;if(timeString.indexOf(separator)!==0){throw'Missing time separator';}
timeString=timeString.substring(separator.length);var parsedTime=$.datepicker.parseTime(timeFormat,timeString,timeSettings);if(parsedTime===null){throw'Wrong time format';}
return{date:date,timeObj:parsedTime};}else{return{date:date};}};var selectLocalTimeZone=function(tp_inst,date)
{if(tp_inst&&tp_inst.timezone_select){tp_inst._defaults.useLocalTimezone=true;var now=typeof date!=='undefined'?date:new Date();var tzoffset=timeZoneString(now);if(tp_inst._defaults.timezoneIso8601){tzoffset=tzoffset.substring(0,3)+':'+tzoffset.substring(3);}
tp_inst.timezone_select.val(tzoffset);}};var timeZoneString=function(date)
{var off=date.getTimezoneOffset()*-10100/60;var timezone=(off>=0?'+':'-')+Math.abs(off).toString().substr(1);return timezone;};$.timepicker=new Timepicker();$.timepicker.version="1.0.1";})(jQuery);

jQuery.fn.daterangepicker=function(settings){var rangeInput=jQuery(this);var options=jQuery.extend({presetRanges:[{text:getI18nMessages("ef.CalendarToday","今天"),dateStart:'today',dateEnd:'today'},{text:getI18nMessages("ef.CalendarLastWeek","前一周"),dateStart:'today-7days',dateEnd:'today'},{text:getI18nMessages("ef.CalendarSinceMonthBegin","月初至今"),dateStart:function(){return Date.parse('today').moveToFirstDayOfMonth();},dateEnd:'today'},{text:getI18nMessages("ef.CalendarSinceYearBegin","年初至今"),dateStart:function(){var x=Date.parse('today');x.setMonth(0);x.setDate(1);return x;},dateEnd:'today'},{text:getI18nMessages("ef.CalendarLastMonth","上月"),dateStart:function(){return Date.parse('1 month ago').moveToFirstDayOfMonth();},dateEnd:function(){return Date.parse('1 month ago').moveToLastDayOfMonth();}}],presets:{dateRange:getI18nMessages("ef.CalendarDateRange","起止日期"),specificDate:getI18nMessages("ef.CalendarSpecificDay","特定日期"),allDatesBefore:getI18nMessages("ef.CalendarDaysBefore","特定日期前"),allDatesAfter:getI18nMessages("ef.CalendarDaysAfter","特定日期后")},rangeStartTitle:getI18nMessages("ef.CalendarStartDate","开始日期"),rangeEndTitle:getI18nMessages("ef.CalendarEndDate","截止日期"),nextLinkText:getI18nMessages("ef.CalendarNext","后"),prevLinkText:getI18nMessages("ef.CalendarPrev","前"),doneButtonText:getI18nMessages("ef.CalendarDone","完成"),earliestDate:Date.parse('-15years'),latestDate:Date.parse('+15years'),rangeSplitter:'-',dateFormat:'m/d/yy',closeOnSelect:true,arrows:false,posX:rangeInput.offset().left,posY:rangeInput.offset().top+rangeInput.outerHeight(),appendTo:'body',onClose:function(){},onOpen:function(){},onChange:function(){},datepickerOptions:null},settings);var datepickerOptions={onSelect:function(){if(rp.find('.ui-daterangepicker-specificDate').is('.ui-state-active')){rp.find('.range-end').datepicker('setDate',rp.find('.range-start').datepicker('getDate'));}
var rangeA=fDate(rp.find('.range-start').datepicker('getDate'));var rangeB=fDate(rp.find('.range-end').datepicker('getDate'));if(rangeInput.length==2){rangeInput.eq(0).val(rangeA);rangeInput.eq(1).val(rangeB);}
else{rangeInput.val((rangeA!=rangeB)?rangeA+' '+options.rangeSplitter+' '+rangeB:rangeA);}
if(options.closeOnSelect){if(!rp.find('li.ui-state-active').is('.ui-daterangepicker-dateRange')&&!rp.is(':animated')){}}
options.onChange();},defaultDate:+0};rangeInput.change(options.onChange);options.datepickerOptions=(settings)?jQuery.extend(datepickerOptions,settings.datepickerOptions):datepickerOptions;var inputDateA,inputDateB=Date.parse('today');var inputDateAtemp,inputDateBtemp;if(rangeInput.size()==2){inputDateAtemp=Date.parse(rangeInput.eq(0).val());inputDateBtemp=Date.parse(rangeInput.eq(1).val());if(inputDateAtemp==null){inputDateAtemp=inputDateBtemp;}
if(inputDateBtemp==null){inputDateBtemp=inputDateAtemp;}}
else{inputDateAtemp=Date.parse(rangeInput.val().split(options.rangeSplitter)[0]);inputDateBtemp=Date.parse(rangeInput.val().split(options.rangeSplitter)[1]);if(inputDateBtemp==null){inputDateBtemp=inputDateAtemp;}}
if(inputDateAtemp!=null){inputDateA=inputDateAtemp;}
if(inputDateBtemp!=null){inputDateB=inputDateBtemp;}
var rp=jQuery('<div class="ui-daterangepicker ui-widget ui-helper-clearfix ui-widget-content ui-corner-all"></div>');var rpPresets=(function(){var ul=jQuery('<ul class="ui-widget-content"></ul>').appendTo(rp);var x=0;jQuery.each(options.presets,function(key,value){jQuery('<li class="ui-daterangepicker-'+key+' preset_'+x+' ui-helper-clearfix ui-corner-all"><span class="ui-icon ui-icon-triangle-1-e"></span><a href="#">'+value+'</a></li>').appendTo(ul);x++;});jQuery.each(options.presetRanges,function(){jQuery('<li class="ui-daterangepicker-'+this.text.replace(/ /g,'')+' ui-corner-all"><a href="#">'+this.text+'</a></li>').data('dateStart',this.dateStart).data('dateEnd',this.dateEnd).appendTo(ul);});ul.find('li').hover(function(){jQuery(this).addClass('ui-state-hover');},function(){jQuery(this).removeClass('ui-state-hover');}).click(function(){rp.find('.ui-state-active').removeClass('ui-state-active');jQuery(this).addClass('ui-state-active').clickActions(rp,rpPickers,doneBtn);return false;});return ul;})();function fDate(date){if(!date.getDate()){return'';}
var day=date.getDate();var month=date.getMonth();var year=date.getFullYear();month++;var dateFormat=options.dateFormat;return jQuery.datepicker.formatDate(dateFormat,date);}
jQuery.fn.restoreDateFromData=function(){if(jQuery(this).data('saveDate')){jQuery(this).datepicker('setDate',jQuery(this).data('saveDate')).removeData('saveDate');}
return this;}
jQuery.fn.saveDateToData=function(){if(!jQuery(this).data('saveDate')){jQuery(this).data('saveDate',jQuery(this).datepicker('getDate'));}
return this;}
function showRP(){if(rp.data('state')=='closed'){rp.data('state','open');rp.fadeIn(10);options.onOpen();}}
function hideRP(){if(rp.data('state')=='open'){rp.data('state','closed');rp.fadeOut(100);options.onClose();}}
function toggleRP(){if(rp.data('state')=='open'){hideRP();}
else{showRP();}}
rp.data('state','closed');jQuery.fn.clickActions=function(rp,rpPickers,doneBtn){if(jQuery(this).is('.ui-daterangepicker-specificDate')){doneBtn.hide();rpPickers.show();rp.find('.title-start').text(options.presets.specificDate);rp.find('.range-start').restoreDateFromData().show(400);rp.find('.range-end').restoreDateFromData().hide(400);setTimeout(function(){doneBtn.fadeIn();},400);}
else if(jQuery(this).is('.ui-daterangepicker-allDatesBefore')){doneBtn.hide();rpPickers.show();rp.find('.title-end').text(options.presets.allDatesBefore);rp.find('.range-start').saveDateToData().datepicker('setDate',options.earliestDate).hide(400);rp.find('.range-end').restoreDateFromData().show(400);setTimeout(function(){doneBtn.fadeIn();},400);}
else if(jQuery(this).is('.ui-daterangepicker-allDatesAfter')){doneBtn.hide();rpPickers.show();rp.find('.title-start').text(options.presets.allDatesAfter);rp.find('.range-start').restoreDateFromData().show(400);rp.find('.range-end').saveDateToData().datepicker('setDate',options.latestDate).hide(400);setTimeout(function(){doneBtn.fadeIn();},400);}
else if(jQuery(this).is('.ui-daterangepicker-dateRange')){doneBtn.hide();rpPickers.show();var lastActivity=new Date().getTime();rp.find('.title-start').text(options.rangeStartTitle);rp.find('.title-end').text(options.rangeEndTitle);rp.find('.range-start').restoreDateFromData().show(400);rp.find('.range-end').restoreDateFromData().show(400);setTimeout(function(){doneBtn.fadeIn();},400);}
else{doneBtn.hide();rp.find('.range-start, .range-end').hide(400,function(){rpPickers.hide();});var dateStart=(typeof jQuery(this).data('dateStart')=='string')?Date.parse(jQuery(this).data('dateStart')):jQuery(this).data('dateStart')();var dateEnd=(typeof jQuery(this).data('dateEnd')=='string')?Date.parse(jQuery(this).data('dateEnd')):jQuery(this).data('dateEnd')();rp.find('.range-start').datepicker('setDate',dateStart).find('.ui-datepicker-current-day').trigger('click');rp.find('.range-end').datepicker('setDate',dateEnd).find('.ui-datepicker-current-day').trigger('click');}
return false;}
var rpPickers=jQuery('<div class="ranges ui-widget-header ui-corner-all ui-helper-clearfix"><div class="range-start"><span class="title-start">Start Date</span></div><div class="range-end"><span class="title-end">End Date</span></div></div>').appendTo(rp);rpPickers.find('.range-start, .range-end').datepicker(options.datepickerOptions);rpPickers.find('.range-start').datepicker('setDate',inputDateA);rpPickers.find('.range-end').datepicker('setDate',inputDateB);var doneBtn=jQuery('<button class="btnDone ui-state-default ui-corner-all">'+options.doneButtonText+'</button>').click(function(){rp.find('.ui-datepicker-current-day').trigger('click');hideRP();}).hover(function(){jQuery(this).addClass('ui-state-hover');},function(){jQuery(this).removeClass('ui-state-hover');}).appendTo(rpPickers);jQuery(this).click(function(){doneBtn.hide();rpPickers.show();rp.find('.title-start').text(options.rangeStartTitle);rp.find('.title-end').text(options.rangeEndTitle);rp.find('.range-start').restoreDateFromData().show(100);rp.find('.range-end').restoreDateFromData().show(100);setTimeout(function(){doneBtn.fadeIn();},100);toggleRP();return false;});rpPickers.css('display','none').find('.range-start, .range-end, .btnDone').css('display','none');jQuery(options.appendTo).append(rp);rp.wrap('<div class="ui-daterangepickercontain"></div>');if(options.posX){rp.parent().css('left',options.posX);}
if(options.posY){rp.parent().css('top',options.posY+77);}
if(options.arrows&&rangeInput.size()==1){var prevLink=jQuery('<a href="#" class="ui-daterangepicker-prev ui-corner-all" title="'+options.prevLinkText+'"><span class="ui-icon ui-icon-circle-triangle-w">'+options.prevLinkText+'</span></a>');var nextLink=jQuery('<a href="#" class="ui-daterangepicker-next ui-corner-all" title="'+options.nextLinkText+'"><span class="ui-icon ui-icon-circle-triangle-e">'+options.nextLinkText+'</span></a>');jQuery(this).addClass('ui-rangepicker-input ui-widget-content').wrap('<div class="ui-daterangepicker-arrows ui-widget ui-widget-header ui-helper-clearfix ui-corner-all"></div>').before(prevLink).before(nextLink).parent().find('a').click(function(){var dateA=rpPickers.find('.range-start').datepicker('getDate');var dateB=rpPickers.find('.range-end').datepicker('getDate');var diff=Math.abs(new TimeSpan(dateA-dateB).getTotalMilliseconds())+86400000;if(jQuery(this).is('.ui-daterangepicker-prev')){diff=-diff;}
rpPickers.find('.range-start, .range-end ').each(function(){var thisDate=jQuery(this).datepicker("getDate");if(thisDate==null){return false;}
jQuery(this).datepicker("setDate",thisDate.add({milliseconds:diff})).find('.ui-datepicker-current-day').trigger('click');});return false;}).hover(function(){jQuery(this).addClass('ui-state-hover');},function(){jQuery(this).removeClass('ui-state-hover');});}
jQuery(document).click(function(){if(rp.is(':visible')){hideRP();}});rp.click(function(){return false;}).hide();return this;}
Date.CultureInfo={name:"en-US",englishName:"English (United States)",nativeName:"English (United States)",dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],abbreviatedDayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],shortestDayNames:["Su","Mo","Tu","We","Th","Fr","Sa"],firstLetterDayNames:["S","M","T","W","T","F","S"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],abbreviatedMonthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],amDesignator:"AM",pmDesignator:"PM",firstDayOfWeek:0,twoDigitYearMax:2029,dateElementOrder:"mdy",formatPatterns:{shortDate:"M/d/yyyy",longDate:"dddd, MMMM dd, yyyy",shortTime:"h:mm tt",longTime:"h:mm:ss tt",fullDateTime:"dddd, MMMM dd, yyyy h:mm:ss tt",sortableDateTime:"yyyy-MM-ddTHH:mm:ss",universalSortableDateTime:"yyyy-MM-dd HH:mm:ssZ",rfc1123:"ddd, dd MMM yyyy HH:mm:ss GMT",monthDay:"MMMM dd",yearMonth:"MMMM, yyyy"},regexPatterns:{jan:/^jan(uary)?/i,feb:/^feb(ruary)?/i,mar:/^mar(ch)?/i,apr:/^apr(il)?/i,may:/^may/i,jun:/^jun(e)?/i,jul:/^jul(y)?/i,aug:/^aug(ust)?/i,sep:/^sep(t(ember)?)?/i,oct:/^oct(ober)?/i,nov:/^nov(ember)?/i,dec:/^dec(ember)?/i,sun:/^su(n(day)?)?/i,mon:/^mo(n(day)?)?/i,tue:/^tu(e(s(day)?)?)?/i,wed:/^we(d(nesday)?)?/i,thu:/^th(u(r(s(day)?)?)?)?/i,fri:/^fr(i(day)?)?/i,sat:/^sa(t(urday)?)?/i,future:/^next/i,past:/^last|past|prev(ious)?/i,add:/^(\+|after|from)/i,subtract:/^(\-|before|ago)/i,yesterday:/^yesterday/i,today:/^t(oday)?/i,tomorrow:/^tomorrow/i,now:/^n(ow)?/i,millisecond:/^ms|milli(second)?s?/i,second:/^sec(ond)?s?/i,minute:/^min(ute)?s?/i,hour:/^h(ou)?rs?/i,week:/^w(ee)?k/i,month:/^m(o(nth)?s?)?/i,day:/^d(ays?)?/i,year:/^y((ea)?rs?)?/i,shortMeridian:/^(a|p)/i,longMeridian:/^(a\.?m?\.?|p\.?m?\.?)/i,timezone:/^((e(s|d)t|c(s|d)t|m(s|d)t|p(s|d)t)|((gmt)?\s*(\+|\-)\s*\d\d\d\d?)|gmt)/i,ordinalSuffix:/^\s*(st|nd|rd|th)/i,timeContext:/^\s*(\:|a|p)/i},abbreviatedTimeZoneStandard:{GMT:"-000",EST:"-0400",CST:"-0500",MST:"-0600",PST:"-0700"},abbreviatedTimeZoneDST:{GMT:"-000",EDT:"-0500",CDT:"-0600",MDT:"-0700",PDT:"-0800"}};Date.getMonthNumberFromName=function(name){var n=Date.CultureInfo.monthNames,m=Date.CultureInfo.abbreviatedMonthNames,s=name.toLowerCase();for(var i=0;i<n.length;i++){if(n[i].toLowerCase()==s||m[i].toLowerCase()==s){return i;}}
return-1;};Date.getDayNumberFromName=function(name){var n=Date.CultureInfo.dayNames,m=Date.CultureInfo.abbreviatedDayNames,o=Date.CultureInfo.shortestDayNames,s=name.toLowerCase();for(var i=0;i<n.length;i++){if(n[i].toLowerCase()==s||m[i].toLowerCase()==s){return i;}}
return-1;};Date.isLeapYear=function(year){return(((year%4===0)&&(year%100!==0))||(year%400===0));};Date.getDaysInMonth=function(year,month){return[31,(Date.isLeapYear(year)?29:28),31,30,31,30,31,31,30,31,30,31][month];};Date.getTimezoneOffset=function(s,dst){return(dst||false)?Date.CultureInfo.abbreviatedTimeZoneDST[s.toUpperCase()]:Date.CultureInfo.abbreviatedTimeZoneStandard[s.toUpperCase()];};Date.getTimezoneAbbreviation=function(offset,dst){var n=(dst||false)?Date.CultureInfo.abbreviatedTimeZoneDST:Date.CultureInfo.abbreviatedTimeZoneStandard,p;for(p in n){if(n[p]===offset){return p;}}
return null;};Date.prototype.clone=function(){return new Date(this.getTime());};Date.prototype.compareTo=function(date){if(isNaN(this)){throw new Error(this);}
if(date instanceof Date&&!isNaN(date)){return(this>date)?1:(this<date)?-1:0;}else{throw new TypeError(date);}};Date.prototype.equals=function(date){return(this.compareTo(date)===0);};Date.prototype.between=function(start,end){var t=this.getTime();return t>=start.getTime()&&t<=end.getTime();};Date.prototype.addMilliseconds=function(value){this.setMilliseconds(this.getMilliseconds()+value);return this;};Date.prototype.addSeconds=function(value){return this.addMilliseconds(value*1000);};Date.prototype.addMinutes=function(value){return this.addMilliseconds(value*60000);};Date.prototype.addHours=function(value){return this.addMilliseconds(value*3600000);};Date.prototype.addDays=function(value){return this.addMilliseconds(value*86400000);};Date.prototype.addWeeks=function(value){return this.addMilliseconds(value*604800000);};Date.prototype.addMonths=function(value){var n=this.getDate();this.setDate(1);this.setMonth(this.getMonth()+value);this.setDate(Math.min(n,this.getDaysInMonth()));return this;};Date.prototype.addYears=function(value){return this.addMonths(value*12);};Date.prototype.add=function(config){if(typeof config=="number"){this._orient=config;return this;}
var x=config;if(x.millisecond||x.milliseconds){this.addMilliseconds(x.millisecond||x.milliseconds);}
if(x.second||x.seconds){this.addSeconds(x.second||x.seconds);}
if(x.minute||x.minutes){this.addMinutes(x.minute||x.minutes);}
if(x.hour||x.hours){this.addHours(x.hour||x.hours);}
if(x.month||x.months){this.addMonths(x.month||x.months);}
if(x.year||x.years){this.addYears(x.year||x.years);}
if(x.day||x.days){this.addDays(x.day||x.days);}
return this;};Date._validate=function(value,min,max,name){if(typeof value!="number"){throw new TypeError(value+" is not a Number.");}else if(value<min||value>max){throw new RangeError(value+" is not a valid value for "+name+".");}
return true;};Date.validateMillisecond=function(n){return Date._validate(n,0,999,"milliseconds");};Date.validateSecond=function(n){return Date._validate(n,0,59,"seconds");};Date.validateMinute=function(n){return Date._validate(n,0,59,"minutes");};Date.validateHour=function(n){return Date._validate(n,0,23,"hours");};Date.validateDay=function(n,year,month){return Date._validate(n,1,Date.getDaysInMonth(year,month),"days");};Date.validateMonth=function(n){return Date._validate(n,0,11,"months");};Date.validateYear=function(n){return Date._validate(n,1,9999,"seconds");};Date.prototype.set=function(config){var x=config;if(!x.millisecond&&x.millisecond!==0){x.millisecond=-1;}
if(!x.second&&x.second!==0){x.second=-1;}
if(!x.minute&&x.minute!==0){x.minute=-1;}
if(!x.hour&&x.hour!==0){x.hour=-1;}
if(!x.day&&x.day!==0){x.day=-1;}
if(!x.month&&x.month!==0){x.month=-1;}
if(!x.year&&x.year!==0){x.year=-1;}
if(x.millisecond!=-1&&Date.validateMillisecond(x.millisecond)){this.addMilliseconds(x.millisecond-this.getMilliseconds());}
if(x.second!=-1&&Date.validateSecond(x.second)){this.addSeconds(x.second-this.getSeconds());}
if(x.minute!=-1&&Date.validateMinute(x.minute)){this.addMinutes(x.minute-this.getMinutes());}
if(x.hour!=-1&&Date.validateHour(x.hour)){this.addHours(x.hour-this.getHours());}
if(x.month!==-1&&Date.validateMonth(x.month)){this.addMonths(x.month-this.getMonth());}
if(x.year!=-1&&Date.validateYear(x.year)){this.addYears(x.year-this.getFullYear());}
if(x.day!=-1&&Date.validateDay(x.day,this.getFullYear(),this.getMonth())){this.addDays(x.day-this.getDate());}
if(x.timezone){this.setTimezone(x.timezone);}
if(x.timezoneOffset){this.setTimezoneOffset(x.timezoneOffset);}
return this;};Date.prototype.clearTime=function(){this.setHours(0);this.setMinutes(0);this.setSeconds(0);this.setMilliseconds(0);return this;};Date.prototype.isLeapYear=function(){var y=this.getFullYear();return(((y%4===0)&&(y%100!==0))||(y%400===0));};Date.prototype.isWeekday=function(){return!(this.is().sat()||this.is().sun());};Date.prototype.getDaysInMonth=function(){return Date.getDaysInMonth(this.getFullYear(),this.getMonth());};Date.prototype.moveToFirstDayOfMonth=function(){return this.set({day:1});};Date.prototype.moveToLastDayOfMonth=function(){return this.set({day:this.getDaysInMonth()});};Date.prototype.moveToDayOfWeek=function(day,orient){var diff=(day-this.getDay()+7*(orient||+1))%7;return this.addDays((diff===0)?diff+=7*(orient||+1):diff);};Date.prototype.moveToMonth=function(month,orient){var diff=(month-this.getMonth()+12*(orient||+1))%12;return this.addMonths((diff===0)?diff+=12*(orient||+1):diff);};Date.prototype.getDayOfYear=function(){return Math.floor((this-new Date(this.getFullYear(),0,1))/86400000);};Date.prototype.getWeekOfYear=function(firstDayOfWeek){var y=this.getFullYear(),m=this.getMonth(),d=this.getDate();var dow=firstDayOfWeek||Date.CultureInfo.firstDayOfWeek;var offset=7+1-new Date(y,0,1).getDay();if(offset==8){offset=1;}
var daynum=((Date.UTC(y,m,d,0,0,0)-Date.UTC(y,0,1,0,0,0))/86400000)+1;var w=Math.floor((daynum-offset+7)/7);if(w===dow){y--;var prevOffset=7+1-new Date(y,0,1).getDay();if(prevOffset==2||prevOffset==8){w=53;}else{w=52;}}
return w;};Date.prototype.isDST=function(){return this.toString().match(/(E|C|M|P)(S|D)T/)[2]=="D";};Date.prototype.getTimezone=function(){return Date.getTimezoneAbbreviation(this.getUTCOffset,this.isDST());};Date.prototype.setTimezoneOffset=function(s){var here=this.getTimezoneOffset(),there=Number(s)*-6/10;this.addMinutes(there-here);return this;};Date.prototype.setTimezone=function(s){return this.setTimezoneOffset(Date.getTimezoneOffset(s));};Date.prototype.getUTCOffset=function(){var n=this.getTimezoneOffset()*-10/6,r;if(n<0){r=(n-10000).toString();return r[0]+r.substr(2);}else{r=(n+10000).toString();return"+"+r.substr(1);}};Date.prototype.getDayName=function(abbrev){return abbrev?Date.CultureInfo.abbreviatedDayNames[this.getDay()]:Date.CultureInfo.dayNames[this.getDay()];};Date.prototype.getMonthName=function(abbrev){return abbrev?Date.CultureInfo.abbreviatedMonthNames[this.getMonth()]:Date.CultureInfo.monthNames[this.getMonth()];};Date.prototype._toString=Date.prototype.toString;Date.prototype.toString=function(format){var self=this;var p=function p(s){return(s.toString().length==1)?"0"+s:s;};return format?format.replace(/dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|zz?z?/g,function(format){switch(format){case"hh":return p(self.getHours()<13?self.getHours():(self.getHours()-12));case"h":return self.getHours()<13?self.getHours():(self.getHours()-12);case"HH":return p(self.getHours());case"H":return self.getHours();case"mm":return p(self.getMinutes());case"m":return self.getMinutes();case"ss":return p(self.getSeconds());case"s":return self.getSeconds();case"yyyy":return self.getFullYear();case"yy":return self.getFullYear().toString().substring(2,4);case"dddd":return self.getDayName();case"ddd":return self.getDayName(true);case"dd":return p(self.getDate());case"d":return self.getDate().toString();case"MMMM":return self.getMonthName();case"MMM":return self.getMonthName(true);case"MM":return p((self.getMonth()+1));case"M":return self.getMonth()+1;case"t":return self.getHours()<12?Date.CultureInfo.amDesignator.substring(0,1):Date.CultureInfo.pmDesignator.substring(0,1);case"tt":return self.getHours()<12?Date.CultureInfo.amDesignator:Date.CultureInfo.pmDesignator;case"zzz":case"zz":case"z":return"";}}):this._toString();};Date.now=function(){return new Date();};Date.today=function(){return Date.now().clearTime();};Date.prototype._orient=+1;Date.prototype.next=function(){this._orient=+1;return this;};Date.prototype.last=Date.prototype.prev=Date.prototype.previous=function(){this._orient=-1;return this;};Date.prototype._is=false;Date.prototype.is=function(){this._is=true;return this;};Number.prototype._dateElement="day";Number.prototype.fromNow=function(){var c={};c[this._dateElement]=this;return Date.now().add(c);};Number.prototype.ago=function(){var c={};c[this._dateElement]=this*-1;return Date.now().add(c);};(function(){var $D=Date.prototype,$N=Number.prototype;var dx=("sunday monday tuesday wednesday thursday friday saturday").split(/\s/),mx=("january february march april may june july august september october november december").split(/\s/),px=("Millisecond Second Minute Hour Day Week Month Year").split(/\s/),de;var df=function(n){return function(){if(this._is){this._is=false;return this.getDay()==n;}
return this.moveToDayOfWeek(n,this._orient);};};for(var i=0;i<dx.length;i++){$D[dx[i]]=$D[dx[i].substring(0,3)]=df(i);}
var mf=function(n){return function(){if(this._is){this._is=false;return this.getMonth()===n;}
return this.moveToMonth(n,this._orient);};};for(var j=0;j<mx.length;j++){$D[mx[j]]=$D[mx[j].substring(0,3)]=mf(j);}
var ef=function(j){return function(){if(j.substring(j.length-1)!="s"){j+="s";}
return this["add"+j](this._orient);};};var nf=function(n){return function(){this._dateElement=n;return this;};};for(var k=0;k<px.length;k++){de=px[k].toLowerCase();$D[de]=$D[de+"s"]=ef(px[k]);$N[de]=$N[de+"s"]=nf(de);}}());Date.prototype.toJSONString=function(){return this.toString("yyyy-MM-ddThh:mm:ssZ");};Date.prototype.toShortDateString=function(){return this.toString(Date.CultureInfo.formatPatterns.shortDatePattern);};Date.prototype.toLongDateString=function(){return this.toString(Date.CultureInfo.formatPatterns.longDatePattern);};Date.prototype.toShortTimeString=function(){return this.toString(Date.CultureInfo.formatPatterns.shortTimePattern);};Date.prototype.toLongTimeString=function(){return this.toString(Date.CultureInfo.formatPatterns.longTimePattern);};Date.prototype.getOrdinal=function(){switch(this.getDate()){case 1:case 21:case 31:return"st";case 2:case 22:return"nd";case 3:case 23:return"rd";default:return"th";}};(function(){Date.Parsing={Exception:function(s){this.message="Parse error at '"+s.substring(0,10)+" ...'";}};var $P=Date.Parsing;var _=$P.Operators={rtoken:function(r){return function(s){var mx=s.match(r);if(mx){return([mx[0],s.substring(mx[0].length)]);}else{throw new $P.Exception(s);}};},token:function(s){return function(s){return _.rtoken(new RegExp("^\s*"+s+"\s*"))(s);};},stoken:function(s){return _.rtoken(new RegExp("^"+s));},until:function(p){return function(s){var qx=[],rx=null;while(s.length){try{rx=p.call(this,s);}catch(e){qx.push(rx[0]);s=rx[1];continue;}
break;}
return[qx,s];};},many:function(p){return function(s){var rx=[],r=null;while(s.length){try{r=p.call(this,s);}catch(e){return[rx,s];}
rx.push(r[0]);s=r[1];}
return[rx,s];};},optional:function(p){return function(s){var r=null;try{r=p.call(this,s);}catch(e){return[null,s];}
return[r[0],r[1]];};},not:function(p){return function(s){try{p.call(this,s);}catch(e){return[null,s];}
throw new $P.Exception(s);};},ignore:function(p){return p?function(s){var r=null;r=p.call(this,s);return[null,r[1]];}:null;},product:function(){var px=arguments[0],qx=Array.prototype.slice.call(arguments,1),rx=[];for(var i=0;i<px.length;i++){rx.push(_.each(px[i],qx));}
return rx;},cache:function(rule){var cache={},r=null;return function(s){try{r=cache[s]=(cache[s]||rule.call(this,s));}catch(e){r=cache[s]=e;}
if(r instanceof $P.Exception){throw r;}else{return r;}};},any:function(){var px=arguments;return function(s){var r=null;for(var i=0;i<px.length;i++){if(px[i]==null){continue;}
try{r=(px[i].call(this,s));}catch(e){r=null;}
if(r){return r;}}
throw new $P.Exception(s);};},each:function(){var px=arguments;return function(s){var rx=[],r=null;for(var i=0;i<px.length;i++){if(px[i]==null){continue;}
try{r=(px[i].call(this,s));}catch(e){throw new $P.Exception(s);}
rx.push(r[0]);s=r[1];}
return[rx,s];};},all:function(){var px=arguments,_=_;return _.each(_.optional(px));},sequence:function(px,d,c){d=d||_.rtoken(/^\s*/);c=c||null;if(px.length==1){return px[0];}
return function(s){var r=null,q=null;var rx=[];for(var i=0;i<px.length;i++){try{r=px[i].call(this,s);}catch(e){break;}
rx.push(r[0]);try{q=d.call(this,r[1]);}catch(ex){q=null;break;}
s=q[1];}
if(!r){throw new $P.Exception(s);}
if(q){throw new $P.Exception(q[1]);}
if(c){try{r=c.call(this,r[1]);}catch(ey){throw new $P.Exception(r[1]);}}
return[rx,(r?r[1]:s)];};},between:function(d1,p,d2){d2=d2||d1;var _fn=_.each(_.ignore(d1),p,_.ignore(d2));return function(s){var rx=_fn.call(this,s);return[[rx[0][0],r[0][2]],rx[1]];};},list:function(p,d,c){d=d||_.rtoken(/^\s*/);c=c||null;return(p instanceof Array?_.each(_.product(p.slice(0,-1),_.ignore(d)),p.slice(-1),_.ignore(c)):_.each(_.many(_.each(p,_.ignore(d))),px,_.ignore(c)));},set:function(px,d,c){d=d||_.rtoken(/^\s*/);c=c||null;return function(s){var r=null,p=null,q=null,rx=null,best=[[],s],last=false;for(var i=0;i<px.length;i++){q=null;p=null;r=null;last=(px.length==1);try{r=px[i].call(this,s);}catch(e){continue;}
rx=[[r[0]],r[1]];if(r[1].length>0&&!last){try{q=d.call(this,r[1]);}catch(ex){last=true;}}else{last=true;}
if(!last&&q[1].length===0){last=true;}
if(!last){var qx=[];for(var j=0;j<px.length;j++){if(i!=j){qx.push(px[j]);}}
p=_.set(qx,d).call(this,q[1]);if(p[0].length>0){rx[0]=rx[0].concat(p[0]);rx[1]=p[1];}}
if(rx[1].length<best[1].length){best=rx;}
if(best[1].length===0){break;}}
if(best[0].length===0){return best;}
if(c){try{q=c.call(this,best[1]);}catch(ey){throw new $P.Exception(best[1]);}
best[1]=q[1];}
return best;};},forward:function(gr,fname){return function(s){return gr[fname].call(this,s);};},replace:function(rule,repl){return function(s){var r=rule.call(this,s);return[repl,r[1]];};},process:function(rule,fn){return function(s){var r=rule.call(this,s);return[fn.call(this,r[0]),r[1]];};},min:function(min,rule){return function(s){var rx=rule.call(this,s);if(rx[0].length<min){throw new $P.Exception(s);}
return rx;};}};var _generator=function(op){return function(){var args=null,rx=[];if(arguments.length>1){args=Array.prototype.slice.call(arguments);}else if(arguments[0]instanceof Array){args=arguments[0];}
if(args){for(var i=0,px=args.shift();i<px.length;i++){args.unshift(px[i]);rx.push(op.apply(null,args));args.shift();return rx;}}else{return op.apply(null,arguments);}};};var gx="optional not ignore cache".split(/\s/);for(var i=0;i<gx.length;i++){_[gx[i]]=_generator(_[gx[i]]);}
var _vector=function(op){return function(){if(arguments[0]instanceof Array){return op.apply(null,arguments[0]);}else{return op.apply(null,arguments);}};};var vx="each any all".split(/\s/);for(var j=0;j<vx.length;j++){_[vx[j]]=_vector(_[vx[j]]);}}());(function(){var flattenAndCompact=function(ax){var rx=[];for(var i=0;i<ax.length;i++){if(ax[i]instanceof Array){rx=rx.concat(flattenAndCompact(ax[i]));}else{if(ax[i]){rx.push(ax[i]);}}}
return rx;};Date.Grammar={};Date.Translator={hour:function(s){return function(){this.hour=Number(s);};},minute:function(s){return function(){this.minute=Number(s);};},second:function(s){return function(){this.second=Number(s);};},meridian:function(s){return function(){this.meridian=s.slice(0,1).toLowerCase();};},timezone:function(s){return function(){var n=s.replace(/[^\d\+\-]/g,"");if(n.length){this.timezoneOffset=Number(n);}else{this.timezone=s.toLowerCase();}};},day:function(x){var s=x[0];return function(){this.day=Number(s.match(/\d+/)[0]);};},month:function(s){return function(){this.month=((s.length==3)?Date.getMonthNumberFromName(s):(Number(s)-1));};},year:function(s){return function(){var n=Number(s);this.year=((s.length>2)?n:(n+(((n+2000)<Date.CultureInfo.twoDigitYearMax)?2000:1900)));};},rday:function(s){return function(){switch(s){case"yesterday":this.days=-1;break;case"tomorrow":this.days=1;break;case"today":this.days=0;break;case"now":this.days=0;this.now=true;break;}};},finishExact:function(x){x=(x instanceof Array)?x:[x];var now=new Date();this.year=now.getFullYear();this.month=now.getMonth();this.day=1;this.hour=0;this.minute=0;this.second=0;for(var i=0;i<x.length;i++){if(x[i]){x[i].call(this);}}
this.hour=(this.meridian=="p"&&this.hour<13)?this.hour+12:this.hour;if(this.day>Date.getDaysInMonth(this.year,this.month)){throw new RangeError(this.day+" is not a valid value for days.");}
var r=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second);if(this.timezone){r.set({timezone:this.timezone});}else if(this.timezoneOffset){r.set({timezoneOffset:this.timezoneOffset});}
return r;},finish:function(x){x=(x instanceof Array)?flattenAndCompact(x):[x];if(x.length===0){return null;}
for(var i=0;i<x.length;i++){if(typeof x[i]=="function"){x[i].call(this);}}
if(this.now){return new Date();}
var today=Date.today();var method=null;var expression=!!(this.days!=null||this.orient||this.operator);if(expression){var gap,mod,orient;orient=((this.orient=="past"||this.operator=="subtract")?-1:1);if(this.weekday){this.unit="day";gap=(Date.getDayNumberFromName(this.weekday)-today.getDay());mod=7;this.days=gap?((gap+(orient*mod))%mod):(orient*mod);}
if(this.month){this.unit="month";gap=(this.month-today.getMonth());mod=12;this.months=gap?((gap+(orient*mod))%mod):(orient*mod);this.month=null;}
if(!this.unit){this.unit="day";}
if(this[this.unit+"s"]==null||this.operator!=null){if(!this.value){this.value=1;}
if(this.unit=="week"){this.unit="day";this.value=this.value*7;}
this[this.unit+"s"]=this.value*orient;}
return today.add(this);}else{if(this.meridian&&this.hour){this.hour=(this.hour<13&&this.meridian=="p")?this.hour+12:this.hour;}
if(this.weekday&&!this.day){this.day=(today.addDays((Date.getDayNumberFromName(this.weekday)-today.getDay()))).getDate();}
if(this.month&&!this.day){this.day=1;}
return today.set(this);}}};var _=Date.Parsing.Operators,g=Date.Grammar,t=Date.Translator,_fn;g.datePartDelimiter=_.rtoken(/^([\s\-\.\,\/\x27]+)/);g.timePartDelimiter=_.stoken(":");g.whiteSpace=_.rtoken(/^\s*/);g.generalDelimiter=_.rtoken(/^(([\s\,]|at|on)+)/);var _C={};g.ctoken=function(keys){var fn=_C[keys];if(!fn){var c=Date.CultureInfo.regexPatterns;var kx=keys.split(/\s+/),px=[];for(var i=0;i<kx.length;i++){px.push(_.replace(_.rtoken(c[kx[i]]),kx[i]));}
fn=_C[keys]=_.any.apply(null,px);}
return fn;};g.ctoken2=function(key){return _.rtoken(Date.CultureInfo.regexPatterns[key]);};g.h=_.cache(_.process(_.rtoken(/^(0[0-9]|1[0-2]|[1-9])/),t.hour));g.hh=_.cache(_.process(_.rtoken(/^(0[0-9]|1[0-2])/),t.hour));g.H=_.cache(_.process(_.rtoken(/^([0-1][0-9]|2[0-3]|[0-9])/),t.hour));g.HH=_.cache(_.process(_.rtoken(/^([0-1][0-9]|2[0-3])/),t.hour));g.m=_.cache(_.process(_.rtoken(/^([0-5][0-9]|[0-9])/),t.minute));g.mm=_.cache(_.process(_.rtoken(/^[0-5][0-9]/),t.minute));g.s=_.cache(_.process(_.rtoken(/^([0-5][0-9]|[0-9])/),t.second));g.ss=_.cache(_.process(_.rtoken(/^[0-5][0-9]/),t.second));g.hms=_.cache(_.sequence([g.H,g.mm,g.ss],g.timePartDelimiter));g.t=_.cache(_.process(g.ctoken2("shortMeridian"),t.meridian));g.tt=_.cache(_.process(g.ctoken2("longMeridian"),t.meridian));g.z=_.cache(_.process(_.rtoken(/^(\+|\-)?\s*\d\d\d\d?/),t.timezone));g.zz=_.cache(_.process(_.rtoken(/^(\+|\-)\s*\d\d\d\d/),t.timezone));g.zzz=_.cache(_.process(g.ctoken2("timezone"),t.timezone));g.timeSuffix=_.each(_.ignore(g.whiteSpace),_.set([g.tt,g.zzz]));g.time=_.each(_.optional(_.ignore(_.stoken("T"))),g.hms,g.timeSuffix);g.d=_.cache(_.process(_.each(_.rtoken(/^([0-2]\d|3[0-1]|\d)/),_.optional(g.ctoken2("ordinalSuffix"))),t.day));g.dd=_.cache(_.process(_.each(_.rtoken(/^([0-2]\d|3[0-1])/),_.optional(g.ctoken2("ordinalSuffix"))),t.day));g.ddd=g.dddd=_.cache(_.process(g.ctoken("sun mon tue wed thu fri sat"),function(s){return function(){this.weekday=s;};}));g.M=_.cache(_.process(_.rtoken(/^(1[0-2]|0\d|\d)/),t.month));g.MM=_.cache(_.process(_.rtoken(/^(1[0-2]|0\d)/),t.month));g.MMM=g.MMMM=_.cache(_.process(g.ctoken("jan feb mar apr may jun jul aug sep oct nov dec"),t.month));g.y=_.cache(_.process(_.rtoken(/^(\d\d?)/),t.year));g.yy=_.cache(_.process(_.rtoken(/^(\d\d)/),t.year));g.yyy=_.cache(_.process(_.rtoken(/^(\d\d?\d?\d?)/),t.year));g.yyyy=_.cache(_.process(_.rtoken(/^(\d\d\d\d)/),t.year));_fn=function(){return _.each(_.any.apply(null,arguments),_.not(g.ctoken2("timeContext")));};g.day=_fn(g.d,g.dd);g.month=_fn(g.M,g.MMM);g.year=_fn(g.yyyy,g.yy);g.orientation=_.process(g.ctoken("past future"),function(s){return function(){this.orient=s;};});g.operator=_.process(g.ctoken("add subtract"),function(s){return function(){this.operator=s;};});g.rday=_.process(g.ctoken("yesterday tomorrow today now"),t.rday);g.unit=_.process(g.ctoken("minute hour day week month year"),function(s){return function(){this.unit=s;};});g.value=_.process(_.rtoken(/^\d\d?(st|nd|rd|th)?/),function(s){return function(){this.value=s.replace(/\D/g,"");};});g.expression=_.set([g.rday,g.operator,g.value,g.unit,g.orientation,g.ddd,g.MMM]);_fn=function(){return _.set(arguments,g.datePartDelimiter);};g.mdy=_fn(g.ddd,g.month,g.day,g.year);g.ymd=_fn(g.ddd,g.year,g.month,g.day);g.dmy=_fn(g.ddd,g.day,g.month,g.year);g.date=function(s){return((g[Date.CultureInfo.dateElementOrder]||g.mdy).call(this,s));};g.format=_.process(_.many(_.any(_.process(_.rtoken(/^(dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|zz?z?)/),function(fmt){if(g[fmt]){return g[fmt];}else{throw Date.Parsing.Exception(fmt);}}),_.process(_.rtoken(/^[^dMyhHmstz]+/),function(s){return _.ignore(_.stoken(s));}))),function(rules){return _.process(_.each.apply(null,rules),t.finishExact);});var _F={};var _get=function(f){return _F[f]=(_F[f]||g.format(f)[0]);};g.formats=function(fx){if(fx instanceof Array){var rx=[];for(var i=0;i<fx.length;i++){rx.push(_get(fx[i]));}
return _.any.apply(null,rx);}else{return _get(fx);}};g._formats=g.formats(["yyyy-MM-ddTHH:mm:ss","ddd, MMM dd, yyyy H:mm:ss tt","ddd MMM d yyyy HH:mm:ss zzz","d"]);g._start=_.process(_.set([g.date,g.time,g.expression],g.generalDelimiter,g.whiteSpace),t.finish);g.start=function(s){try{var r=g._formats.call({},s);if(r[1].length===0){return r;}}catch(e){}
return g._start.call({},s);};}());Date._parse=Date.parse;Date.parse=function(s){var r=null;if(!s){return null;}
try{r=Date.Grammar.start.call({},s);}catch(e){return null;}
return((r[1].length===0)?r[0]:null);};Date.getParseFunction=function(fx){var fn=Date.Grammar.formats(fx);return function(s){var r=null;try{r=fn.call({},s);}catch(e){return null;}
return((r[1].length===0)?r[0]:null);};};Date.parseExact=function(s,fx){return Date.getParseFunction(fx)(s);};var TimeSpan=function(days,hours,minutes,seconds,milliseconds){var attrs="days hours minutes seconds milliseconds".split(/\s+/);var gFn=function(attr){return function(){return this[attr];};};var sFn=function(attr){return function(val){this[attr]=val;return this;};};for(var i=0;i<attrs.length;i++){var $a=attrs[i],$b=$a.slice(0,1).toUpperCase()+$a.slice(1);TimeSpan.prototype[$a]=0;TimeSpan.prototype["get"+$b]=gFn($a);TimeSpan.prototype["set"+$b]=sFn($a);}
if(arguments.length==4){this.setDays(days);this.setHours(hours);this.setMinutes(minutes);this.setSeconds(seconds);}else if(arguments.length==5){this.setDays(days);this.setHours(hours);this.setMinutes(minutes);this.setSeconds(seconds);this.setMilliseconds(milliseconds);}else if(arguments.length==1&&typeof days=="number"){var orient=(days<0)?-1:+1;this.setMilliseconds(Math.abs(days));this.setDays(Math.floor(this.getMilliseconds()/86400000)*orient);this.setMilliseconds(this.getMilliseconds()%86400000);this.setHours(Math.floor(this.getMilliseconds()/3600000)*orient);this.setMilliseconds(this.getMilliseconds()%3600000);this.setMinutes(Math.floor(this.getMilliseconds()/60000)*orient);this.setMilliseconds(this.getMilliseconds()%60000);this.setSeconds(Math.floor(this.getMilliseconds()/1000)*orient);this.setMilliseconds(this.getMilliseconds()%1000);this.setMilliseconds(this.getMilliseconds()*orient);}
this.getTotalMilliseconds=function(){return(this.getDays()*86400000)+(this.getHours()*3600000)+(this.getMinutes()*60000)+(this.getSeconds()*1000);};this.compareTo=function(time){var t1=new Date(1970,1,1,this.getHours(),this.getMinutes(),this.getSeconds()),t2;if(time===null){t2=new Date(1970,1,1,0,0,0);}
else{t2=new Date(1970,1,1,time.getHours(),time.getMinutes(),time.getSeconds());}
return(t1<t2)?-1:(t1>t2)?1:0;};this.equals=function(time){return(this.compareTo(time)===0);};this.add=function(time){return(time===null)?this:this.addSeconds(time.getTotalMilliseconds()/1000);};this.subtract=function(time){return(time===null)?this:this.addSeconds(-time.getTotalMilliseconds()/1000);};this.addDays=function(n){return new TimeSpan(this.getTotalMilliseconds()+(n*86400000));};this.addHours=function(n){return new TimeSpan(this.getTotalMilliseconds()+(n*3600000));};this.addMinutes=function(n){return new TimeSpan(this.getTotalMilliseconds()+(n*60000));};this.addSeconds=function(n){return new TimeSpan(this.getTotalMilliseconds()+(n*1000));};this.addMilliseconds=function(n){return new TimeSpan(this.getTotalMilliseconds()+n);};this.get12HourHour=function(){return(this.getHours()>12)?this.getHours()-12:(this.getHours()===0)?12:this.getHours();};this.getDesignator=function(){return(this.getHours()<12)?Date.CultureInfo.amDesignator:Date.CultureInfo.pmDesignator;};this.toString=function(format){this._toString=function(){if(this.getDays()!==null&&this.getDays()>0){return this.getDays()+"."+this.getHours()+":"+this.p(this.getMinutes())+":"+this.p(this.getSeconds());}
else{return this.getHours()+":"+this.p(this.getMinutes())+":"+this.p(this.getSeconds());}};this.p=function(s){return(s.toString().length<2)?"0"+s:s;};var me=this;return format?format.replace(/dd?|HH?|hh?|mm?|ss?|tt?/g,function(format){switch(format){case"d":return me.getDays();case"dd":return me.p(me.getDays());case"H":return me.getHours();case"HH":return me.p(me.getHours());case"h":return me.get12HourHour();case"hh":return me.p(me.get12HourHour());case"m":return me.getMinutes();case"mm":return me.p(me.getMinutes());case"s":return me.getSeconds();case"ss":return me.p(me.getSeconds());case"t":return((me.getHours()<12)?Date.CultureInfo.amDesignator:Date.CultureInfo.pmDesignator).substring(0,1);case"tt":return(me.getHours()<12)?Date.CultureInfo.amDesignator:Date.CultureInfo.pmDesignator;}}):this._toString();};return this;};Date.prototype.getTimeOfDay=function(){return new TimeSpan(0,this.getHours(),this.getMinutes(),this.getSeconds(),this.getMilliseconds());};var TimePeriod=function(years,months,days,hours,minutes,seconds,milliseconds){var attrs="years months days hours minutes seconds milliseconds".split(/\s+/);var gFn=function(attr){return function(){return this[attr];};};var sFn=function(attr){return function(val){this[attr]=val;return this;};};for(var i=0;i<attrs.length;i++){var $a=attrs[i],$b=$a.slice(0,1).toUpperCase()+$a.slice(1);TimePeriod.prototype[$a]=0;TimePeriod.prototype["get"+$b]=gFn($a);TimePeriod.prototype["set"+$b]=sFn($a);}
if(arguments.length==7){this.years=years;this.months=months;this.setDays(days);this.setHours(hours);this.setMinutes(minutes);this.setSeconds(seconds);this.setMilliseconds(milliseconds);}else if(arguments.length==2&&arguments[0]instanceof Date&&arguments[1]instanceof Date){var d1=years.clone();var d2=months.clone();var temp=d1.clone();var orient=(d1>d2)?-1:+1;this.years=d2.getFullYear()-d1.getFullYear();temp.addYears(this.years);if(orient==+1){if(temp>d2){if(this.years!==0){this.years--;}}}else{if(temp<d2){if(this.years!==0){this.years++;}}}
d1.addYears(this.years);if(orient==+1){while(d1<d2&&d1.clone().addDays(Date.getDaysInMonth(d1.getYear(),d1.getMonth()))<d2){d1.addMonths(1);this.months++;}}
else{while(d1>d2&&d1.clone().addDays(-d1.getDaysInMonth())>d2){d1.addMonths(-1);this.months--;}}
var diff=d2-d1;if(diff!==0){var ts=new TimeSpan(diff);this.setDays(ts.getDays());this.setHours(ts.getHours());this.setMinutes(ts.getMinutes());this.setSeconds(ts.getSeconds());this.setMilliseconds(ts.getMilliseconds());}}
return this;};

efColumn=function(){this.init();};var COLUMN_CONSTANT={defaultWidth:101,defaultHeight:22};var CUSTOM_ATTR_NAME={enable:true,serviceName:true,queryMethod:true};efColumn.prototype.init=function(){this.sortType="-";this.columnListValue=[];this.columnListLabel=[];this.eiColumn=null;this.customSetting=null;this.columnType=0;this.validator=null;this.existinmeta=true;this.pos=-1;};efColumn.prototype.prepareData=function(eiinfo){return;};efColumn.prototype.getColumnType=function(){return this.columnType;};efColumn.prototype.setEiMeta=function(customed,ei_c){this.customSetting=customed;this.pos=ei_c.pos;this.eiColumn=ei_c;this.validator=efvalidator.build(customed,ei_c);};efColumn.prototype.getWidth=function(){var w=this.customSetting["width"];if(!isAvailable(w))
w=this.eiColumn.width;if(!isAvailable(w)||w<=0){w=COLUMN_CONSTANT["defaultWidth"];this.setWidth(w);}
return w;};efColumn.prototype.set=function(n,v)
{var attr=this.customSetting["attr"];if(!isAvailable(attr)){attr=new Object();this.customSetting["attr"]=attr;}
if(n==="attr"){for(var key in v)
attr[key]=v[key];return;}
if(isAvailable(CUSTOM_ATTR_NAME[n])){attr[n]=v;return;}
this.customSetting[n]=v;};efColumn.prototype.setWidth=function(w){this.set("width",eval(w));};efColumn.prototype.getHeight=function()
{var h=this.customSetting["height"];if(!isAvailable(h))
h=this.eiColumn.height;if(!isAvailable(h)||h<=0){h=COLUMN_CONSTANT["defaultHeight"];this.setHeight(h);}
return eval(h);};efColumn.prototype.setHeight=function(h){this.set("height",eval(h));};efColumn.prototype.getAlign=function(){return this.customSetting["align"]!=null?this.customSetting["align"]:this.eiColumn.align;};efColumn.prototype.getEname=function(){return this.eiColumn.name;};efColumn.prototype.getCname=function(){return this.customSetting["descName"]!=null?this.customSetting["descName"]:this.eiColumn.descName;};efColumn.prototype.isVisible=function(){var v=this.customSetting["visible"]!=null?this.customSetting["visible"]:this.eiColumn.visible;return isAvailable(v)?eval(v):true;};efColumn.prototype.isReadonly=function(){var v=this.customSetting["readonly"]!=null?this.customSetting["readonly"]:this.eiColumn.readonly;return isAvailable(v)?eval(v):false;};efColumn.prototype.getDisplayType=function(){return this.customSetting["displayType"]!=null?this.customSetting["displayType"]:this.eiColumn.displayType;};efColumn.prototype.getFormatString=function(){return this.customSetting["formatter"]!=null?this.customSetting["formatter"]:this.eiColumn.formatter;};efColumn.prototype.getDateFormatString=function(){return this.customSetting["dateFormatString"]!=null?this.customSetting["dateFormatString"]:this.eiColumn.dateFormatString;};efColumn.prototype.getDateFormat=function(){return this.customSetting["dateFormat"]!=null?this.customSetting["dateFormat"]:this.eiColumn.dateFormat;};efColumn.prototype.getDefaultValue=function(){return this.customSetting["defaultValue"]!=null?this.customSetting["defaultValue"]:this.eiColumn.defaultValue;};efColumn.prototype.getSourceName=function(){return this.customSetting["sourceName"]!=null?this.customSetting["sourceName"]:this.eiColumn.sourceName;};efColumn.prototype.getBlockName=function(){return this.customSetting["blockName"]!=null?this.customSetting["blockName"]:this.eiColumn.blockName;};efColumn.prototype.getLabelProperty=function(){return this.customSetting["labelProperty"]!=null?this.customSetting["labelProperty"]:this.eiColumn.labelProperty;};efColumn.prototype.getValueProperty=function(){return this.customSetting["valueProperty"]!=null?this.customSetting["valueProperty"]:this.eiColumn.valueProperty;};efColumn.prototype.isEnable=function(){var enable=true;var attr=this.customSetting["attr"];if(isAvailable(attr)&&isAvailable(attr["enable"]))
enable=eval(attr["enable"]);return enable;};efColumn.prototype.canPersonal=function(){var canPersonal=true;var attr=this.customSetting["canPersonal"];if(isAvailable(this.customSetting)&&isAvailable(attr))
canPersonal=eval(attr);return canPersonal;};efColumn.prototype.getSumType=function(){var sumType="none";var attr=this.customSetting["sumType"];if(isAvailable(this.customSetting)&&isAvailable(attr))
sumType=attr;return sumType;};efColumn.prototype.getValidator=function(){return this.validator;};efColumn.prototype.getEditNodeValue=function(node){return node.value;};efColumn.prototype.genCellDisplayNode=function(col_value,grid_id,row_index,col_index){var html=this.genCellNode(col_value,grid_id,row_index,col_index);var div_node=document.createElement("div");div_node.innerHTML=html;var node=div_node.firstChild;div_node.removeChild(node);var message=this.vallidateCell(row_index,col_index,col_value,grid_id);if(message!="")
efform.setErrorStyle(node,message,false);else
efform.setErrorStyle(node,"",true);return node;};efColumn.prototype.genCellNode=function(col_value,grid_id,row_index,col_index,enable,checked){var display_type=this.getDisplayType();var display_value=this.getFormattedDisplay(col_value);if(this.customSetting.editor=="subgrid"||this.customSetting.editor=="popup")
display_value=this.getDisplayCellValue(grid_id,row_index,display_value);var innerHtml=this.genBaseInnerHtml(display_type,col_value,display_value,grid_id,row_index,col_index,enable,checked);var div_html="";var div_align=this.getAlign();var width=this.getWidth()-1;if(div_align&&div_align!="left"){div_html="<div efVal='' class='efgrid-cell' style='width:100%; position:relative; height:24px;text-align:"+this.getAlign()+";'>"+innerHtml+"</div>";}
else{div_html="<div efVal='' class='efgrid-cell' style='width:100%; position:relative; height:24px;'>"+innerHtml+"</div>";}
if(grid_id=="efgrid_config_sub_grid"){var grid=efgrid.getGridObject(grid_id);var columnEname=grid.getColumn(col_index,TYPE_DATA).getEname();var canPersonal=grid.getCellValue(row_index,0,TYPE_DATA,true);var canHtml=canPersonal=="false"?"disabled=true":"";switch(columnEname){case"isFix":div_html="";if(display_value=='true'){div_html="<div align=center class='efgrid-cell' "+canHtml+"><input hidefocus='-1'  type='checkbox' checked onclick='efgrid.subcgrid.setFix("+row_index+","+col_index+",this.checked);'/></div>";}else{div_html="<div align=center class='efgrid-cell' "+canHtml+"><input hidefocus='-1' type='checkbox' onclick='efgrid.subcgrid.setFix("+row_index+","+col_index+",this.checked)'/></div>";}
break;case"isVisible":div_html="";if(display_value=='true'){div_html="<div align=center class='efgrid-cell' "+canHtml+"><input hidefocus='-1' type='checkbox' checked onclick='efgrid.subcgrid.setVisible("+row_index+","+col_index+",this.checked);'/></div>";}else{div_html="<div align=center class='efgrid-cell' "+canHtml+"><input hidefocus='-1' type='checkbox' onclick='efgrid.subcgrid.setVisible("+row_index+","+col_index+",this.checked)'/></div>";}
break;}
return div_html;}else if(this.columnType==TYPE_DATA&&typeof(efgrid_onCellDisplayReady)=="function"){var customed=efgrid_onCellDisplayReady(div_html,row_index,col_index,col_value,display_value,grid_id);if(isAvailable(customed)){if(customed.trim().toLocaleLowerCase().indexOf("<div")!=0)
div_html=$('<div>').append($(div_html).html(customed)).html();else
div_html=customed;}}else if(this.columnType==TYPE_FIX&&typeof(efgrid_onFixCellDisplayReady)=="function"){var customed=efgrid_onFixCellDisplayReady(div_html,row_index,col_index,col_value,display_value,grid_id);if(isAvailable(customed)){if(customed.trim().toLocaleLowerCase().indexOf("<div")!=0)
div_html=$('<div>').append($(div_html).html(customed)).html();else
div_html=customed;}}
return div_html;};efColumn.prototype.genBaseInnerHtml=function(display_type,col_value,display_value,grid_id,row_index,col_index,enable,checked){if(display_type=="text")return display_value;var html="";var callback=(this.columnType==TYPE_FIX)?"efgrid_onFixCellClick":"efgrid_onDataCellClick";switch(display_type){case"text":html=display_value;break;case"checkbox":html="<input hidefocus='-1' type='checkbox' "
+(enable?"":"disabled=true ")
+(checked?"checked":"")+"/>";break;case"hyperlink":col_value=efutils.replaceCR(col_value," ");html="<a href='#' onclick=\"efform.evalFunction('"+callback+"', '"+grid_id+"', "
+row_index+", "+col_index+", '"+col_value+"');return false;\">"+display_value+"</a>";break;case"textbutton":col_value=efutils.replaceCR(col_value," ");html="<input class='buttonClass' type='button' value='"+display_value+"' onclick=\"efform.evalFunction('"+callback+"', '"
+grid_id+"', "+row_index+", "+col_index+", '"+col_value+"');\"/>";break;case"image":html="<span><img src='"+col_value+"' onclick=\"efform.evalFunction('"+callback+"', '"+grid_id+"', "
+row_index+", "+col_index+", '"+col_value+"');\"/></span>";break;default:html=display_value;break;}
return html;};efColumn.prototype.vallidateCell=function(row_index,col_index,col_value,grid_id){var message="";var key="key_"+row_index+"_"+col_index;var gridDiv=$('#'+grid_id)[0].firstChild;if(this.getColumnType()==TYPE_FIX){key="fix_"+key;message=getI18nMessages(EF_MSG["FIX_COLUMN"],"固定列");}else{key="data_"+key;message=getI18nMessages(EF_MSG["DATA_COLUMN"],"数据列");}
try{if(this.validator)
this.validator.validate(col_value);if(ef_form_validate_message[key]!=null)
delete ef_form_validate_message[key];if(!efform.hasErrorMessage())
gridDiv.title=gridDiv.parentNode.title;else
gridDiv.title=efform.getErrorMessage();return"";}catch(ex){var msg=ex.message;message+="["+col_index+"]"+getI18nMessages(EF_MSG["ROW"],"行")+"["+row_index+"]"
+getI18nMessages(EF_ERROR_MSG["VALIDATE_ERROR"],"数据验证错误")+":"+msg;ef_form_validate_message[key]=message;gridDiv.title=efform.getErrorMessage();return msg;}};efColumn.prototype.getHeaderHTML=function(readonly,enableColumnSetter){var innerHtml=$("<div />");var tempDiv=$("<div />");var colInnerHTML=this.getCname();sorttype=this.sortType.toLowerCase();if(this.getDisplayType()=="checkbox"){var checkBox=$("<input />").attr({'hidefocus':-1,'type':'checkbox','align':'center'});if(readonly){checkBox.attr('disabled','disabled');}
return tempDiv.append(innerHtml.append(checkBox)).html();}else{switch(sorttype){case"a":colInnerHTML+=innerHtml.append($("<img />").attr("src",efico.get("efgrid.columnSortAscend"))).html();break;case"d":colInnerHTML+=innerHtml.append($("<img />").attr("src",efico.get("efgrid.columnSortDecend"))).html();break;case"","-":colInnerHTML=this.getCname();;break;}}
var columnSetterJson={};if(enableColumnSetter){columnSetterJson={'oncontextmenu':'efgrid.divData.onHeaderRightClick(event)','columnId':this.customSetting.name};}
var headerDiv=$("<div />").attr(columnSetterJson).attr('align','center');var divCss={'width':'100%','position':'relative'};var divCss={};if(sorttype=="")
{divCss={'width':'100%','position':'relative','cusor':'hand','text-decoration':'underline'};}
else if(sorttype=="a"||sorttype=="d")
{divCss={'width':'100%','position':'relative','cusor':'hand'};}
return tempDiv.append(headerDiv.css(divCss).html(colInnerHTML)).html();};efColumn.prototype.getFormattedDisplay=function(value,label){value=efutils.replaceCR(value,"&nbsp;");var format_str=this.getFormatString();var dateFormat_str=this.getDateFormatString();if(format_str!=null){var validator=ef_validator_regexes["number"];if(validator.test(value))
return efformat.formatFloat(value,format_str);}else if(dateFormat_str!=null){return efformat.formatDate(value,dateFormat_str);}
return label?label:value;};efColumn.prototype.getEditNode=function(div_node,newline){var pos=efgrid.getCellPos(div_node);var row_index=pos.row;var col_index=pos.col;var grid_node=efgrid.getEfGridNode(div_node);if(!this.isEnable()||(this.isReadonly()&&!newline)){if(efgrid.config==undefined||undefined==efgrid.config.READONLY_PROMPT||efgrid.config.READONLY_PROMPT=="true"){if(!grid_node||grid_node.efgrid.getStyleSetting(STYLE_CONSTANT["READONLY_PROMPT"])!="false")
efform.showMessageBox(getI18nMessages(EF_ERROR_MSG["CELL_NOT_EDITABLE"],"该单元格无法编辑"));}
return null;}
if(!grid_node)return div_node;var ef_grid=grid_node.efgrid;var value=ef_grid.getCellValue(row_index,col_index,this.getColumnType());div_node.innerHTML=this.getEditNodeHtml(div_node,value);return div_node;};efColumn.prototype.getEditNodeHtml=function(div_node,value){var inner_html="<input type='text'  class='inputField' "+"onchange = 'efgrid.cellChange(event);' value='"+value.replace(/'/g,"&#39;")+"' "
+"style='width:100% ;position:relative' />";return inner_html;};efTextColumn=function(){efColumn.call(this);};efTextColumn.prototype=new efColumn;efComboColumn=function(){efColumn.call(this);};efComboColumn.prototype=new efColumn;efComboColumn.prototype.prepareData=function(eiinfo){this.columnListValue=[];this.columnListLabel=[];var source_name=this.getSourceName();var attrs=this.customSetting["attr"];var source_list=attrs?attrs[source_name]:null;if(isAvailable(source_list)){for(var i=0;i<source_list.length;i++){this.columnListValue.push(source_list[i]["value"]);this.columnListLabel.push(source_list[i]["label"]);}}
var blockName=this.getBlockName();if(!isAvailable(blockName))
return;var block=eiinfo.getBlock(blockName);if(!isAvailable(block))
throw new Error("Block with id:["+blockName+"] not exists in eiinfo!");var valuePro=this.getValueProperty();var metas=block.getBlockMeta().getMetas();if(!isAvailable(metas[valuePro]))
return;var labelPro=this.getLabelProperty();if(!isAvailable(labelPro)||!isAvailable(metas[labelPro]))
labelPro=valuePro;for(var i=0;i<block.getRows().length;i++){this.columnListValue.push(block.getCell(i,valuePro));this.columnListLabel.push(block.getCell(i,labelPro));}
return;};efComboColumn.prototype.getDefaultValue=function(){return this.columnListValue[0];};efComboColumn.prototype.getEditNodeValue=function(node){if(node.selectedIndex<0)
return node.options.length>0?node.options[0].value:"";return node.options[node.selectedIndex].value;};efComboColumn.prototype.getFormattedDisplay=function(value,label){var format_str=this.getFormatString();if(isAvailable(format_str)){if(!isAvailable(label)){for(var i=0;i<this.columnListValue.length;i++){if(this.columnListValue[i]==value){label=this.columnListLabel[i];break;}}
if(i>=this.columnListValue.length){value=this.columnListValue[0];label=this.columnListLabel[0];}}
return efutils.replaceString(format_str,"#valueString#",value,/\#labelString#/g,label);}
if(label==null){for(var i=0;i<this.columnListValue.length;i++){if(this.columnListValue[i]==value){label=this.columnListLabel[i];break;}}
if(i>=this.columnListValue.length)
label=this.columnListLabel[0];}
return label;};efComboColumn.prototype.getEditNodeHtml=function(div_node,value){var opts=[];if(this.columnListValue&&this.columnListValue.length>0){var has_selected=false;for(var i=0;i<this.columnListValue.length;i++){var selected=" ";if(value==this.columnListValue[i]){selected="selected";has_selected=true;}
var display_value=this.getFormattedDisplay(this.columnListValue[i],this.columnListLabel[i]);opts.push("<option value='"+this.columnListValue[i]+"' "+selected+">"+display_value+"</option>");}}else{opts.push("<option selected value='"+value+"'>"+value+"</option>");}
var style_str=(this.getMaxWidth()*15<this.getWidth())?"style='width:"+this.getWidth()+"px' ":" ";var innerHtml="<select class='pulldown' "+style_str+">"+opts.join("")+"</select>";return innerHtml;};efComboColumn.prototype.getMaxWidth=function(){var w=0;for(var i=0;i<this.columnListValue.length;i++){var option_str=this.getFormattedDisplay(this.columnListValue[i],this.columnListLabel[i]);var option_w=efutils.getTotalBytes(option_str);if(option_w>w)
w=option_w;}
return w;};efDateColumn=function(type){this.type=type;efColumn.call(this);};efDateColumn.prototype=new efColumn;efDateColumn.prototype.getEditNodeHtml=function(div_node,value){div_node.style.verticalAlign="top";if(isNS)
div_node.style.position="relative";var html_str="<input type='text' id='date_input' class='inputField' ";html_str+=" callback='efDateColumn._calendarCallback' value='"+value+"' style='width:"+this.getWidth()+"px' />";var img_left=div_node.parentNode.offsetWidth-16;html_str+="<div class='ef-input ef-input-calendar'><span style='position: absolute; top:3px; left:"+img_left+"px' class='ef-icon ef-icon-calendar'";if(this.type.toString().toLowerCase()=="date")
{html_str+="onClick=\"bindAndShow(this, ef.get('date_input'), \'"+this.getDateFormat()+"\');\">";}
else if(this.type.toString().toLowerCase()=="datetime")
{html_str+="onClick=\"showDatetimePicker('date_input');\"></span></div>";}
return html_str;};efDateColumn._calendarCallback=function(date_value){efgrid.setCellValue("date_input",date_value);};efSubgridColumn=function(){efColumn.call(this);};efSubgridColumn.prototype=new efColumn;efSubgridColumn.prototype.getServiceName=function(){var v="";var attr=this.customSetting["attr"];if(isAvailable(attr)&&isAvailable(attr["serviceName"]))
v=attr["serviceName"];return v;};efSubgridColumn.prototype.getQueryMethod=function(){var v="null_method";var attr=this.customSetting["attr"];if(isAvailable(attr)&&isAvailable(attr["queryMethod"]))
v=attr["queryMethod"];return v;};efSubgridColumn.prototype.prepareData=function(eiinfo){var blockName=this.getBlockName();this.subgridBlock=eiinfo.blocks[blockName];if(!isAvailable(this.subgridBlock))
throw new Error("Block with id:["+blockName+"] not exists in eiinfo!");var valuePro=this.getValueProperty();return;};efSubgridColumn.prototype.getEditNodeHtml=function(div_node,value){if(isNS)div_node.style.position="relative";var window_node=efform.getSubGridDiv();window_node.efDisplayCol=this;value=value.replace(/"/g,"&quot;");var html_str="";var labelPropertyString=this.customSetting.labelProperty;if(labelPropertyString==undefined||labelPropertyString=="")
{html_str="<input type='text' id='subgrid_input' class='inputField' ";html_str+=" value=\""+value+"\" style=\"width:"+(this.getWidth())+"px\"/>";}
else
{var grid=efgrid.getEfGridNode(div_node).efgrid;var pos=efgrid.getCellPos(div_node);var row_index=pos.row;var block=grid.blockData;var labelValue=value;if(block.meta.metas[labelPropertyString]!=undefined)
{labelValue=block.rows[row_index][block.meta.metas[labelPropertyString].pos];if(labelValue==null)labelValue="";}
html_str="<input type='text' id='subgrid_input' class='inputField' readonly ";html_str+=" value=\""+value+"\" style=\"display:none\"/>";html_str+="<input type='text' id='subgrid_label' class='inputField' readonly ";html_str+=" value=\""+labelValue+"\" style=\"width:100%;\"/>";}
var img_left=div_node.offsetWidth-18;html_str+="<div class='ef-input ef-input-popupwindow'><span style='position: absolute; top:3px; left:"+img_left+"px; cursor:pointer' class='ef-icon ef-icon-popupwindow' onclick=\"efform.showSubGridWindow('subgrid_input');\" ></span></div>";return html_str;};efSubgridColumn.prototype.getDisplayCellValue=function(gridId,row_index,oldValue){if(this.customSetting.labelProperty!=undefined&&this.customSetting.labelProperty!="")
{var block=efgrid.getGridObject(gridId).blockData;if(block.meta.metas[this.customSetting.labelProperty]!=undefined)
{var labelValue=block.rows[row_index][block.meta.metas[this.customSetting.labelProperty].pos];}
else
{var currentEditNode=efgrid.getGridObject(gridId).cellOriginEditNode;if(currentEditNode!=null)
{var inputNodes=currentEditNode.childNodes;if(inputNodes!=null&&inputNodes.length>2)
labelValue=inputNodes[1].value;}}
if(labelValue==null)labelValue="";return labelValue;}
return oldValue;};efTextareaColumn=function(){efColumn.call(this);};efTextareaColumn.prototype=new efColumn;efTextareaColumn.prototype.getEditNodeHtml=function(div_node,value){if(isNS)div_node.style.position="relative";var cell_value=efutils.replaceCR(value);var window_node=efform.getSubGridDiv();window_node.efDisplayingCol=null;cell_value=cell_value.replace(/"/g,"&quot;");var html_str="<input type='text' id='area_input' class='inputField' ";html_str+=" callback=\"efgrid.setCellValue('area_input',\" value=\""+cell_value+"\" style=\"width:"+(this.getWidth())+"px\"/>";var img_left=div_node.parentNode.offsetWidth-16;html_str+="<div class='ef-input ef-input-popupwindow'><span style='position: absolute; top:2px; left:"+img_left+"px;' class='ef-icon ef-icon-popupwindow' onclick=\"efform.showTextAreaWindow('area_input');\" ></span></div>";return html_str;};efMultiselectColumn=function(){efColumn.call(this);};efMultiselectColumn.prototype=new efColumn;efMultiselectColumn.prototype.getFormattedDisplay=function(value,label){var returnValue=label?label:value;if(returnValue==null||returnValue.trim()==""){returnValue=getI18nMessages("ef.InputPrompt","请选择...");}
var valueArray=returnValue.split(',');var displayValue="";for(var i=0;i<valueArray.length;i++){var value_i=valueArray[i];var j=getValueIndexFromList(value_i,this.columnListValue);if(i>0){displayValue+=",";}
if(j!=-1){displayValue+=this.columnListLabel[j];}else{displayValue+=value_i;}}
return displayValue;};function getValueIndexFromList(value,valueList){for(var i=0;i<valueList.length;i++){if(valueList[i]==value){return i;}}
return-1;};efMultiselectColumn.prototype.prepareData=efComboColumn.prototype.prepareData;efMultiselectColumn.prototype.getMaxWidth=efComboColumn.prototype.getMaxWidth;efMultiselectColumn.prototype.getEditNodeHtml=function(div_node,value){if(isNS)div_node.style.position="relative";var cell_value=efutils.replaceCR(value);var window_node=efform.getSubGridDiv();window_node.efDisplayingCol=null;cell_value=cell_value.replace(/"/g,"&quot;");var html_str="<input readonly type='text' id='area_input' class='inputField' onclick=\"efform.showMultiselectWindow('area_input', '"+this.getEname()+"');\" ";html_str+=" callback=\"efgrid.setCellValue('area_input',\" value=\""+cell_value+"\" style=\"width:"+(this.getWidth())+"px\"/>";var img_left=div_node.parentNode.offsetWidth-16;html_str+="<div class='ef-input ef-input-popupwindow'><span style='position: absolute; top:2px; left:"+img_left+"px' class='ef-icon ef-icon-popupwindow' onclick=\"efform.showMultiselectWindow('area_input', '"+this.getEname()+"');\" ></span></div>";return html_str;};efNewwindowColumn=function(){efColumn.call(this);};efNewwindowColumn.prototype=new efColumn;efNewwindowColumn.prototype.getEditNodeHtml=function(div_node,value){if(isNS)div_node.style.position="relative";var grid_node=efgrid.getEfGridNode(div_node);var ef_grid=grid_node.efgrid;if(!ef_grid)return div_node.innerHtml;var pos=efgrid.getCellPos(div_node);var row_index=pos.row;var col_index=pos.col;var html_str="<input type='text' id='newwindow_input' class='inputField' value='"+value+"' style='width:"+(this.getWidth())+"px'/>";var img_left=div_node.parentNode.offsetWidth-16;html_str+="<div class='ef-input ef-input-newform'><span style='position: absolute; top:2px; left:"+img_left+"px' class='ef-icon ef-icon-newform' onclick=\"efform.newWindow('newwindow_input','"
+ef_grid.gridId+"',"+row_index+","+col_index+");\" ></span></div>";return html_str;};efPopupColumn=function(){efColumn.call(this);};efPopupColumn.prototype=new efColumn;efPopupColumn.prototype.getEditNodeHtml=function(div_node,value){if(isNS)div_node.style.position="relative";div_node.efDisplayCol=this;var grid_node=efgrid.getEfGridNode(div_node);var ef_grid=grid_node.efgrid;if(!ef_grid)return div_node.innerHtml;var pos=efgrid.getCellPos(div_node);var row_index=pos.row;var col_index=pos.col;var labelPropertyString=this.customSetting.labelProperty;if(labelPropertyString==undefined||labelPropertyString=="")
{html_str="<input type='text' id='popup_input' class='inputField' ";html_str+=" value=\""+value+"\" style=\"width:"+(this.getWidth())+"px\"/>";}
else
{var grid=efgrid.getEfGridNode(div_node).efgrid;var pos=efgrid.getCellPos(div_node);var row_index=pos.row;var block=grid.blockData;var labelValue=value;if(block.meta.metas[labelPropertyString]!=undefined)
{labelValue=block.rows[row_index][block.meta.metas[labelPropertyString].pos];if(labelValue==null)labelValue="";}
html_str="<input type='text' id='popup_input' class='inputField' readonly ";html_str+=" value=\""+value+"\" style=\"display:none\"/>";html_str+="<input type='text' id='popup_label' class='inputField' readonly ";html_str+=" value=\""+labelValue+"\" style=\"width:100%\"/>";}
var img_left=div_node.offsetWidth-18;html_str+="<div class='ef-input ef-input-newform'><span style='position: absolute; top:2px; left:"+img_left+"px' class='ef-icon ef-icon-newform";if(this.customSetting.popupType==""||this.customSetting.popupType==null)
{html_str+="' onclick=\"efform.showPopupWindow('"+this.customSetting.contentDivId+"','popup_input');\" />";}
else
{html_str+="' onclick=\"efform.showPopupGridWindow('"+this.customSetting.contentDivId+"','popup_input','"
+this.customSetting.visibleColumnNames+"','"+this.customSetting.visibleColumnDisplayNames+"','"+this.customSetting.valueProperty+"','"
+this.customSetting.labelProperty+"','popupGrid','"+this.customSetting.backFillColumnIds+"','"+this.customSetting.backFillFieldIds+"');\" />";}
return html_str;};efPopupColumn.prototype.getDisplayCellValue=function(gridId,row_index,oldValue){if(this.customSetting.labelProperty!=undefined&&this.customSetting.labelProperty!="")
{var block=efgrid.getGridObject(gridId).blockData;if(block.meta.metas[this.customSetting.labelProperty]!=undefined)
{var labelValue=block.rows[row_index][block.meta.metas[this.customSetting.labelProperty].pos];}
else
{var currentEditNode=efgrid.getGridObject(gridId).cellOriginEditNode;if(currentEditNode!=null)
{var inputNodes=currentEditNode.childNodes;if(inputNodes!=null&&inputNodes.length>2)
labelValue=inputNodes[1].value;}}
if(labelValue==null)labelValue="";return labelValue;}
return oldValue;};efPopupColumn.prototype.init=function(){this.contentDivId=null;this.fieldId=null;this.popupType=null;this.visibleColumnNames=null;this.visibleColumnDisplayNames=null;this.backFillColumnIds=null;this.backFillFieldIds=null;};efPopupColumn.transferDataToParent=function(popupId,value,label)
{var showComponent=$('#'+popupId)[0].relativePopupParent;if(showComponent!=undefined&&showComponent!=null)
showComponent.value=value;var popupParentSibling=showComponent.nextSibling;if(popupParentSibling!=undefined&&popupParentSibling!=null)
popupParentSibling.value=label;var pos=efgrid.getCellPos(showComponent);var row_index=pos.row;try{var column=showComponent.parentNode.efDisplayCol;var ef_grid=efgrid.getEfGridNode(showComponent).efgrid;var block=ef_grid.blockData;var labelProperty=column.getLabelProperty();if(labelProperty!=undefined||labelProperty!=""&&showComponent.tagName=='INPUT')
{if(block.meta.metas[labelProperty]!=undefined)
block.rows[row_index][block.meta.metas[labelProperty].pos]=label;}}catch(e){}
efwindow.hide();};efColumn.getColumnObject=function(div_node,t){var cell_pos=div_node.parentNode.cellIndex;var grid_node=efgrid.getEfGridNode(div_node);if(!grid_node)return null;var grid=grid_node.efgrid;if(!grid)return null;return grid.getColumn(cell_pos,t);};efColumn.build=function(customed,eicol,eiinfo){if(customed==null)customed=new Object();var ef_c=customed["column"];if(ef_c==null){var edit_type=(customed["editor"]!=null)?customed["editor"]:eicol.editor;switch(edit_type){case"text":ef_c=new efTextColumn();break;case"date":ef_c=new efDateColumn("date");break;case"datetime":ef_c=new efDateColumn("datetime");break;case"combo":ef_c=new efComboColumn();break;case"subgrid":ef_c=new efSubgridColumn();break;case"textarea":ef_c=new efTextareaColumn();break;case"newwindow":ef_c=new efNewwindowColumn();break;case"popup":ef_c=new efPopupColumn();break;case"multiselect":ef_c=new efMultiselectColumn();break;default:ef_c=new efTextColumn();break;}}
var pk=(customed["primaryKey"]!=null)?customed["primaryKey"]:eicol.primaryKey;if(pk){ef_c.columnType=1;customed["visible"]=true;customed["displayType"]="hyperlink";}
var sort=customed["sort"];ef_c.sortType=(sort!==undefined)?(sort?"":"-"):(pk?"":"-");ef_c.setEiMeta(customed,eicol);ef_c.prepareData(eiinfo);return ef_c;};

efColumnGroup=function(){this.init();}
efColumnGroup.prototype.init=function(){this.columnType=0;}
efColumnGroup.prototype.getColumnType=function(){return this.columnType;}
efColumnGroup.prototype.getWidth=function(){var w=this.customSetting["width"];if(!isAvailable(w))
w=this.eiColumn.width;if(!isAvailable(w)||w<=0){w=COLUMN_CONSTANT["defaultWidth"];this.setWidth(w);}
return w;}
efColumnGroup.prototype.set=function(n,v)
{var attr=this.customSetting["attr"];if(!isAvailable(attr)){attr=new Object();this.customSetting["attr"]=attr;}
if(n==="attr"){for(var key in v)
attr[key]=v[key];return;}
if(isAvailable(CUSTOM_ATTR_NAME[n])){attr[n]=v;return;}
this.customSetting[n]=v;}
efColumnGroup.prototype.setWidth=function(w){this.set("width",eval(w));}
efColumnGroup.prototype.getHeight=function()
{var h=this.customSetting["height"];if(!isAvailable(h))
h=this.eiColumn.height;if(!isAvailable(h)||h<=0){h=COLUMN_CONSTANT["defaultHeight"];this.setHeight(h);}
return eval(h);}
efColumnGroup.prototype.setHeight=function(h){this.set("height",eval(h));}
efColumnGroup.prototype.getAlign=function(){return this.customSetting["align"]!=null?this.customSetting["align"]:this.eiColumn.align;}
efColumnGroup.prototype.getEname=function(){return this.eiColumn.name;}
efColumnGroup.prototype.getCname=function(){return this.customSetting["descName"]!=null?this.customSetting["descName"]:this.eiColumn.descName;}
efColumnGroup.prototype.isVisible=function(){var v=this.customSetting["visible"]!=null?this.customSetting["visible"]:this.eiColumn.visible;return isAvailable(v)?eval(v):true;}
efColumnGroup.prototype.build=function(customed){if(customed==null)customed=new Object();var pk=(customed["primaryKey"]!=null)?customed["primaryKey"]:false;if(pk=="true"){this.columnType=1;}
this.customSetting=customed;this.pos=customed.pos;}

efformat=function()
{}
efformat.formatFloat=function(value,mask)
{var reg=/%$/;if(reg.exec(mask)=='%')
{return efformat.formatPercent(value,mask);}
return efformat.formatNumber(value,mask);}
efformat.formatPercent=function(value,format)
{if(value==null||!ef_validator_regexes["number"].test(value))return value;var reg=/%$/;var result=0;if(reg.exec(format)=='%')
result=efformat._multiply(value,100);var decNum=efformat.numOfDecFormat(format);result=efformat.decimal(result,decNum);result=result.toString();if(result.indexOf(".")==-1)
{result+=".";for(var i=0;i<decNum;i++)
result+="0";}
return result+"%";}
efformat.numOfDecFormat=function(format)
{var dec_dig=0;var before_dot=true;for(var i=0;i<format.length;i++){var c=format.charAt(i);if(c=="#"||c=="0"){if(!before_dot)
dec_dig++;}else{if(c==".")before_dot=false;}}
return dec_dig;}
efformat.decimal=function(num,v)
{var vv=Math.pow(10,v);return Math.round(num*vv)/vv;}
efformat.IsDateFormatter=function(format)
{return(format.indexOf("yy")>-1)||(format.indexOf("MM")>-1)||(format.indexOf("dd")>-1)||(format.indexOf("HH")>-1)||(format.indexOf("mm")>-1)||(format.indexOf("ss")>-1)||(format.indexOf("SSS")>-1);}
efformat.formatDate=function(number,format)
{return efform._dateParseToString(efform._stringParseToDate(number),format);}
efform._stringParseToDate=function(num,rawFormat)
{if(num==undefined)return null;var raw_format="";if(rawFormat)
raw_format=rawFormat;else{if(num.length==14&&ef_validator_regexes["number"].test(num))
raw_format="yyyyMMddhhmmss";else if(num.length==17&&ef_validator_regexes["number"].test(num))
raw_format="yyyyMMddhhmmssSSS";else if(num.length==8&&ef_validator_regexes["number"].test(num))
raw_format="yyyyMMdd";else if(num.length>=8&&num.length<=10)
{if(num.indexOf("-")>0)
raw_format="yyyy-MM-dd";else if(num.indexOf("/")>0)
raw_format="yyyy/MM/dd";}}
if(raw_format==""){return num;}
var date=new Object();var y_index=raw_format.indexOf("yyyy");var M_index=raw_format.indexOf("MM");var d_index=raw_format.indexOf("dd");var h_index=raw_format.indexOf("hh");var m_index=raw_format.indexOf("mm");var s_index=raw_format.indexOf("ss");var ss_index=raw_format.indexOf("SSS");if(y_index>-1)
date["yyyy"]=num.substring(y_index,y_index+4);else
date["yyyy"]="0000";if(M_index>-1)
date["MM"]=num.substring(M_index,M_index+2);else
date["MM"]="00";if(d_index>-1)
date["dd"]=num.substring(d_index,d_index+2);else
date["dd"]="00";if(h_index>-1)
date["hh"]=num.substring(h_index,h_index+2);else
date["hh"]="00";if(m_index>-1)
date["mm"]=num.substring(m_index,m_index+2);else
date["mm"]="00";if(s_index>-1)
date["ss"]=num.substring(s_index,s_index+2);else
date["ss"]="00";if(ss_index>-1)
date["SSS"]=num.substring(ss_index,ss_index+3);else
date["SSS"]="000";return date;}
efform._dateParseToString=function(date,format)
{if(date==undefined||format==undefined)return"";if(typeof date=="string")return date;var y_index=format.indexOf("yyyy");var M_index=format.indexOf("MM");var d_index=format.indexOf("dd");var h_index=format.indexOf("hh");var m_index=format.indexOf("mm");var s_index=format.indexOf("ss");var ss_index=format.indexOf("SSS");var retDateString=new Array();for(var i=0;i<format.length;i++)
{if(format.charAt(i)=="y"&&format.charAt(i+1)=="y"&&format.charAt(i+2)=="y"&&format.charAt(i+3)=="y")
{retDateString.push(date["yyyy"]);i=i+3;}
else if(format.charAt(i)=="M"&&format.charAt(i+1)=="M")
{retDateString.push(date["MM"]);i++;}
else if(format.charAt(i)=="d"&&format.charAt(i+1)=="d")
{retDateString.push(date["dd"]);i++;}
else if(format.charAt(i)=="h"&&format.charAt(i+1)=="h")
{retDateString.push(date["hh"]);i++;}else if(format.charAt(i)=="m"&&format.charAt(i+1)=="m")
{retDateString.push(date["mm"]);i++;}else if(format.charAt(i)=="s"&&format.charAt(i+1)=="s")
{retDateString.push(date["ss"]);i++;}else if(format.charAt(i)=="S"&&format.charAt(i+1)=="S"&&format.charAt(i+2)=="S")
{retDateString.push(date["SSS"]);i=i+2;}else
retDateString.push(format.charAt(i));}
return retDateString.join("");}
efformat.formatNumber=function(number,format)
{var isNegative=(number<0);if(isNegative)number=-number;var arr_f=new Array();var arr_rep_index=new Array();var before_dot=true;var dec_dig=0;for(var i=0;i<format.length;i++){var c=format.charAt(i);if(c=="#"||c=="0"){var len=arr_f.push("");arr_rep_index.push(len-1)
if(!before_dot)dec_dig++;}else{arr_f.push(c);if(c==".")before_dot=false;}}
number=Math.round(number*Math.pow(10,dec_dig)).toString();var j=number.length-1;for(var i=arr_rep_index.length-1;i>-1;i--){if(j>-1){arr_f[arr_rep_index[i]]=number.charAt(j);j--;}else{for(var k=arr_rep_index[0];k<=arr_rep_index[i]+1;k++){if(arr_f[k]==",")arr_f[k]="";}
break;}}
if(j>-1){var mixValue=new Array();if(isNegative)mixValue.push("-");mixValue.push(number.substring(0,j+1));mixValue.push(arr_f[arr_rep_index[0]]);arr_f[arr_rep_index[0]]=mixValue.join("");}
var count=0;for(i=arr_f.length-1;count<dec_dig;count++,i--)
{if(arr_f[i]=="")
arr_f[i]="0";}
var retv=arr_f.join("");var regNum=/^\d*$/;var isNumber=regNum.test(retv.charAt(0));var isDot=false;var withCurSymbol=false;if(retv.charAt(0)==".")
{retv="0"+retv;}else if(!isNumber&&retv.charAt(1)=="."){var headChar=retv.charAt(0);var numPart=retv.substring(1);numPart="0"+numPart;retv=headChar.concat(numPart);}
if(isNegative)
{var ifWithCurSym=!regNum.test(retv.charAt(0));if(ifWithCurSym)
{var headChar=retv.charAt(0);var numPart=retv.substring(1);numPart="-"+numPart;retv=headChar.concat(numPart);}else{retv="-"+retv;}}
return retv;}
efformat._formatInput=function(element1)
{var value=element1.value;if(value==undefined||value=="")return"";var format_str=element1.formatter;var dateFormat_str=element1.dateFormat;if(format_str!=null&&format_str!=""){var validator=ef_validator_regexes["number"];if(validator.test(value))
return efformat.formatFloat(value,format_str);}else if(dateFormat_str!=null&&dateFormat_str!=""){return efformat.formatDate(value,dateFormat_str);}
return value;}
efformat._changeStatus=function(element1,element2,needFormat)
{element1.style.display="none";element2.style.display="inline";if(needFormat)
element2.value=efformat._formatInput(element1);else
element2.focus();}
efformat.initFormatDiv=function(inputId,format_str,dateFormat_str)
{var element=$('#'+inputId)[0];element.style.display="none";element.formatter=format_str;element.dateFormat=dateFormat_str;var format_input=$('#'+inputId+"_formatInput")[0];if(!element.readOnly)format_input.onclick=function(){efformat._changeStatus(format_input,element,false)};if(!element.readOnly)element.onblur=function(){efformat._changeStatus(element,format_input,true)};if($.browser.msie){element.onpropertychange=function(){format_input.value=efformat._formatInput(element);};}else{element.addEventListener('input',function(o){format_input.value=efformat._formatInput(element);});}
format_input.readOnly=true;if(!element.readOnly)format_input.style.background="#F5F6F8";format_input.value=efformat._formatInput(element);format_input.className="inputField";}
efformat._basicFormat=function(value,mask,action,param)
{var xmlDoc;var xslDoc;var v='<formats><format><value>'+value+'</value><mask>'+mask
+'</mask></format></formats>';xmlDoc=efformat._parseXML(v);var x;if(isIE)
x='<xsl:stylesheet xmlns:xsl="uri:xsl">'
else
x='<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">';x+='<xsl:template match="/">';if(isIE)
{x+='<xsl:eval>'+action+'('+value+',"'+mask+'"';if(param)x+=','+param;x+=')</xsl:eval>';}
else
x+='<xsl:value-of select="format-number('+value+',\''+mask+'\')" />';x+='</xsl:template></xsl:stylesheet>';xslDoc=efformat._parseXML(x);var s;if(isIE)
s=xmlDoc.transformNode(xslDoc)
else
{var processor=new XSLTProcessor();processor.importStylesheet(xslDoc);var result=processor.transformToFragment(xmlDoc,xmlDoc);var xmls=new XMLSerializer();s=xmls.serializeToString(result);}
return s;}
efformat._multiply=function(arg1,arg2)
{arg1=String(arg1);var i=arg1.length-arg1.indexOf(".")-1;i=(i>=arg1.length)?0:i;arg2=String(arg2);var j=arg2.length-arg2.indexOf(".")-1;j=(j>=arg2.length)?0:j;return arg1.replace(".","")*arg2.replace(".","")/Math.pow(10,i+j);}
efformat._getXMLDOM=function()
{if(null==efformat._XMLDOM)
efformat._XMLDOM=new ActiveXObject("Microsoft.XMLDOM");return efformat._XMLDOM;}
efformat._XMLDOM=null;efformat._parseXML=function(st)
{var result;if(isIE)
{result=efformat._getXMLDOM();result.loadXML(st);}
else
{var parser=new DOMParser();result=parser.parseFromString(st,"text/xml");}
return result;}

var TYPE_FIX=1;var TYPE_DATA=0;var LIMIT_ALL=-999999;var STYLE_CONSTANT={OPERTATION_BAR:"operationBar",REMOVE_BAR:"removeBar",NAVIGATION_BAR:"navigationBar",TOOL_BAR:"toolBar",SORTABLE:"sortable",SHOW_COUNT:"showCount",INIT_SELECT:"initSelect",KEY_EVENT:"keyEvent",CHECK_NEWLINE:"checkNewLine",PERSONAL_BAR:"personalBar",MODELXLS_BAR:"modelXlsBar",SHOW_LINE_NUMBER:"showLineNumber",AUTO_HEIGHT:'autoHeight'};function efgrid(id,paint_id){this.blockId=id;this.gridId=paint_id;this.init();efform.addGrid(this);}
efgrid.getCellPos=function(div_node)
{var pos={'row':-1,'col':-1};var rowIndex=$(div_node).closest('tr[rawrowindex]').attr('rawrowindex');if(rowIndex)
{pos.row=parseInt(rowIndex);}
if($(div_node).is('td'))
{pos.col=$(div_node).index();}
else
{pos.col=$(div_node).closest('td[id*=Td]').index();}
return pos;};efgrid.getFuncDiv=function(grid_node){var gridId=grid_node.efgrid.gridId;var funcDivId='#'+gridId+EF_SPLIT+"func_div";if($(funcDivId).length>0)
return $(funcDivId)[0];return null;};efgrid.getCornerDiv=function(grid_node){var gridId=grid_node.efgrid.gridId;var cornerDivId='#'+gridId+EF_SPLIT+"corner_div";if($(cornerDivId).length>0)
return $(cornerDivId)[0];return null;};efgrid.getFixDiv=function(grid_node){var gridId=grid_node.efgrid.gridId;var fixDivId='#'+gridId+EF_SPLIT+"fix_div";if($(fixDivId).length>0)
return $(fixDivId)[0];return null;};efgrid.getHeadDiv=function(grid_node){var gridId=grid_node.efgrid.gridId;var headDivId='#'+gridId+EF_SPLIT+"head_div";if($(headDivId).length>0)
return $(headDivId)[0];return null;};efgrid.getDataDiv=function(grid_node){var gridId=grid_node.efgrid.gridId;var dataDivId='#'+gridId+EF_SPLIT+"data_div";if($(dataDivId).length>0)
return $(dataDivId)[0];return null;};efgrid.getLineNumberDiv=function(grid_node){var gridId=grid_node.efgrid.gridId;var dataDivId='#'+gridId+EF_SPLIT+"line_data_div";if($(dataDivId).length>0)
return $(dataDivId)[0];return null;};efgrid._saveOldCell=function(old_node,grid){var pos=efgrid.getCellPos(old_node);var old_row_index=pos.row;var old_col_index=pos.col;var col_obj=grid.getColumn(old_col_index,grid.cellOriginNodeType);var cell_value=col_obj.getEditNodeValue(old_node.firstChild);efgrid.setCurrentValue(old_node,cell_value,(cell_value!=grid.cellOriginNodeValue));cell_value=grid.getCellValue(old_row_index,old_col_index,grid.cellOriginNodeType);var parent_node=old_node.parentNode;parent_node.innerHtml="";parent_node.removeChild(old_node);parent_node.appendChild(col_obj.genCellDisplayNode(cell_value,grid.gridId,old_row_index,old_col_index));grid.cellOriginEditNode=null;grid.cellOriginNodeValue="";};efgrid._setEditNodeEvent=function(div_node){var edit_node=div_node.firstChild;if(edit_node){if(edit_node.tagName=="SELECT"){var selectedIndex=eval(edit_node.selectedIndex);edit_node.selectedIndex=(selectedIndex<0)?0:selectedIndex;if(isIE)
window.setTimeout(function(){edit_node.focus();},10);}
if(!edit_node.onkeydown)
edit_node.onkeydown=efgrid.cellChange;if(!edit_node.onchange)
edit_node.onchange=efgrid.cellChange;if(!edit_node.disabled&&edit_node.style.display!="none"&&$(edit_node).parents('div::hidden').length==0){edit_node.focus();if(isAvailable(edit_node.select))
edit_node.select();}}};efgrid._genEditNode=function(grid,div_node,data_type){if(!grid.isEnable()||grid.isReadonly())
return;var pos=efgrid.getCellPos(div_node);var row_index=pos.row;var col_index=pos.col;var newline=grid.isNewLine(row_index);if(data_type==TYPE_FIX&&!newline)
return;if(typeof efgrid_onBeforeCellEditNodeDisplay=="function"){try{if(efgrid_onBeforeCellEditNodeDisplay(grid.gridId,row_index,col_index,data_type)==false)
return;}catch(ex){efgrid.processException(ex,"Callback to efgrid_onBeforeCellEditNodeDisplay failed");}}
var column=grid.getColumn(col_index,data_type);div_node=grid.getCellDivNode(row_index,col_index,data_type);div_node=column.getEditNode(div_node,newline);if(!div_node)
return null;if(typeof efgrid_onCellEditNodeDisplayReady=="function"){try{var cell_value=grid.getCellValue(row_index,col_index,data_type);efgrid_onCellEditNodeDisplayReady(grid.gridId,row_index,col_index,cell_value,data_type,div_node);}catch(exception){efgrid.processException(exception);}}
div_node=grid.getCellDivNode(row_index,col_index,data_type);efgrid._setEditNodeEvent(div_node);grid.cellOriginEditNode=div_node;grid.cellOriginNodeType=data_type;grid.cellOriginNodeValue=grid.getCellValue(row_index,col_index,data_type);};efgrid.cellClick=function(data_type,event,dbclick){var div_node=event.srcElement||event.target;if(div_node.tagName=="A")
div_node=div_node.parentNode;if(div_node.tagName!="DIV")
return;var grid_node=efgrid.getEfGridNode(div_node);var grid=grid_node.efgrid;if(!grid)
return;var not_cell=(div_node.getAttribute("efVal")==null);var row_index=0,col_index=0;if(!not_cell){var pos=efgrid.getCellPos(div_node);row_index=pos.row;col_index=pos.col;}
var old_node=grid.cellOriginEditNode;if((old_node)&&(old_node==div_node))
return;if(old_node)
efgrid._saveOldCell(old_node,grid);if(not_cell)
return;div_node=grid.getCellDivNode(row_index,col_index,data_type);var rowCheck=grid.isRowChecked(row_index);if(!rowCheck){grid.setCurrentRowIndex(row_index,dbclick);if(TYPE_DATA==0&&grid.getColumn(col_index,TYPE_DATA)!=undefined&&grid.getColumn(col_index,TYPE_DATA).customSetting.editor=="textarea"){var component=grid.getCellDivNode(row_index,col_index,TYPE_DATA);var title=getI18nMessages("ef.GridDetail","详情");var div_node=efform.getSubGridDiv(title,"cell_subgrid");var show_value=component.innerHTML;var index=show_value.indexOf(EF_CR_IDENTIFIER);while(index!=-1){show_value=show_value.substring(0,index)+"\r\n"
+show_value.substring(index+2);index=show_value.indexOf(EF_CR_IDENTIFIER);}
var inner_html=[];inner_html.push("<div style='width:320px'>");inner_html.push("<textarea wrap=\"hard\" rows=8 cols=30 style='width:100%;' readonly id=\"subwindow_read_textarea\" >"
+show_value+"</textarea>");inner_html.push("</div>");div_node.innerHTML=inner_html.join("");efwindow.show(component,div_node.id);}}else
efgrid._genEditNode(grid,div_node,data_type);};efgrid.cellChange=function(e){var event=window.event||e;var tag_node=event.srcElement||event.target;var div_node=tag_node;if(div_node.tagName=="INPUT"||div_node.tagName=="input")
div_node=div_node.parentNode;if(div_node.tagName=="SELECT"||div_node.tagName=="select")
div_node=div_node.parentNode;if(div_node.tagName!="DIV")
return;var pos=efgrid.getCellPos(div_node);var col_index=pos.col;var row_index=pos.row;var grid_node=efgrid.getEfGridNode(tag_node);if(!grid_node)
return;var grid=grid_node.efgrid;if(!grid)
return;var old_node=grid.cellOriginEditNode;if(!((old_node)&&(old_node==div_node)))
return;var switched=efgrid._cellKeydown(grid,row_index,col_index,event);if(switched)
return false;var div_cell_column=grid.getColumn(col_index,grid.cellOriginNodeType);var cell_value=div_cell_column.getEditNodeValue(tag_node);efgrid.setCurrentValue(grid.cellOriginEditNode,cell_value);};efgrid._getSelectedGridData=function(grid_node){var inner_html=[];var grid=grid_node.efgrid;var blockId=grid.blockId;var metas=grid.getBlockData().getBlockMeta().getMetas();for(var i=0,k=0;i<grid.getRowCount();i++){if(!grid.isRowChecked(i))
continue;for(var key in metas){var column_name=metas[key].name;var param_name=blockId+EF_FORMDATA_SPLIT+k
+EF_FORMDATA_SPLIT+column_name;var cell_value=efutils.trimString(grid.getBlockData().getCell(i,column_name));cell_value=(cell_value=="")?" ":cell_value.replace(/'/g,"&#39;");var str_trmp="<INPUT type='hidden' "+"value='"+cell_value
+"' "+"name = '"+param_name+"'>";inner_html.push(str_trmp);}
k++;}
return inner_html.join('');};efgrid._getSelectedData=function(id_in,include_selected_data){var ef_div_submit=document.createElement("div");ef_div_submit.id=id_in+"_submit";var tableId="#"+id_in+EF_SPLIT+"grid_table";var grid_node=$(tableId)[0];ef_div_submit.innerHTML+=efgrid._getGridMetadata(grid_node);if(include_selected_data){ef_div_submit.innerHTML+=efgrid._getSelectedGridData(grid_node);}
return ef_div_submit;};efgrid._getGridMetadata=function(grid_node){var inner_html=[];var grid_obj=grid_node.efgrid;var blockId=grid_obj.blockId;var str_trmp="<INPUT type='hidden' value='"+grid_obj.getOffset()+"' "
+"name = '"+blockId+EF_FORMDATA_SPLIT+"offset'>";inner_html.push(str_trmp);str_trmp="<INPUT type='hidden' "+"value='-1' "+"name = '"+blockId
+EF_FORMDATA_SPLIT+"count'>";inner_html.push(str_trmp);str_trmp="<INPUT type='hidden' "+"value='"+grid_obj.getShowCount()
+"' "+"name = '"+blockId+EF_FORMDATA_SPLIT+"showCount'>";inner_html.push(str_trmp);str_trmp="<INPUT type='hidden' "+"value='"+grid_obj.getLimit()+"' "
+"name = '"+blockId+EF_FORMDATA_SPLIT+"limit'>";inner_html.push(str_trmp);str_trmp="<INPUT type='hidden' "+"value='"+grid_obj.getOrderBy()
+"' "+"name = '"+blockId+EF_FORMDATA_SPLIT+"orderBy'>";inner_html.push(str_trmp);return inner_html.join("");};efgrid.getEfGridNode=function(in_node){var node_now=in_node;while(node_now.tagName!="TABLE"){if(node_now.parentNode==null){node_now=null;break;}else{node_now=node_now.parentNode;}}
if(node_now==null)
return null;var in_id=node_now.id;var pos_at=in_id.indexOf(EF_SPLIT);if(pos_at>0)
in_id=in_id.substring(0,pos_at);return $('#'+in_id+EF_SPLIT+"grid_table")[0];};efgrid.getRowIndex=function(inTr){if(inTr.rowIndex&&inTr.rowIndex>=0)
return inTr.rowIndex;var rows=inTr.parentNode.childNodes;for(var i=0,l=rows.length;i<l;i++){if(inTr==rows[i])
return i;}
return-1;};efgrid.findEventCell=function(inTarget){if(!inTarget)
return null;if(inTarget.tagName=='TABLE')
return null;while(inTarget.tagName!='TD'&&inTarget.parentNode)
inTarget=inTarget.parentNode;if((inTarget.tagName=='TD')){var ef_grid_main_table=inTarget.getAttribute("efGridTopTable");if(ef_grid_main_table==null)
return inTarget;}
return null;};efgrid.getGridObject=function(grid_id){return efform.getGrid(grid_id);};efgrid.setCurrentValue=function(div_node,cell_value,invoke_callback){cell_value=efutils.trimString(cell_value);var index=cell_value.indexOf(EF_CR_IDENTIFIER);while(index!=-1){cell_value=cell_value.substring(0,index)+"\r\n"
+cell_value.substring(index+2);index=cell_value.indexOf(EF_CR_IDENTIFIER);}
var grid_node=efgrid.getEfGridNode(div_node);var grid=grid_node.efgrid;if(!grid)
return;var pos=efgrid.getCellPos(div_node);var row_index=pos.row;var col_index=pos.col;grid.setCellValue(row_index,col_index,cell_value,grid.cellOriginNodeType);if(!invoke_callback)
return;try{if(grid.cellOriginNodeType==TYPE_FIX){if(typeof efgrid_onFixCellSaved=="function")
efgrid_onFixCellSaved(grid.gridId,row_index,col_index,cell_value);}else{if(typeof efgrid_onDataCellSaved=="function")
efgrid_onDataCellSaved(grid.gridId,row_index,col_index,cell_value);}}catch(ex){var callback=(grid.cellOriginNodeType==TYPE_FIX)?"onFixCellSaved":"onDataCellSaved";efgrid.processException(ex,"Callback to efgrid_"+callback
+" failed");}};efgrid.setReturnValue=function(edit_node,cell_value,cell_label){edit_node.value=cell_value;var div_node=edit_node.parentNode;if(div_node.tagName!="DIV"&&div_node.tagName!="div")
return;efgrid.setCurrentValue(div_node,cell_value);};efgrid.setCellValue=function(edit_node_id,cell_value,cell_label){var edit_node=$('#'+edit_node_id)[0];efgrid.setReturnValue(edit_node,cell_value,cell_label);};efgrid.submitForm=function(id_in,package_name,service_name,method_name,include_selected_data,check,need_callback,ajax_mode){if(!isAvailable(check))
check=false;var grid=efform.getGrid(id_in);var selcount=grid.getCheckedRowCount();if(selcount<=0&&check){if(!confirm(getI18nMessages(EF_MSG["SUBMIT_CONFIRM"],"未选中任何记录，确定要提交吗？")))
return;}
var grid_ids=[];grid_ids.push(id_in);efgrid._submitFormData(grid_ids,package_name,service_name,method_name,include_selected_data,include_selected_data,true,need_callback,ajax_mode);};efgrid.submitInqu=function(id_in,package_name,service_name,method_name){var grid=efform.getGrid(id_in);grid.setOffset(0);efgrid.submitInquWithMeta(id_in,package_name,service_name,method_name);};efgrid.submitInquWithMeta=function(id_in,package_name,service_name,method_name){efform.clearErrorMessage();var grid_ids=[];grid_ids.push(id_in);efgrid._submitFormData(grid_ids,package_name,service_name,method_name,false,true,false,false);};efgrid.submitAllGridsData=function(package_name,service_name,method_name){var grid_ids=efform.getAllGridIDs();efgrid._submitFormData(grid_ids,package_name,service_name,method_name,true,true,true);};efgrid.submitGridsData=function(grid_ids,package_name,service_name,method_name){efgrid._submitFormData(grid_ids,package_name,service_name,method_name,true,true,true);};efgrid._addSelectedData=function(block,grid){var blockData=grid.getBlockData();var colCount=grid.getColCount(TYPE_DATA)+grid.getColCount(TYPE_FIX)
+grid.getInvisibleColCount();for(var i=0;i<grid.getRowCount();i++){if(grid.isRowChecked(i)){var row=blockData.getRows()[i];for(var j=0;j<row.length;j++){row[j]=efutils.trimString(row[j]);if(row[j]=="")
row[j]=" ";}
block.addRow(row);}}};efgrid._submitFormData=function(grid_ids,package_name,service_name,method_name,include_selected_data,include_metadata,need_validate,need_callback,ajax_mode){if(efgrid.config!=undefined&&efgrid.config.SESSION_TIMEOUT!=undefined){if(checkTimeOut())
{return;}}
if(!isAvailable(need_callback))
need_callback=true;if(!isAvailable(grid_ids)||!(grid_ids instanceof Array)){alert("Invalid grid id array");return;}
if(need_validate){for(var i=0;i<grid_ids.length;i++){var grid=efform.getGrid(grid_ids[i]);var message=grid.validateAll();if(message!=null&&message!=""){efform.setErrorStyle(grid.getGridTableNode(),message,false);EFAlert(message);return;}}}
var submit_data=true;if(need_callback&&typeof efgrid_onGridSubmit=="function"){try{submit_data=efgrid_onGridSubmit();}catch(ex){efgrid.processException(ex,"Callback to efgrid_onGridSubmit failed");}}
if(submit_data===false){return;}
if(grid_ids.length==1&&efform.getGrid(grid_ids[0]).ajax){var grid=efform.getGrid(grid_ids[0]);if(grid.cellOriginEditNode!=null)
efgrid._saveOldCell(grid.cellOriginEditNode,grid);var info=new EiInfo();info.setByNodeObject(document.body);var block=info.getBlock(grid.blockId);if(!isAvailable(block)){block=new EiBlock(grid.getBlockData().getBlockMeta());info.addBlock(block);}
block.setAttr(grid.getBlockData().getAttr());block.set("orderBy",grid.getOrderBy());if(include_selected_data){efgrid._addSelectedData(block,grid);}
if(!isAvailable(service_name))
service_name=grid.serviceName;if(!isAvailable(method_name))
method_name=grid.queryMethod;grid.serviceName=service_name;grid.queryMethod=method_name;if(typeof grid.onGridSubmit=="function"){try{grid.onGridSubmit(info);}catch(ex){efgrid.processException(ex,"Callback to onGridSubmit failed");}}
EiCommunicator.send(service_name,method_name,info,{onSuccess:function(eiInfo){if(typeof efgrid_onAjaxSubmitSuccess=="function"){try{efgrid_onAjaxSubmitSuccess(grid.gridId,service_name,method_name,eiInfo);}catch(ex){efgrid.processException(ex,"Callback to efgrid_onAjaxSubmitSuccess failed");}}else{var ef_grid=efform.getGrid(grid_ids[0]);ef_grid.refresh(eiInfo);}},onFail:function(eMsg){alert("Error occured on call service: "+eMsg);}},true,ajax_mode);}else{if(isAvailable(package_name))
ef.get("packageName").value=package_name;if(isAvailable(service_name))
ef.get("serviceName").value=service_name;if(isAvailable(method_name))
ef.get("methodName").value=method_name;if(include_metadata){for(var i=0;i<grid_ids.length;i++){var grid=efform.getGrid(grid_ids[i]);if(grid.cellOriginEditNode!=null)
efgrid._saveOldCell(grid.cellOriginEditNode,grid);var ef_div_submit=efgrid._getSelectedData(grid_ids[i],include_selected_data);var in_div=$('#'+grid_ids[i])[0];if(!ef.get(grid_ids[i]+"_submit"))
in_div.appendChild(ef_div_submit);}}
efform.submit(document.forms[0]);}};efgrid.setRowDisplayStyle=function(grid_id,row_index,style_classname){var grid=efform.getGrid(grid_id);if(row_index<0||row_index>=grid.getRowCount())
return;grid._rowStyle[row_index]=style_classname+" "+grid._rowStyle[row_index];var table_node=grid.getGridTableNode();efgrid.divData.setRowStyle(table_node,row_index,style_classname);};efgrid.setDisplayStyle=function(grid_id,row_index,col_index,style_name,style_value,column_type){if(TYPE_FIX!=column_type)
column_type=TYPE_DATA;var cell_table=(column_type==TYPE_FIX)?$('#'+grid_id+'__fix_table'):$('#'+grid_id+'__data_table');var cell_node=cell_table.find('tr[rawrowindex='+row_index+']').children('td:eq('+col_index+')');if(cell_node.length>0)
{cell_node.children().eq(0).css(style_name,style_value);}
else
{ef.debug("["+new Date().getTime()+"] Grid cell["+row_index+","
+col_index+"] not found!");}};efgrid._cellKeydown=function(grid,row_index,col_index,event){if(grid.getStyleSetting(STYLE_CONSTANT["KEY_EVENT"])==="false")
return false;switch(event.keyCode){case 9:var direct=event.shiftKey?1:2;return efgrid._shiftCell(grid,row_index,col_index,direct);case 10:case 13:var direct=event.ctrlKey?(event.shiftKey?4:8):(event.shiftKey?1:2);return efgrid._shiftCell(grid,row_index,col_index,direct);case 38:if(grid.getColumn(col_index,grid.cellOriginNodeType)instanceof efComboColumn)
return false;return efgrid._shiftCell(grid,row_index,col_index,4);case 40:if(grid.getColumn(col_index,grid.cellOriginNodeType)instanceof efComboColumn)
return false;return efgrid._shiftCell(grid,row_index,col_index,8);default:return false;}};efgrid._shiftCellNode=function(grid,row_index,col_index,direct,col_type,next_dir){if(col_type==undefined)
col_type=grid.cellOriginNodeType;else
grid.cellOriginNodeType=col_type;var table_node=grid.getGridTableNode();var table_div=(col_type==TYPE_DATA)?efgrid.getDataDiv(table_node):efgrid.getFixDiv(table_node);var table=table_div.firstChild;while(true){if(direct<4){col_index+=(direct==1)?-1:1;if(col_index<0){if(col_type==TYPE_DATA){return efgrid._shiftCellNode(grid,row_index,grid.getColCount(TYPE_FIX),direct,TYPE_FIX);}else{return efgrid._shiftCellNode(grid,row_index,grid.getColCount(TYPE_DATA)
-1,4,TYPE_DATA,1);}}else if(col_index>grid.getColCount(col_type)-1){if(col_type==TYPE_FIX){return efgrid._shiftCellNode(grid,row_index,-1,direct,TYPE_DATA);}else{return efgrid._shiftCellNode(grid,row_index,0,8,TYPE_FIX,2);}}
var column=grid.getColumn(col_index,col_type);var isCheckCol=(!col_index&&(col_type==TYPE_FIX)&&(column.getDisplayType()=="checkbox"));if(column.isEnable()&&!isCheckCol&&(grid.isNewLine(row_index)||(col_type!=TYPE_FIX&&!column.isReadonly()))){return $(table).find("tr:[rawrowindex="+row_index+"]")[0].childNodes[col_index].firstChild;}}else{row_index+=(direct==4)?-1:1;if(row_index<0){if(col_index==0){col_type=!col_type+0;col_index=grid.getColCount(col_type);}
return efgrid._shiftCellNode(grid,grid.getRowCount(),col_index-1,direct,col_type);}else if(row_index>grid.getRowCount()-1){if(col_index==grid.getColCount(col_type)-1){col_type=!col_type+0;col_index=-1;}
return efgrid._shiftCellNode(grid,-1,col_index+1,direct,col_type);}
if(grid.isRowChecked(row_index)){var column=grid.getColumn(col_index,col_type);var isCheckCol=(!col_index&&(col_type==TYPE_FIX)&&(column.getDisplayType()=="checkbox"));if(column.isEnable()&&!isCheckCol&&(grid.isNewLine(row_index)||(col_type!=TYPE_FIX&&!column.isReadonly()))){return $(table).find("tr:[rawrowindex="+row_index+"]")[0].childNodes[col_index].firstChild;}else{return efgrid._shiftCellNode(grid,row_index,col_index,next_dir||direct,col_type);}}}}};efgrid._shiftCell=function(grid,row_index,col_index,direct){if(isAvailable(grid.cellOriginEditNode))
efgrid._saveOldCell(grid.cellOriginEditNode,grid);var div_node=efgrid._shiftCellNode(grid,row_index,col_index,direct);if(div_node!=null){efgrid._genEditNode(grid,div_node,grid.cellOriginNodeType);return true;}
return false;};efgrid.exportToModleXLS=function(grid_id){if(typeof efgrid_onExport_modleXls=="function"){try{efgrid_onExport_modleXls(grid_id);}catch(ex){efgrid.processException(ex,"Callback to efgrid_onBeforeCellEditNodeDisplay failed");}}};efgrid.exportToXLS=function(grid_id){var grid=efgrid.getGridObject(grid_id);grid.exportData("xls");};efgrid.exportToPDF=function(grid_id){var grid=efgrid.getGridObject(grid_id);grid.exportData("pdf");};efgrid.processException=function(ex,msg){var msg=(msg?msg:"Exception occurred")+": "+ex.message;ef.debug("["+new Date().getTime()+"] "+msg);alert(msg);};efgrid.addGridsSelectedData=function(grid_ids,info){if(!isAvailable(grid_ids)||!(grid_ids instanceof Array)){alert("Invalid grid id array");return;}
for(var i=0;i<grid_ids.length;i++){var grid=efform.getGrid(grid_ids[i]);var block=info.getBlock(grid.blockId);if(!isAvailable(block)){block=new EiBlock(grid.getBlockData().getBlockMeta());info.addBlock(block);}
block.setAttr(grid.getBlockData().getAttr());block.set("orderBy",grid.getOrderBy());efgrid._addSelectedData(block,grid);}};

efgrid.divCorner=function(){};efgrid.divCorner.paintHead=function(efGridIn,paintId,widthNow,columnCount,gridColumn,fixCol)
{var rowHeight=efGridIn.hasColumnGroups?(2*efGridIn.rowHeight+1):efGridIn.rowHeight;if($.browser.msie&&efGridIn.hasColumnGroups)
{rowHeight=2*efGridIn.rowHeight;}
var headTable=$("<table />").addClass('ef-grid-table').attr({'id':efGridIn.gridId+EF_SPLIT+paintId,'cellspacing':0,'cellpadding':0}).css({'table-layout':'fixed','height':rowHeight+'px'});var headTr=$("<tr />").addClass('ef-grid-tableHeader-tableTR');var first_tr=$("<tr />").height(0);if($.browser.msie)
{first_tr.css("height","1px");}
var second_tr=$("<tr / >").addClass('ef-grid-tableHeader-tableTR');var third_tr=$("<tr / >").addClass('ef-grid-tableHeader-tableTR');if(efGridIn.hasColumnGroups)
{var rawColumnGroups=[];if(!fixCol)
rawColumnGroups=efGridIn.dataColumnGroups;else
rawColumnGroups=efGridIn.fixColumnGroups;var groupColumns=[];for(var i=0;i<rawColumnGroups.length;i++)
{groupColumns[i]=rawColumnGroups[i].customSetting.columnIds.split(",");}
var cusor_1=0;for(var k=0;k<columnCount;k++)
{if(groupColumns.length>cusor_1&&groupColumns[cusor_1][0]==gridColumn[k].getEname()){var addCellWidth=0;var colSpan=groupColumns[cusor_1].length;for(var j=0;j<groupColumns[cusor_1].length;j++){var colGroupName=rawColumnGroups[cusor_1].customSetting.descName;first_tr.append($("<td / >").width(gridColumn[k].getWidth()).attr({'id':efGridIn.gridId+'HeadColAid_'+gridColumn[k].getEname()}));addCellWidth+=gridColumn[k].getWidth();third_tr.append($("<td / >").addClass("ef-grid-tableHeaderColumn").attr({"parent":colGroupName,"headSplit":0,"tdIndex":k,'id':efGridIn.gridId+'HeadCol_'+gridColumn[k].getEname()}).width(gridColumn[k].getWidth()).html(gridColumn[k].getHeaderHTML(efGridIn.readonly,efGridIn.enableColumnSetter)));if(j<groupColumns[cusor_1].length-1){k++;}}
second_tr.append($("<td / >").addClass("ef-grid-tableHeaderColumn").attr({'id':colGroupName,"headSplit":0,"colspan":colSpan,"tdIndex":-1}).width(addCellWidth).append($("<div / >")).attr("align","center").html(rawColumnGroups[cusor_1].customSetting.descName));cusor_1++;}
else
{if(efGridIn.isShowLineNumber()&&fixCol){var line=new EiColumn("_line_num");line.primaryKey=false;line.descName="";line.displayType="text";line.visible=true;line.readonly=false;var ef_c=efGridIn.buildColumn(line,line);ef_c.setWidth(20);first_tr.append($("<td / >").width(20).attr({'id':efGridIn.gridId+'HeadColAid_line_number'}));second_tr.append($("<td / >").addClass("ef-grid-tableHeaderColumn").attr({'id':efGridIn.gridId+'HeadCol_line_number',"headSplit":0,"rowspan":2,"tdIndex":-1}).width(20).html(ef_c.getHeaderHTML(efGridIn.readonly,efGridIn.enableColumnSetter)));}
first_tr.append($("<td / >").width(gridColumn[k].getWidth()).attr({'id':efGridIn.gridId+'HeadColAid_'+gridColumn[k].getEname()}));second_tr.append($("<td / >").addClass("ef-grid-tableHeaderColumn").attr({'id':efGridIn.gridId+'HeadCol_'+gridColumn[k].getEname(),"headSplit":0,"rowspan":2,"tdIndex":k}).width(gridColumn[k].getWidth()).html(gridColumn[k].getHeaderHTML(efGridIn.readonly,efGridIn.enableColumnSetter)));}}
if(!fixCol)
{first_tr.append($("<td / >").width(18).attr('width',18)).append($("<td / >").attr('rowspan',1).css('border','0px'));second_tr.append($("<td />").width(18).attr({'rowspan':2}).css("border-right","0px")).append($("<td / >").width('100%').attr({'rowspan':2}).css("border-left","0px"));}
headTable.append(first_tr).append(second_tr).append(third_tr);}
else
{if(efGridIn.isShowLineNumber()&&fixCol){var line=new EiColumn("_line_num");line.primaryKey=false;line.descName="";line.displayType="text";line.visible=true;line.readonly=false;var ef_c=efGridIn.buildColumn(line,line);ef_c.setWidth(20);first_tr.append($("<td / >").width(20).attr({'id':efGridIn.gridId+'HeadColAid_line_number'}));var headColumn=$("<td />").addClass("ef-grid-tableHeaderColumn").attr({'headSplit':'0','id':efGridIn.gridId+'HeadCol_line_number',"tdIndex":k}).css({'width':'20px','height':'26px'}).html(ef_c.getHeaderHTML(efGridIn.readonly,efGridIn.enableColumnSetter));headTr.append(headColumn);}
var first_tr=$("<tr />").css("height","0px");if($.browser.msie)
{first_tr.css("height","1px");}
for(var k=0;k<columnCount;k++)
{var colWidth=gridColumn[k].getWidth();first_tr.append($("<td / >").width(colWidth).attr({'id':efGridIn.gridId+'HeadColAid_'+gridColumn[k].getEname()}));var headColumn=$("<td />").addClass("ef-grid-tableHeaderColumn").attr({'headSplit':'0','id':efGridIn.gridId+'HeadCol_'+gridColumn[k].getEname(),"tdIndex":k}).css({'width':colWidth+'px','height':'26px'}).html(gridColumn[k].getHeaderHTML(efGridIn.readonly,efGridIn.enableColumnSetter));headTr.append(headColumn);}
if(!fixCol)
{first_tr.append($("<td />").width(18).css("border-right","0px")).append($("<td />").css({"border-left":"0px","width":"100%"}));headTr.append($("<td />").width(18).css("border-right","0px")).append($("<td />").css({"border-left":"0px","width":"100%"}));}
if(efGridIn.groupField!=""||efGridIn.rowDetailDivID!="")
{headTable.append(first_tr).append(headTr);}
else
{headTable.append(headTr);}}
return headTable;};efgrid.divCorner.buildCornerDiv=function(grid)
{var fixHeadTable=efgrid.divCorner.paintHead(grid,"corner_table",grid.leftWidth,grid.getColCount(TYPE_FIX),grid.getColumns(TYPE_FIX),true);var cornerDiv=$("<div />").css({'overflow':'hidden','width':grid.leftWidth+'px','height':grid.rowHeight+'px'}).attr({'id':grid.gridId+EF_SPLIT+'corner_div','onmouseout':'efgrid.divHead.onmouseout(event)','onmouseover':'efgrid.divHead.onmouseover(event)','onclick':'efgrid.divCorner.onclick(event)','onselectstart':'return false'});cornerDiv.append(fixHeadTable);if(grid.hasColumnGroups)
cornerDiv.height(2*grid.rowHeight);return cornerDiv;};efgrid.divCorner.onclick=function(event){var srcElement=event.srcElement||event.target;if(srcElement.tagName!="INPUT"){var grid_node=efgrid.getEfGridNode(srcElement);if(!grid_node)return;var grid=grid_node.efgrid;if(!grid)return;var node_now=srcElement;if(node_now.tagName=="IMG")
node_now=srcElement.parentNode;if(node_now.tagName=="DIV")
node_now=node_now.parentNode;var headSplit=node_now.getAttribute("headSplit");var not_sortable=(grid.getStyleSetting(STYLE_CONSTANT["SORTABLE"])==="false");if(headSplit=="0"&&!not_sortable){var cell_pos=node_now.cellIndex;var col=grid.getColumn(cell_pos,TYPE_FIX);efgrid.divHead.sort(grid_node,col);return;}}
var ef_grid_whole_table=efgrid.getEfGridNode(srcElement);var grid=ef_grid_whole_table.efgrid;var cont=true;if(typeof efgrid_onSelectAllClicked=="function"){try{var r=efgrid_onSelectAllClicked(grid.gridId,srcElement.parentNode);if(isAvailable(r))cont=r;}catch(ex){efgrid.processException(ex,"Callback to efgrid_onSelectAllClicked failed");}}
if(cont)
efgrid.divFix.setRowsStatus(ef_grid_whole_table,srcElement.checked);};

efgrid.divData=function(){};efgrid.divData.buildFixDataDiv=function(grid){var html=[];var col_count=grid.getColCount(TYPE_DATA);var data_table_node=$("<table />").addClass('ef-grid-table ef-grid-dataTable').css('table-layout','fixed').attr({'id':grid.gridId+EF_SPLIT+'data_table','hidefocus':'','cols':col_count+1});var fix_table_node=$("<table />").addClass('ef-grid-table ef-grid-fixTable').css('table-layout','fixed').attr({'id':grid.gridId+EF_SPLIT+'fix_table','hidefocus':''});var first_data_row=$("<tr />");var first_fix_row=$("<tr />");var inner_html=[];var data_div=$("<div />").css({'overflow':'visible','width':grid.rightWidth+'px','height':grid.bottomHeight+'px'}).attr({'id':grid.gridId+EF_SPLIT+'data_div','onscroll':'efgrid.divData.onscroll(event)','onclick':'efgrid.divData.onclick(event)','ondblclick':'efgrid.divData.ondblclick(event)','oncontextmenu':'efgrid.divData.oncontextmenu(event);return false;','onmouseover':'efgrid.divData.onmouseover(event)','onmouseout':'efgrid.divData.onmouseout(event)','onmousemove':'efgrid.divHead.onmousemove(event)'});var fix_div=$("<div />").css({'overflow':'hidden','width':grid.leftWidth+'px','height':grid.bottomHeight+'px'}).attr({'id':grid.gridId+EF_SPLIT+'fix_div','onclick':'efgrid.divFix.onclick(event)'}).attr({'ondblclick':'efgrid.divFix.ondblclick(event)','oncontextmenu':'efgrid.divFix.oncontextmenu(event);return false;','onmousedown':'efgrid.divData.onmousedown(event)'}).attr({'onmouseup':'efgrid.divData.onmouseup(event)','onmouseover':'efgrid.divData.onmouseover(event)','onmouseout':'efgrid.divData.onmouseout(event)'});if(grid.isAutoHeight())
{data_div.height('100%');fix_div.height('100%');}
var blockData=new EiBlock(grid.blockData.meta.blockId);var blockMeta=blockData.meta;grid.displayBlock=blockData;if(grid.showModel==""){fix_div.append(fix_table_node);data_div.append(data_table_node);var _rowCount=grid.getRowCount();var _colFixCount=grid.getColCount(TYPE_FIX);var _isEnable=grid.isEnable();var c_tr=$("<tr />").addClass(efform.getGridCurrentRowStyle());var fix_tr;var data_tr;for(var i=0;i<_rowCount;i++){var checked_line=((!grid.readonly)&&((grid.rowStatus[i]&2)!=0));var n_tr=$("<tr />").addClass('tableRow'+(i&1)).attr('rawrowindex',i);var _tr=$("<tr />").addClass('ef-grid-tableRow-Highlight').attr('rawrowindex',i);if(checked_line){data_tr=_tr;fix_tr=_tr.clone();}
else if(i==grid.getCurrentRowIndex()){data_tr=c_tr.attr('rawrowindex',i);fix_tr=c_tr.clone();}
else{data_tr=n_tr;fix_tr=n_tr.clone();}
var data_tr_html="";var fix_tr_html="";var displayIndex=0;if(grid.isShowLineNumber()){var line=new EiColumn("_line_num");line.primaryKey=false;line.descName="";line.displayType="text";line.visible=true;line.readonly=false;var ef_c=grid.buildColumn(line,line);ef_c.setWidth(20);var tdId=grid.gridId+"line_number";var col_str="<td id='"+tdId+"' style='width:20px;height:24px'>"+(i+1)+"</td>";fix_tr_html+=col_str;if(i==0)
{first_fix_row.append($("<td  />").width(20).css('padding','0px').append($("<div />").width('100%')));}}
for(var j=0;j<_colFixCount;j++){var column=grid.fixedColumns[j];var tdId=grid.gridId+"FixTd"+column.getEname();var col_str="<td id='"+tdId+"' style='width:"+column.getWidth()+"px;height:24px'>";var fixValue=column.genCellNode(grid.getTFCellValue(i,j),grid.gridId,i,j,_isEnable,checked_line);col_str+=fixValue+"</td>";fix_tr_html+=col_str;if(i==0)
{first_fix_row.append($("<td  />").width(column.getWidth()).css('padding','0px').append($("<div />").width('100%')));}
var pos=column.customSetting.pos;if(typeof(grid.autoDraw)!=undefined&&(grid.autoDraw=="true"||grid.autoDraw=="yes"))
{pos=column.pos;}
if(pos>=0)
{var name=column.customSetting.name;if(name===undefined)
{name=column.getEname()+"";}
var tempEiColumn=new EiColumn(name+displayIndex);tempEiColumn.descName=column.getCname();tempEiColumn.descName=tempEiColumn.descName.replace(/<.*>/g,"");tempEiColumn.pos=displayIndex;blockMeta.addMeta(tempEiColumn);if(name.match(/^is/i)&&grid.getTDCellValue(i,j)=="")
{blockData.setCell(i,name+displayIndex,"false");}
else
{blockData.setCell(i,name+displayIndex,column.getFormattedDisplay(grid.getTFCellValue(i,j)));}
displayIndex++;}}
fix_tr.html(fix_tr_html);for(var j=0;j<col_count;j++){var column=grid.dataColumns[j];var tdId=grid.gridId+"DataTd"+column.getEname();var col_str="<td nowrap='' id='"+tdId+"' style='width:"+column.getWidth()+"px;height:24px' >";var dataValue=column.genCellNode(grid.getTDCellValue(i,j),grid.gridId,i,j,_isEnable);col_str+=dataValue+"</td>";data_tr_html+=col_str;if(i==0)
{first_data_row.append($("<td  />").attr({'id':tdId}).width(column.getWidth()).css('padding','0px').append($("<div />").width('100%')));}
var name=column.customSetting.name;if(name===undefined)
{name=column.getEname()+"";}
var tempEiColumn=new EiColumn(name+displayIndex);tempEiColumn.descName=column.getCname();tempEiColumn.descName=tempEiColumn.descName.replace(/<.*>/g,"");tempEiColumn.pos=displayIndex;blockMeta.addMeta(tempEiColumn);if(name.match(/^is/i)&&grid.getTDCellValue(i,j)=="")
{blockData.setCell(i,name+displayIndex,"false");}
else
{blockData.setCell(i,name+displayIndex,column.getFormattedDisplay(grid.getTDCellValue(i,j)));}
displayIndex++;}
data_tr_html+="<td  style='width:100%'><div style='height:24px'></div></td>";data_tr.html(data_tr_html);if(i==0)
first_data_row.append($("<td  />").width('100%').removeClass('ef-grid-dataTable').append($("<div />").width('100%')));if(grid.hasColumnGroups&&i==0)
{fix_table_node.append(first_fix_row);data_table_node.append(first_data_row);}
fix_table_node.append(fix_tr);data_table_node.append(data_tr);}
if(grid.needSum()){if(grid.getRenderSumType()=="all"){grid.sumDivRowCount=2;}else{grid.sumDivRowCount=1;}
var _rowCount=grid.sumDivRowCount;var _colFixCount=grid.getColCount(TYPE_FIX);var _isEnable=grid.isEnable();for(var i=0;i<_rowCount;i++){var data_tr=$("<tr />").addClass('tableRow'+i);var fix_tr=$("<tr />").addClass('tableRow'+i);if(i==0)
{data_tr.attr('id',grid.gridId+'sumDataTrForFloat');}
data_table_node.append(data_tr);fix_table_node.append(fix_tr);for(var j=0;j<col_count;j++){var column=grid.dataColumns[j];var renderType=efgrid.divSum.getColRenderType(grid,TYPE_DATA,j);var tdId=grid.gridId+"DataTd"+column.getEname();var col_str=$("<td />").attr({'id':tdId}).html(efgrid.divSum.genDisplayColumn(grid,i,j,TYPE_DATA,renderType));if(i==0)
{col_str.width(column.getWidth());}
data_tr.append(col_str);}
data_tr.append($("<td />").width(18).css('border-right','0px')).append($("<td />").css('border-left','0px').width('100%').append($("<div />").html('&nbsp;')));for(var j=0;j<_colFixCount;j++){var column=grid.fixedColumns[j];var renderType=efgrid.divSum.getColRenderType(grid,TYPE_FIX,j);var col_str=$("<td />").html(efgrid.divSum.genDisplayColumn(grid,i,j,TYPE_FIX,renderType));if(i==0)
{col_str.width(column.getWidth());}
fix_tr.append(col_str);}}}
html[0]=fix_div;html[1]=data_div;}
else if(grid.showModel=="quickshow")
{html[0]=fix_div.html(grid.getFixHtml());html[1]=data_div.html(grid.getDataHtml());}
return html;};efgrid.divData.buildGroupDetailDataDiv=function(grid){var html=[];var groupRows=new Array();var col_count=grid.getColCount(TYPE_DATA);var _rowCount=grid.getRowCount();var _colFixCount=grid.getColCount(TYPE_FIX);var _isEnable=grid.isEnable();var _doubleClickString={};if(grid.rowDetailDivID!="")
_doubleClickString={'ondblclick':'efgrid.onRowDoubleClicked(event)'};var first_data_row=$("<tr />");var first_fix_row=$("<tr />");for(var i=0;i<_rowCount;i++){var data_tr;var fix_tr;var _tr=$("<tr />").addClass('ef-grid-tableRow-Highlight').attr('rawRowIndex',i).attr(_doubleClickString);var c_tr=$("<tr />").addClass(efform.getGridCurrentRowStyle()).attr('rawRowIndex',i).attr(_doubleClickString);var cellValue=grid.getCellMappingValueByColumnName(i,grid.groupField);if(groupRows[cellValue+"_fix"]==undefined)
{groupRows[groupRows.length]=cellValue;groupRows[cellValue+"_fix"]=new Array();groupRows[cellValue+"_data"]=new Array();}
var checked_line=((!grid.readonly)&&((grid.rowStatus[i]&2)!=0));var n_tr=$("<tr />").addClass('tableRow'+(i&1)).attr('rawRowIndex',i).attr(_doubleClickString);if(checked_line){data_tr=_tr;fix_tr=_tr.clone();}
else if(i==grid.getCurrentRowIndex()){data_tr=c_tr;fix_tr=c_tr.clone();}
else{data_tr=n_tr;fix_tr=n_tr.clone();}
var fix_tr_html="";var data_tr_html="";for(var j=0;j<_colFixCount;j++){var column=grid.fixedColumns[j];var tdId=grid.gridId+"FixTd"+column.getEname();var col_str="<td nowrap='' id='"+tdId+"' style='width:"+column.getWidth()+"px' >";var fixValue=column.genCellNode(grid.getTFCellValue(i,j),grid.gridId,i,j,_isEnable,checked_line);col_str+=dataValue+"</td>";fix_tr_html+=col_str;if(i==0)first_fix_row.append($("<td />").width(column.getWidth()).css('padding','0px').append($("<div />").width('100%')));}
fix_tr.html(fix_tr_html);for(var j=0;j<col_count;j++){var column=grid.dataColumns[j];var tdId=grid.gridId+"DataTd"+column.getEname();var col_str="<td nowrap='' id='"+tdId+"' style='width:"+column.getWidth()+"px' >";var dataValue=column.genCellNode(grid.getTDCellValue(i,j),grid.gridId,i,j,_isEnable);col_str+=dataValue+"</td>";data_tr_html+=col_str;if(i==0)
{first_data_row.append($("<td />").attr({'id':tdId}).width(column.getWidth()).css('padding','0px').append($("<div />").width('100%')));}}
data_tr_html+="<td  style='width:100%'><div /></td>";data_tr.html(data_tr_html);if(i==0)
first_data_row.append($("<td />").width('100%').append($("<div />").width('100%')));if(grid.rowDetailDivID!="")
{fix_tr.append($("<tr />").addClass('rowDetail').css('display','none').append($("<td />").attr('colspan',_colFixCount)));data_tr.append($("<tr />").addClass('rowDetail').css('display','none').append($("<td />").attr('colspan',col_count)));}
groupRows[cellValue+"_fix"][groupRows[cellValue+"_fix"].length]=fix_tr;groupRows[cellValue+"_data"][groupRows[cellValue+"_data"].length]=data_tr;}
var div_data_inner_html=$("<div/>").css({'overflow':'visiable','width':(grid.rightWidth+grid.leftWidth)+'px','height':grid.bottomHeight+'px','overflowX':'visible','overflowY':'visible'}).attr({'id':grid.gridId+EF_SPLIT+'data_div','onscroll':'efgrid.divData.onscroll(event)','onclick':'efgrid.divData.onclick(event)','ondblclick':'efgrid.divData.ondblclick(event)','oncontextmenu':'efgrid.divData.oncontextmenu(event)'});var table_data=$("<table />").addClass('ef-grid-table ef-grid-dataTable').attr({'id':grid.gridId+EF_SPLIT+'data_table','hidefocus':'','cols':col_count+1}).css('table-layout','fixed');div_data_inner_html.append(table_data);var div_fix_inner_html=$("<div/>").css({'overflow':'visiable','width':grid.leftWidth+'px','height':grid.bottomHeight+'px','overflowX':'visible','overflowY':'visible'}).attr({'id':grid.gridId+EF_SPLIT+'fix_div','onclick':'efgrid.divFix.onclick(event)','ondblclick':'efgrid.divFix.ondblclick(event)','oncontextmenu':'efgrid.divFix.oncontextmenu(event)','onmousedown':'efgrid.divData.onmousedown(event)','onmouseup':'efgrid.divData.onmouseup(event)'});var table_fix=$("<table />").addClass('ef-grid-table ef-grid-fixTable').attr({'id':grid.gridId+EF_SPLIT+'fix_table','hidefocus':''}).css('table-layout','auto');div_fix_inner_html.append(table_fix);table_fix.append(first_fix_row);table_data.append(first_data_row);if(grid.isAutoHeight())
{div_data_inner_html.height('100%');div_fix_inner_html.height('100%');}
var lastCss=0;for(var i=0;i<groupRows.length;i++)
{if(grid.groupField!="")
{var fix_tr=$("<tr />").addClass('rowGroupHeader').append($("<td />").attr('colspan',_colFixCount+1).append("<div />").css({'font-weight':'bold','border-style':'solid','border-width':'0px 0px 2px 0px','border-color':'#99bbe8'}).attr('onclick','efgrid.divData.onRowGroupHeaderClicked(event)').html("-"+groupRows[i]));table_fix.append(fix_tr);var data_tr=$("<tr />").addClass('rowGroupHeader').append($("<td />").attr('colspan',col_count+1).append("<div />").css({'font-weight':'bold','border-style':'solid','border-width':'0px 0px 2px 0px','border-color':'#99bbe8'}).attr('onclick','efgrid.divData.onRowGroupHeaderClicked(event)').html(groupRows[i]).prepend($("<img />").css({'float':'left','margin':'0px 5px 0px 1px'}).attr({'src':'./EF/Images/group-collapse.gif'})));table_data.append(data_tr);}
var sum_data_tr=$("<tr />").addClass('tableRow0');for(var j=0;j<groupRows[groupRows[i]+"_fix"].length;j++)
{var trClass='tableRow'+lastCss%2;lastCss^=1;table_fix.append(groupRows[groupRows[i]+"_fix"][j]);var tempFixTr=groupRows[groupRows[i]+"_fix"][j];if(tempFixTr.children('.rowDetail').length>0)
{var tr=tempFixTr.children('.rowDetail').detach();if(tempFixTr.hasClass('tableRow0'))
{tempFixTr.removeClass('tableRow0').addClass(trClass);}
else if(tempFixTr.hasClass('tableRow1'))
{tempFixTr.removeClass('tableRow1').addClass(trClass);}
var rowIndex=parseInt(tempFixTr.attr('rawrowindex'));grid._rowStyle[rowIndex]=trClass;table_fix.append(tr);}
table_data.append(groupRows[groupRows[i]+"_data"][j]);var tempDataTr=groupRows[groupRows[i]+"_data"][j];if(tempDataTr.children('.rowDetail').length>0)
{var tr=tempDataTr.children('.rowDetail').detach();if(tempDataTr.hasClass('tableRow0'))
{tempDataTr.removeClass('tableRow0').addClass(trClass);}
else if(tempDataTr.hasClass('tableRow1'))
{tempDataTr.removeClass('tableRow1').addClass(trClass);}
var rowIndex=parseInt(tempDataTr.attr('rawrowindex'));grid._rowStyle[rowIndex]=trClass;table_data.append(tr);}}}
if(grid.needSum()){if(grid.getRenderSumType()=="all"){grid.sumDivRowCount=2;}else{grid.sumDivRowCount=1;}
var _rowCount=grid.sumDivRowCount;var _colFixCount=grid.getColCount(TYPE_FIX);var _isEnable=grid.isEnable();for(var index=0;index<_rowCount;++index){var data_tr=$("<tr />").addClass('tableRow'+index);var fix_tr=$("<tr />").addClass('tableRow'+index);if(index==0)
{data_tr.attr('id',grid.gridId+'sumDataTrForFloat');}
table_data.append(data_tr);table_fix.append(fix_tr);for(var j=0;j<col_count;++j){var column=grid.dataColumns[j];var renderType=efgrid.divSum.getColRenderType(grid,TYPE_DATA,j);var tdId=grid.gridId+"DataTd"+column.getEname();var col_str=$("<td />").attr({'id':tdId}).html(efgrid.divSum.genDisplayColumn(grid,index,j,TYPE_DATA,renderType));data_tr.append(col_str);}
data_tr.append($("<td />").width(18).css('border-right','0px')).append($("<td />").css('border-left','0px').width('100%').append($("<div />").html('&nbsp;')));for(var j=0;j<_colFixCount;j++){var column=grid.fixedColumns[j];var renderType=efgrid.divSum.getColRenderType(grid,TYPE_FIX,j);var tdId=grid.gridId+"DataTd"+column.getEname();var col_str=$("<td />").attr({'id':tdId}).html(efgrid.divSum.genDisplayColumn(grid,index,j,TYPE_FIX,renderType));fix_tr.append(col_str);}
table_data.append(data_tr);}}
html[0]=div_fix_inner_html;html[1]=div_data_inner_html;return html;};efgrid.onRowDoubleClicked=function(event){var srcElement=event.srcElement||event.target;var id_in=srcElement.id;var grid_node=efgrid.getEfGridNode(srcElement);if(!grid_node)return;var grid=grid_node.efgrid;if(!grid)return;var currentRow=null;if(srcElement.tagName=="DIV")
currentRow=srcElement.parentNode.parentNode;else if(srcElement.tagName=="TR")
currentRow=srcElement;else
return;if(currentRow.mark==undefined)currentRow.mark=0;if(currentRow.nextSibling.style.display=="none")
{$(currentRow.nextSibling).show("fast");currentRow.nextSibling.mark=1;}
else
{$(currentRow.nextSibling).hide("fast");currentRow.nextSibling.mark=0;}
var tempBlock=grid.eiinfo.blocks[grid.blockId];var eiinfo=new EiInfo();var block=new EiBlock(grid.blockId);block.setBlockMeta(tempBlock.getBlockMeta());var allRows=currentRow.parentNode.rows;block.addRow(tempBlock.rows[currentRow.rawRowIndex]);eiinfo.addBlock(block);efform.fillDiv(grid.rowDetailDivID,eiinfo);if(grid._rowDetailDiv!=null&&currentRow.nextSibling.children[0].innerHTML=="")
{currentRow.nextSibling.children[0].innerHTML=grid._rowDetailDiv.innerHTML;}};efgrid.divData.onRowGroupHeaderClicked=function(event){var div_node=event.srcElement||event.target;var head_handle=$(div_node).closest("tr");if(head_handle.length==0)return;if(!head_handle.attr("mark"))head_handle.attr("mark",1);var handle_tr=head_handle[0];if(head_handle.attr("mark")==1)
{jQuery.data(handle_tr,"TR",new Array());var nextNode=head_handle.next();while(nextNode.length>0&&!nextNode.hasClass('rowGroupHeader'))
{var currentNode=nextNode;nextNode=nextNode.next();jQuery.data(handle_tr,"TR").push(currentNode.detach());}
head_handle.children().children().attr("src","./EF/Images/group-expand.gif");head_handle.attr("mark",0);}else
{var nextNode=head_handle.next();for(var index=jQuery.data(handle_tr,"TR").length;index>0;index--)
jQuery.data(handle_tr,"TR")[index-1].insertAfter(head_handle);head_handle.children().children().attr("src","./EF/Images/group-collapse.gif");head_handle.attr("mark",1);}};efgrid.divData.onclick=function(event,dbclick){return efgrid.cellClick(0,event,dbclick);};efgrid.divData.ondblclick=function(event){return efgrid.divData.onclick(event,true);};efgrid.divData.onscroll=function(event){var target=event.srcElement||event.target;var ef_grid_whole_table=efgrid.getEfGridNode(target);var fixDiv=efgrid.getFixDiv(ef_grid_whole_table);var headDiv=efgrid.getHeadDiv(ef_grid_whole_table);var dataDiv=efgrid.getDataDiv(ef_grid_whole_table);headDiv.scrollLeft=dataDiv.scrollLeft;fixDiv.scrollTop=dataDiv.scrollTop;var grid=ef_grid_whole_table.efgrid;if($('#'+grid.gridId+'__sum_data_div').length>0)
{$('#'+grid.gridId+'__sum_data_div')[0].scrollLeft=dataDiv.scrollLeft;}};efgrid.divData.setRowStyle=function(ef_grid_whole_table,row_index,style_classname){var fixDiv=efgrid.getFixDiv(ef_grid_whole_table);var fixTable=fixDiv.firstChild;var dataDiv=efgrid.getDataDiv(ef_grid_whole_table);var dataTable=dataDiv.firstChild;var grid=ef_grid_whole_table.efgrid;if(row_index<0||row_index>=grid.getRowCount())return;if(grid.hasColumnGroups||grid.groupField!="")
{$(fixTable).find('tr[rawrowindex='+row_index+']').attr('class','').addClass(style_classname).addClass(grid._rowStyle[row_index]);$(dataTable).find('tr[rawrowindex='+row_index+']').attr('class','').addClass(style_classname).addClass(grid._rowStyle[row_index]);}
else
{$(fixTable.rows[row_index]).attr('class','').addClass(style_classname).addClass(grid._rowStyle[row_index]);$(dataTable.rows[row_index]).attr('class','').addClass(style_classname).addClass(grid._rowStyle[row_index]);}};efgrid.divData.onmouseover=function(event){var event_node=event.srcElement||event.target;var target=efgrid.findEventCell(event_node);if(target){var ef_grid_whole_table=efgrid.getEfGridNode(target);if(ef_grid_whole_table){var grid=ef_grid_whole_table.efgrid;var pos=efgrid.getCellPos(target);var row_index=pos.row;if(!grid.isRowChecked(row_index)&&row_index!=grid.getCurrentRowIndex())
efgrid.divData.setRowStyle(ef_grid_whole_table,row_index,'ef-grid-tableRow-Selected');}}};efgrid.divData.onmouseout=function(event){var target=efgrid.findEventCell(event.srcElement||event.target);if(target){var ef_grid_whole_table=efgrid.getEfGridNode(target);if(ef_grid_whole_table){var grid=ef_grid_whole_table.efgrid;var pos=efgrid.getCellPos(target);var row_index=pos.row;if(grid.isRowChecked(row_index))
efgrid.divData.setRowStyle(ef_grid_whole_table,row_index,'ef-grid-tableRow-Highlight');else if(row_index==grid.getCurrentRowIndex())
efgrid.divData.setRowStyle(ef_grid_whole_table,row_index,efform.getGridCurrentRowStyle());else
efgrid.divData.setRowStyle(ef_grid_whole_table,row_index,grid._rowStyle[row_index]);}}};efgrid.divData.newRows=null;efgrid.divData.onmousedown=function(event){var target=efgrid.findEventCell(event.srcElement||event.target);if(target){var ef_grid_whole_table=efgrid.getEfGridNode(target);if(ef_grid_whole_table){var grid=ef_grid_whole_table.efgrid;var pos=efgrid.getCellPos(target);var row_index=pos.row;if(grid.isRowChecked(row_index)){efgrid.divData.newRows=row_index;}else{efgrid.divData.newRows=null;}}}};efgrid.divData.oncontextmenu=function(event){efgrid.rightmenu.show(event,TYPE_DATA);return false;};efgrid.divData.onHeaderRightClick=function(event){efgrid.headerRightMenu.show(event,TYPE_FIX);};efgrid.divData.onmouseup=function(event){var target=efgrid.findEventCell(event.srcElement||event.target);if(target){var ef_grid_whole_table=efgrid.getEfGridNode(target);if(ef_grid_whole_table){var grid=ef_grid_whole_table.efgrid;var pos=efgrid.getCellPos(target);var row_index=pos.row;if(!grid.isRowChecked(row_index)&&efgrid.divData.newRows!=null){from_index=efgrid.divData.newRows;efgrid.divData.newRows=new Array();efgrid.divData.newRowStatus=new Array();count=grid.getRowCount();if(from_index<row_index)
row_index+=1;for(i=0;i<row_index;i++){if(!grid.isRowChecked(i)){efgrid.divData.newRows.push(grid.getRowData(i));efgrid.divData.newRowStatus.push(grid.rowStatus[i]);}}
startCheckedCount=efgrid.divData.newRows.length;efgrid.divData.newRows=efgrid.divData.newRows.concat(grid.getSelectRowsData());endCheckedCount=efgrid.divData.newRows.length;for(i=0;i<count;i++){if(grid.isRowChecked(i))
efgrid.divData.newRowStatus.push(grid.rowStatus[i]);}
for(i=row_index;i<count;i++){if(!grid.isRowChecked(i)){efgrid.divData.newRows.push(grid.getRowData(i));efgrid.divData.newRowStatus.push(grid.rowStatus[i]);}}
for(i=count-1;i>=0;i--)
grid.removeRow(i);grid.addRowData(efgrid.divData.newRows);grid.rowStatus=efgrid.divData.newRowStatus;for(i=startCheckedCount;i<=endCheckedCount-1;i++)
grid.setRowChecked(i,true);grid.refresh();efgrid.divData.newRows=null;efgrid.divData.newRowStatus=null;}}}};efgrid.divData.refreshRowStyle=function(ef_grid_whole_table,row_index)
{var fixDiv=efgrid.getFixDiv(ef_grid_whole_table);var fix_div_table=fixDiv.firstChild;var dataDiv=efgrid.getDataDiv(ef_grid_whole_table);var dataTable=dataDiv.firstChild;var grid=ef_grid_whole_table.efgrid;if(grid.isRowChecked(row_index))
efgrid.divData.setRowStyle(ef_grid_whole_table,row_index,'ef-grid-tableRow-Highlight');else if(row_index==grid.getCurrentRowIndex())
efgrid.divData.setRowStyle(ef_grid_whole_table,row_index,efform.getGridCurrentRowStyle());else
efgrid.divData.setRowStyle(ef_grid_whole_table,row_index,grid._rowStyle[row_index]);};efgrid.divData.changeChoiceStatus=function(ef_grid_whole_table,row_index,in_row_status){var dataDiv=efgrid.getDataDiv(ef_grid_whole_table);var dataTable=dataDiv.firstChild;var grid=ef_grid_whole_table.efgrid;if(row_index>=dataTable.rows.length)return;if(in_row_status)
grid.rowStatus[row_index]|=2;else
grid.rowStatus[row_index]&=253;efgrid.divData.refreshRowStyle(ef_grid_whole_table,row_index);};efgrid.divData.buildSumDataDiv=function(grid){var gridId=grid.gridId;var dataDivId='#'+grid.gridId+EF_SPLIT+'data_div';var l=grid.leftWidth;var r=$(dataDivId)[0].clientWidth;var w=l+r+'px';if(grid.getRenderSumType()=="all"){grid.sumDivRowCount=2;}else{grid.sumDivRowCount=1;}
var _rowCount=grid.sumDivRowCount;var h=_rowCount*25+'px';var a=$('#'+gridId+'sumDataTrForFloat').offset().top;var b=$(dataDivId)[0].scrollHeight;var c=$(dataDivId)[0].clientHeight;var d=$(dataDivId).scrollTop();var top=a-b+c+d;var floatSumDiv=$('<div />').attr('id',gridId+'sumDataDivForFloat').addClass('ef-grid-border ef-grid-content').css({'min-height':h,'width':w,'height':h,'overflow':'hidden','position':'absolute','top':top+'px','z-index':100});var grid_table=$("<table />").attr({'id':gridId+EF_SPLIT+'sum_grid_table','border':0,'cellspacing':0,'cellpadding':0,'cols':2}).css({'width':w}).append($("<colgroup />").append($("<col/>").width(l)).append($("<col/>").width(r)));floatSumDiv.append(grid_table);var html=[];var col_count=grid.getColCount(TYPE_DATA);var data_table_node=$("<table />").addClass('ef-grid-table ef-grid-dataTable').css('table-layout','fixed').attr({'id':gridId+EF_SPLIT+'sum_data_table','hidefocus':'','cols':col_count+1});var fix_table_node=$("<table />").addClass('ef-grid-table ef-grid-fixTable').css('table-layout','fixed').attr({'id':gridId+EF_SPLIT+'sum_fix_table','hidefocus':''});var first_data_row=$("<tr />");var first_fix_row=$("<tr />");var inner_html=[];var data_div=$("<div />").css({'overflow':'hidden','width':r+'px','height':h+'px'}).attr({'id':gridId+EF_SPLIT+'sum_data_div'});var fix_div=$("<div />").css({'overflow':'hidden','width':l+'px','height':h+'px'}).attr({'id':gridId+EF_SPLIT+'sum_fix_div'});fix_div.append(fix_table_node);data_div.append(data_table_node);var _colFixCount=grid.getColCount(TYPE_FIX);var _isEnable=grid.isEnable();for(var j=0;j<_colFixCount;j++){var column=grid.fixedColumns[j];first_fix_row.append($("<td  />").width(column.getWidth()).css('padding','0px'));}
for(var j=0;j<col_count;j++){var column=grid.dataColumns[j];var tdId=grid.gridId+"SumDataTd"+column.getEname();first_data_row.append($("<td  />").attr({'id':tdId}).width(column.getWidth()).css('padding','0px').append($("<div />").width('100%')));}
first_data_row.append($("<td  />").width('100%').removeClass('ef-grid-dataTable').append($("<div />").width('100%')));if(grid.hasColumnGroups||grid.groupField!="")
{fix_table_node.append(first_fix_row);data_table_node.append(first_data_row);}
var _colFixCount=grid.getColCount(TYPE_FIX);var _isEnable=grid.isEnable();for(var i=0;i<_rowCount;i++){var data_tr=$("<tr />").addClass('tableRow'+i);var fix_tr=$("<tr />").addClass('tableRow'+i);data_table_node.append(data_tr);fix_table_node.append(fix_tr);for(var j=0;j<col_count;j++){var column=grid.dataColumns[j];var renderType=efgrid.divSum.getColRenderType(grid,TYPE_DATA,j);var tdId=grid.gridId+"SumDataTd"+column.getEname();var col_str=$("<td />").attr({'id':tdId}).html(efgrid.divSum.genDisplayColumn(grid,i,j,TYPE_DATA,renderType));if(i==0)
{col_str.width(column.getWidth());}
data_tr.append(col_str);}
data_tr.append($("<td />").width(18).css('border-right','0px')).append($("<td />").css('border-left','0px').width('100%').append($("<div />").html('&nbsp;')));for(var j=0;j<_colFixCount;j++){var column=grid.fixedColumns[j];var renderType=efgrid.divSum.getColRenderType(grid,TYPE_FIX,j);var col_str=$("<td />").html(efgrid.divSum.genDisplayColumn(grid,i,j,TYPE_FIX,renderType));if(i==0)
{col_str.width(column.getWidth());}
fix_tr.append(col_str);}}
html[0]=fix_div;html[1]=data_div;grid_table.append($("<tr />").attr('efGridTopTable',1).height(h).append($("<td />").attr('efGridTopTable',1).append(html[0])).append($("<td />").attr('efGridTopTable',1).append(html[1])));return floatSumDiv;};

efgrid.divFix=function()
{};efgrid.divFix.calcFixWidth=function(grid)
{var sum=0;for(var i=0;i<grid.getColCount(TYPE_FIX);i++)
sum+=parseInt(grid.getColumn(i,TYPE_FIX).getWidth());if(sum<=3)
{return $.browser.msie?1:0;}
return sum+grid.getColCount(TYPE_FIX)*(2);};efgrid.divFix.calcDataWidth=function(grid)
{var sum=0;for(var i=0;i<grid.getColCount(TYPE_DATA);i++)
sum+=parseInt(grid.getColumn(i,TYPE_DATA).getWidth());return sum;};efgrid.divFix.onclick=function(event,dbclick){var srcElement=event.srcElement||event.target;if(srcElement.tagName=="INPUT"&&srcElement.getAttribute("type")=="checkbox"){var ef_grid_whole_table=efgrid.getEfGridNode(srcElement);var fixDiv=efgrid.getFixDiv(ef_grid_whole_table);var grid=ef_grid_whole_table.efgrid;var pos=efgrid.getCellPos(srcElement);var rowIndex=pos.row;if(typeof efgrid_onRowCheckboxClicked=="function"){try{efgrid_onRowCheckboxClicked(grid.gridId,rowIndex,srcElement.parentNode);}catch(ex){efgrid.processException(ex,"Callback to efgrid_onRowCheckboxClicked failed");}}
efgrid.divData.changeChoiceStatus(ef_grid_whole_table,rowIndex,srcElement.checked);if(typeof efgrid_afterRowCheckboxClicked=="function"){try{efgrid_afterRowCheckboxClicked(grid.gridId,rowIndex,srcElement.parentNode);}catch(ex){efgrid.processException(ex,"Callback to efgrid_afterRowCheckboxClicked failed");}}}else{efgrid.cellClick(1,event,dbclick);}};efgrid.divFix.ondblclick=function(event){efgrid.divFix.onclick(event,true);};efgrid.divFix.oncontextmenu=function(event){efgrid.rightmenu.show(event,TYPE_FIX);};efgrid.divFix.isRowChecked=function(ef_grid_whole_table,in_row_id){var grid=ef_grid_whole_table.efgrid;return grid.isRowChecked(in_row_id);};efgrid.divFix.setRowsStatus=function(ef_grid_whole_table,row_status)
{var fixDiv=efgrid.getFixDiv(ef_grid_whole_table);var grid=ef_grid_whole_table.efgrid;var fix_div_table=fixDiv.firstChild;var length=$(fix_div_table).find('tr[rawrowindex]').length;for(var i=0;i<length;i++){var cell_node=$(fix_div_table).find('tr[rawrowindex='+i+']')[0].cells[0].firstChild.firstChild;if(cell_node.tagName!="INPUT")return false;cell_node.checked=row_status;if(row_status)
grid.rowStatus[i]|=2;else
grid.rowStatus[i]&=253;efgrid.divData.changeChoiceStatus(ef_grid_whole_table,i,cell_node.checked);}};

efgrid.divFunc=function(){};efgrid.divFunc.buildFuncDiv=function(grid){var table_html=[];table_html.push("<table "+" id='"+grid.gridId+EF_SPLIT
+"func_table' ");table_html.push("class='ef-grid-functable' cellspacing=1 >");table_html.push("<tr>");table_html.push("<td></td>");var isFuncNull=false;if(!grid.isLazyLoad()){var OperationBar=efgrid.divFunc._buildOperationBar(grid);var RemoveBar=efgrid.divFunc._buildRemoveBar(grid);var ToolBar=efgrid.divFunc._buildToolBar(grid);var ModelXlsBar=efgrid.divFunc._buildModelXlsBar(grid);var PersonalBar=efgrid.divFunc._buildPersonalBar(grid);var NavigationBar=efgrid.divFunc._buildNavigationBar(grid);table_html.push(OperationBar);table_html.push(RemoveBar);table_html.push(ToolBar);table_html.push(ModelXlsBar);table_html.push(PersonalBar);table_html.push(NavigationBar);if(NavigationBar===""&&OperationBar===""&&ToolBar===""&&ModelXlsBar===""&&PersonalBar===""&&grid.buttonBarId==="")
isFuncNull=true;}
else{var PersonalBar=efgrid.divFunc._buildPersonalBar(grid);table_html.push(PersonalBar);if(PersonalBar===""&&grid.buttonBarId==="")
isFuncNull=true;}
table_html.push("</tr></table>");var buttonbarHtml="<div style='float:right; ' align='right' id='ef_grid_"
+grid.buttonBarId+EF_SPLIT+"buttonbar"+"'></div>";var funcDivHtml="<div "+"id='"+grid.gridId+EF_SPLIT
+"func_bar_div' class='ef-grid-func'><div "+"id='"+grid.gridId
+EF_SPLIT+"func_div'  class='ef-grid-funcdiv'>"
+table_html.join('')+"</div>"+buttonbarHtml+"</div>";ef.debug("["+new Date().getTime().toString()+"]build row 0 finish.");if(isFuncNull==true){return"";}
return funcDivHtml;};efgrid.divFunc._buildPersonalBar=function(grid){var show=true;if(show&&grid.getStyleSetting(STYLE_CONSTANT["PERSONAL_BAR"])==="true")
return"<td class='ef-grid-funcImgButtonTD ef-state-default ef-cornerredius-all'><div title='配置信息' class='ef-icon ef-icon-customColumn' onmouseover=\"this.style.cursor='pointer';\" onclick=efgrid.subcgrid.show(this,\""
+grid.gridId+"\")></td>";else
return"";};efgrid.divFunc.isBuildOperationBar=function(grid){var showOprationBar=grid.isEnable()&&!grid.isReadonly();if(grid.getStyleSetting(STYLE_CONSTANT["OPERTATION_BAR"])==="false")
showOprationBar=false;return showOprationBar;};efgrid.divFunc.isBuildRemoveBar=function(grid){var showRemoveBar=grid.isEnable()&&!grid.isReadonly();showRemoveBar&=grid.getStyleSetting(STYLE_CONSTANT["REMOVE_BAR"])==="true";return showRemoveBar;};efgrid.divFunc.isBuildNavigationBar=function(grid){var showOprationBar=grid.isEnable()&&!grid.isReadonly();if(grid.getStyleSetting(STYLE_CONSTANT["NAVIGATION_BAR"])==="false")
showOprationBar=false;return showOprationBar;};efgrid.divFunc._buildOperationBar=function(grid){if(!efgrid.divFunc.isBuildOperationBar(grid))
return"";var html=[];html.push("<td class='ef-grid-funcImgButtonTD ef-state-default ef-cornerredius-all'>"
+efbutton.newIconButton(grid.gridId+"_new_row_img","ef-icon-add",getI18nMessages("ef.AddRow","增加新行"),"efpage.newRecord",grid.gridId)+"</td>");return html.join('');};efgrid.divFunc._buildRemoveBar=function(grid){if(!efgrid.divFunc.isBuildRemoveBar(grid))
return"";var html=[];html.push("<td class='ef-grid-funcImgButtonTD ef-state-default ef-cornerredius-all'>"
+efbutton.newIconButton(grid.gridId+"_remove_row_img","ef-icon-remove",getI18nMessages("ef.RemoveRow","删除选中行"),"efgrid.removeSelectedRow",grid.gridId)+"</td>");return html.join('');};efgrid.divFunc._buildToolBar=function(grid){var html=[];if(grid.getStyleSetting(STYLE_CONSTANT["TOOL_BAR"])==="true"){html.push("<td class='ef-grid-funcImgButtonTD ef-state-default ef-cornerredius-all'>"
+efbutton.newIconButton(grid.gridId+"_export_xls","ef-icon-exportExcel",getI18nMessages("ef.ExportExcel","导出到Excel"),"efgrid.exportToXLS",grid.gridId)+"</td>");}
return html.join('');};efgrid.divFunc._buildModelXlsBar=function(grid){var html=[];if(grid.getStyleSetting(STYLE_CONSTANT["MODELXLS_BAR"])==="true"){html.push("<td class='ef-grid-funcImgButtonTD ef-state-default ef-cornerredius-all'>"
+efbutton.newIconButton(grid.gridId
+"_export_modelXls","ef-icon-exportXlsTemplate",getI18nMessages("ef.ExportExcelfromModel","从模板导出xls文件"),"efgrid.exportToModleXLS",grid.gridId)
+"</td>");}
return html.join('');};efgrid.divFunc._buildNavigationBar=function(grid){if(grid.getStyleSetting(STYLE_CONSTANT["NAVIGATION_BAR"])==="false")
return"";var html=[];html.push("<td class='ef-grid-navigationBarTD'><table cellspacing=0 class='ef-grid-navigationBar' ><tr>");var tempTD=document.createElement("td");var count=grid.getCount();var offset=grid.getOffset();var limit=grid.getLimit();if(limit==LIMIT_ALL){tempTD.innerHTML=efbutton.newIconButton(grid.gridId+"_first","ef-icon-firstpage",'第一页','','');$(tempTD).addClass('ef-state-disabled');html.push(tempTD.outerHTML);tempTD=document.createElement("td");$(tempTD).addClass('ef-state-disabled');tempTD.innerHTML=efbutton.newIconButton(grid.gridId+"_previous","ef-icon-left","");html.push(tempTD.outerHTML);tempTD=document.createElement("td");$(tempTD).addClass('ef-state-disabled');tempTD.innerHTML=efbutton.newIconButton(grid.gridId+"_next","ef-icon-right","");html.push(tempTD.outerHTML);tempTD=document.createElement("td");$(tempTD).addClass('ef-state-disabled');tempTD.innerHTML=efbutton.newIconButton(grid.gridId+"_last","ef-icon-lastpage","");html.push(tempTD.outerHTML);}else{tempTD=document.createElement("td");tempTDPre=document.createElement("td");if(offset>0)
{$(tempTD).addClass('ef-state-default ef-cornerredius-all');tempTD.innerHTML=efbutton.newIconButton(grid.gridId+"_first","ef-icon-firstpage",'第一页','efpage.goFirst',grid.gridId);$(tempTDPre).addClass('ef-state-default ef-cornerredius-all');tempTDPre.innerHTML=efbutton.newIconButton(grid.gridId
+"_previous","ef-icon-left",'上一页',"efpage.goPrevious",grid.gridId);}else{$(tempTD).addClass('ef-state-disabled');tempTD.innerHTML=efbutton.newIconButton(grid.gridId+"_first","ef-icon-firstpage",'第一页');$(tempTDPre).addClass('ef-state-disabled');tempTDPre.innerHTML=efbutton.newIconButton(grid.gridId,"ef-icon ef-icon-left",'上一页');}
html.push(tempTD.outerHTML);html.push(tempTDPre.outerHTML);tempTD=document.createElement("td");if((grid.getRowCount()>=limit)&&(count<0||(offset+limit<count))){$(tempTD).addClass('ef-state-default ef-cornerredius-all');tempTD.innerHTML=efbutton.newIconButton(grid.gridId+"_next","ef-icon-right",'下一页',"efpage.goNext",grid.gridId);}else{$(tempTD).addClass('ef-state-disabled');tempTD.innerHTML=efbutton.newIconButton(grid.gridId+"_next","ef-icon-right",'下一页');}
html.push(tempTD.outerHTML);tempTD=document.createElement("td");if(count>=0&&(offset+limit<count)){$(tempTD).addClass('ef-state-default ef-cornerredius-all');tempTD.innerHTML=efbutton.newIconButton(grid.gridId+"_last","ef-icon-lastpage",'最末页',"efpage.goLast",grid.gridId);}
else{$(tempTD).addClass('ef-state-disabled');tempTD.innerHTML=efbutton.newIconButton(grid.gridId+"_last","ef-icon-lastpage",'最末页');}
html.push(tempTD.outerHTML);}
html.push("</tr></table></td>");html.push("<td class='ef-grid-navigationJumpToInputTD'><div style='overflow:hidden'>");html.push("<INPUT class=smallinputField size=3 value='");html.push((offset/limit+1)+"' id='"+grid.gridId+"_jumpto' >");html.push("</div></td>");html.push("<td class='ef-grid-navigationJumpToButtonTD'>"
+"<a class='ef-button ef-grid-navigationJumpToButton ' id=\""
+grid.gridId+"_jump_img"+"\" title=\""
+getI18nMessages("ef.JumpPage","跳转")
+"\" onmouseover=\"this.style.cursor='pointer';\" "+"onclick=\""
+"efpage.jumpTo"+"('"+grid.gridId+"')\" "
+"><span class='ef-grid-navigationJumpToButton-text'>"
+getI18nMessages("ef.JumpPage","跳转")+"</span></button></td>");html.push("<td class='ef-grid-resultLimitSelector'><div style='overflow:hidden;align=center;zIndex=10'>");html.push("<select id ='"+grid.gridId
+"_limit' class=pulldownSmall style='zIndex:10' ");html.push("onchange='efpage.limit(\""+grid.gridId+"\")'>");html.push("<option value=10 "+((limit==10)?"selected":"")
+">10</option>");html.push("<option value=20 "+((limit==20)?"selected":"")
+">20</option>");html.push("<option value=50 "+((limit==50)?"selected":"")
+">50</option>");html.push("<option value=100 "+((limit==100)?"selected":"")
+">100</option>");if(grid.canPageAll){html.push("<option value="+LIMIT_ALL+" "
+((limit==LIMIT_ALL)?"selected":"")+">"
+getI18nMessages("ef.PageAll","全部")+"</option>");}
html.push("</select>"+"</div></td>");var count_disabled=(grid.getStyleSetting(STYLE_CONSTANT["SHOW_COUNT"])==="false");var all_record_count=null;var count_checked="";if(count>=0){all_record_count=""+count;count_checked="checked";}else if(grid.getRowCount()<limit&&grid.getRowCount()>0){all_record_count=""+(offset+grid.getRowCount());}
var show_count=(count>=0);grid.setShowCount(show_count);var showTotalCount="ef-state-disabled ef-icon-total";var title=getI18nMessages("ef.HideTotalCount","默认隐藏全部记录数，点击可打开");if(show_count){showTotalCount="ef-icon-total";title=getI18nMessages("ef.ShowTotalCount","默认显示全部记录数，点击可关闭");}
html.push("<td class='ef-grid-totalDataButtonTd ef-grid-funcImgButtonTD ef-state-default ef-cornerredius-all'>"
+efbutton.newIconButton(grid.gridId+"_count",showTotalCount,title,"efpage.setShowCount",grid.gridId)+"</td>");if(all_record_count!=null){html.push("<td class='ef-grid-totalDataNumbersTd'>"+"&nbsp;");html.push(getI18nMessages(EF_MSG["TOGETHER"],"共")+"&nbsp;"
+all_record_count+"&nbsp;"+"条 &nbsp;");html.push("</td>");}
return html.join('');};

efgrid.divHead=function(){};efgrid.divHead.buildHeadDiv=function(grid){var headTable=efgrid.divCorner.paintHead(grid,"head_table","auto",grid.getColCount(TYPE_DATA),grid.getDataColumns());var headDiv=$("<div />").css({'overflow':'hidden','width':grid.rightWidth+'px','height':grid.rowHeight+'px'}).attr({'id':grid.gridId+EF_SPLIT+'head_div','onmouseout':'efgrid.divHead.onmouseout(event)','onmouseover':'efgrid.divHead.onmouseover(event)','onmousedown':'efgrid.divHead.onmousedown(event)','ondblclick':'efgrid.divHead.ondblclick(event)','ondrag':'return false','onselectstart':'return false'});headDiv.append(headTable);if(grid.hasColumnGroups)
headDiv.height(2*grid.rowHeight);return headDiv;};efgrid.divHead.onmousedown=function(event){var srcElement=event.srcElement||event.target;ef.log("mouse click["+srcElement.tagName+"|"
+srcElement.id+"]"+event.screenX);if((srcElement.tagName!="IMG")&&(srcElement.tagName!="DIV")&&(srcElement.tagName!="TD"))
return;var grid_node=efgrid.getEfGridNode(srcElement);if(!grid_node)return;var grid=grid_node.efgrid;if(!grid)return;var node_now=$(srcElement);if(node_now.is("img"))
node_now=node_now.parent();if(node_now.hasClass('ui-resizable-handle'))
return;if(node_now.is("div"))
node_now=node_now.parent();var headSplit=node_now.attr("headSplit");var not_sortable=(grid.getStyleSetting(STYLE_CONSTANT["SORTABLE"])==="false");if(headSplit=="0"&&!not_sortable){var tdIndex=node_now.attr("tdIndex");var cell_pos=(tdIndex!=undefined)?tdIndex:(node_now[0].cellIndex);var col=grid.getColumn(cell_pos,TYPE_DATA);if(!col)
return;efgrid.divHead.sort(grid_node,col);return;}};efgrid.divHead.onmousemove=function(event){};efgrid.divHead.onmouseup=function(event){};efgrid.divHead.onmouseout=function(event){};efgrid.divHead.onmouseover=function(event){};efgrid.divHead.ondblclick=function(event){var srcElement=event.srcElement||event.target;if(srcElement===null)return;var grid_node=efgrid.getEfGridNode(srcElement);var grid=grid_node.efgrid;var gridId=grid.gridId;var dataTDID=gridId+"DataTd";var headTdid=$(srcElement).closest("td").attr("id");if(!isAvailable(headTdid))
{return;}
var startIndex=headTdid.indexOf("HeadCol_");var offset="HeadCol_".length;var colName=headTdid.substring(startIndex+offset,headTdid.length);dataTDID+=colName;var helpTdId="#"+gridId+"HeadColAid_"+colName;var sumTdId=gridId+"SumDataTd"+colName;var maxTdWidth=0;$("#"+gridId+" td:[id="+dataTDID+"]").each(function(){var currentWidth=$(this).children()[0].scrollWidth;maxTdWidth=(maxTdWidth<currentWidth)?currentWidth:maxTdWidth;});if((maxTdWidth-3)>$("#"+headTdid).width())
{$(helpTdId).width(maxTdWidth+2);$("#"+headTdid).width(maxTdWidth+2);var tdnode=$("#"+headTdid);var colIndex=tdnode.attr('tdindex');var column=grid.dataColumns[colIndex];if(grid.hasColumnGroups)
{column.setWidth(tdnode.width()+2);}
else
{column.setWidth(tdnode.width());}
$("#"+gridId+" td:[id="+dataTDID+"]").each(function(){$(this).width(maxTdWidth+2);});$("#"+gridId+"__sum_data_div td:[id="+sumTdId+"]").each(function(){$(this).width(maxTdWidth+2);});}};efgrid.divHead.resize=function(grid_node,inc_width){};efgrid.divHead.sort=function(grid_node,col){var grid=grid_node.efgrid;var paint_div_id=grid.gridId;if(!grid||!col.existinmeta)return;switch(col.sortType){case"d":col.sortType="";break;case"a":col.sortType="d";break;case"":col.sortType="a";break;default:return;}
if(col.columnType==TYPE_DATA){var tdId="#"+paint_div_id+"HeadCol_"+col.eiColumn.name;var head_div=$(tdId).children(":first");switch(col.sortType){case"a":head_div.append($("<img />").attr("src",efico.get("efgrid.columnSortAscend")));break;case"d":head_div.children(":last").remove();head_div.append($("<img />").attr("src",efico.get("efgrid.columnSortDecend")));break;case"":head_div.children(":last").remove();break;}}else{var cornerDiv=efgrid.getCornerDiv(grid_node);cornerDiv.outerHTML=$('<div />').append(efgrid.divCorner.buildCornerDiv(grid)).html();}
addButtonEffect();if(grid.ajax&&grid.getRowCount()>1)
efgrid.submitInqu(grid.gridId);return;};

var scrollHtml="";efgrid.prototype.init=function(){this.autoDraw=false;this.ajax=false;this.frontSort=false;this.lazyLoadAble=false;this.useBuffer=true;this.showModel="";this.sumType="none";this.rowStatus=null;this.readonly=false;this.enable=true;this.customCols=null;this.originCustomCols=null;this.xlsExportMode=null;this.buttonBarId="";this.buttonBarPosition="bottom";this.colResizeStatus=null;this.colOriginIndex=0;this.colOriginPosX=0;this.colOriginPosY=0;this.cellEditNode=null;this.cellOriginEditNode=null;this.cellOriginNodeType=-1;this.cellOriginNodeValue="";this.blockData=null;this.dataColumns=null;this.dataColumnsSQ=null;this.invisibleColumns=null;this.fixedColumns=null;this.displayBlock=null;this.fixedColumnsSQ=null;this.leftWidth=0;this.rightWidth=0;this.rowHeight=this.getRowHeight();this.bottomHeight=0;this._currentRow=-1;this.dataHtml=null;this.fixHtml=null;this.toolBarPosition="top";this.menuData=new absTreeModel();this.addMenuItem("",{label:"ascending",parent:"",text:getI18nMessages("ef.GridAscend","升序"),leaf:"1",imgSrc:efico.get("efgrid.frontAsc")});this.addMenuItem("",{label:"descending",parent:"",text:getI18nMessages("ef.GridDescend","降序"),leaf:"1",imgSrc:efico.get("efgrid.frontDesc")});this.bufferRows=[];this.timer=null;this.scrollLastPos=-1;this.columnGroups=[];this.dataColumnGroups=[];this.fixColumnGroups=[];this.hasColumnGroups=false;this.enableColumnSetter=false;this.groupField="";this.rowDetailDivID="";this._rowDetailDiv=null;this.onRowClicked=null;this.canPageAll=false;this.isSubGrid=false;};efgrid.prototype.getRowHeight=function(){return 27;};efgrid.prototype.setAjax=function(v){this.ajax=v;};efgrid.prototype.setFrontSort=function(v){this.frontSort=v;};efgrid.prototype.setShowModel=function(v){this.showModel=v;};efgrid.prototype.setDataHtml=function(data){this.dataHtml=data;};efgrid.prototype.getDataHtml=function(data){return this.dataHtml;};efgrid.prototype.setFixHtml=function(fix){this.fixHtml=fix;};efgrid.prototype.getFixHtml=function(fix){return this.fixHtml;};efgrid.prototype.setGroupField=function(groupField){this.groupField=groupField;if((typeof groupField)=="string"&&groupField!="")
this.enableColumnSetter=true;};efgrid.prototype.getGroupField=function(){return this.groupField;};efgrid.prototype.setEnableColumnSetter=function(v){this.enableColumnSetter=isAvailable(v)?eval(v):false;};efgrid.prototype.getEnableColumnSetter=function(){return this.enableColumnSetter;};efgrid.prototype.setRowDetailDivID=function(rowDetailDivID){this.rowDetailDivID=rowDetailDivID;this._rowDetailDiv=$('#'+this.rowDetailDivID)[0];};efgrid.prototype.getRowDetailDivID=function(){return this.rowDetailDivID;};efgrid.prototype.setAutoDraw=function(v){this.autoDraw=v;};efgrid.prototype.setCustomColumns=function(custom_cols){this.customCols=custom_cols;};efgrid.prototype.setJsonData=function(eiJson){var eiinfo=Json2EiInfo.prototype.parseJsonObject(eiJson);this.setData(eiinfo);};efgrid.prototype.setStyle=function(style_config){this.styleConfig=style_config;};efgrid.prototype.getStyleSetting=function(key){return isAvailable(this.styleConfig)?this.styleConfig[key]:null;};efgrid.prototype.setCanPageAll=function(v){this.canPageAll=v;};efgrid.prototype.setXlsExportMode=function(mode){this.xlsExportMode=mode;};efgrid.prototype.setButtonBarId=function(id){this.buttonBarId=id;};efgrid.prototype.setButtonBarPosition=function(mode){this.buttonBarPosition=mode;};efgrid.addGridStyle=function(){$(document).ready(function(){$(".ef-grid-func").addClass("ef-header");$(".ef-grid-tableHeader").addClass("ef-header");});};efgrid.prototype.setData=function(eiinfo){this.eiinfo=eiinfo;this.dataColumns=[];this.invisibleColumns=[];this.fixedColumns=[];this.blockData=eiinfo.getBlock(this.blockId);if(!isAvailable(this.blockData)){efform._removeGrid(this.gridId);throw new Error("Block with id:["+this.blockId
+"] not exists in request!");}
var choose=new EiColumn("_rowcheck");choose.primaryKey=false;choose.descName="";choose.displayType=this.isEnable()?"checkbox":"text";choose.visible=true;choose.readonly=false;var ef_c=this.buildColumn(choose,choose);ef_c.setWidth(this.isEnable()?20:1);this.fixedColumns.push(ef_c);var metas=this.blockData.getBlockMeta().getMetas();if(!this.customCols)
this.customCols={};var customIndex=this.customCols["index"]?this.customCols["index"]:{};var customMeta=this.customCols["metas"]?this.customCols["metas"]:[];var groupIndex=this.customCols["groupIndex"]?this.customCols["groupIndex"]:{};var columnGroups=this.customCols["columnGroups"]?this.customCols["columnGroups"]:[];if(this.autoDraw!="no"&&(""+this.autoDraw)!="false"){customKeys=[];for(var key in metas){var index=customIndex[key];var custom_setting=(index!==undefined)?customMeta[eval(index)]:metas[key];ef_c=this.buildColumn(custom_setting,metas[key],eiinfo);if(index!=null){customKeys.push(key);}
this.getColumns(ef_c.getColumnType(),ef_c.isVisible()).push(ef_c);}
if(this.autoDraw=="yes"){for(var key in customIndex){if(customKeys.indexOf(key)>=0)
continue;var index=customIndex[key];var ei_c=new EiColumn(key);ei_c.descName=customMeta[eval(index)]["descName"];ei_c.pos=this.blockData.getBlockMeta().colCount;this.blockData.getBlockMeta().addMeta(ei_c);for(var j=0;j<this.blockData.getRows().length;j++)
this.blockData.setCell(j,key," ");ef_c=this.buildColumn(customMeta[eval(index)],ei_c,eiinfo);ef_c.existinmeta=false;this.getColumns(ef_c.getColumnType(),ef_c.isVisible()).push(ef_c);}}}
else{for(var i=0;i<customMeta.length;i++){var custom_setting=customMeta[i];var key=custom_setting["name"];var origin_setting=metas[key];if(!isAvailable(metas[key])){origin_setting=new EiColumn(key);if(isAvailable(custom_setting["descName"]))
origin_setting.descName=custom_setting["descName"];origin_setting.pos=this.blockData.getBlockMeta().colCount;this.blockData.getBlockMeta().addMeta(origin_setting);for(var j=0;j<this.blockData.getRows().length;j++)
this.blockData.setCell(j,key," ");}
ef_c=this.buildColumn(custom_setting,origin_setting,eiinfo);ef_c.existinmeta=isAvailable(metas[key]);this.getColumns(ef_c.getColumnType(),ef_c.isVisible()).push(ef_c);}
for(var i=0;i<columnGroups.length;i++){var ef_c=new efColumnGroup();ef_c.build(columnGroups[i]);this.columnGroups[this.columnGroups.length]=ef_c;if(ef_c.columnType==1){this.fixColumnGroups[this.fixColumnGroups.length]=ef_c;}else{this.dataColumnGroups[this.dataColumnGroups.length]=ef_c;}}
if(this.columnGroups!=null&&this.columnGroups.length>0)
this.hasColumnGroups=true;}
if(this.fixedColumnsSQ!=null&&null!=this.dataColumnsSQ){_fixed=[];_data=[];_fixed.push(this.fixedColumns[0]);for(i=0;c=this.fixedColumnsSQ[i++];){for(j=0;t=this.fixedColumns[j++];){if(!!t.customSetting&&t.customSetting["name"]==c){_fixed.push(t);}}}
this.fixedColumns=_fixed;for(i=0;c=this.dataColumnsSQ[i++];){for(j=0;t=this.dataColumns[j++];){if(!!t.customSetting&&t.customSetting["name"]==c){_data.push(t);}}}
this.dataColumns=_data;}
this.serviceSetting(eiinfo);this._clearRowState();this._clearStyle();this.setOrderBy(this.getProp("orderBy",""));};efgrid.prototype.setServiceName=function(sName){this.serviceName=sName;};efgrid.prototype.setQueryMethod=function(sName){this.queryMethod=sName;};efgrid.prototype.serviceSetting=function(eiinfo){if(!isAvailable(this.serviceName))
this.serviceName=eiinfo.get("serviceName");};efgrid.prototype.getCurrentRowIndex=function(){return this._currentRow;};efgrid.prototype.setCurrentRowIndex=function(row_index,dbclick){if(row_index<0||row_index>=this.getRowCount())
return;if(this._currentRow!=row_index){var table_node=this.getGridTableNode();efgrid.divData.setRowStyle(table_node,row_index,this.isRowChecked(row_index)?"rowHighlight":efform.getGridCurrentRowStyle());if(this._currentRow>=0&&!this.isRowChecked(this._currentRow)){efgrid.divData.setRowStyle(table_node,this._currentRow,this._rowStyle[this._currentRow]);}
this._currentRow=row_index;if(typeof efgrid_onRowClicked=="function"){try{efgrid_onRowClicked(this.gridId,row_index);}catch(ex){efgrid.processException(ex,"Callback to efgrid_onRowClicked failed");}}
if(typeof this.onRowClicked=="function"){try{this.onRowClicked(this.gridId,row_index);}catch(ex){efgrid.processException(ex,"Callback to onRowClicked failed");}}}else if(dbclick==true){if(typeof efgrid_onRowDblClicked=="function"){try{efgrid_onRowDblClicked(this.gridId,row_index);}catch(ex){efgrid.processException(ex,"Callback to efgrid_onRowDblClicked failed");}}
if(this.onRowDblClicked!=undefined&&typeof this.onRowDblClicked=="function"){try{this.onRowDblClicked();}catch(ex){efgrid.processException(ex,"Callback to this.onRowDblClicked failed");}}}};efgrid.prototype.getCheckedRows=function(){var rows=[];for(var i=0;i<this.rowStatus.length;i++){if(this.isRowChecked(i))
{rows.push(i);}}
return rows;};efgrid.prototype.getCheckedRowCount=function(){return this.getCheckedRows().length;};efgrid.prototype.getSelectRowsData=function(){var rows=[];for(var i=0;i<this.rowStatus.length;i++){if(this.isRowChecked(i))
{rows.push(this.getRowData(i));}}
return rows;};efgrid.prototype.getRowData=function(row_index){var rowData=new Object();if(row_index>=0&&row_index<this.blockData.getRows().length){var metas=this.blockData.getBlockMeta().getMetas();for(var key in metas)
rowData[key]=this.blockData.getCell(row_index,key);}
return rowData;};efgrid.prototype.addRowData=function(rowData,clear){if(!isAvailable(rowData)||!isAvailable(rowData.length))
return;var metas=this.blockData.getBlockMeta().getMetas();var row_index=this.blockData.getRows().length;if(clear==undefined||clear)
this._clearSelect();for(var i=0;i<rowData.length;i++,row_index++){this.blockData.addRow();for(var key in metas){if(isAvailable(rowData[i][key]))
this.blockData.setCell(row_index,key,rowData[i][key]);}
this.rowStatus.push(3);this._rowStyle.push("tableRow"+((this.getRowCount()+1)&1));}
this.refresh();};efgrid.prototype._clearStyle=function(){this._rowStyle=[];var rowCount=this.blockData.getRows().length;for(var i=0;i<rowCount;i++)
this._rowStyle[i]='tableRow'+(i&1);};efgrid.prototype._clearSelect=function(){var rowCount=this.blockData.getRows().length;for(var i=0;i<rowCount;i++)
this.rowStatus[i]&=0xFD;};efgrid.prototype._clearRowState=function(){this.rowStatus=[];var rowCount=this.blockData.getRows().length;for(var i=0;i<rowCount;i++)
this.rowStatus[i]=0;};efgrid.prototype.getBlockData=function(){return this.blockData;};efgrid.prototype.buildColumn=function(custom_col,original_col,eiinfo){return efColumn.build(custom_col,original_col,eiinfo);};efgrid.prototype.getAllColumns=function(){return this.fixedColumns.concat(this.dataColumns).concat(this.invisibleColumns);};efgrid.prototype.getDataColumns=function(){return this.getColumns(TYPE_DATA,true);};efgrid.prototype.getColumns=function(t,visible){if(TYPE_FIX==t)
return this.fixedColumns;return visible?this.dataColumns:this.invisibleColumns;};efgrid.prototype.getProp=function(name,defaultValue){var value=this.getBlockData().getAttr()[name];return(value===null||value===undefined)?defaultValue:value;};efgrid.prototype.setProp=function(name,v){this.getBlockData().getAttr()[name]=v;};efgrid.prototype.getOffset=function(){var v=eval(this.getProp("offset",0));this.setOffset(v);return v;};efgrid.prototype.setOffset=function(v){this.setProp("offset",v);};efgrid.prototype.getLimit=function(){var v=eval(this.getProp("limit",10));this.setLimit(v);return v;};efgrid.prototype.setLimit=function(v){this.setProp("limit",v);};efgrid.prototype.getCount=function(){return eval(this.getProp("count",-1));};efgrid.prototype.setCount=function(v){this.setProp("count",v);};efgrid.prototype.getTotalPageCount=function(){var count=this.getCount();var limit=this.getLimit();if(count==0||limit==LIMIT_ALL)
return 1;if(count<0)
return Number.MAX_VALUE;var mod=count%limit;var pages=(count-mod)/limit;return(count%limit==0)?pages:pages+1;};efgrid.prototype.isReadonly=function(){return this.readonly;};efgrid.prototype.setReadonly=function(v){this.readonly=isAvailable(v)?eval(v):false;};efgrid.prototype.isEnable=function(){return this.enable;};efgrid.prototype.setEnable=function(v){this.enable=isAvailable(v)?eval(v):true;};efgrid.prototype.getCellValue=function(row,col,t,invisible){var column=invisible?this.getInvisibleColumn(col):this.getColumn(col,t);var rows=this.getBlockData().rows;var v=null;if(rows.length>row)
v=rows[row][column.pos];return isAvailable(v)?efutils.trimString(v):"";};efgrid.prototype.getTDCellValue=function(row,col){var column=this.dataColumns[col];var v=this.blockData.rows[row][column.pos];return isAvailable(v)?efutils.trimString(v):"";};efgrid.prototype.getTFCellValue=function(row,col){var column=this.fixedColumns[col];var v=this.blockData.rows[row][column.pos];return isAvailable(v)?efutils.trimString(v):"";};efgrid.prototype.getCellValueByColumnName=function(row,ename){var allColumns=this.getAllColumns();var column;var v;for(var i=0;i<allColumns.length;i++){if(allColumns[i].getEname()==ename){column=allColumns[i];}}
if(isAvailable(column)){if(isAvailable(this.getBlockData().rows[row])){v=this.getBlockData().rows[row][column.pos];}else{return"";}}
return isAvailable(v)?efutils.trimString(v):"";};efgrid.prototype.getCellMappingValueByColumnName=function(row,ename){var allColumns=this.getAllColumns();var column;var v;for(var i=0;i<allColumns.length;i++){if(allColumns[i].getEname()==ename){column=allColumns[i];}}
if(isAvailable(column)){v=this.getBlockData().rows[row][column.pos];}
var retValue=isAvailable(v)?efutils.trimString(v):"";if(retValue!=""&&column.columnListValue.length>0){for(var k=0;k<column.columnListValue.length;k++){if(column.columnListValue[k]==retValue){retValue=column.columnListLabel[k];break;}}}
return retValue;};efgrid.prototype.setCellValue=function(row,col,v,t){if(!isAvailable(v))
v="";else
v=efutils.trimString(v);if(!isAvailable(v))
v=" ";var column=this.getColumn(col,t);var blockmeta=this.blockData.getBlockMeta();if(!isAvailable(blockmeta.getMeta(column.getEname()))){column.pos=blockmeta.colCount;blockmeta.addMeta(column.eiColumn);}
this.getBlockData().setCell(row,column.getEname(),v);};efgrid.prototype.getRowCount=function(){return this.getBlockData().getRows().length;};efgrid.prototype.getColCount=function(t){return(t==TYPE_FIX)?this.fixedColumns.length:this.dataColumns.length;};efgrid.prototype.getInvisibleColCount=function(){return this.invisibleColumns.length;};efgrid.prototype.getColumn=function(index,t){return this.getColumns(t,true)[index];};efgrid.prototype.getColumnByName=function(ename){var allColumns=this.getAllColumns();for(var i=0;i<allColumns.length;i++){if(allColumns[i].getEname()==ename){var column=allColumns[i];return column;}}
return null;};efgrid.prototype.getInvisibleColumn=function(index){return this.getColumns(TYPE_DATA,false)[index];};efgrid.prototype.calcColsWidth=function(){var sum=0;for(var i=0;i<this.getColCount(TYPE_DATA);i++)
sum+=this.getColumn(i,TYPE_DATA).getWidth();return sum;};efgrid.prototype.calcTableWidth=function(){return this.calcColsWidth()+this.getColCount(TYPE_DATA)+1;};efgrid.prototype.paint=function(){var paint_div_id=this.gridId;var gridDiv=$('#'+paint_div_id);var paintDivElement=$('#'+paint_div_id)[0];if(!paintDivElement){return-1;}
if(this.cellOriginEditNode!=null)
efgrid._saveOldCell(this.cellOriginEditNode,this);this.cellEditNode=null;this.cellOriginEditNode=null;this.cellOriginNodeValue="";this.cellOriginNodeType=-1;efform.clearErrorMessage();if(this._currentRow<0){if(this.getStyleSetting(STYLE_CONSTANT["INIT_SELECT"])==="true"&&this.blockData.getRows().length>0){this._currentRow=0;}}
if(typeof efgrid_onBeforeGridDisplay=="function"){try{efgrid_onBeforeGridDisplay(this.gridId);}catch(ex){efgrid.processException(ex,"Callback to efgrid_onBeforeGridDisplay failed");}}
var gridDiv=$('#'+paint_div_id);gridDiv.addClass("ef-grid-border ef-grid-content");var w_total=gridDiv.width();if(w_total>document.body.clientWidth)
w_total=document.body.clientWidth-20;this.leftWidth=efgrid.divFix.calcFixWidth(this);this.rightWidth=w_total-this.leftWidth;var h_total=gridDiv.height();if(h_total<50)
h_total=300;this.bottomHeight=h_total-60;if(this.hasColumnGroups)
this.bottomHeight-=this.rowHeight;if(this.getStyleSetting(STYLE_CONSTANT["PERSONAL_BAR"])!=="true"&&this.getStyleSetting(STYLE_CONSTANT["OPERTATION_BAR"])==="false"&&this.getStyleSetting(STYLE_CONSTANT["NAVIGATION_BAR"])==="false"&&!efgrid.divFunc.isBuildOperationBar(this)&&this.getStyleSetting(STYLE_CONSTANT["TOOL_BAR"])!=="true"&&this.getStyleSetting(STYLE_CONSTANT["MODELXLS_BAR"])!=="true")
this.bottomHeight+=30;if(this.isLazyLoad()){this.rightWidth=this.rightWidth-21;this.setShowCount(true);this.setLimit(parseInt((this.bottomHeight-10)/(this.rowHeight+3)));var scrollClientHeight=this.bottomHeight+this.rowHeight;var scrollDivHeight=Math.floor(scrollClientHeight/8)*this.getCount();if(scrollDivHeight<scrollClientHeight)
scrollDivHeight=scrollClientHeight-20;scrollHtml="<DIV id='"+this.gridId+EF_SPLIT+"scroll_div' "
+"style='height:"+scrollClientHeight
+"px;overflow-y:scroll' "
+"onscroll='var grid = efgrid.getGridObject( \""+this.gridId
+"\" );grid.onScroll();wsug(event, grid.getScrollTooltip())' "
+"onmouseout='wsug(event, 0)'>"+"<DIV  style='height:"
+scrollDivHeight+"px;'></DIV>"+"</DIV>";}
var tableWidth=w_total+"px";if(w_total<=0)
tableWidth="100%";if(this.isShowLineNumber()){this.leftWidth+=22;this.rightWidth-=22;}
var grid_table=$("<table />").attr({'id':this.gridId+EF_SPLIT+'grid_table','border':0,'cellspacing':0,'cellpadding':0,'cols':2}).css({'width':tableWidth}).append($("<colgroup />").append($("<col/>").width(this.leftWidth)).append($("<col/>").width(this.rightWidth)));this.configToolBarPosition(grid_table);if(this.groupField!=""||this.rowDetailDivID!=""){$("#"+this.gridId+"__corner_div").css("display","none");$("#"+this.gridId+"__fix_div").css("display","none");var left_col=$("#"+this.gridId+"__grid_table").find("col").eq(0);var right_col=$("#"+this.gridId+"__grid_table").find("col").eq(1);var tableHeadDiv=$("#"+this.gridId+"__head_div");var tableCornerDiv=$("#"+this.gridId+"__corner_div");right_col.width(w_total);if($.browser.msie){tableHeadDiv.width(w_total-1);tableCornerDiv.width(1);left_col.width(1);}else{tableHeadDiv.width(w_total);tableCornerDiv.width(0);left_col.width(0);}}
if(paintDivElement.id=="efgrid_config_sub_grid"){var grid=efgrid.getGridObject("efgrid_config_sub_grid");var rowCount=grid.getRowCount();for(var i=0;i<rowCount;i++){var canPersonal=grid.getCellValue(i,0,TYPE_DATA,true);if(canPersonal=="false")
efgrid.setRowDisplayStyle(paintDivElement.id,i,"show");}}else if(typeof efgrid_onGridDisplayReady=="function"){try{efgrid_onGridDisplayReady(paintDivElement);}catch(ex){efgrid.processException(ex,"Callback to efgrid_onGridDisplayReady failed");}}
this.showModel="";if(this.isLazyLoad()&&this.scrollLastPos!=-1)
this.getScrollDivNode().scrollTop=this.scrollLastPos;};efgrid_paint_handler=function(grid)
{if(grid.buttonBarId&&grid.buttonBarId!=""){$("#ef_grid_"+grid.buttonBarId+EF_SPLIT+"buttonbar").empty();var func=eval("paintButtonBar_"+grid.gridId);func();}
var tableId="#"+grid.gridId+EF_SPLIT+"grid_table";var grid_table=$(tableId)[0];grid_table.efgrid=grid;efform.addGrid(grid);grid._setScrollStyle();addButtonEffect();};efgrid_resize_handler=function(paint_div_id)
{var grid_div=$("#"+paint_div_id)[0];var grid=efgrid.getGridObject(paint_div_id);jQuery.data(grid_div,"RESIZE",0);$(document).delegate("#"+paint_div_id,"mouseover",function(){if(jQuery.data(grid_div,"RESIZE")==0)
{var gridTable=$(grid.getGridTableNode());var styleCss=gridTable.attr('style');if(styleCss.search(/width:\s*100%/)>=0)
{grid.paint();}
var tableTDID="";var dataTDID;tableTDID+="#"+paint_div_id+EF_SPLIT+"head_table"
+" td.ef-grid-tableHeaderColumn";dataTDID="#"+paint_div_id+"DataTd";$(tableTDID).not('td[tdindex=-1]').each(function(){var id=$(this).attr("id");var startIndex=id.indexOf("HeadCol_");var offset="HeadCol_".length;var colName=id.substring(startIndex+offset,id.length);var dataId=dataTDID+colName;var aidId="#"+paint_div_id+"HeadColAid_"+colName;var sumTd="#"+paint_div_id+"SumDataTd"+colName;$(this).data('DATA',dataId);$(this).data('AID',aidId);$(this).data('SUM',sumTd);$(this).resizable({alsoResize:dataId+","+aidId+","+sumTd,handles:'e',stop:function(){var dataDivId="#"+paint_div_id+EF_SPLIT
+"data_div";var fixDivId="#"+paint_div_id+EF_SPLIT
+"fix_div";var dataTableId="#"+paint_div_id+EF_SPLIT
+"data_table";if($(dataTableId).width()>$(dataDivId).width()){$(dataDivId).css('overflow-x','scroll');$(fixDivId).css('overflow-x','scroll');$('div[id*=sumDataDivForFloat]').trigger('positionChanged');}
var tdnode=$(this);var colIndex=tdnode.attr('tdindex');var column=grid.dataColumns[colIndex];var tdWidth=tdnode.width();column.setWidth(tdWidth);$($(this).data('DATA')).width(tdWidth);$($(this).data('AID')).width(tdWidth);$($(this).data('SUM')).width(tdWidth);if($.browser.msie){var dataDivId="#"+paint_div_id+EF_SPLIT
+"data_div";var begin=$(dataDivId).scrollLeft();if(begin>0){$(dataDivId).scrollLeft(begin-1);$(dataDivId).scrollLeft(begin);}}}});});jQuery.data(grid_div,"RESIZE",1);}});};efgrid_sum_handler=function(grid)
{if(grid.needSum()){$('#'+grid.gridId).ready(function(){efgrid_sum_load_handler(grid);});$(window).load(function(){efgrid_sum_load_handler(grid);});}};efgrid_sum_load_handler=function(grid)
{var gridId=grid.gridId;$('#'+gridId+'sumDataDivForFloat').remove();var sumDiv=efgrid.divData.buildSumDataDiv(grid);sumDiv.insertAfter($('#'+gridId));$(sumDiv).bind('positionChanged',function(){var dataDivId='#'+gridId+EF_SPLIT+'data_div';var a=$('#'+gridId+'sumDataTrForFloat').offset().top;var b=$(dataDivId)[0].scrollHeight;var c=$(dataDivId)[0].clientHeight;var d=$(dataDivId).scrollTop();var top=a-b+c+d;if(top&&a)
{$(this).offset({'top':top});}});if(grid.groupField!=""||grid.rowDetailDivID!=""){$("#"+gridId+"__sum_fix_div").css("display","none");var left_col=$("#"+gridId+"__sum_grid_table").find("col").eq(0);var right_col=$("#"+gridId+"__sum_grid_table").find("col").eq(1);var r=right_col.width();var tableHeadDiv=$("#"+gridId+"__sum_data_div");var tableCornerDiv=$("#"+gridId+"__sum_fix_div");$('#'+gridId+'sumDataDivForFloat').width(r);$("#"+gridId+"__sum_grid_table").width(r);if($.browser.msie){tableHeadDiv.width(r-1);tableCornerDiv.width(1);left_col.width(1);}else{tableHeadDiv.width(r);tableCornerDiv.width(0);left_col.width(0);}}};efgrid.prototype.configToolBarPosition=function(grid_table){var html;if(this.groupField!=""||this.rowDetailDivID!=""){html=efgrid.divData.buildGroupDetailDataDiv(this);}
else
{html=efgrid.divData.buildFixDataDiv(this);}
var funcDivHtml=efgrid.divFunc.buildFuncDiv(this);var cornerDiv=efgrid.divCorner.buildCornerDiv(this);var headDiv=efgrid.divHead.buildHeadDiv(this);var gridDiv=$('#'+this.gridId);var gridHeight=gridDiv.css("height");if(gridDiv.height()==0&&!this.isAutoHeight())
{gridDiv.css("height","300px");}
gridDiv.children().each(function(){$(this).remove();});gridDiv.append(grid_table);var headerHeight=this.hasColumnGroups?2*this.rowHeight:this.rowHeight;var tempTd=this.isLazyLoad()?$("<td rowspan=2 />").html(scrollHtml):$("");grid_table.append($("<tr />").addClass('ef-grid-tableHeader').attr('efGridTopTable',1).height(headerHeight).append($("<td />").attr('efGridTopTable',1).append(cornerDiv)).append($("<td />").attr('efGridTopTable',1).append(headDiv)).append(tempTd)).append($("<tr />").attr('efGridTopTable',1).height(this.isAutoHeight()?'100%':this.bottomHeight).append($("<td />").attr('efGridTopTable',1).append(html[0])).append($("<td />").attr('efGridTopTable',1).append(html[1])));switch(this.toolBarPosition){case"top":gridDiv.prepend($(funcDivHtml));break;case"bottom":gridDiv.append($(funcDivHtml));break;default:gridDiv.prepend($(funcDivHtml));break;}
efgrid_paint_handler(this);efgrid_resize_handler(this.gridId);efgrid.addGridStyle();efgrid_sum_handler(this);};efgrid.prototype._addErroMsgContent=function(){var errorMsgContent=$("#"+this.gridId+"_errorMsgContent")[0];var gridContent=$("#"+this.gridId)[0];if(errorMsgContent==undefined||errorMsgContent==null){errorMsgContent=document.createElement("div");errorMsgContent.style.position="absolute";errorMsgContent.style.display="none";errorMsgContent.id=this.gridId+"_errorMsgContent";errorMsgContent.innerHTML="<table><tr><td style='width:4px;height:4px;background:red' "
+"onmouseover='this.parentNode.nextSibling.firstChild.nextSibling.style.display=\"block\";' "
+"onmouseout='this.parentNode.nextSibling.firstChild.nextSibling.style.display=\"none\"' ></td> "
+"<td></td></tr><tr><td></td> "
+"<td id='"
+this.gridId
+"_errorMsgContent' style='display:none;border-style:solid;border-width:1px;'></td> "
+"</tr></table>";document.body.appendChild(errorMsgContent);}
errorMsgContent.style.pixelLeft=gridContent.offsetLeft;errorMsgContent.style.pixelTop=gridContent.offsetTop;return errorMsgContent;};efgrid.prototype._setScrollStyle=function(){var grid_table=this.getGridTableNode();var fixDiv=efgrid.getFixDiv(grid_table);var dataDiv=efgrid.getDataDiv(grid_table);if(this.rightWidth<eval(this.calcColsWidth())){fixDiv.style.overflowX="scroll";dataDiv.style.overflowX="scroll";}else{fixDiv.style.overflowX="hidden";dataDiv.style.overflowX="hidden";}
fixDiv.style.overflowY="hidden";dataDiv.style.overflowY="scroll";if(this.isLazyLoad())
dataDiv.style.overflowY="hidden";};efgrid.prototype.getShowCount=function(){return eval(this.getBlockData().get("showCount"));};efgrid.prototype.setShowCount=function(v){this.getBlockData().set("showCount",v);};efgrid.prototype.setOrderBy=function(order_by){if(!order_by)
return;var col_order=order_by.split(",");for(var i=0;i<col_order.length;i++){var order_param=col_order[i].split(" ");if(order_param.length!=2)
continue;for(var j=0;j<this.getColCount(TYPE_FIX);j++){if(this.getColumn(j,TYPE_FIX).getEname()==order_param[0]){this.getColumn(j,TYPE_FIX).sortType=(order_param[1]=="desc")?"d":"a";break;}}
for(var j=0;j<this.getColCount(TYPE_DATA);j++){if(this.getColumn(j,TYPE_DATA).getEname()==order_param[0]){this.getColumn(j,TYPE_DATA).sortType=(order_param[1]=="desc")?"d":"a";break;}}}};efgrid.prototype.getOrderBy=function(){var fix_order_by=this._getTypedOrderBy("",TYPE_FIX);return this._getTypedOrderBy(fix_order_by,TYPE_DATA);};efgrid.prototype._getTypedOrderBy=function(order_by,type){for(var i=0;i<this.getColCount(type);i++){var col=this.getColumn(i,type);if(!col.existinmeta)
continue;if(col.sortType&&col.sortType!="-"){if(order_by!="")
order_by+=",";order_by+=col.getEname();order_by+=(col.sortType=="d")?" desc":" asc";}}
return order_by;};efgrid.prototype.newLine=function(copy){var unchecked=(this.getStyleSetting(STYLE_CONSTANT["CHECK_NEWLINE"])==="false");if(isAvailable(copy)&&copy){var row_count=this.getRowCount();var rows=this.getCheckedRows();for(var i=0;i<rows.length;i++){if(!unchecked)
this.rowStatus[rows[i]]&=0xFD;var row=efutils.copyArray(this.getBlockData().getRows()[rows[i]]);this._rowStyle.push("tableRow"+(row_count&1));this.getBlockData().addRow(row);this.rowStatus.push(unchecked?1:3);row_count++;}}else{var row=[];for(var i=1;i<this.getColCount(TYPE_FIX);i++){var column=this.getColumn(i,TYPE_FIX);if(column.pos>=0)
row[column.pos]=column.getDefaultValue();}
for(var i=0;i<this.getColCount(TYPE_DATA);i++){var column=this.getColumn(i,TYPE_DATA);if(column.pos>=0)
row[column.pos]=column.getDefaultValue();}
for(var i=0;i<this.getInvisibleColCount();i++){var column=this.getInvisibleColumn(i);if(column.pos>=0)
row[column.pos]=column.getDefaultValue();}
var rows=this.getCheckedRows();for(var i=0;i<rows.length;i++){if(!unchecked)
this.rowStatus[rows[i]]&=0xFD;}
this._rowStyle.push("tableRow"+(this.getRowCount()&1));this.getBlockData().addRow(row);this.rowStatus.push(unchecked?1:3);}};efgrid.prototype.setRowChecked=function(row,checked){if(row<0||row>=this.getRowCount())
return;if(checked)
this.rowStatus[row]|=2;else
this.rowStatus[row]&=0xFD;};efgrid.prototype.isRowChecked=function(row){if(row<0||row>=this.getRowCount())
return false;return(this.rowStatus[row]&2)!=0;};efgrid.prototype.isNewLine=function(row){if(row<0||row>=this.getRowCount())
return false;return(this.rowStatus[row]&1)!=0;};efgrid.prototype.validateAll=function(){var message="";for(var i=0;i<this.getRowCount();i++){if(!this.isRowChecked(i))
continue;for(var j=0;j<this.getColCount(TYPE_DATA);j++){var column=this.getColumn(j,TYPE_DATA);try{column.getValidator().validate(this.getCellValue(i,j,TYPE_DATA));}catch(ex){message+=getI18nMessages(EF_MSG["DATA_COLUMN"],"数据列")
+"["
+j
+"]"
+getI18nMessages(EF_MSG["ROW"],"行")
+"["
+i
+"]"
+getI18nMessages(EF_ERROR_MSG["VALIDATE_ERROR"],"数据验证错误")+":"+ex.message+"\n";ef_form_validate_message["data_key_"+i+"_"+j]=message;efform.setErrorStyle(this.getCellDivNode(i,j,TYPE_DATA),ex.message,false);}}
for(var j=1;j<this.getColCount(TYPE_FIX);j++){var column=this.getColumn(j,TYPE_FIX);try{column.getValidator().validate(this.getCellValue(i,j,TYPE_FIX));}catch(ex){message+=getI18nMessages(EF_MSG["FIX_COLUMN"],"固定列")
+"["
+j
+"]"
+getI18nMessages(EF_MSG["ROW"],"行")
+"["
+i
+"]"
+getI18nMessages(EF_ERROR_MSG["VALIDATE_ERROR"],"数据验证错误")+":"+ex.message+"\n";ef_form_validate_message["fix_key_"+i+"_"+j]=message;efform.setErrorStyle(this.getCellDivNode(i,j,TYPE_FIX),ex.message,false);}}}
return message;};efgrid.prototype.getGridTableNode=function(){return $("#"+this.gridId+EF_SPLIT+"grid_table")[0];};efgrid.prototype.getCellDivNode=function(row_index,col_index,data_type){var fixTable=$('#'+this.gridId+EF_SPLIT+'fix_table');var dataTable=$('#'+this.gridId+EF_SPLIT+'data_table');if(data_type==TYPE_FIX)
return fixTable.find('tr[rawrowindex='+row_index+']').children('td:eq('+col_index+')')[0].firstChild;else
return dataTable.find('tr[rawrowindex='+row_index+']').children('td:eq('+col_index+')')[0].firstChild;};efgrid.prototype.refreshCell=function(row_index,col_index,data_type){if(row_index<0||row_index>=this.getRowCount())
return;if(col_index<0||col_index>=this.getColCount(data_type))
return;var div_node=this.getCellDivNode(row_index,col_index,data_type);var column=this.getColumn(col_index,data_type);var cell_value=this.getCellValue(row_index,col_index,data_type);var parent_node=div_node.parentNode;var new_node=column.genCellDisplayNode(cell_value,this.gridId,row_index,col_index);if(div_node==this.cellOriginEditNode){new_node=column.getEditNode(div_node,this.isNewLine(row_index));if(!new_node)
return;efgrid._setEditNodeEvent(new_node);this.cellOriginEditNode=new_node;this.cellOriginNodeValue=cell_value;}
parent_node.innerHtml="";parent_node.removeChild(div_node);parent_node.appendChild(new_node);};efgrid.prototype.refreshRow=function(row_index){if(row_index<0||row_index>=this.getRowCount())
return;var div_node=this.getCellDivNode(row_index,0,TYPE_FIX);div_node.firstChild.checked=this.isRowChecked(row_index);for(var i=1;i<this.getColCount(TYPE_FIX);i++)
this.refreshCell(row_index,i,TYPE_FIX);for(var i=0;i<this.getColCount(TYPE_DATA);i++)
this.refreshCell(row_index,i,TYPE_DATA);};efgrid.prototype.refresh=function(eiinfo){this.cellEditNode=null;this.cellOriginEditNode=null;this.cellOriginNodeType=-1;this.cellOriginNodeValue="";if(isAvailable(eiinfo)){var meta=eiinfo.getBlock(this.blockId).getBlockMeta();var repaintHead=isAvailable(meta);if(repaintHead){this.setData(eiinfo);}else{meta=this.blockData.getBlockMeta();this.blockData=eiinfo.getBlock(this.blockId);this.blockData.setBlockMeta(meta);}
this._clearRowState();if(this.getStyleSetting(STYLE_CONSTANT["INIT_SELECT"])==="true"&&this.blockData.getRows().length>0)
this._currentRow=0;else
this._currentRow=-1;this._clearStyle();}
var grid_table=this.getGridTableNode();if(!grid_table)return;var funcDivHtml=efgrid.divFunc.buildFuncDiv(this);var funcDiv=efgrid.getFuncDiv(grid_table);$(funcDiv).html($(funcDivHtml).find('table').eq(0));var cornerDivHtml=efgrid.divCorner.buildCornerDiv(this);var conerDiv=efgrid.getCornerDiv(grid_table);$(conerDiv).html($(cornerDivHtml).find('table').eq(0));var html;if(this.groupField!=""||this.rowDetailDivID!=""){html=efgrid.divData.buildGroupDetailDataDiv(this);}else{html=efgrid.divData.buildFixDataDiv(this);}
var fixDiv=efgrid.getFixDiv(grid_table);$(fixDiv).html($(html[0]).find('table').eq(0));var dataDiv=efgrid.getDataDiv(grid_table);$(dataDiv).html($(html[1]).find('table').eq(0));if(repaintHead){var headDivHtml=efgrid.divHead.buildHeadDiv(this);var dataDiv=efgrid.getHeadDiv(grid_table);$(dataDiv).html($(headDivHtml).find('table').eq(0));jQuery.data($('#'+this.gridId)[0],"RESIZE",0);efgrid_resize_handler(this.gridId);}
this._setScrollStyle();grid_table.title=grid_table.parentNode.title;if(grid_table.parentNode.id=="efgrid_config_sub_grid"){var grid=efgrid.getGridObject("efgrid_config_sub_grid");var rowCount=grid.getRowCount();for(var i=0;i<rowCount;i++){var canPersonal=grid.getCellValue(i,0,TYPE_DATA,true);if(canPersonal=="false")
efgrid.setRowDisplayStyle(grid_table.parentNode.id,i,"show");}}else if(typeof efgrid_onGridDisplayReady=="function"){try{efgrid_onGridDisplayReady(grid_table.parentNode);}catch(ex){efgrid.processException(ex,"Callback to efgrid_onGridDisplayReady failed");}}
efgrid_sum_handler(this);};efgrid.prototype.removeRow=function(row_index){if(row_index<0||row_index>=this.getRowCount()){alert("Illegal row index:["+row_index+"]");return;}
this.blockData.getRows().splice(row_index,1);this.rowStatus.splice(row_index,1);this._rowStyle.splice(row_index,1);};efgrid.removeSelectedRow=function(grid_id)
{var grid=efform.getGrid(grid_id);var count=grid.getCheckedRowCount();var checkedRows=grid.getCheckedRows();for(var i=0;i<count;i++)
{grid.removeRow(checkedRows[i]-i);}
grid.refresh();for(i=0;i<grid._rowStyle.length;i++)
{grid._rowStyle[i]="tableRow"+i%2;}};efgrid.prototype.isFixedColumn=function(name){for(var i=0;i<this.fixedColumns.length;i++){if(this.fixedColumns[i].customSetting.name==name){return true;}}
return false;};efgrid.prototype.xlsExportValue=function(eiinfo){eiinfo.addBlock(this.displayBlock);};efgrid.prototype.exportData=function(file_type){var eiinfo=new EiInfo();if(this.xlsExportMode==''){if(efgrid.config!=undefined&&efgrid.config.XLS_EXPORT_MODE!=undefined&&efgrid.config.XLS_EXPORT_MODE=="value"){this.xlsExportValue(eiinfo);}else{eiinfo.addBlock(this.getBlockData());}}else if(this.xlsExportMode=='value'){this.xlsExportValue(eiinfo);}else{eiinfo.addBlock(this.getBlockData());}
var export_form=document.forms["_eiExportForm"];if(export_form!=null)
document.body.removeChild(export_form);export_form=document.createElement("form");export_form.setAttribute("id","_eiExportForm");export_form.setAttribute("method","POST");export_form.setAttribute("target","_blank");export_form.setAttribute("action","export");var input_node=document.createElement("input");input_node.setAttribute("type","hidden");input_node.setAttribute("name","_eiExportFlag");input_node.setAttribute("value","true");export_form.appendChild(input_node);input_node=document.createElement("input");input_node.setAttribute("type","hidden");input_node.setAttribute("name","_eiExportFiletype");input_node.setAttribute("value",file_type);export_form.appendChild(input_node);input_node=document.createElement("input");input_node.setAttribute("type","hidden");input_node.setAttribute("name","_eiExportBlockname");input_node.setAttribute("value",this.blockId);export_form.appendChild(input_node);input_node=document.createElement("input");input_node.setAttribute("type","hidden");input_node.setAttribute("name","_eiExportData");input_node.setAttribute("value",EiInfo2Json.prototype.EiInfo2JsonString(eiinfo));export_form.appendChild(input_node);document.body.appendChild(export_form);export_form.submit();};efgrid.prototype.setToolBarPosition=function(pos){if(efgrid.config!=undefined&&efgrid.config.GRID_TOOLBAR_POSITION!=undefined){if(efgrid.config.GRID_TOOLBAR_POSITION=="top"||efgrid.config.GRID_TOOLBAR_POSITION=="bottom"){this.toolBarPosition=efgrid.config.GRID_TOOLBAR_POSITION;}}
if(pos=="bottom"||pos=="top"){this.toolBarPosition=pos;}};efgrid.prototype.setIsSubGrid=function(v){this.isSubGrid=v;};efgrid.prototype.isShowLineNumber=function(){var globalConfig=false;if(efgrid.config!=undefined&&efgrid.config.SHOW_LINE_NUMBER!=undefined&&efgrid.config.SHOW_LINE_NUMBER=="true"){globalConfig=true;}
if(this.getStyleSetting(STYLE_CONSTANT["SHOW_LINE_NUMBER"])==null)
return globalConfig;return this.getStyleSetting(STYLE_CONSTANT["SHOW_LINE_NUMBER"])=="true";};efgrid.prototype.isAutoHeight=function(){var globalConfig=false;if(efgrid.config!=undefined&&efgrid.config.AUTO_HEIGHT!=undefined&&efgrid.config.AUTO_HEIGHT=="true"){globalConfig=true;}
if(this.getStyleSetting(STYLE_CONSTANT["AUTO_HEIGHT"])==null)
return globalConfig;return this.getStyleSetting(STYLE_CONSTANT["AUTO_HEIGHT"])=="true";};

efpage=function(){};efpage.goFirst=function(grid_id){var grid=efform.getGrid(grid_id);grid.setOffset(0);efpage.submitMetadata(grid);};efpage.goPrevious=function(grid_id){var grid=efform.getGrid(grid_id);var offset=grid.getOffset();if(offset>0)
grid.setOffset(offset-grid.getLimit());efpage.submitMetadata(grid);};efpage.goNext=function(grid_id){var grid=efform.getGrid(grid_id);var offset=grid.getOffset();if((offset/grid.getLimit()+1)<grid.getTotalPageCount())
grid.setOffset(offset+grid.getLimit());efpage.submitMetadata(grid);};efpage.goLast=function(grid_id){var grid=efform.getGrid(grid_id);if(efgrid.config!=undefined&&efgrid.config.PAGE_SCOPE!=undefined&&grid.getCount()>efgrid.config.PAGE_SCOPE){alert(getI18nMessages("ef.OutOffPage","翻页超出"
+efgrid.config.PAGE_SCOPE+"条范围，请缩小操作范围！"));}else{grid.setOffset((grid.getTotalPageCount()-1)*grid.getLimit());efpage.submitMetadata(grid);}};efpage.limit=function(grid_id){var limit=$("#"+grid_id+"_limit")[0];var grid=efform.getGrid(grid_id);if(grid){grid.setOffset(0);grid.setLimit(eval(limit.options[limit.selectedIndex].value));efpage.submitMetadata(grid);}};efpage.jumpTo=function(grid_id){var jumpto=$("#"+grid_id+"_jumpto")[0];var topage=0;try{var validator=ef_validator_regexes["positive_integer"];if(validator.test(jumpto.value))
topage=eval(jumpto.value);}catch(exception){topage=0;}
var grid=efform.getGrid(grid_id);if(grid){if(topage<=0){alert(ef_validator_errormsg["positive_integer"]);}else{if(efgrid.config!=undefined&&efgrid.config.PAGE_SCOPE!=undefined&&(topage*grid.getLimit())>efgrid.config.PAGE_SCOPE){alert(getI18nMessages("ef.OutOffPage","翻页超出"
+efgrid.config.PAGE_SCOPE+"条范围，请缩小操作范围！"));}else{grid.setOffset((topage-1)*grid.getLimit());efpage.submitMetadata(grid);}}}};efpage.getCount=function(grid_id){var grid=efform.getGrid(grid_id);efpage.submitMetadata(grid);};efpage.newRecord=function(grid_id){var grid=efform.getGrid(grid_id);if(grid){var copy=false;if(typeof(efgrid_onAddNewRow)=="function"){try{if(efgrid_onAddNewRow(grid_id)===false)
return;}catch(ex){}}
var selcount=grid.getCheckedRowCount();if(selcount>0)
copy=confirm("["+selcount+"]"
+getI18nMessages("ef.GridRowsCopy","条记录被选中，将它们复制为新记录吗？"));grid.newLine(copy);if(typeof(efgrid_afterAddNewRow)=="function"){try{efgrid_afterAddNewRow(grid_id);}catch(ex){}}
grid.refresh();var grid_table=$("#"+grid_id+EF_SPLIT+"grid_table")[0];var dataDiv=efgrid.getDataDiv(grid_table);dataDiv.scrollTop=dataDiv.scrollHeight;var rows=grid.getCheckedRows();for(var i=0;i<rows.length;i++){if(grid.isNewLine(rows[i])){grid.cellOriginNodeType=TYPE_FIX;efgrid._shiftCell(grid,rows[i],0,2);break;}}}};efpage.setShowCount=function(grid_id){var count_check=$("#"+grid_id+"_count");var grid=efform.getGrid(grid_id);var showTotalTitle=getI18nMessages("ef.HideTotalCount","默认隐藏全部记录数，点击可打开");grid.setShowCount(!grid.getShowCount());if(!grid.getShowCount()){count_check.removeClass("ef-state-default");count_check.addClass("ef-state-disabled");efpage._disableNavButton(grid,"last");efform.setStatus(0,getI18nMessages("ef.FinishHideTotalCount","禁用显示全部记录数！"));grid.setCount(-1);}else{count_check.removeClass("ef-state-disabled");count_check.addClass("ef-state-default");showTotalTitle=getI18nMessages("ef.ShowTotalCount","默认显示全部记录数，点击可关闭");efpage.getCount(grid_id);}
count_check.attr("title",showTotalTitle);};efpage.submitMetadata=function(grid){efform.clearErrorMessage();var grid_ids=[];grid_ids.push(grid.gridId);efgrid._submitFormData(grid_ids,null,null,grid.queryMethod,false,true,false);};efpage._disableNavButton=function(grid,button_name){(function($,undefined){$('#'+grid.gridId+"_"+button_name).addClass('disabledNavButton').attr("onclick","efform.nullfunction");})(jQuery);}

efgrid.subcgrid=function(){}
efgrid.subcgrid.show=function(node,gridId){var grid=efgrid.getGridObject(gridId);var idStr=gridId+"_config_sub_div";subDiv=ef.get(idStr);var dialogTitle="Grid"+getI18nMessages("ef.GridConfig","配置信息");var button_json=[{text:getI18nMessages("ef.GridInit","初始化"),click:function(){efgrid.subcgrid._default(gridId);}},{text:getI18nMessages("ef.GridRefresh","刷新"),click:function(){efgrid.subcgrid._apply(gridId);}},{text:getI18nMessages("ef.GridSave","保存"),click:function(){efgrid.subcgrid.ensure(gridId);}}];if(null==subDiv||undefined==subDiv){subDiv=document.createElement("div");subDiv.id=idStr;subDiv.className="efwindow";subDiv.style.overflow="hidden";subDiv.style.display="none";var inner_html=[];inner_html.push("<div id=\"efgrid_config_sub_grid\" title='"+getI18nMessages("ef.GridConfig","配置信息")+"' style='overflow:hidden;width:500px;height:200px;'></div>");subDiv.innerHTML=inner_html.join('');document.body.appendChild(subDiv);}
var info=new EiInfo();var block=new EiBlock("result");info.addBlock(block);var blockMeta=new EiBlockMeta("result");var meta=new EiColumn("name");meta.descName=getI18nMessages("ef.GridColumnEname","列英文名");meta.pos=0;meta.width=120;meta.readonly=true;blockMeta.addMeta(meta);meta=new EiColumn("descName");meta.descName=getI18nMessages("ef.GridColumnName","列中文名");meta.pos=1;meta.width=100;blockMeta.addMeta(meta);meta=new EiColumn("isFix");meta.descName=getI18nMessages("ef.GridFixColumn","固定列")+"<input  type='checkbox' id='testcheck'  onclick=efgrid.subcgrid.setAllFix(this)>";meta.pos=2;meta.width=80;meta.readonly=true;blockMeta.addMeta(meta);meta=new EiColumn("isVisible");meta.descName=getI18nMessages("ef.GridVisibleColumn","可见列")+"<input  type='checkbox' id='testcheck'  onclick=efgrid.subcgrid.setAllVisible(this)>";meta.pos=3;meta.width=80;meta.readonly=true;blockMeta.addMeta(meta);meta=new EiColumn("width");meta.descName=getI18nMessages("ef.GridColumnWidth","列宽");meta.pos=4;meta.width=60;meta.validateType="nonnegative_integer";meta.nullable=false;blockMeta.addMeta(meta);block.setBlockMeta(blockMeta);meta=new EiColumn("canPersonal");meta.descName=getI18nMessages("ef.GridCanPersonal","能否个性化");meta.pos=5;meta.width=60;meta.visible=false;blockMeta.addMeta(meta);block.setBlockMeta(blockMeta);var _fixColCount=grid.getColCount(TYPE_FIX);var _dataColCount=grid.getColCount(TYPE_DATA);var _invisibleColCount=grid.getInvisibleColCount();var i=1;for(i=1;i<_fixColCount;i++){var column=grid.fixedColumns[i];block.setCell(i-1,"name",column.getEname());block.setCell(i-1,"descName",column.getCname());block.setCell(i-1,"isFix","true");block.setCell(i-1,"isVisible","true");block.setCell(i-1,"width",column.getWidth()+"");block.setCell(i-1,"canPersonal",column.canPersonal()+"");}
for(j=0;j<_dataColCount;j++){var column=grid.dataColumns[j];block.setCell(j+i-1,"name",column.getEname());block.setCell(j+i-1,"descName",column.getCname());block.setCell(j+i-1,"isFix","false");block.setCell(j+i-1,"isVisible","true");block.setCell(j+i-1,"width",column.getWidth()+"");block.setCell(j+i-1,"canPersonal",column.canPersonal()+"");}
var cpCount=0;for(h=0;h<_invisibleColCount;h++){var column=grid.invisibleColumns[h];if(!column.canPersonal()){cpCount++;continue;}
block.setCell(h+j+i-1-cpCount,"name",column.getEname());block.setCell(h+j+i-1-cpCount,"descName",column.getCname());block.setCell(h+j+i-1-cpCount,"isFix","false");block.setCell(h+j+i-1-cpCount,"isVisible","false");block.setCell(h+j+i-1-cpCount,"width",column.getWidth()+"");block.setCell(h+j+i-1-cpCount,"canPersonal",column.canPersonal()+"");}
var subGrid=new efgrid("result","efgrid_config_sub_grid");var custom_cols={"index":{},"metas":[]};subGrid.setEnable(true);subGrid.setReadonly(false);subGrid.setAjax(true);subGrid.setAutoDraw(true);subGrid.setServiceName("");subGrid.setQueryMethod("");subGrid.setCustomColumns(custom_cols);subGrid.setData(info);subGrid.setStyle({"navigationBar":"false","operationBar":"false"});subGrid.paint();efwindow.show(node,subDiv.id,"default",dialogTitle,button_json);};efgrid.subcgrid.setVisible=function(row_index,col_index,flage){var grid=efgrid.getGridObject("efgrid_config_sub_grid");if(flage){grid.setCellValue(row_index,col_index,"true",TYPE_DATA);grid.refreshCell(row_index,col_index,TYPE_DATA);}else{grid.setCellValue(row_index,col_index,"false",TYPE_DATA);grid.setCellValue(row_index,col_index-1,"false",TYPE_DATA);grid.refreshCell(row_index,col_index,TYPE_DATA);grid.refreshCell(row_index,col_index-1,TYPE_DATA);}}
efgrid.subcgrid.setAllVisible=function(node,gridId){var grid=efgrid.getGridObject("efgrid_config_sub_grid");rowCount=grid.getRowCount();for(var i=0;i<rowCount;i++){data=grid.getRowData(i);if(data["canPersonal"]=="true"){efgrid.subcgrid.setVisible(i,3,node.checked);}}}
efgrid.subcgrid.setAllFix=function(node,gridId){var grid=efgrid.getGridObject("efgrid_config_sub_grid");rowCount=grid.getRowCount();for(var i=0;i<rowCount;i++){data=grid.getRowData(i);if(data["canPersonal"]=="true"){efgrid.subcgrid.setFix(i,2,node.checked);}}}
efgrid.subcgrid.setFix=function(row_index,col_index,flage){var grid=efgrid.getGridObject("efgrid_config_sub_grid");if(flage){grid.setCellValue(row_index,col_index,"true",TYPE_DATA);grid.setCellValue(row_index,col_index+1,"true",TYPE_DATA);grid.refreshCell(row_index,col_index,TYPE_DATA);grid.refreshCell(row_index,col_index+1,TYPE_DATA);}else{grid.setCellValue(row_index,col_index,"false",TYPE_DATA);grid.refreshCell(row_index,col_index,TYPE_DATA);}}
efgrid.subcgrid._default=function(gridId){efwindow.hide();efgrid.subcgrid.deleteInfo(gridId);var grid=efgrid.getGridObject(gridId);grid.customCols=cloneObject(grid.originCustomCols);grid.dataColumnsSQ=null;grid.fixedColumnsSQ=null;grid.setData(grid.eiinfo);grid.paint();}
efgrid.subcgrid._apply=function(gridId){efgrid.subcgrid.ensure(gridId,true,true);}
efgrid.subcgrid.ensure=function(gridId,flage,isHide){var grid=efgrid.getGridObject(gridId);var subGrid=efgrid.getGridObject("efgrid_config_sub_grid");var message=subGrid.validateAll();if(message!=null&&message!=""){alert(message);return;}
if(!isHide)
efwindow.hide();var customCols=grid.customCols;var eiinfo=grid.eiinfo;var metas=grid.blockData.getBlockMeta().getMetas();grid.dataColumnsSQ=[];grid.fixedColumnsSQ=[];rowCount=subGrid.getRowCount();for(i=0;i<rowCount;i++){data=subGrid.getRowData(i);if(eval(data["isFix"])){grid.fixedColumnsSQ.push(data["name"]);}else if(eval(data["isVisible"])){grid.dataColumnsSQ.push(data["name"]);}
efgrid.subcgrid.setPersonalAttr(customCols,metas,data,gridId);}
if(!flage)
efgrid.subcgrid.saveInfo(subGrid.eiinfo,ef.get("efFormEname").value,gridId);grid.setData(eiinfo);grid.paint();}
efgrid.subcgrid.saveInfo=function(eiinfo,formEname,gridId){eiinfo.set("formEname",formEname);eiinfo.set("gridId",gridId);EiCommunicator.send("EDFA60","save",eiinfo,null,false);}
efgrid.subcgrid.setPersonalAttr=function(customCols,meta,data,gridId){var customIndex=customCols["index"]?customCols["index"]:{};var customMeta=customCols["metas"]?customCols["metas"]:[];var index=customIndex[data["name"]];var custom_setting=(index!==undefined)?customMeta[eval(index)]:meta[data["name"]];var grid=efgrid.getGridObject(gridId);var _origin=grid.originCustomCols;var _customIndex=_origin["index"]?_origin["index"]:{};var _customMeta=_origin["metas"]?_origin["metas"]:[];var _index=_customIndex[data["name"]];var _custom_setting=(_index!==undefined)?_customMeta[eval(_index)]:meta[data["name"]];if(custom_setting instanceof EiColumn){custom_setting.visible=eval(data["isVisible"]);custom_setting.primaryKey=eval(data["isFix"]);custom_setting.width=eval(data["width"]);customIndex[data["name"]]=customMeta.length;var _custom={};_custom["name"]=data["name"];_custom["primaryKey"]=eval(data["isFix"]);_custom["visible"]=eval(data["isVisible"]);_custom["width"]=eval(data["width"]);_custom["attr"]={"enable":true};_custom["pos"]=customMeta.length;_custom["descName"]=data["descName"];customMeta[customMeta.length]=_custom;}else if(!!custom_setting){custom_setting["primaryKey"]=eval(data["isFix"]);custom_setting["visible"]=eval(data["isVisible"]);custom_setting["width"]=eval(data["width"]);custom_setting["descName"]=data["descName"];if(data["isFix"]=="false"){custom_setting["displayType"]=_custom_setting["displayType"];}}}
efgrid.subcgrid.deleteInfo=function(gridId){var info=new EiInfo();info.setByNameValue("inqu_status-0-formEname",ef.get("efFormEname").value);info.setByNameValue("inqu_status-0-gridId",gridId);EiCommunicator.send("EDFA60","deleteInfo",info,null,false);}
efgrid.prototype.setPersonalColumns=function(custom_cols,eiinfo){var block=eiinfo.getBlock(this.blockId);var metas=block.getBlockMeta().getMetas();var info=new EiInfo();info.setByNameValue("inqu_status-0-formEname",ef.get("efFormEname").value);info.setByNameValue("inqu_status-0-gridId",this.gridId);EiCommunicator.send("EDFA60","queryInfo",info,null,false);if(null!=ajaxEi){blk=ajaxEi.getBlock("result");rowCount=blk.getRows().length;if(rowCount>0){this.dataColumnsSQ=[];this.fixedColumnsSQ=[];}
for(i=0;i<rowCount;i++){data=blk.getMappedObject(blk.rows[i]);if(eval(data["columnIsfix"])){this.fixedColumnsSQ.push(data["columnEname"]);}else if(eval(data["columnIsvisible"])){this.dataColumnsSQ.push(data["columnEname"]);}
_data={};for(var key in data){switch(key){case"columnEname":_data["name"]=data[key];break;case"columnCname":_data["descName"]=data[key];break;case"columnIsfix":_data["isFix"]=data[key];break;case"columnIsvisible":_data["isVisible"]=data[key];break;case"columnWidth":_data["width"]=data[key];break;default:break;}}
efgrid.subcgrid.setPersonalAttr(custom_cols,metas,_data,this.gridId);}}}
function cloneObject(jsonObj){var buf;if(jsonObj instanceof Array){buf=[];var i=jsonObj.length;while(i--){buf[i]=cloneObject(jsonObj[i]);}
return buf;}else if(jsonObj instanceof Object){buf={};for(var k in jsonObj){buf[k]=cloneObject(jsonObj[k]);}
return buf;}else{return jsonObj;}}

efgrid.prototype.addMenuItem=function(parent,data){var flage=false;for(var key in data){if(key=="imgSrc")
flage=true;}
if(!flage){data["imgSrc"]=efico.get("efgrid.frontBlank");}
this.menuData.addChild(parent,data);}
efgrid.headerRightMenu=function(){}
efgrid.headerRightMenu.show=function(event,data_type){var div_node=event.srcElement||event.target;if(div_node.tagName=="A")
div_node=div_node.parentNode;if(div_node.tagName!="DIV")return;var grid_node=efgrid.getEfGridNode(div_node);if(grid_node){var grid=grid_node.efgrid;if(!grid)return;var menuDiv=null;var menuDiv=ef.get("efgrid_rightMenu_div");if(menuDiv==undefined||menuDiv==null){menuDiv=document.createElement("DIV");menuDiv.className="ef-menu";menuDiv.style.width="60";}
var columnId=div_node.attributes["columnId"].value;menuDiv.innerHTML="<a class='ef-state-default' href='#' efgridid='"+grid.gridId+"' columnId='"+columnId+"' onclick='efgrid.headerRightMenu.onGroupLinkClick(event)'>"+"<span style='border:0;' class='ef-icon ef-icon-group'  ></span><span>分组</span></a>";var menu=menuDiv;menu.id="efgrid_rightMenu_div";document.body.appendChild(menu);menu.style.left=event.clientX;menu.style.top=event.clientY;menu.style.display="block";menu.style.visibility="visible";$("#efgrid_rightMenu_div").css({'top':event.clientY+'px','left':event.clientX+'px'}).width(65);document.body.onclick=function(){if(!!ef.get("efgrid_rightMenu_div"))
ef.get("efgrid_rightMenu_div").style.display="none";}}}
efgrid.headerRightMenu.onGroupLinkClick=function(event)
{var div_node=event.srcElement||event.target;if(div_node.tagName=="SPAN")
div_node=div_node.parentNode;if(div_node.tagName!="A")return;var columnId=div_node.attributes["columnId"].value;var gridId=div_node.attributes["efgridid"].value;var grid=efgrid.getGridObject(gridId);grid.groupField=columnId;grid.paint();}
efgrid.rightmenu=function(){}
efgrid.rightmenu.show=function(event,data_type){var div_node=event.srcElement||event.target;if(div_node.tagName=="A")
div_node=div_node.parentNode;if(div_node.tagName!="DIV")return;var grid_node=efgrid.getEfGridNode(div_node);if(grid_node){var grid=grid_node.efgrid;if(!grid)return;if(grid.frontSort==false)return;var not_cell=(div_node.getAttribute("efVal")==null);var row_index=0,col_index=0;if(!not_cell){var pos=efgrid.getCellPos(div_node);row_index=pos.row;col_index=pos.col;var divNode=ef.get("efgrid_rightMenu_div");if(!!divNode){divNode.parentNode.removeChild(divNode);}
var nMenu=new EFMenu(grid.menuData,"rightMenu","rightMenu");nMenu.hoverExpand=function(n){return true;}
nMenu.textClicked=function(node){var data=node.data();var menu_name="gridmenu_"+node.label()+"_onclick";if(eval("typeof "+menu_name)=="function"){eval(menu_name+"(\""+grid.gridId+"\",\""+node._label+"\","+row_index+","+col_index+","+data_type+"); ");}};nMenu._horizental=false;nMenu.render();var menu=nMenu._rootNode._jMenuDIV.get(0);menu.id="efgrid_rightMenu_div";document.body.appendChild(menu);$("#efgrid_rightMenu_div").css({'top':event.clientY+'px','left':event.clientX+'px'});document.body.onclick=function(){if(!!ef.get("efgrid_rightMenu_div"))
ef.get("efgrid_rightMenu_div").style.display="none";}}}}
gridmenu_ascending_onclick=function(gridId,label,row_index,col_index,data_type){var grid=efgrid.getGridObject(gridId);var eicolumn=grid.getColumn(col_index,data_type);efutils.sortGird(gridId,eicolumn.getEname(),"true");}
gridmenu_descending_onclick=function(gridId,label,row_index,col_index,data_type){var grid=efgrid.getGridObject(gridId);var eicolumn=grid.getColumn(col_index,data_type);efutils.sortGird(gridId,eicolumn.getEname(),"false");}

efgrid.prototype.isLazyLoad=function(){return this.lazyLoad;}
efgrid.prototype.setLazyLoad=function(v){this.lazyLoad=v;this.enable=false;this.ajax=false;this.readonly=true;this.frontSort=false;}
efgrid.prototype.isUseBuffer=function(){return this.useBuffer;}
efgrid.prototype.setUseBuffer=function(v){this.useBuffer=v;}
efgrid.prototype.getScrollDivNode=function(){return ef.get(this.gridId+EF_SPLIT+"scroll_div");}
efgrid.prototype.setDataFromBuffer=function(offset){if(!isAvailable(offset))
offset=0;offset=parseInt(offset);var limit=this.getLimit();var last_line_num=offset+limit-1;if(this.bufferRows[last_line_num]==null){var page_num=parseInt((last_line_num)/limit);this.loadRowsToBuffer(page_num);}
if(this.bufferRows[offset]==null){var page_num=parseInt((offset)/limit);this.loadRowsToBuffer(page_num);}
var rows=this.getBlockData().getRows();for(i=0;i<limit;i++)
rows[i]=this.bufferRows[offset+i];if(!this.isUseBuffer())
this.bufferRows=[];this.setOffset(offset);}
efgrid.prototype.loadRowsToBuffer=function(page_num){var grid_id=this.gridId;var info=new EiInfo();info.setByNodeObject(document.forms[0]);var block=info.getBlock(this.blockId);if(!isAvailable(block)){block=new EiBlock(this.getBlockData().getBlockMeta());info.addBlock(block);}
block.setAttr(this.getBlockData().getAttr());block.set("orderBy",this.getOrderBy());block.set("offset",page_num*this.getLimit());block.set("limit",this.getLimit());block.set("showCount",false);service_name=this.serviceName;method_name=this.queryMethod;EiCommunicator.send(service_name,method_name,info,{onSuccess:function(eiInfo){var ef_grid=efform.getGrid(grid_id);ef_grid.setBufferRows(page_num,eiInfo);ef_grid.setShowCount(true);},onFail:function(eMsg){alert("Error occured on call service: "+eMsg);}});}
efgrid.prototype.setBufferRows=function(page_num,ei_info){var ei_block=ei_info.getBlock(this.blockId);var offset=page_num*this.getLimit();var rows=ei_block.getRows();for(i=0;i<rows.length;i++){this.bufferRows[offset+i]=rows[i];}}
efgrid.prototype.onScroll=function(){var timestamp=new Date().getTime().toString();if(this.timer==null){ef.debug("[onScroll "+timestamp+"]start timer");this.timer=setInterval('var grid = efgrid.getGridObject( \"'+this.gridId+'\" );grid.onScrollTime();',500);this.scrollLastPos=this.getScrollDivNode().scrollTop;}else{ef.debug("[onScroll "+timestamp+"]do nothing");}}
efgrid.prototype.onScrollTime=function(){var timestamp=new Date().getTime().toString();var curPos=this.getScrollDivNode().scrollTop
if(this.scrollLastPos==curPos){ef.debug("[onScrollTime "+timestamp+"]stop timer, do job");clearInterval(this.timer);this.timer=null;this.setDataFromBuffer(this.calculateOffset());this.refresh();}else{ef.debug("[onScrollTime "+timestamp+"]do nothing");this.scrollLastPos=curPos;}}
efgrid.prototype.calculateOffset=function(){var scrollDiv=this.getScrollDivNode();var scrollHeight=scrollDiv.scrollHeight;var clientHeight=scrollDiv.clientHeight;var scrollTop=scrollDiv.scrollTop;var count=this.getCount();var limit=this.getLimit();if(count<=limit)
return 0;return parseInt((count-limit)*scrollTop/(scrollHeight-clientHeight));}
efgrid.prototype.getScrollTooltip=function(){return(this.calculateOffset()+1)+"/"+this.getCount();}
function wsug(e,str){var oThis=arguments.callee;if(!oThis.sug){var div=document.createElement('div'),css='top:0; left:0; position:absolute; z-index:100; visibility:hidden';div.style.cssText=css;div.setAttribute('style',css);var sug=document.createElement('div'),css='font:normal 12px/16px "宋体"; white-space:nowrap; color:#666; padding:3px; position:absolute; left:0; top:0; z-index:10; background:#f9fdfd; border:1px solid #0aa';sug.style.cssText=css;sug.setAttribute('style',css);var dr=document.createElement('div'),css='position:absolute; top:3px; left:3px; background:#333; filter:alpha(opacity=50); opacity:0.5; z-index:9';dr.style.cssText=css;dr.setAttribute('style',css);var ifr=document.createElement('iframe'),css='position:absolute; left:0; top:0; z-index:8; filter:alpha(opacity=0); opacity:0';ifr.style.cssText=css;ifr.setAttribute('style',css);div.appendChild(ifr);div.appendChild(dr);div.appendChild(sug);div.sug=sug;document.body.appendChild(div);oThis.sug=div;oThis.dr=dr;oThis.ifr=ifr;div=dr=ifr=sug=null;}
if(!str){oThis.sug.style.visibility='hidden';document.onmousemove=null;return;}
var e=e||window.event,obj=oThis.sug,dr=oThis.dr,ifr=oThis.ifr;obj.sug.innerHTML=str;var w=obj.sug.offsetWidth,h=obj.sug.offsetHeight,dw=document.documentElement.clientWidth||document.body.clientWidth;dh=document.documentElement.clientHeight||document.body.clientHeight;var st=document.documentElement.scrollTop||document.body.scrollTop,sl=document.documentElement.scrollLeft||document.body.scrollLeft;var left=e.clientX+sl+17+w<dw+sl&&e.clientX+sl+15||e.clientX+sl-8-w,top=e.clientY+st+17+h<dh+st&&e.clientY+st+17||e.clientY+st-5-h;obj.style.left=left+10+'px';obj.style.top=top+10+'px';dr.style.width=w+'px';dr.style.height=h+'px';ifr.style.width=w+3+'px';ifr.style.height=h+3+'px';obj.style.visibility='visible';document.onmousemove=function(e){var e=e||window.event,st=document.documentElement.scrollTop||document.body.scrollTop,sl=document.documentElement.scrollLeft||document.body.scrollLeft;var left=e.clientX+sl+17+w<dw+sl&&e.clientX+sl+15||e.clientX+sl-8-w,top=e.clientY+st+17+h<dh+st&&e.clientY+st+17||e.clientY+st-5-h;obj.style.left=left+'px';obj.style.top=top+'px';}}

efgrid.prototype.setSumType=function(v){this.sumType=v;};efgrid.prototype.getSumType=function(v){return this.sumType;};efgrid.prototype.needSum=function(){if(this.getSumType()!="none")
return true;if(this.getSumType()=="none"){for(i=0;column=this.fixedColumns[i++];){if(column.getSumType()!="none")
return true;}
for(i=0;column=this.dataColumns[i++];){if(column.getSumType()!="none")
return true;}}
return false;};efgrid.prototype.getRenderSumType=function(){if(this.getSumType()!="none"){return this.getSumType();}else if(this.getSumType()=="none"){var fixStr="";for(i=0;column=this.fixedColumns[i++];){if(column.getSumType()!="none")
fixStr+=column.getSumType();}
var dataStr="";for(i=0;column=this.dataColumns[i++];){if(column.getSumType()!="none")
dataStr+=column.getSumType();}
var str=dataStr+fixStr;if(str.indexOf("all")!=-1)
return"all";if(str.indexOf("page")!=-1&&str.indexOf("total")!=-1)
return"all";if(str.indexOf("page")!=-1&&str.indexOf("total")==-1)
return"page";if(str.indexOf("page")==-1&&str.indexOf("total")!=-1)
return"total";return"none";}};efgrid.divSum=function(){};efgrid.divSum.buildSumDiv=function(grid){var html=[];var col_count=grid.getColCount(TYPE_DATA);ef.debug("["+new Date().getTime().toString()+"]build sum row start.");var data_table_node=$("<table />").addClass('ef-grid-table ef-grid-dataTable').attr({'id':grid.gridId+EF_SPLIT+'sum_data_table','hidefocus':'','cellspacing':0,'cellpadding':0,'cols':col_count+1}).css('table-layout','fixed');var fix_table_node=$("<table />").addClass('ef-grid-table ef-grid-fixTable').attr({'id':grid.gridId+EF_SPLIT+'sum_fix_table','hidefocus':'','cellspacing':0,'cellpadding':0}).css('table-layout','fixed');var inner_html=[];var sum_data_div=$("<div />").css({'overflow':'hidden','width':grid.rightWidth+'px','height':grid.sumDivHeight+'px','overflowX':'hidden','overflowY':'hidden'}).attr('id',grid.gridId+EF_SPLIT+'sum_data_div');var fix_inner_html=[];var sum_fix_div=$("<div />").css({'overflow':'hidden','width':grid.leftWidth+'px','height':grid.sumDivHeight+'px','overflowX':'hidden','overflowY':'hidden'}).attr('id',grid.gridId+EF_SPLIT+'sum_fix_div');sum_fix_div.append(fix_table_node);sum_data_div.append(data_table_node);var _rowCount=grid.sumDivRowCount;var _colFixCount=grid.getColCount(TYPE_FIX);var _isEnable=grid.isEnable();for(var i=0;i<_rowCount;i++){var data_tr=$("<tr />").addClass('tableRow'+i);var fix_tr=$("<tr />").addClass('tableRow'+i);data_table_node.append(data_tr);fix_table_node.append(fix_tr);for(var j=0;j<col_count;j++){var column=grid.dataColumns[j];var renderType=efgrid.divSum.getColRenderType(grid,TYPE_DATA,j);var tdId=grid.gridId+"SumDataTd"+column.getEname();var col_str=$("<td />").attr({'id':tdId}).html(efgrid.divSum.genDisplayColumn(grid,i,j,TYPE_DATA,renderType));if(i==0)
{col_str.width(column.getWidth());}
data_tr.append(col_str);}
data_tr.append($("<td />").width(18).css('border-right','0px')).append($("<td />").css('border-left','0px').width('100%').append($("<div />").html('&nbsp;')));for(var j=0;j<_colFixCount;j++){var column=grid.fixedColumns[j];var renderType=efgrid.divSum.getColRenderType(grid,TYPE_FIX,j);var col_str=$("<td />").html(efgrid.divSum.genDisplayColumn(grid,i,j,TYPE_FIX,renderType));if(i==0)
{col_str.width(column.getWidth());}
fix_tr.append(col_str);}}
html[0]=$("<div />").append(sum_fix_div).html();html[1]=$("<div />").append(sum_data_div).html();return html;};efgrid.divSum.getColRenderType=function(grid,type,col_index){var column=grid.getColumn(col_index,type);if(column.eiColumn.type.toLowerCase()=="c")
return"none";if(grid.getSumType()!="none"&&column.eiColumn.type.toLowerCase()=="n"){return grid.getSumType();}else if(grid.getSumType()=="none"&&column.eiColumn.type.toLowerCase()=="n"){var customRenderType=column.getSumType();return customRenderType;}};efgrid.divSum._calculatePageSum=function(grid,colEname){var count=grid.getRowCount();var sum=0;var PN=1000000;var validator=ef_validator_regexes["number"];for(var i=0;i<count;i++){var cellValue=grid.blockData.getCell(i,colEname);if(validator.test(cellValue))
sum+=parseFloat(cellValue)*PN;}
return sum/PN;};efgrid.divSum.genDisplayColumn=function(grid,row_index,col_index,type,renderType){if(type==TYPE_FIX&&col_index==0){if(grid.getRenderSumType()=="all"){if(row_index==0){return"<div class='ef-cornerredius-all'  style='height:24px;padding:0px' efVal=''><div title='"+getI18nMessages("ef.GridSubTotal","小计")+"' class='ef-icon ef-icon-sum' /></div>";}else if(row_index==1){return"<div class='ef-cornerredius-all'  style='height:24px;padding:0px' efVal=''><div title='"+getI18nMessages("ef.GridSumTotal","总计")+"' class='ef-icon ef-icon-total' /></div>";}}else if(grid.getRenderSumType()=="total"){return"<div class='ef-cornerredius-all'  style='height:24px;padding:0px' efVal=''><div title='"+getI18nMessages("ef.GridSumTotal","总计")+"'  class='ef-icon ef-icon-total'  /></div>";}else if(grid.getRenderSumType()=="page"){return"<div class='ef-cornerredius-all'  style='height:24px;padding:0px' efVal=''><div title='"+getI18nMessages("ef.GridSubTotal","小计")+"'  class='ef-icon ef-icon-sum'  /></div>";}}
var column=grid.getColumn(col_index,type);var totalSum=grid.blockData.get("columnTotalSum");var colFmtStr=column.getFormatString();var colEname=column.getEname();if(renderType=="none"){sumValue="";}else if(renderType=="all"){if(row_index==0){sumValue=efgrid.divSum._calculatePageSum(grid,colEname);}else if(row_index==1){sumValue=!!totalSum?(!!totalSum[colEname]?totalSum[colEname]:""):"";}}else if(renderType=="page"){if(row_index==0){sumValue=efgrid.divSum._calculatePageSum(grid,colEname);}else if(row_index==1){sumValue="";}}else if(renderType=="total"){if(row_index==0){sumValue="";if(grid.sumDivRowCount==1)
sumValue=!!totalSum?(!!totalSum[column.getEname()]?totalSum[column.getEname()]:""):"";}else if(row_index==1){sumValue=!!totalSum?(!!totalSum[column.getEname()]?totalSum[column.getEname()]:""):"";}}
var displaySumValue=sumValue;if(colFmtStr!=null&&""!=sumValue){displaySumValue=efformat.formatFloat(sumValue,colFmtStr);}
var div_html="";var div_align=column.getAlign();if(div_align&&div_align!="left")
div_html="<div style='height:24px' efVal='' align='"+div_align+"'><b>"+displaySumValue+"</b></div>";else
div_html="<div style='height:24px' efVal=''><b>"+displaySumValue+"</b></div>";if(type==TYPE_DATA&&typeof(efgrid_onSumCellDisplayReady)=="function"){var customed=efgrid_onSumCellDisplayReady(div_html,row_index,col_index,sumValue,displaySumValue,grid.gridId,renderType);if(isAvailable(customed))
div_html=customed;}else if(type==TYPE_FIX&&typeof(efgrid_onSumFixCellDisplayReady)=="function"){var customed=efgrid_onSumFixCellDisplayReady(div_html,row_index,col_index,sumValue,displaySumValue,grid.gridId,renderType);if(isAvailable(customed))
div_html=customed;}
return div_html;};efgrid.divSum.resize=function(grid_node){var sumDataDiv=efgrid.getSumDataDiv(grid_node);var sumDataTable=sumDataDiv.firstChild;var grid=grid_node.efgrid;for(var j=0;j<grid.getColCount(TYPE_DATA);j++){if(sumDataTable.rows.length>0)
sumDataTable.rows[0].cells[j].width=grid.getColumn(j,TYPE_DATA).getWidth();}};efgrid.getSumDataDiv=function(grid_node){return $(grid_node).find("div:[id*='sum_data']")[0];};efgrid.getSumFixDiv=function(grid_node){return $(grid_node).find("div:[id*='sum_fix']")[0];};

efregion=function()
{};efregion.showTitle="yes";efregion.buttonBarPosition="bottom";efregion.showLostRegions=function()
{if($("form").length==0)return;$("form").children("div:[id*='ef_region_']").each(function(){if(!$(this).hasClass('ef-region-border')||$(this).hasClass(''))
{efregion.show($(this).attr("id"));}});};efregion.show=function(region_id)
{if(!$(document).data("ONCE"))
{$("div[id*=ef_region]").each(function(i,o)
{var id=$(o).attr("id").toLowerCase();$(o).attr("id",id);});$(document).data("ONCE",1);}
var region_node=$("#"+region_id);if(!region_node)return;if(region_node.hasClass("ef-region-border"))
{if(efregion.showTitle=="yes")
{$("#"+region_id+"_title").html(region_node.attr("title"));}
return;}
region_node.addClass("ef-region-content ef-region-border");if(!$.browser.msie||($.browser.msie&&$.browser.version>8))
region_node.addClass("ef-state-default");region_node.attr("efRegionShow","true");region_node.css({'overflow-y':'hidden','overflow-x':'auto'});var ef_div_head_id=region_id+EF_SPLIT+"head";if($("#"+ef_div_head_id).length>0)
return;ef_div_head=$("<div />");ef_div_head.attr({"id":ef_div_head_id,"align":"right"}).addClass("ef-region-head");region_node.prepend(ef_div_head);var position="bottom";if(efregion.buttonBarPosition=='')
{if(efregion.config!=undefined&&efregion.config.BUTTON_POSITION!=undefined)
position=efregion.config.BUTTON_POSITION;}
else
{position=efregion.buttonBarPosition;}
ef_table_head=$("<table/>");ef_table_head.addClass("ef-container-header").attr({'id':'containerOuter','width':'100%'});head_tr=$("<tr />").css('height','27px');head_tr.append("<td style='width:17px'>"+"<a id='"+region_id+"_toggle_img'  class='ef-state-default' "+"title=\""+getI18nMessages("ef.RunRegionFold","区域折叠")+"\" "+"href=\"javascript:efregion.toggleShow('"+region_id+"');\" "+">"+"<span class='ef-icon ef-icon-collapse'></span>"+"</a></td>");head_td1=$("<td />").css('text-align','left');head_span=$("<span />").addClass("ef-region-title").attr("id",region_id+"_title").html(region_node.attr("title"));ef_table_head.append(head_tr.append(head_td1.append(head_span)));var bntbarAlign=region_node.attr("efRegionButtonBarAlign");if(bntbarAlign!="left"&&bntbarAlign!="center")
bntbarAlign="right";if(position=="top")
{head_tr.append($("<td />").attr({"id":region_id+EF_SPLIT+"buttonbar"}).css('text-align',bntbarAlign));}
head_tr.append("<td style='text-align:right;'><div id='"+region_id+"_configMenuDiv"+"' class='ef-region-configMenuDiv' style='display: none'><a id='"+region_id+"_configMenu"+"' href='#'></a></div></td>");ef_div_head.append(ef_table_head);if(position=="bottom")
{var ef_div_tail=$("<div />").attr({"id":region_id+EF_SPLIT+"tail"}).css('text-align',bntbarAlign);ef_div_tail.append($("<div />").attr("id",region_id+EF_SPLIT+"buttonbar")).addClass("ef-region-footer");region_node.append(ef_div_tail);}
region_node.children().each(function(){var _div_id=this.id.toLowerCase();if((_div_id.indexOf("ef_grid")>=0)||(_div_id.indexOf("ef_tab")>=0)){region_node.removeClass("ef-region-data-content").addClass("ef-region-data-content");}
if($(this).is('div'))return;if($(this).hasClass('ef-region-footer'))return;$(this).addClass('ef-container-body');});if(efregion.showTitle=="no"){ef_div_head.css("display","none");}else{ef_div_head.css("display","block");}
addButtonEffect();$('#'+region_id+"_configMenu").addClass("ef-state-default").button({icons:{primary:"ef-icon ef-icon-gear",secondary:"ef-icon ef-icon-expand"},text:false}).click(function(event){$('#_efFormConfigMenu').children().hide();if(region_node.attr("efRegionShowClear")==="true"){$('#'+'_efRegionMenu_clear').button("enable");}else{$('#'+'_efRegionMenu_clear').button("disable");}
if(region_node.attr("efRegionSave")==="true"){$('#'+'_efRegionMenu_load').button("enable");$('#'+'_efRegionMenu_save').button("enable");}else{$('#'+'_efRegionMenu_load').button("disable");$('#'+'_efRegionMenu_save').button("disable");}
var configMenuObj=$('#efRegionConfigMenu');configMenuObj.children('div').each(function(){$(this).css('display','none');});if(configMenuObj.children('div[id='+region_id+'_CustomConfigMenu]').length>0)
{configMenuObj.children('div[id='+region_id+'_CustomConfigMenu]').css('display','block');;}
else
{configMenuObj.children('div[id=_efRegionConfigMenu]').css('display','block');}
var leftPos=event.clientX-configMenuObj.outerWidth();configMenuObj.css({top:event.clientY+"px",left:leftPos,position:"absolute"}).css("z-index","10").show().attr("efRegionId",region_id);$("body").click(function(){configMenuObj.hide();});return false;});$("#"+ef_div_head_id).find("a").css("border","none").addClass('ef-region-headerButton');$(document).ready(function(){$("#"+ef_div_head_id).hover(function(){$("#"+region_id).css("cursor","pointer");$("#"+region_id+"_configMenuDiv").parent().width(40);$("#"+region_id+"_configMenuDiv").slideDown(250,function(){$('div[id*=sumDataDivForFloat]').trigger('positionChanged');});},function(){$("#"+region_id).css("cursor","auto");$("#"+region_id+"_configMenuDiv").parent().width(0);$("#"+region_id+"_configMenuDiv").slideUp(250,function(){$('div[id*=sumDataDivForFloat]').trigger('positionChanged');});}).click(function(){efregion.toggleShow(region_id);return false;});});};efregion.customConfigMenu=function(region_id,option)
{$('#_efRegionConfigMenu').css('display','none');var configMenu=$('<div />').attr('id',region_id+'_CustomConfigMenu');$('#efRegionConfigMenu').append(configMenu);$.each(option,function(index,item)
{if(!item.id)
return;var customMenuId='_efRegionCustomMenu'+item.id;$('<a />').attr({'id':customMenuId,'herf':'#'}).wrap('<div />').parent().appendTo(configMenu);if(item.line)
{$("<div style='border-top:1px solid #BEBEBE;font-size:0;margin:10px 0;padding:0 10px'></div>").appendTo(configMenu);}
$('#'+customMenuId).addClass("ef-state-default").button({disabled:item.disabled,icons:{primary:"ef-icon "+item.icon},label:item.label}).click(function(event){if(item.params)
{var params=[];$.each(item.params,function(i,o){params.push(o);});item.func.apply(null,params);}
else
{item.func();}});});$("#efRegionConfigMenu").find("a").css("border","none");$("#efRegionConfigMenu").find("span").addClass('ef-region-configMenuSpan');};efregion.setTitle=function(sDivId,sTitle)
{ef.get(sDivId+"_title").innerText=sTitle;ef.get(sDivId+"_title").title=sTitle;};efregion.toggleShow=function(sDivId)
{if(efregion.showTitle=="no")
return;var sDiv=$("#"+sDivId);var region_show_status=sDiv.attr("efRegionShow");if(region_show_status==="true"){region_show_status="false";$('#'+sDivId+"_toggle_img span").removeClass().addClass('ef-icon ef-icon-expand');sDiv.children("div:gt(0)").each(function(){$(this).slideUp(250,function(){$('div[id*=sumDataDivForFloat]').trigger('positionChanged');});});sDiv.addClass("ef-region-expand");}else{region_show_status="true";$('#'+sDivId+"_toggle_img span").removeClass().addClass('ef-icon ef-icon-collapse');sDiv.children("div:gt(0)").each(function(){if($(this).children("table:[id*=ef_grid]").length>0&&$.browser.msie)
{$(this).show(250,function(){$('div[id*=sumDataDivForFloat]').trigger('positionChanged');});}
else
{$(this).slideDown(250,function(){$('div[id*=sumDataDivForFloat]').trigger('positionChanged');});}});sDiv.removeClass("ef-region-expand");}
sDiv.attr("efRegionShow",region_show_status);};efregion.loadQueryCondition=function(region_id){var component=$("#"+region_id+"_configMenu")[0];if(!component)
return;var div_node=efform.getSubDiv("ef_region_load");$("#ef_region_load").attr("regionId",region_id);var inner_html=[];inner_html.push("<TABLE cellspacing='2'  cellpadding='2' width='750px'>");inner_html.push("<TR>");inner_html.push("<TD align='left'  width='50%' >页面["+ef.get("efFormEname").value+"]定义的查询条件集");inner_html.push("<INPUT class='inputField' id='table_inqu_status-0-searchSeq' type='hidden' name='table_inqu_status-0-searchSeq' value='' />");inner_html.push("<INPUT class='inputField' id='inqu_status-0-pageNo' type='hidden' name='inqu_status-0-pageNo' value='"
+ef.get("efFormEname").value+"' />");inner_html.push("</TD>");inner_html.push("<TD align='right' width='50%'><div id = '"+region_id
+"_condition_query_buttonbar'></div></TD>");inner_html.push("</TR>");inner_html.push("<TR>");inner_html.push("<TD>");inner_html.push("<div id = '"
+region_id
+"_query_condition_master' style='overflow: hidden;height:350px;'/>");inner_html.push("</TD><TD>");inner_html.push("<div id = '"
+region_id
+"_query_condition_detail' style='overflow: hidden;height:350px;'/>");inner_html.push("<TR>");inner_html.push("</TABLE>");div_node.innerHTML=inner_html.join("");var __buttonbar=new efbuttonbar();__buttonbar.buttonCount=4;__buttonbar.buttonData=[["_efregion_condition_query",getI18nMessages("ef.Query","查询"),"1"],["_efregion_condition_load",getI18nMessages("ef.Load","载入"),"1"],["_efregion_condition_update",getI18nMessages("ef.Update","修改"),"1"],["_efregion_condition_delete",getI18nMessages("ef.Delete","删除"),"1"]];__buttonbar.paint(region_id+"_condition_query_buttonbar");var inInfo=new EiInfo();inInfo.setById("inqu_status-0-pageNo");inInfo.setById("table_inqu_status-0-searchSeq");EiCommunicator.send("EDSQ02","query",inInfo);if(ajaxEi==null){return;}
var __grid_result=new efgrid("result",region_id+"_query_condition_master");var custom_cols={"index":{"userId":0,"pageNo":1,"searchName":2,"searchSeq":3},"metas":[{"name":"userId","descName":"用户名","primaryKey":false,"readonly":true,"sumType":"none","sort":true,"attr":{"enable":true},"pos":0},{"name":"pageNo","descName":"页面号","primaryKey":false,"readonly":true,"sumType":"none","sort":true,"attr":{"enable":true},"pos":1},{"name":"searchName","descName":"查询条件名","primaryKey":false,"nullable":false,"sumType":"none","sort":true,"attr":{"enable":true},"pos":2},{"name":"searchSeq","descName":"查询名索引号","primaryKey":false,"visible":false,"sumType":"none","attr":{"enable":true},"pos":3}],"groupIndex":{},"columnGroups":[]};__grid_result.onRowClicked=function(grid_id,row_index){if(grid_id==region_id+"_query_condition_master"){grid=efgrid.getGridObject(region_id+"_query_condition_master");var searchSeq=grid.getCellValue(row_index,0,TYPE_DATA,true);ef.get("table_inqu_status-0-searchSeq").value=searchSeq;efgrid.submitInqu(region_id+"_query_condition_detail","ED","EDSQ02","getSearchInfo");}};__grid_result.setEnable(true);__grid_result.setReadonly(false);__grid_result.setAjax(true);__grid_result.setAutoDraw('no');__grid_result.setServiceName("");__grid_result.setQueryMethod("query");__grid_result.setCustomColumns(custom_cols);__grid_result.setData(ajaxEi);__grid_result.setStyle({"operationBar":"false","toolBar":"true"});__grid_result.paint();var __grid_result1=new efgrid("result1",region_id+"_query_condition_detail");var custom_cols={"index":{"elementId":0,"elementValue":1},"metas":[{"name":"elementId","descName":"元素ID","primaryKey":false,"readonly":true,"width":200,"sumType":"none","attr":{"enable":true},"pos":0},{"name":"elementValue","descName":"元素值","primaryKey":false,"readonly":true,"sumType":"none","attr":{"enable":true},"pos":1}],"groupIndex":{},"columnGroups":[]};__grid_result1.setEnable(true);__grid_result1.setReadonly(false);__grid_result1.setAjax(true);__grid_result1.setAutoDraw('no');__grid_result1.setServiceName("");__grid_result1.setQueryMethod("getSearchInfo");__grid_result1.setCustomColumns(custom_cols);__grid_result1.setData(ajaxEi);__grid_result1.setStyle({"operationBar":"false","toolBar":"true"});__grid_result1.paint();efwindow.show(component,div_node.id,"fixed");};efregion.saveQueryCondition=function(region_id){var component=$("#"+region_id+"_configMenu")[0];if(!component)return;var div_node=efform.getSubDiv("ef_region_save");$("#ef_region_save").attr("regionId",region_id);var inner_html=[];inner_html.push("<TABLE cellspacing='0'  cellpadding='1'>");inner_html.push("<TR>");inner_html.push("<TD align='left'  >请输入页面["+ef.get("efFormEname").value+"]预定义的查询条件集名称");inner_html.push("</TR>");inner_html.push("<TR><TD>");inner_html.push("<DIV style='overflow:auto;height:25;width:150'><input type='text' id='"+region_id+"_iplat4jSName' name='"+region_id+"iplat4jSName' value='' class='inputField' /></DIV>");inner_html.push("</TD></TR>");inner_html.push("<TR>");inner_html.push("<TD align='right' width='50%'><div id = '"+region_id+"_condition_save_buttonbar'></div></TD>");inner_html.push("</TR>");inner_html.push("</TABLE>");div_node.innerHTML=inner_html.join("");var __buttonbar=new efbuttonbar();__buttonbar.buttonCount=1;__buttonbar.buttonData=[["_efregion_condition_save",getI18nMessages("ef.Save","保存"),"1"]];__buttonbar.paint(region_id+"_condition_save_buttonbar");efwindow.show(component,div_node.id,"fixed");};button__efregion_condition_query_onclick=function()
{var region_id=$("#ef_region_load").attr("regionId");efgrid.submitInqu(region_id+"_query_condition_master","ed","EDSQ02","query");};button__efregion_condition_load_onclick=function()
{var region_id=$("#ef_region_load").attr("regionId");efregion.efregion_load_onclick(region_id);};button__efregion_condition_update_onclick=function()
{var region_id=$("#ef_region_load").attr("regionId");efgrid.submitInqu(region_id+"_query_condition_master","ed","EDSQ02","update");};button__efregion_condition_delete_onclick=function()
{var region_id=$("#ef_region_load").attr("regionId");efgrid.submitInqu(region_id+"_query_condition_master","ed","EDSQ02","delete");};button__efregion_condition_save_onclick=function()
{var region_id=$("#ef_region_save").attr("regionId");efregion.efregion_save_onclick(region_id);};efregion.efregion_save_onclick=function(region_id)
{var iplat4jSName=$("#"+region_id+"_iplat4jSName")[0].value;if(iplat4jSName.trim()=='')
{alert("请输入查询条件名");return;}
var info=new EiInfo();info.setByNode(region_id);info.set("iplat4jSName",iplat4jSName);var efFormEname=ef.get("efFormEname").value;info.set("efFormEname",efFormEname);EiCommunicator.send("EDSQ01","saveQuery",info,efregion.efregion_save_callback,false,true);efwindow.hide();};efregion.efregion_save_callback={onSuccess:function(eiInfo){var info=eiInfo.get("info");if(info=='update')
alert("修改查询条件成功");else if(info=='insert')
alert("新增查询条件成功");},onFail:function(eMsg){alert("failure");}};efregion.efregion_load_onclick=function(region_id){var grid=efgrid.getGridObject(region_id+"_query_condition_master");var num=grid.getCheckedRowCount();if(num>1){alert("只能选择一个查询条件");}else if(num<1){alert("请选择查询条件");}else if(num==1){var rows=grid.getCheckedRows();var searchSeq=grid.getCellValue(rows[0],0,TYPE_DATA,true);var info=new EiInfo();info.set("searchSeq",searchSeq);efregion.efregion_load_callback.region_id=region_id;EiCommunicator.send("EDSQ02","getSearch",info,efregion.efregion_load_callback,false,true);efwindow.hide();}};efregion.efregion_load_callback={onSuccess:function(eiInfo){efform.fillDiv(this.region_id,eiInfo,true);},onFail:function(eMsg){alert("failure");}};

eftab=function(){};eftab.show=function(tab_id,action){var jqTab=$("#"+tab_id).addClass("ef-tab-border ef-tab-content");jqTab.attr("Callback",action);jqTab.attr("CallbackIndex","0");var _scroll=(jqTab.attr("scroll")=="true");var _tabWidthSame=(jqTab.attr("tabWidthSame")=="true");var tabDivs=jqTab.children("div");var tabs=[];tabDivs.each(function(index,tabDiv){var _id=$(tabDiv).attr("id");var _title=$(tabDiv).attr("title");var _frmSrc=$(tabDiv).attr("eftabSrc");var _html=$(tabDiv).html();var _newFrame=$(tabDiv).attr("efRemember");var _share=(_newFrame=="yes");var _height=$(tabDiv).attr("eftabHeight");var _switchAffterCallBack=$(tabDiv).attr("switchAffterCallBack");if(_height==null){_height="100%";}
var item={switchAffterCallBack:_switchAffterCallBack,id:_id,title:_title,closed:false,icon:'',domNode:tabDiv,load:_frmSrc,height:_height,share:_share,callback:function(item){return eftab.click(tab_id,item);}};item.index=index;tabs.push(item);$(tabDiv).detach();});var width=jqTab.attr("eftabWidth");if(width==null){if(_scroll){width=jqTab.width();}else{width="100%";}}
var tabCtl=jqTab.Tab({items:tabs,width:width,tabcontentWidth:width,tabScroll:_scroll,tabWidth:80,tabHeight:35,tabScrollWidth:10,tabClassDiv:'benma_ui_tab',tabClass:'benma_ui_tab_div',tabClassClose:'tab_close',tabClassOn:'tab_item',tabClassInner:'tab_item',tabClassInnerLeft:'tab_item1',tabClassInnerMiddle:'tab_item2',tabClassInnerRight:'tab_item3',tabClassText:'text',tabClassScrollLeft:'scroll-left',tabClassScrollRight:'scroll-right',tabWidthSame:_tabWidthSame});tabCtl.setDivNode(jqTab);jqTab.data("TabCtrl",tabCtl);jqTab.attr("CallbackIndex","1");return tabCtl;};eftab.click=function(tab_id,item){var jqTab=$("#"+tab_id);var jqDom=jqTab.get(0);var prevNode=jqTab.data("NowNode");jqTab.data("PrevNode",prevNode);jqTab.data("NowNode",item);var cf=jqDom.getAttribute("Callback");var index=jqDom.getAttribute("CallbackIndex");if(index=="0")
return;if(cf!=null){try{var func=eval(cf)(prevNode.length>0?prevNode.index:-1,item.index);if(func!=false){eftab_getSrc(item,jqDom);}
return func;}catch(exception){eftab_getSrc(item,jqDom);var sError="";for(var i in exception)
sError+=i+":"+exception[i]+"\n";}}else{eftab_getSrc(item,jqDom);}};function eftab_getSrc(item,jqDom){if((!!item.load&&item.load.length>0)&&!item.share){var tab_item=$("#"+item.id,jqDom);var _src=tab_item.attr("eftabSrc");if(!!_src){item.load=_src;}}};function eftab_hidden(tab_id,index){var jqTab=$("#"+tab_id);var tabCtrl=jqTab.data("TabCtrl");return tabCtrl.hideItem(index);};function eftab_show(tab_id,index){var jqTab=$("#"+tab_id);var tabCtrl=jqTab.data("TabCtrl");return tabCtrl.showItem(index);};function eftab_current(tab_id){return efRoundIframeGetDestinationIndex(tab_id);};function efRoundDivTabChange_option(tab_id,index,action){var dstIdx=efRoundIframeGetDestinationIndex(tab_id);var jqTab=$("#"+tab_id);var tabCtrl=jqTab.data("TabCtrl");if(action!=null)
{if(action(dstIdx,index)==false)
{return;}}
tabCtrl.clickTab(index,true);}
function efRoundIframechange_option(tab_id,index,action){var dstIdx=efRoundIframeGetDestinationIndex(tab_id);var jqTab=$("#"+tab_id);var tabCtrl=jqTab.data("TabCtrl");if(action!=null)
if(action(dstIdx,index)==false)
return;setEfTabSrcWithIframe(jqTab,index);tabCtrl.clickTab(index,true);}
function setEfTabSrcWithIframe(jqTab,index){var tabCtrl=jqTab.data("TabCtrl");var _item=tabCtrl.getItemWithNum(index);if((_item.load!=null||_item.load.length>0)&&!_item.share){var _src=getEfTabDivAttr(jqTab,_item.id,"eftabSrc");if(!!_src){_item.load=_src;var prevNode=jqTab.data("NowNode");jqTab.data("PrevNode",prevNode);jqTab.data("NowNode",_item);}}}
function getEfTabDivAttr(jqTab,_id,_attr){var tab_item=$("#"+_id,jqTab);return tab_item.attr(_attr);}
function efRoundIframeGetIframe(tab_id,currentIndex){var jqTab=$("#"+tab_id);if(currentIndex==-1){var prevnode=jqTab.data("PrevNode");if(!!prevnode)
currentIndex=prevnode.index;}
var tabCtrl=jqTab.data("TabCtrl");return tabCtrl.getIframe(currentIndex);}
function efRoundIframeGetSourceIndex(tab_id){var prevNode=$("#"+tab_id).data("NowNode");if(prevNode.length>0)
return prevNode.index;return-1;}
function efRoundIframeGetDestinationIndex(tab_id){var prevNode=$("#"+tab_id).data("NowNode");return prevNode.index;}
function eftab_ReloadIframeWithoutNum(tab_id,_num,_path){var jqTab=$("#"+tab_id);var tabCtrl=jqTab.data("TabCtrl");var _item=tabCtrl.getItemWithNum(_num);_item.load=_path;}
function eftab_ReloadIframeWithId(tab_id,_id,_path){var jqTab=$("#"+tab_id);var tabCtrl=jqTab.data("TabCtrl");var _item=tabCtrl.getItemWithId(_id);_item.load=_path;}
function eftab_GetIframeIndexById(tab_id,_id){var jqTab=$("#"+tab_id);var tabCtrl=jqTab.data("TabCtrl");var _item=tabCtrl.getItemWithId(_id);return _item?(_item.index?_item.index:_item.dom.index()):-1;}

function EFTreeTemplate(sModel,sLabel,sText){this._model=sModel;this._label=sLabel;this._text=sText;this._depth=null;}
EFTreeTemplate.prototype.depth=function(v){if(v===undefined){return this._depth;}
this._depth=v;};EFTreeTemplate.prototype.getNode=function(lb){var l=new Array();var tlb=lb;l.push(tlb);do{var p=this._model.getParent(tlb);if(p!=null){tlb=p.label;l.push(p.label);}}while(p!=null);var nd=l.pop();var node=this._rootNode;while(nd!=undefined){node=node.getChildNode(nd);nd=l.pop();}
return node;};EFTreeTemplate.prototype.render=function(){};function EFTTNode(sTree,sParent,sLabel,sText,sLeaf,sData){this._tree=sTree;this._parent=sParent;this._label=sLabel;this._text=sText;this._leaf=sLeaf;this._data=sData;this._opened=false;this._childNodes=[];this._status=-1;}
EFTTNode.prototype.label=function(v){if(v===undefined){return this._label;}
this._label=v;};EFTTNode.prototype.text=function(v){if(v===undefined){return this._text;}
this._text=v;};EFTTNode.prototype.leaf=function(v){if(v===undefined){return this._leaf;}
this._leaf=v;};EFTTNode.prototype.data=function(v){if(v===undefined){return this._data;}
this._data=v;};EFTTNode.prototype.open=function(v){if(v===undefined){return this._opened;}
this._opened=v;};EFTTNode.prototype.status=function(){return this._status;};EFTTNode.prototype.parent=function(){return this._parent;};EFTTNode.prototype.tree=function(){return this._tree;};EFTTNode.prototype.top=function(){return(this._parent==null);};EFTTNode.prototype.virtual=function(){return(this._label==null);};EFTTNode.prototype.depth=function(){var depth=0;var treeItem=this;while(!treeItem.top()){depth++;treeItem=treeItem._parent;}
return depth;};EFTTNode.prototype.addChild=function(sNode){this._childNodes.push(sNode);};EFTTNode.prototype.getChildNodes=function(){var td=this._tree.depth();if(td!=null&&td<this.depth()+1){return new Array();}
this.load();return this._childNodes;};EFTTNode.prototype.getChildNode=function(lb){var children=this.getChildNodes();for(var i=0;i<children.length;i++){var child=children[i];if(child.label()===lb){return child;}}
return null;};EFTTNode.prototype.load=function(force){if(force||this._status===-1){this._status=0;this._childNodes=new Array();var children=new Array();if(this._label===null){children=this.tree()._model.getTopNodes(this.tree());}else{children=this.tree()._model.getChildren(this._label,this.tree());}
for(var i=0;i<children.length;i++){var sub=this._createChildNode(children[i]);this._childNodes.push(sub);}
this._status=1;}};EFTTNode.prototype._createChildNode=function(child){alert("_createChildNode NOT implemented");};EFTTNode.prototype.expand=function(){this._opened=true;this.load();this.render();};EFTTNode.prototype.collapse=function(){this._opened=false;this.render();};EFTTNode.prototype.render=function(){alert("render NOT implemented");};

function treeModel(){this.listerners=[];}
treeModel.prototype.getTopNodes=function(){};treeModel.prototype.getChildren=function(p){};treeModel.prototype.getParent=function(p){alert('getParent NOT implemented');};treeModel.prototype.addListener=function(l){this.listerners.push(l);};treeModel.prototype.notify=function(e,param){for(var i in this.listerners){var l=this.listerners[i];l.accept(e,param);}};function eiTreeModel(s,n){this.queryBlockName="inqu_status";this.resultBlockName="result";this.methodQuery="query";this.keyOffset="offset";this.keyCount="limit";this.base=treeModel;this.base();this.service=s;this.nodeLabel=n;this._cache={};this._status=0;};eiTreeModel.prototype=new treeModel();eiTreeModel.prototype.getTopNodes=function(tree){return this.getChildren("$",tree);};eiTreeModel.prototype.status=function(v){if(v===undefined){return this._status;}
this._status=v;}
eiTreeModel.prototype.getChildren=function(p,tree){var cached=this._cache[p];var treeModel=this;if(isAvailable(cached)){return cached;}
var host=this;var queryCallBack={onSuccess:function(ei){host.status(0);var blocks=ei.getBlocks();for(var name in blocks){var _block=blocks[name];var rows=_block.getMappedRows();host._cache[name]=rows;}},onFail:function(xmlR,status,e){host.status(-1);if(status!=-2)
alert("ERROR");}};var queryMeta=new EiBlockMeta(this.queryBlockName);var column=new EiColumn("node");column.pos=0;queryMeta.addMeta(column);var queryBlock=new EiBlock(queryMeta);queryBlock.addRow([p+""]);var blocka=new EiBlock(this.resultBlockName);var eiinfo=new EiInfo();if(tree&&tree.param!=null)
{eiinfo.extAttr.param=tree.param;}
eiinfo.addBlock(queryBlock);eiinfo.addBlock(blocka);EiCommunicator.send(this.service,this.methodQuery,eiinfo,queryCallBack,false,null,true);var ret=this._cache[p];if(isAvailable(ret)){delete this._cache[p];return ret;}else{return new Array();}};eiTreeModel.prototype.getParent=function(p){var ret=null;var host=this;var queryCallBack={onSuccess:function(ei){host.status(0);var block=ei.getBlock(p);if(block!=null){var rows=block.getMappedRows();ret=rows[0];}},onFail:function(msg){host.status(-1);if(status!=-2)
alert("ERROR");}};var queryMeta=new EiBlockMeta(this.queryBlockName);var column=new EiColumn("node");column.pos=0;queryMeta.addMeta(column);var queryBlock=new EiBlock(queryMeta);queryBlock.addRow([p+""]);var blocka=new EiBlock(this.resultBlockName);var eiinfo=new EiInfo();eiinfo.addBlock(queryBlock);eiinfo.addBlock(blocka);EiCommunicator.send(this.service,"queryParent",eiinfo,queryCallBack,false,null,true);return ret;};function tagTreeModel(loc){this.resultBlockName="result";this.base=treeModel;this.base();this._loc=loc;this.idK="label";this.parentK="parent";this._parentC={};this._status=0;};tagTreeModel.prototype=new treeModel();tagTreeModel.prototype.status=function(v){if(v===undefined){return this._status;}
this._status=v;}
tagTreeModel.prototype.getTopNodes=function(){return this.getChildren("$");};tagTreeModel.prototype.getChildren=function(p){var ret=new Array();var host=this;var queryCallBack={onSuccess:function(ei){host.status(0);var _block=ei.getBlock(p);if(_block!=null){ret=_block.getMappedRows();}},onFail:function(msg){host.status(-1);if(status!=-2)
alert("ERROR");}};EiCommunicator.$send(this._loc+"&PARTNUMBER="+p,"",queryCallBack);return ret;};tagTreeModel.prototype.getParent=function(p){var host=this;var cached=this._parentC[p];if(isAvailable(cached)){return cached;}
var queryCallBack={onSuccess:function(ei){host.status(0);var blocks=ei.getBlocks();for(var _n in blocks){var _block=blocks[_n];var rows=_block.getMappedRows();if(isAvailable(rows[0])){host._parentC[_n]=rows[0];}}},onFail:function(msg){host.status(-1);if(status!=-2)
alert("ERROR");}};EiCommunicator.$send(this._loc+"&PARENT=true&PARTNUMBER="+p,"",queryCallBack);return this._parentC[p];};function xmlTreeModel(s){this.base=treeModel;this.base();this.nodes={};this.parseXML(s);this._status=0;};xmlTreeModel.prototype=new treeModel();xmlTreeModel.prototype.status=function(v){if(v===undefined){return this._status;}
this._status=v;}
xmlTreeModel.prototype.getTopNodes=function(){return this.getChildren("");};xmlTreeModel.prototype.getChildren=function(p){var cached=this.nodes[p];if(isAvailable(cached)){return cached;}
var em=new Array();return em;};xmlTreeModel.prototype.addChild=function(p,node){var children=this.getChildren(p);children.push(node);this.nodes[p]=children;};xmlTreeModel.prototype.parseXML=function(sSrc){var oXmlDoc=null;if(window.ActiveXObject){oXmlDoc=new ActiveXObject("Microsoft.XMLDOM");oXmlDoc.async="true";oXmlDoc.loadXML(sSrc);}else{var parser=new DOMParser();oXmlDoc=parser.parseFromString(sSrc,"text/xml");}
var root=oXmlDoc.documentElement;this._parseXMLNode("",root);};xmlTreeModel.prototype._parseXMLNode=function(p,oNode){var cs=oNode.childNodes;var len=cs.length;for(var i=0;i<len;i++){var oNode=cs[i];if(oNode.tagName=="tree"){var tNode={};for(var k=0;k<oNode.attributes.length;k++){var l=oNode.attributes[k].nodeName;var v=oNode.attributes[k].nodeValue;tNode[l]=v;}
this.addChild(p,tNode);this._parseXMLNode(tNode["label"],oNode);}}};function absTreeModel(){this.base=treeModel;this.base();this.childs={};this.nodes={};};absTreeModel.prototype=new treeModel();absTreeModel.prototype.getTopNodes=function(){return this.getChildren("");};absTreeModel.prototype.getChildren=function(p){var cached=this.childs[p];if(isAvailable(cached)){return cached;}
var em=new Array();return em;};absTreeModel.prototype.getParent=function(m){var nd=this.nodes[m];if(nd!=null){var p=this.nodes[nd.parent];return p;}
return null;};absTreeModel.prototype.addChild=function(p,node){var children=this.getChildren(p);children.push(node);this.childs[p]=children;this.nodes[node.label]=node;};

EFMenuImagePath=EF_IMAGES_PATH;var EFMenuConfig={nextIcon:efico.get("efmenu.arrowRight"),disabledNextIcon:efico.get("efmenu.arrowRight2"),downIcon:efico.get("efmenu.arrowDown"),delay:500,useHover:false,onTextClick:false};function EFMenu(sModel,sLabel,sText){this.base=EFTreeTemplate;this.base(sModel,sLabel,sText);this._horizental=true;this._width=100;this._rootNode=null;this._selected=null;this._showTimeout=null;this._hideTimeout=null;this.textClicked=null;this.hoverExpand=null;this.menuItemClicked=null;}
EFMenu.prototype=new EFTreeTemplate();EFMenu.prototype.width=function(v){if(v==undefined){return this._width;}
this._width=v;}
EFMenu.prototype.render=function(){if(this._rootNode==null){this._rootNode=new EFMenuItem(this,null,null,this._text,false,null);this._rootNode._opened=true;}
return this._rootNode._renderSubMenu(this._horizental);}
EFMenu.prototype.setSelected=function(node){this._selected=node;}
function EFMenuItem(sTree,sParent,sLabel,sText,sLeaf,sData){this.base=EFTTNode;this.base(sTree,sParent,sLabel,sText,sLeaf,sData);this._horizental=false;this._userHover=this._getUserHover();this._jItemDIV=null;this._jMenuDIV=null;this._needRender=true;}
EFMenuItem.prototype=new EFTTNode();EFMenuItem.prototype._getUserHover=function(){var menu=this.tree();if(menu.hoverExpand!=null){var u=menu.hoverExpand(this);if(isAvailable(u)){return u;}}
return EFMenuConfig.useHover;}
EFMenuItem.prototype._onTextClick=function(){var menu=this.tree();if(menu.menuItemClicked!=null){var c=menu.menuItemClicked(this);if(isAvailable(c)){return c;}}
return EFMenuConfig.onTextClick;}
EFMenuItem.prototype.onTextClicked=function(){var menu=this.tree();if(this._parent._parent==null)
{if(menu.menuItemClicked!=null){menu.menuItemClicked.removeClass('ef-menu-bar-onTextClicked');}
$(this).removeClass();$(this._jItemDIV).addClass('ef-menu-bar-onTextClicked');menu.menuItemClicked=this._jItemDIV;}
else if(this.leaf()){var rootNode=this._parent;while(rootNode._parent._parent!=null){rootNode=rootNode._parent;}
if(menu.menuItemClicked!=null){menu.menuItemClicked.removeClass('ef-menu-bar-onTextClicked');}
$(rootNode).removeClass();$(rootNode._jItemDIV).addClass('ef-menu-bar-onTextClicked');menu.menuItemClicked=rootNode._jItemDIV;}
if(!this._userHover){if(this._opened){this.collapse();}else{this.expand();}}
if(menu.textClicked!=null){menu.textClicked(this);}}
EFMenuItem.prototype.onMouseOver=function(){var menu=this.tree();menu.setSelected(this);if(this._userHover){this.expand();}}
EFMenuItem.prototype.onMouseOut=function(){var menu=this.tree();if(this._userHover){var host=menu._rootNode;menu._hideTimeout=window.setTimeout(function(){host.collapse();},EFMenuConfig.delay);}}
EFMenuItem.prototype.collapse=function(){this._needRender=this._opened;this._hidesubs();if(this._label!=null){this._opened=false;this.render();}}
EFMenuItem.prototype.expand=function(){var menu=this.tree();if(menu._showTimeout!=null)window.clearTimeout(menu._showTimeout);if(menu._hideTimeout!=null)window.clearTimeout(menu._hideTimeout);this.load();if(this._label!=null){if(this._parent instanceof EFMenuItem)
this._parent._hidesubs();this._needRender=this._opened?false:true;this._opened=true;this.render();}}
EFMenuItem.prototype._hidesubs=function(){for(var i=0;i<this._childNodes.length;i++){var _node=this._childNodes[i];_node.collapse();}}
EFMenuItem.prototype._createChildNode=function(child){return new EFMenuItem(this.tree(),this,child['label'],child['text'],child['leaf']=="1",child);}
EFMenuItem.prototype._renderSubMenu=function(hor){var horizental=hor|false;var menu=this.tree();var children=this.getChildNodes();if(children.length>0){if(this._jMenuDIV==null){this._jMenuDIV=$("<div>");if(horizental){this._jMenuDIV.toggleClass("ef-menu-bar");var instance=this;this._jMenuDIV.mouseover(function(){instance.menuOnMouseOver();});this._jMenuDIV.mouseout(function(){instance.menuOnMouseOut();});}else{this._jMenuDIV.toggleClass("ef-menu");}
this._jMenuDIV.css("visibility","visible");for(var i=0;i<children.length;i++){var child=children[i];child._horizental=horizental;this._jMenuDIV.append(child.render());}}
return this._jMenuDIV.get(0);}else{return null;}}
EFMenuItem.prototype.menuOnMouseOver=function(){this._jMenuDIV.addClass("ef-menu-hover");}
EFMenuItem.prototype.menuOnMouseOut=function(){this._jMenuDIV.removeClass("ef-menu-hover");}
EFMenuItem.prototype.render=function(){var renderAsLeaf=this._leaf;if(this._jItemDIV==null){this._jItemDIV=$("<a href='#' style=''/>");var instance=this;this._jItemDIV.click(function(){instance.onTextClicked();});this._jItemDIV.mouseover(function(){instance.onMouseOver();});this._jItemDIV.mouseout(function(){instance.onMouseOut();});var imgSrc;if(!!this.data()&&!!this.data()["imgSrc"])
imgSrc="<img style='border:0 ' src="+this.data()["imgSrc"]+">&nbsp;&nbsp;";if(renderAsLeaf){this._jItemDIV.html((!!imgSrc?imgSrc:"")+this._text);}else{if(this._horizental){var _h=this._text+"&nbsp;&nbsp;<img class='arrow' src=\""+EFMenuConfig.downIcon+"\" align='absmiddle'>";this._jItemDIV.html(_h);}else{var _h="<img class='arrow' src=\""+EFMenuConfig.nextIcon+"\" align='absmiddle'>"+
(!!imgSrc?imgSrc:"")+this._text;this._jItemDIV.html(_h);}}}
if(renderAsLeaf||!this._needRender){return this._jItemDIV.get(0);}
if(this._opened){var divElement=this._renderSubMenu();if(divElement!=null){document.body.appendChild(divElement);domLayout.postionWithRel(divElement,this._jItemDIV.get(0),!this._horizental);}}else{if(this._jMenuDIV!=null){var divElement=this._jMenuDIV.get(0);if(divElement.parentNode!=null){divElement.parentNode.removeChild(divElement);}}}
return this._jItemDIV.get(0);}

EFTreeImagePath=EF_IMAGES_PATH;var ef_treeIds=new Object();var EFTreeConfig={rootIcon:efico.get("eftree.folderIcon"),openRootIcon:efico.get("eftree.openFolderIcon"),folderIcon:efico.get("eftree.folderIcon"),openFolderIcon:efico.get("eftree.openFolderIcon"),fileIcon:efico.get("eftree.file"),iIcon:efico.get("eftree.blank"),lIcon:efico.get("eftree.blank"),lMinusIcon:efico.get("eftree.treeImgLminus"),lPlusIcon:efico.get("eftree.treeImgLplus"),tIcon:efico.get("eftree.blank"),tMinusIcon:efico.get("eftree.treeImgLminus"),tPlusIcon:efico.get("eftree.treeImgLplus"),blankIcon:efico.get("eftree.blank")};function EFTree(sModel,sLabel,sText,sRightMenuDiv,sMenuDepth){this.base=EFTreeTemplate;this.base(sModel,sLabel,sText);this._status=0;this._current=null;this._selected=new Object();this.hideRoot=false;this.emptyNodeAsLeaf=false;this.activeEmptyJudger=false;this.nodeInitializer=null;this.initialExpandDepth=null;this.clickableNodeNames=true;this.param=null;var nodeLabel=null;if(typeof(sModel)!='undefined'&&!sModel&&isAvailable(sModel.nodeLabel))
{nodeLabel=sModel.nodeLabel;}
this._rootNode=new EFTreeNode(this,null,nodeLabel,this._text,false,null);this._rootNode.active(false);this._rightMenuDiv=sRightMenuDiv;this._menuDepth=parseInt(sMenuDepth);this._target=this._rootNode;this._jTreeDiv=document.createElement("div");if($.browser.msie){if(!!sLabel)
ef_treeIds[sLabel]=sLabel;window.attachEvent("onload",function(){for(var key in ef_treeIds){var tree=$("#"+key);if(tree.length==0)return;var parentDiv=tree.parent().filter('div');if(parentDiv.length==0)return;var dHeight=0;var tmpObj=parentDiv;while(tmpObj!=null&&dHeight==0)
{tmpObj=tmpObj.parent();if(tmpObj.length==0||tmpObj.children().length>1)
return;dHeight=tmpObj.height();}
parentDiv.height(dHeight);}});}}
EFTree.prototype=new EFTreeTemplate();EFTree.prototype.render=function(){this._jTreeDiv.innerHMTL='';this._target.needRender(true);var rootDom=this._target.render(this._label);if(this.hideRoot){this._rootNode.expand();this._jTreeDiv.appendChild(this._target._jTreeChildrenDiv);}else{this._jTreeDiv.appendChild(rootDom);}
if(this.initialExpandDepth!=null&&this.initialExpandDepth>0)
this.autoExpandTree();return this._jTreeDiv;}
EFTree.prototype.autoExpandTree=function(){if(this.initialExpandDepth>=1){this._rootNode.expandIterative();}}
EFTree.prototype.target=function(t){if(t===undefined){return this._target;}
this._target=t;}
EFTree.prototype.forward=function(lb){var t=this._rootNode.getChildNode(lb);if(t!=null){this._target=t;this.render();}}
EFTree.prototype.backward=function(){var p=this._target.parent();if(p!=null){this._target=p;this.render();}}
EFTree.prototype.status=function(v){if(v===undefined){return this._status;}
this._status=v;}
EFTree.prototype.reload=function(m){this._model=m;this._rootNode.reload();}
EFTree.prototype.rootNode=function(){return this._rootNode;}
EFTree.prototype.expand=function(){this._rootNode.expand();}
EFTree.prototype.collapse=function(){this._rootNode.collapse();}
EFTree.prototype.expandNode=function(lb){var _n=this.getNode(lb);var _t=_n;while(_t!=null){_t.expand();_t=_t.parent();}
return _n;}
EFTree.prototype.getChildNode=function(lb){return this._rootNode.getChildNode(lb);}
EFTree.prototype.getChildNodes=function(){return this._rootNode.getChildNodes();}
EFTree.prototype.setCurrent=function(node){for(var k in this._selected){$(this._selected[k]._jNodeTextDiv).removeClass("ef-tree-item-current");}
this._selected=new Object();if(this._current!=null){$(this._current._jNodeTextDiv).removeClass("ef-tree-item-current");}
if(node._jNodeTextDiv!=null){$(node._jNodeTextDiv).addClass("ef-tree-item-current");}
this._current=node;}
EFTree.prototype.getCurrent=function(){return this._current;}
EFTree.prototype._setSelected=function(node){if(this._current!=null&&(this._current.label()==node.label())){alert("return");return;}
var _lb=node.label();if(this._selected[_lb]){$(node._jNodeTextDiv).removeClass("ef-tree-item-current");delete this._selected[_lb];}else{this._selected[_lb]=node;$(node._jNodeTextDiv).addClass("ef-tree-item-current");}}
EFTree.prototype.getSeleted=function(){var ar=new Array();for(var k in this._selected){ar.push(this._selected[k]);}
return ar;}
function EFTreeNode(sTree,sParent,sLabel,sText,sLeaf,sData){this.base=EFTTNode;this.base(sTree,sParent,sLabel,sText,sLeaf,sData);this._jTreeNodeDIV=null;this._jBlankDiv=null;this._jNodeArchDiv=null;this._jNodeImgDiv=null;this._jTypeDiv=null;this._jNodeTextDiv=null;this._jTreeChildrenDiv=null;this._active=true;this._type=null;this._cIcon=null;this._oIcon=null;this._init=false;this._show=true;this._needRender=true;this._cascadeRender=false;this.menuData=null;}
EFTreeNode.prototype=new EFTTNode();EFTreeNode.prototype.addNode=function(sNode)
{this.expand(false);this._childNodes.push(sNode);this.needRender(true);this._hasRendered=false;this.render();};EFTreeNode.prototype.removeNode=function(sNode)
{this.expand(false);var index=$.inArray(sNode,this._childNodes);if(index>=0)
{this._childNodes.splice(index,1);}
if(this._childNodes.length==0)
{$(this._jTreeChildrenDiv).empty();}
this.needRender(true);this._hasRendered=false;this.render();};EFTreeNode.prototype.expandIterative=function(){this.expand();if(this.depth()<this.tree().initialExpandDepth-1){var subItems=this._childNodes;for(var k=0;k<subItems.length;k++){subItems[k].expandIterative();}}}
EFTreeNode.prototype.addMenuItem=function(parent,data,func){if(!this.menuData)
{this.menuData=new absTreeModel();}
var flage=false;for(var key in data){if(key=="imgSrc")
flage=true;}
if(!flage){data["imgSrc"]=efico.get("efgrid.frontBlank");}
this.menuData.addChild(parent,data);if(!!func)this.rightMenuFunc=func;}
EFTreeNode.RightMenuData={MenuName:"treeRightMenu"}
EFTreeNode.prototype.genMenuName=function(menuName){this.menuName="eftree_"+EFTreeNode.RightMenuData.MenuName+"_div";return this.menuName;}
EFTreeNode.prototype.rightMenuShow=function(event){var tree=this.tree();if(!this.menuData&&!isAvailable(tree._rightMenuDiv))
{return;}
else if(isAvailable(tree._rightMenuDiv))
{if(isAvailable(tree._rightMenuDiv))
{if(this.depth()!=tree._menuDepth)
return;}
var rMenu=$("#"+tree._rightMenuDiv);var leftPos=event.clientX;var topPos=event.clientY;var redge=document.body.clientWidth-event.clientX;var bedge=document.body.clientHeight-event.clientY;if(redge<rMenu[0].offsetWidth){leftPos=($(document).scrollLeft()+event.clientX-rMenu[0].offsetWidth)+"px";}
else{leftPos=($(document).scrollLeft()+event.clientX)+"px";}
if(bedge<rMenu[0].offsetHeight){topPos=($(document).scrollTop()+event.clientY-rMenu[0].offsetHeight)+"px";}
else{topPos=($(document).scrollTop()+event.clientY)+"px";}
rMenu.show();rMenu.css({"top":topPos,"left":leftPos,"visibility":"visible"});$(getElem('iframe')).each(function(i,o){o.contents().find('body').click(function(){rMenu.hide();});});$("body").click(function(){rMenu.hide();});}else{var x=event.clientX;var y=event.clientY;var host=this;var nMenu=new EFMenu(this.menuData,EFTreeNode.RightMenuData.MenuName,EFTreeNode.RightMenuData.MenuName);nMenu.hoverExpand=function(n){return true;}
nMenu.textClicked=function(node){var data=node.data();try{if(typeof data.func=="function")
data.func(host._label,node._label);}catch(e){alert("函数名定义有误！");}};nMenu._horizental=false;nMenu.render();var menu=nMenu._rootNode._jMenuDIV.get(0);menu.id=this.genMenuName(EFTreeNode.RightMenuData.MenuName);tNode=ef.get(menu.id);if(!!tNode){tNode.parentNode.removeChild(tNode);}
document.body.appendChild(menu);var redge=document.body.clientWidth-event.clientX;var bedge=document.body.clientHeight-event.clientY;if(redge<menu.offsetWidth){menu.style.left=($(document).scrollLeft()+event.clientX-menu.offsetWidth)+"px";}
else{menu.style.left=($(document).scrollLeft()+event.clientX)+"px";menu.style.display="block";}
if(bedge<menu.offsetHeight){menu.style.top=($(document).scrollTop()+event.clientY-menu.offsetHeight)+"px";}
else{menu.style.top=($(document).scrollTop()+event.clientY)+"px";menu.style.display="block";}
$(getElem('iframe')).each(function(i,o){o.contents().find('body').click(function(){!!ef.get(host.menuName)?ef.get(host.menuName).style.display="none":"";});});document.body.onclick=function(){!!ef.get(host.menuName)?ef.get(host.menuName).style.display="none":"";};}};function getElem(selector,$root,$collection){if(!$root)$root=$(document);if(!$collection)$collection=[];try{$root.find(selector).contents();}catch(e){return $collection;}
$root.find(selector).each(function()
{$collection.push($(this));});$root.find('iframe,frame').each(function(){getElem(selector,$(this).contents(),$collection);});return $collection;}
EFTreeNode.prototype._initialize=function(){if(this.leaf()){this._oIcon=EFTreeConfig.fileIcon;this._cIcon=EFTreeConfig.fileIcon;}else{this._oIcon=EFTreeConfig.openFolderIcon;this._cIcon=EFTreeConfig.folderIcon;}
var _t=this.tree();var d=this.data();for(var key in d){if(typeof this[key]=="undefined"){this[key]=d[key];}}
if(_t.nodeInitializer!=null){_t.nodeInitializer(this);}
this._init=true;}
EFTreeNode.prototype.show=function(v){if(v===undefined){return this._show;}
this._show=v;}
EFTreeNode.prototype.type=function(v){if(v===undefined){return this._type;}
this._type=v;if(this._type!=null){this._type.item=this;}}
EFTreeNode.prototype.active=function(v){if(v===undefined){return this._;}
this._active=v;}
EFTreeNode.prototype.needRender=function(v){if(v===undefined){return true;}
if(v===undefined){return this._needRender;}
this._needRender=v;}
EFTreeNode.prototype.icon=function(v){if(v===undefined){return this._cIcon;}
this._cIcon=v;}
EFTreeNode.prototype.openIcon=function(v){if(v===undefined){return this._oIcon;}
this._oIcon=v;}
EFTreeNode.prototype.expand=function(force){this._needRender=this._opened?false:true;this._opened=true;if(typeof force=='undefined')
{this.load(true);}
else
{this.load(force);}
if(this.tree()._model.status()==-1)
{this._opened=false;return;}
this.render();}
EFTreeNode.prototype.collapse=function(){this._needRender=this._opened;this._opened=false;this.render();}
EFTreeNode.prototype._hasnext=function(){if(this.top()){return false;}
var parentItem=this._parent;var subItems=parentItem._childNodes;for(var k=0;k<subItems.length;k++){if(this==subItems[k]){if(k!=subItems.length-1){return true;}else{return false;}}}
return false;}
EFTreeNode.prototype.onArchClicked=function(){if(this._opened){this.collapse();}else{this.expand(this.tree().dynamic);}}
EFTreeNode.prototype.onImageClicked=function(){this.onArchClicked();}
EFTreeNode.prototype.textClicked=function(){}
EFTreeNode.prototype.onTextClicked=function(){var tr=this.tree();if(this.tree().clickableNodeNames&&!this.leaf())
this.onArchClicked();switch(tr._status){case 0:tr.setCurrent(this);this.textClicked();break;case 1:tr._setSelected(this);break;}}
EFTreeNode.prototype.textContextMenu=function(node,event){this.rightMenuShow(event);}
EFTreeNode.prototype.onTextContextMenu=function(event){this.textContextMenu(this,event);}
i=0;EFTreeNode.prototype._createChildNode=function(child){var node=new EFTreeNode(this.tree(),this,child['label'],child['text'],child['leaf']=="1",child);return node;}
EFTreeNode.prototype.textDom=function(){return this._jNodeTextDiv;}
EFTreeNode.prototype.reload=function(){this.load(true);this.needRender(true);this._hasRendered=false;this.render();}
EFTreeNode.prototype._asLeaf=function(){var renderAsLeaf=this._leaf;if(!this._leaf){if(this._status==1||this._opened){if(this.tree().emptyNodeAsLeaf&&this.getChildNodes().length==0){renderAsLeaf=true;}}else if(this.tree().activeEmptyJudger&&this.getChildNodes().length==0){renderAsLeaf=true;}}
return renderAsLeaf;}
EFTreeNode.prototype._renderSkeleton=function(rootLabel){var tree=this.tree();if(this._jTreeNodeDIV==null){this._jTreeNodeDIV=document.createElement("div");if(isAvailable(rootLabel)){this.id=rootLabel;}else if(isAvailable(this._label))
{this.id=this._label;}
this._jTreeNodeDIV.className="ef-tree-item";if($.browser.msie){this._jTreeNodeDIV.style.height="100%";}
this._jTreeNodeDIV.nowrap="yes";this._jBlankDiv=document.createElement("span");this._jNodeArchDiv=document.createElement("img");this._jNodeImgDiv=document.createElement("img");this._jNodeTextDiv=document.createElement("a");this._jNodeTextDiv.innerHTML=" "+this._text+"";if(!this._init){this._initialize();}
if(this._active){this._jNodeTextDiv.href="javascript:void(0)";}
this._jTypeDiv=document.createElement("span");this._jTreeChildrenDiv=document.createElement("div");var instance=this;this._jNodeArchDiv.onclick=function(){instance.onArchClicked();return false;};if(this._active){this._jNodeTextDiv.onclick=function(){instance.onTextClicked();return false;};}
this._jNodeImgDiv.onclick=function(){instance.onImageClicked();return false;};var _jqueryNodeTextDiv=$(this._jNodeTextDiv);_jqueryNodeTextDiv.bind("contextmenu",function(event){instance.onTextContextMenu(event);return false;});}}
EFTreeNode.prototype._renderType=function(){if(!!this._jTypeDiv){this._jTypeDiv.innerHTML='';if(this.type()!=null){var typeDom=this.type().render();this._jTypeDiv.appendChild(typeDom);}}}
EFTreeNode.prototype._renderChildrenType=function(){var children=this._childNodes;for(var i=0;i<children.length;i++){var child=children[i];var childType=child._type;if(!!child._jTypeDiv&&(childType instanceof checkItemType||childType instanceof radioItemType))
child._renderType();child._renderChildrenType();}}
EFTreeNode.prototype._renderIndent=function(){var tree=this.tree();this._jBlankDiv.innerHTML='';var tmpItem=this;for(var j=this.depth();j>tree._target.depth();j--){if(tmpItem._parent!=tree._target&&tmpItem._parent._hasnext()){this._jBlankDiv.innerHTML="<img src="+EFTreeConfig.iIcon+" />"+this._jBlankDiv.innerHTML;}else{this._jBlankDiv.innerHTML="<img src="+EFTreeConfig.blankIcon+" />"+this._jBlankDiv.innerHTML;}
tmpItem=tmpItem._parent;}}
EFTreeNode.prototype._renderChildren=function(opened){this._jTreeChildrenDiv.style.display="none";if(opened){this._jTreeChildrenDiv.style.display="block";if(!this._hasRendered){if(!!this._jTreeChildrenDiv.parentNode){this._jTreeChildrenDiv.parentNode.removeChild(this._jTreeChildrenDiv);this._jTreeChildrenDiv=document.createElement("div");this._jTreeNodeDIV.appendChild(this._jTreeChildrenDiv);}
var children=this.getChildNodes();this._hasRendered=true;for(var i=0;i<children.length;i++){var child=children[i];var cDom=child.render();if(child._show){this._jTreeChildrenDiv.appendChild(cDom);}}}}};EFTreeNode.prototype._renderIconText=function(asLeaf){var closedIcon=this._cIcon;var openIcon=this._oIcon;this._jNodeTextDiv.innerHTML=" "+this._text+"";if(asLeaf){if(this._hasnext()){this._jNodeArchDiv.src=EFTreeConfig.tIcon;}else{this._jNodeArchDiv.src=EFTreeConfig.lIcon;}
this._jNodeImgDiv.src=closedIcon;}else{if(this._opened){if(this._hasnext()){this._jNodeArchDiv.src=EFTreeConfig.tMinusIcon;}else{this._jNodeArchDiv.src=EFTreeConfig.lMinusIcon;}
this._jNodeImgDiv.src=openIcon;}else{if(this._hasnext()){this._jNodeArchDiv.src=EFTreeConfig.tPlusIcon;}else{this._jNodeArchDiv.src=EFTreeConfig.lPlusIcon;}
this._jNodeImgDiv.src=closedIcon;}}}
EFTreeNode.prototype.render=function(rootLabel){this._renderSkeleton(rootLabel);this._renderType();if(this.needRender()||this._cascadeRender){this.needRender(false);this._cascadeRender=false;}else{this._jTreeNodeDIV.appendChild(this._jBlankDiv);this._jTreeNodeDIV.appendChild(this._jNodeArchDiv);this._jTreeNodeDIV.appendChild(this._jTypeDiv);this._jTreeNodeDIV.appendChild(this._jNodeImgDiv);this._jTreeNodeDIV.appendChild(this._jNodeTextDiv);this._jTreeNodeDIV.appendChild(this._jTreeChildrenDiv);this._renderChildrenType();return this._jTreeNodeDIV;}
this._renderIndent();var asLeaf=this._asLeaf();this._renderIconText(asLeaf);if(!asLeaf){this._renderChildren(this._opened);}
this._jTreeNodeDIV.appendChild(this._jBlankDiv);this._jTreeNodeDIV.appendChild(this._jNodeArchDiv);this._jTreeNodeDIV.appendChild(this._jTypeDiv);this._jTreeNodeDIV.appendChild(this._jNodeImgDiv);this._jTreeNodeDIV.appendChild(this._jNodeTextDiv);this._jTreeNodeDIV.appendChild(this._jTreeChildrenDiv);this._renderChildrenType();return this._jTreeNodeDIV;}
function treeItemType(){this.item=null;}
function checkItemType(pChecked,pCascade){this.checked=false;this.cascade=true;if(pChecked!=null){this.checked=pChecked};if(pCascade!=null){this.cascade=pCascade};this._jqDom=null;}
checkItemType.prototype=new treeItemType;checkItemType.prototype.render=function(){var host=this;var ck="";if(this.checked){ck="checked";}
var t="<input type='checkbox' "+ck+">";var check=$(t);check.click(function(){host.onCheckBoxClicked();});this._jqDom=check;return check.get(0);}
checkItemType.prototype.checkboxClicked=function(cked){}
checkItemType.prototype.onCheckBoxClicked=function(c){var bChecked=!this.checked;this.checkItem(bChecked);var toCheck=this.checkboxClicked(bChecked);};checkItemType.prototype.checkItem=function(bChecked){this.checked=bChecked;this.checkDom(bChecked);var node=this.item;if(this.cascade&&node.open()){for(var i=0;i<node._childNodes.length;i++){var sub=node._childNodes[i];if(sub._type instanceof checkItemType){sub._type.checkItem(bChecked);}}}}
checkItemType.prototype.checkDom=function(bChecked){this.checked=bChecked;this._jqDom.attr("checked",this.checked);};EFTreeNode.prototype.getCheckedChildren=function(recursive){var _selectedItems=[];for(var i=0;i<this.getChildNodes().length;i++){var node=this.getChildNodes()[i];var nodeType=node._type;if(nodeType instanceof checkItemType&&nodeType.checked){_selectedItems[_selectedItems.length]=node;}
if(recursive)
_addSelectedItems(node,_selectedItems,true);}
return _selectedItems;}
EFTreeNode.prototype.getUncheckedChildren=function(recursive){var _selectedItems=[];for(var i=0;i<this.getChildNodes().length;i++){var node=this.getChildNodes()[i];var nodeType=node._type;if(nodeType instanceof checkItemType&&(!nodeType.checked)){_selectedItems[_selectedItems.length]=node;}
if(recursive)
_addSelectedItems(node,_selectedItems,false);}
return _selectedItems;}
EFTree.prototype.getCheckedNods=function(){return this._rootNode.getCheckedChildren(true);}
EFTree.prototype.getChecked=function(){var _selected=[];var nodes=this.getCheckedNods();for(var i=0;i<nodes.length;i++){_selected[_selected.length]=nodes[i].label();}
return _selected;}
function _addSelectedItems(item,_selectedItems,checked){for(var i=0;i<item._childNodes.length;i++){var sub=item._childNodes[i];var subType=sub._type;if(subType instanceof checkItemType&&(subType.checked===checked)){_selectedItems[_selectedItems.length]=sub;}
_addSelectedItems(sub,_selectedItems,checked);}}
function radioItemType(pChecked){this.checked=false;if(pChecked!=null){this.checked=pChecked};this._jqDom=null;}
radioItemType.prototype=new treeItemType;radioItemType.prototype.render=function(){var host=this;var ck="";if(this.checked){ck="checked";this.item.tree().option=this.item;}
var t="<input type='radio' "+ck+">";var check=$(t);check.click(function(){host.onRadioClicked();});this._jqDom=check;return check.get(0);}
radioItemType.prototype.radioboxClicked=function(cked){};radioItemType.prototype.onRadioClicked=function(){var bChecked=!this.checked;this.checkItem(bChecked);this.radioboxClicked(bChecked);}
radioItemType.prototype.checkItem=function(bChecked){var tree=this.item.tree();if(tree.option&&tree.option._label==this.item._label){this.checkDom(false);tree.option=null;}else{if(tree.option){tree.option._type.checkDom(false);};this.checkDom(true);tree.option=this.item;}};radioItemType.prototype.checkDom=function(bChecked){this.checked=bChecked;this._jqDom.attr("checked",this.checked);}
EFTree.prototype.getOption=function(){if(this.option==null){return""};return this.option._label;}

function EFMenuTree(sModel,sLabel,sText){this.base=EFTree;this.base(sModel,sLabel,sText);this.hideRoot=true;this._rootNode=new EFMenuTreeNode(this,null,null,this._text,false,null);this._rootNode.active(false);this._target=this._rootNode;this._jTreeDiv=document.createElement("div");}
EFMenuTree.prototype=new EFTree();EFMenuTree.prototype.setCurrent=function(node){for(var k in this._selected){$(this._selected[k]._jNodeTextDiv).removeClass("ef-outLookTree-current");}
this._selected=new Object();if(this._current!=null){$(this._current._jNodeTextDiv).removeClass("ef-outLookTree-current");}
if(node._jNodeTextDiv!=null){$(node._jNodeTextDiv).addClass("ef-outLookTree-current");}
this._current=node;}
EFMenuTree.prototype._setSelected=function(node){if(this._current!=null&&(this._current.label()==node.label())){alert("return");return;}
var _lb=node.label();if(this._selected[_lb]){$(node._jNodeTextDiv).removeClass("ef-outLookTree-current");delete this._selected[_lb];}else{this._selected[_lb]=node;$(node._jNodeTextDiv).addClass("ef-outLookTree-current");}}
function EFMenuTreeNode(sTree,sParent,sLabel,sText,sLeaf,sData){this.base=EFTreeNode;this.base(sTree,sParent,sLabel,sText,sLeaf,sData);}
EFMenuTreeNode.prototype=new EFTreeNode();EFMenuTreeNode.prototype.onArchClicked=function(){if(this!=this.tree()._mycurrent&&!!this.tree()._mycurrent){this.tree()._mycurrent=null;}
if(this._opened){this.collapse();this.tree()._mycurrent=null;this._jNodeTextDiv.innerHTML=" <div id='ef-outLookTreeRoot' class='ef-outLookTree' ><img style='float:right' src='"+efico.get("eftree.padDown")+"' /><span >"+this._text+"</span></div>";}else{this.expandOutLookTab();this.tree()._mycurrent=this;this._jNodeTextDiv.innerHTML=" <div id='ef-outLookTreeRoot' class='ef-outLookTree' ><img style='float:right' src='"+efico.get("eftree.padUp")+"' /><span >"+this._text+"</span></div>";}}
EFMenuTreeNode.prototype.expandOutLookTab=function(){this._needRender=this._opened?false:true;this._opened=true;this.renderSubTree();}
EFMenuTreeNode.prototype.renderSubTree=function(){if(this._opened){this._jTreeChildrenDiv.style.display="block";this._jTreeChildrenDiv.style.overflow="hidden";if(!this._hasRendered){var xTree=new EFTree(this.tree()._model,this._label+"_tree","");this.configFun(xTree);xTree._rootNode._label=this._label
xTree.hideRoot=true;var tNode=xTree.render()
this._jTreeChildrenDiv.appendChild(xTree.render());this._hasRendered=true;}}
return this._jTreeNodeDIV;}
EFMenuTreeNode.prototype.configFun=function(nTree){nTree.nodeInitializer=this.tree().nodeInitializer;nTree.depth(this.tree().depth());nTree.emptyNodeAsLeaf=this.tree().emptyNodeAsLeaf;nTree.activeEmptyJudger=this.tree().activeEmptyJudger;nTree.clickableNodeNames=this.tree().clickableNodeNames;nTree.textClicked=this.tree().textClicked;nTree.hoverExpand=this.tree().hoverExpand;nTree.initialExpandDepth=this.tree().initialExpandDepth-1;}
EFMenuTreeNode.prototype.onTextClicked=function(){var tr=this.tree();switch(tr._status){case 0:tr.setCurrent(this);this.textClicked(this);break;case 1:tr._setSelected(this);break;}}
EFMenuTreeNode.prototype._createChildNode=function(child){var node=new EFMenuTreeNode(this.tree(),this,child['label'],child['text'],child['leaf']=="1",child);return node;}
EFMenuTreeNode.prototype._renderSkeleton=function(){var tree=this.tree();if(this._jTreeNodeDIV==null){this._jTreeNodeDIV=document.createElement("div");this._jTreeNodeDIV.nowrap="yes";this._jNodeTextDiv=document.createElement("div");this._jTreeChildrenDiv=document.createElement("div");var instance=this;if(this.depth()==1)
{this._jNodeTextDiv.nowrap="yes";this._jNodeTextDiv.width="100%";this._jNodeTextDiv.innerHTML=" <div id='ef-outLookTreeRoot' class='ef-outLookTree'><img style='float:right'  src='"+efico.get("eftree.padDown")+"' /><span >"+this._text+"</span></div>";}
if(tree.nodeInitializer!=null){tree.nodeInitializer(this);}
this._jNodeTextDiv.onclick=function(){if(instance.leaf()==false)
{instance.onArchClicked();}
else if(instance.leaf()==true)
instance.onTextClicked();};}}
EFMenuTreeNode.prototype.render=function(){this._renderSkeleton();if(this.needRender()||this._cascadeRender){this.needRender(false);this._cascadeRender=false;}else{this._jTreeNodeDIV.appendChild(this._jNodeTextDiv);this._jTreeNodeDIV.appendChild(this._jTreeChildrenDiv);return this._jTreeNodeDIV;}
var asLeaf=this._asLeaf();if(!asLeaf){this._renderChildren(this._opened);}
this._jTreeNodeDIV.appendChild(this._jNodeTextDiv);this._jTreeNodeDIV.appendChild(this._jTreeChildrenDiv);return this._jTreeNodeDIV;}

efvalidator=function()
{this.regexType="";this.regex=null;this.nullable=true;this.maxLength=Number.MAX_VALUE;this.minLength=0;this.errorPrompt="";}
efvalidator.prototype.setRegexType=function(t)
{if(isAvailable(t))
{this.regexType=t;}}
efvalidator.prototype.setRegex=function(ex)
{if(isAvailable(ex))
{this.regex=eval(ex);}}
efvalidator.prototype.getRegex=function()
{if(!isAvailable(this.regex)&&isAvailable(this.regexType))
{return ef_validator_regexes[this.regexType];}
else
{return this.regex;}}
efvalidator.prototype.setNullable=function(v)
{if(isAvailable(v))
{this.nullable=eval(v);}}
efvalidator.prototype.setMaxLength=function(v)
{if(isAvailable(v)&&eval(v)>0)
{this.maxLength=eval(v);}}
efvalidator.prototype.setMinLength=function(v)
{if(isAvailable(v)&&eval(v)>=0)
{this.minLength=eval(v);}}
efvalidator.prototype.setErrorPrompt=function(v)
{if(isAvailable(v))
{this.errorPrompt=efutils.trimString(v);}}
efvalidator.prototype.getErrorMessage=function()
{var message=efutils.trimString(this.errorPrompt);if(message!="")return message;if(isAvailable(this.regexType))
{message=ef_validator_errormsg[this.regexType];}
if(!isAvailable(message))
{message=getI18nMessages("ef.IllegalImportation","输入非法!");}
return message;}
efvalidator.prototype.validate=function(str)
{var error_message=this.getErrorMessage();var userMsgAdded=false;var err_msg_list="";if(this.nullable&&efutils.trimString(str)=="")
{return;}
if(!this.nullable&&efutils.trimString(str)=="")
{err_msg_list+=getI18nMessages("ef.NotNull","数据不能为空!")+"\n";}
var str_length=efutils.getTotalBytes(str);if(str_length>this.maxLength||str_length<this.minLength)
{err_msg_list+=getI18nMessages("ef.DataMin","数据至少")+" "+this.minLength+" "+getI18nMessages("ef.DataMax","数据至多")
+" "+this.maxLength+" "+getI18nMessages("ef.DataByte","位")+"\n";}
var regex=this.getRegex();if(regex!=null&&!regex.test(str))
{var msg=this.errorPrompt;if(this.regexType!="")
var msg=isAvailable(this.errorPrompt)?ef_validator_errormsg[this.regexType]:"";err_msg_list+=efutils.trimString(msg)+"\n";if(isAvailable(this.errorPrompt))
{userMsgAdded=true;}}
if(this.regexs!=null)
{for(var i=0;i<this.regexs.length;i++)
{if(this.regexs[i]!=null&&!eval(this.regexs[i]).test(str))
{var msgs=(this.errorPrompts!=null&&this.errorPrompts.length>i)?this.errorPrompts[i]:"";err_msg_list+=efutils.trimString(msgs)+"\n"}}
if(err_msg_list.length>0)err_msg_list="\n"+err_msg_list;}
else
{if(userMsgAdded==false)
{if(err_msg_list.length>0)err_msg_list="\n"+error_message+"\n"+err_msg_list;}}
if(err_msg_list.length>0)throw new Error(efutils.trimString(err_msg_list));}
efvalidator.build=function(customed,eicol)
{var validator=new efvalidator();validator.setRegexType($(customed).attr("validateType")!=null?$(customed).attr("validateType"):eicol.validateType);validator.setRegex($(customed).attr("regex")!=null?$(customed).attr("regex"):eicol.regex);validator.setNullable($(customed).attr("nullable")!=null?$(customed).attr("nullable"):eicol.nullable);validator.setMaxLength($(customed).attr("maxLength")!=null?$(customed).attr("maxLength"):eicol.maxLength);validator.setMinLength($(customed).attr("minLength")!=null?$(customed).attr("minLength"):eicol.minLength);validator.setErrorPrompt($(customed).attr("errorPrompt")!=null?$(customed).attr("errorPrompt"):eicol.errorPrompt);return validator;}
efvalidator.addSystemRegex=function(name,reg,errormsg)
{ef_validator_regexes[name]=reg;ef_validator_errormsg[name]=errormsg;}
efvalidator.init=function()
{efvalidator.addSystemRegex("email",/^([_a-z0-9]|[\.]|[\-])+@(([_a-z0-9]|[\-])+\.)+[a-z0-9]+$/i,getI18nMessages("ef.ValidateEmail","非法电子邮件地址"));efvalidator.addSystemRegex("mobile_phone",/^1[358](\d{9})$/,getI18nMessages("ef.ValidateMobilePhone","非法手机号码"));efvalidator.addSystemRegex("postcode",/^(\d{6})$/,getI18nMessages("ef.ValidatePost","非法邮政编码"));efvalidator.addSystemRegex("phone_with_area_code",/^[0-9]{3,4}-[0-9]{3,11}(-[0-9]{0,}){0,1}$/,getI18nMessages("ef.ValidatePhone","非法电话号码"));efvalidator.addSystemRegex("phone_without_area_code",/^[1-9]{1}[0-9]{2,10}$/,getI18nMessages("ef.ValidatePhone","非法电话号码"));efvalidator.addSystemRegex("integer",/^[-]{0,1}[1-9]+[0-9]{0,}$|^[0]{1,1}$/,getI18nMessages("ef.ValidateInt","必须输入整数"));efvalidator.addSystemRegex("positive_integer",/^[1-9]+[0-9]{0,}$/,getI18nMessages("ef.ValidatePositiveInt","必须输入正整数"));efvalidator.addSystemRegex("nonnegative_integer",/^[1-9]+[0-9]{0,}$|^[0]{1,1}$/,getI18nMessages("ef.ValidateNonnegtiveInt","必须输入非负整数"));efvalidator.addSystemRegex("negative_integer",/^-[1-9]+[0-9]{0,}$/,getI18nMessages("ef.ValidateNegtiveInt","必须输入负整数"));efvalidator.addSystemRegex("http_url",/^https?:\/\/(([a-zA-Z0-9_-])+(\.)?)*(:\d+)?(\/((\.)?(\?)?=?&?[a-zA-Z0-9_-](\?)?)*)*$/i,getI18nMessages("ef.ValidateHttp","非法http地址"));efvalidator.addSystemRegex("number",/^[-]{0,1}[1-9]+[0-9]{0,}$|^[-]{0,1}[1-9]+[0-9]{0,}[\.][0-9]+$|^[-]{0,1}[0]{0,1}[\.][0-9]+$|^[0]{1,1}$/,getI18nMessages("ef.ValidateNumber","必须输入数字"));efvalidator.addSystemRegex("nonnegative_number",/^[1-9]+[0-9]{0,}$|^[1-9]+[0-9]{0,}[\.][0-9]+$|^[0]{0,1}[\.][0-9]+$|^[0]{1,1}$/,getI18nMessages("ef.ValidateNonnegtiveNumber","必须输入非负数字"));efvalidator.addSystemRegex("positive_number",/^[1-9]+[0-9]{0,}$|^[1-9]+[0-9]{0,}[\.][0-9]+$|^[0]{0,1}[\.][0-9]+$/,getI18nMessages("ef.ValidatePositiveNumber","必须输入正数字"));efvalidator.addSystemRegex("decimal",/^[-]{0,1}[0]{0,1}[\.][0-9]+$/,getI18nMessages("ef.ValidateDecimal","必须输入小数"));efvalidator.addSystemRegex("label",/^[a-z]{1}([a-z0-9]|[_])+$/i,getI18nMessages("ef.ValidateTag","非法的标签名"));efvalidator.addSystemRegex("string",/^([a-z0-9]|[_])+$/i,getI18nMessages("ef.ValidateEnglishString","非法的英文字符串"));efvalidator.addSystemRegex("chinese_string",/^([a-z0-9]|[_]|[\u4E00-\u9FA5])+$/i,getI18nMessages("ef.ValidateChineseString","非法的中文字符串"));efvalidator.addSystemRegex("not_chinese_string",/^[^\u4E00-\u9FA5]*$/i,getI18nMessages("ef.ValidateNonChineseString","包含非法的中文字符串"));efvalidator.addSystemRegex("ip_address",/^([0-9]|[1-9][0-9]|[1][0-9]{2}|[2][0-4][0-9]|25[0-5])([\.]([0-9]|[1-9][0-9]|[1][0-9]{2}|[2][0-4][0-9]|25[0-5])){3}$/,getI18nMessages("ef.ValidateIP","非法的IP地址"));efvalidator.addSystemRegex("text",/^([\w]|[\W])*$/i,getI18nMessages("ef.ValidateString","非法的字符串"));efvalidator.addSystemRegex("mac",/^[0-9a-f]{2}([:][0-9a-f]{2}){5}$|^[0-9a-f]{2}([\-][0-9a-f]{2}){5}$/i,getI18nMessages("ef.ValidateMac","非法的MAC地址"));}
function efvalidateForm(node,needAlert)
{if(node==null)
{efform.setStatus(-1,getI18nMessages("ef.AssignNode","需指定一个节点"));return false;}
var len=node.elements.length;var mark=true;for(var j=0;j<len;j++)
{node.elements[j].setAttribute("valType","form");if(!efvalidateObj(node.elements[j],needAlert))
mark=false;}
if(mark==false)
{efform.setStatus(-1,getI18nMessages("ef.Invalid","校验出错，请检查输入框内的值！"));}
return mark;}
function efvalidateObj(node,needAlert,notNeedFocus)
{if(node==null)
{efform.setStatus(-1,getI18nMessages("ef.AssignNode","需指定一个节点"));return false;}
var currentObj=node;if(currentObj.type=="textarea"||currentObj.type=="text"||currentObj.type=="select-one")
{var validate=new efvalidator();validate.setRegexType($(currentObj).attr("validateType")!=null?$(currentObj).attr("validateType"):"");validate.setRegex($(currentObj).attr("regex")!=null?$(currentObj).attr("regex"):null);validate.setNullable($(currentObj).attr("nullable")!=null?$(currentObj).attr("nullable"):true);validate.setMaxLength($(currentObj).attr("maxLength")!=null?$(currentObj).attr("maxLength"):Number.MAX_VALUE);validate.setMinLength($(currentObj).attr("minLength")!=null?$(currentObj).attr("minLength"):0);validate.setErrorPrompt($(currentObj).attr("errorPrompt")!=null?$(currentObj).attr("errorPrompt"):"");if($(currentObj).attr("regex0")!=null)
{var regexs=[];for(var i=0;true;i++)
{if($(currentObj).attr("regex"+i)!=null)
regexs[i]=$(currentObj).attr("regex"+i);else
break;}
validate.regexs=regexs;}
if($(currentObj).attr("errorPrompt0")!=null)
{var errorPrompts=[];for(var i=0;true;i++)
{if($(currentObj).attr("errorPrompt"+i)!=null)
errorPrompts[i]=$(currentObj).attr("errorPrompt"+i);else
break;}
validate.errorPrompts=errorPrompts;}
try
{if(currentObj.style.display=="none"||currentObj.style.visibility=="hidden")
return true;else
validate.validate(currentObj.value);}
catch(ex)
{efform.setErrorStyle(node,getI18nMessages("ef.InvalidReason","校验出错，原因为")+"["+ex.message+"]",false);var valType=currentObj.getAttribute("valType");if(!isAvailable(valType))
{if(needAlert!=false)
efform.setStatus(-1,getI18nMessages("ef.InvalidReason","校验出错，原因为")+"["+ex.message+"]");}
if(!!notNeedFocus==false){}
return false;}
efform.setErrorStyle(node,"",true);}
return true;}
function efvalidateDiv(div_id,needAlert,notNeedFocus)
{var flage=true;try
{var div_node=$('#'+div_id);flage=efvalidateInputField(div_node[0],needAlert,notNeedFocus);}
catch(exception)
{efform.setStatus(-1,exception.message);return false;}
if(flage==false)
{efform.setStatus(-1,getI18nMessages("ef.Invalid","校验出错，请检查输入框内的值！"));}
return flage;}
function efvalidateInputField(node,needAlert,notNeedFocus)
{var flage=true;if((node.tagName=="INPUT"&&node.type!="button")||node.tagName=="TEXTAREA"||node.type=="select-one")
{flage=efvalidateObj(node,needAlert,notNeedFocus);}
else
{for(var i=0;i<node.childNodes.length;i++)
{try
{node.childNodes[i].setAttribute("valType","embed");flage=efvalidateInputField(node.childNodes[i],needAlert,notNeedFocus)&&flage;}
catch(exception)
{}}}
return flage;}
function efvalidateFormInGroup(node,validateGroupName,needAlert)
{var returnFlag;returnFlag=true;if(node==null)
{efform.setStatus(-1,getI18nMessages("ef.AssignNode","需指定一个节点"));return false;}
var len=node.elements.length;for(var j=0;j<len;j++)
{if(!efvalidateObjInGroup(node.elements[j],validateGroupName,needAlert))
{returnFlag=false;}}
return returnFlag;}
function efvalidateObjInGroup(node,validateGroupName,needAlert,notNeedFocus)
{if(node==null||$(node).attr('validateGroupName')==null||$(node).attr('validateGroupName')==undefined||$(node).attr('validateGroupName')==""||$(node).attr('validateGroupName')!=validateGroupName)return true;return efvalidateObj(node,needAlert,notNeedFocus);}
function efvalidateDivInGroup(div_id,validateGroupName,needAlert,notNeedFocus)
{var flage=true;try
{var div_node=$('#'+div_id);flage=efvalidateInputFieldInGroup(div_node,validateGroupName,needAlert,notNeedFocus);}
catch(exception)
{efform.setStatus(-1,exception.message);return false;}
return flage;}
function efvalidateInputFieldInGroup(node,validateGroupName,needAlert,notNeedFocus)
{var flage=true;if((node.tagName=="INPUT"&&node.type!="button")||node.tagName=="TEXTAREA"||node.type=="select-one")
{flage=efvalidateObjInGroup(node,validateGroupName,needAlert,notNeedFocus);if(flage==false)
return false;}
else
{for(var i=0;i<node.childNodes.length;i++)
{try
{flage=efvalidateInputFieldInGroup(node.childNodes[i],validateGroupName,needAlert,notNeedFocus);if(flage==false)
return false;}
catch(exception)
{}}}
return flage;}

var EFWindow=null;self.onError=null;var showComponent=null;efwindow=function(){}
efwindow.show=function(obj,div_id,center,title,button_json){showComponent=obj;EFWindow=div_id;var window_obj=$('#'+EFWindow);if(window_obj.length==0)return;var resizeFunc=window.onresize;window.onresize=null;var dlgleft=0;var dlgtop=0;var aWidth=window_obj.css('width');if(window_obj.hasClass("ui-dialog-content ui-widget-content"))
aWidth=window_obj.parent().css('width');if(center=="center"){dlgleft=(document.body.clientWidth-window_obj.clientWidth)/2;dlgtop=(document.body.clientHeight-window_obj.clientHeight)/2;}
else{if(obj.style.display=="none"&&obj.nextSibling!=null)
obj=obj.nextSibling;var offset=$(obj).offset();var objheight=$(obj).height();dlgleft=offset.left;dlgtop=offset.top+objheight;}
window_obj.dialog({dialogClass:'ef-widget-shadow',resizable:false,minHeight:50,height:'auto',open:function(event,ui){$(document).bind('mousedown',efwindow.clickdlgclose);if(document.forms.length>0)
document.forms[0].appendChild(window_obj.closest('div.ui-dialog')[0]);},close:function(event,ui){window.onresize=resizeFunc;$(document).unbind('mousedown',efwindow.clickdlgclose);}});if(!!title)window_obj.dialog({title:title});if(!!button_json)window_obj.dialog({buttons:button_json});aWidth=parseInt(aWidth);if(!(aWidth>0)||aWidth==300){aWidth=window_obj.width();var divWidth=window_obj.find('div').width()+2;var tblWidth=window_obj.find('table').width();aWidth=Math.max(aWidth,divWidth,tblWidth);if(aWidth==2){window_obj.dialog("open");aWidth=window_obj.find('table').width();}}
window_obj.dialog({width:aWidth});$('.ui-dialog .ui-dialog-content').css('padding','0px');window_obj.dialog({position:[dlgleft,dlgtop]}).dialog("open");$('a[type=button]').button();}
efwindow.clickdlgclose=function(e){var window_obj=$('#'+EFWindow);var uidialog=jQuery(e.target).closest('.ui-dialog');if(window_obj.dialog('isOpen')&&((!jQuery(e.target).is('.ui-dialog')&&!uidialog.length)||uidialog.find('div:eq(1)').attr('id')!=EFWindow)&&jQuery(e.target).closest('.ui-datepicker').length==0){efwindow.hide();}
return true;}
efwindow.hide=function(){var window_obj=$('#'+EFWindow);if(window_obj){window_obj.dialog("close");}}
efwindow.setValue=function(cell_value){if(showComponent.tagName=='INPUT'){var index=cell_value.indexOf("\r\n");while(index!=-1){cell_value=cell_value.substring(0,index)+EF_CR_IDENTIFIER
+cell_value.substring(index+2);index=cell_value.indexOf("\r\n");}
showComponent.value=cell_value;if(showComponent.callback){try{eval(showComponent.callback+"\""+cell_value+"\" )");}catch(exception){}}}
efwindow.hide();}
function EFModalWindow(windowID){this.winID=windowID;var modalwindow=document.createElement("div");modalwindow.id=this.winID+'_efModalWindowContainer';modalwindow.className='efModalWindowContainer';modalwindow.style.textAlign="center";modalwindow.innerHTML="&nbsp;"
document.body.appendChild(modalwindow);var dlgDiv=$("#"+modalwindow.id);dlgDiv.dialog({dialogClass:'ef-widget-shadow',autoOpen:false,resizable:false,closeOnEscape:false,height:140,modal:true,create:function(event,ui){$(this).dialog("widget").find(".ui-dialog-titlebar").hide();$(this).dialog("widget").removeClass('ui-widget-content');var html=$(document).find('html');if(html.length>0&&html[0].scrollHeight<=html[0].clientHeight&&document.body.scrollHeight<=document.body.clientHeight){$('body').css('overflow','hidden');}},open:function(event,ui){$('.ui-widget-overlay').css('width','100%');dlgDiv.css('height','100%');},close:function(event,ui){$('body').css('overflow','auto');}});this.popupContainer=$('#'+this.winID+"_efModalWindowContainer")[0];}
EFModalWindow.prototype.setContent=function(content){if(typeof content=="string"){this.popupContainer.innerHTML=content;}else if(typeof content=="object"){this.popupContainer.innerHTML="";this.popupContainer.appendChild(content);}else{alert(getI18nMessages("ef.ParamInvalid","非法参数"));}}
EFModalWindow.prototype.show=function(width,height){var dlgId=this.popupContainer.id;$("#"+dlgId).dialog({width:width,height:height}).dialog('open');}
EFModalWindow.prototype.showProgressBar=function(){this.setContent('<img src='+efico.get("efform.ajaxLoader")+' >');this.show(30,70);}
EFModalWindow.prototype.hide=function(){var dlgId=this.popupContainer.id;$("#"+dlgId).dialog('close');$("#"+dlgId).remove();}
function EFSubWindow(divId,title,w,h){this.divId=divId;this.div=$('#'+divId);this.title=title;this.w=w;this.h=h;this.returnValue;this.div.find("script").remove();this.msgObj=newMsgObj(this.div,this.title,this.w,this.h);this.show=function(isShowModel){if(isShowModel){this.msgObj.dialog({modal:true});}
this.msgObj.dialog("open");}
this.hide=function(){this.msgObj.dialog("close");return this.returnValue;}
function newMsgObj(div,title,w,h){var iWidth=document.body.clientWidth;var iHeight=document.body.clientHeight;div.css('overflow-y','auto');div.dialog({dialogClass:'ef-widget-shadow',autoOpen:false,resizable:false,title:"- "+title,width:w,height:h,position:[(iWidth-w)/2,(iHeight-h)/2],open:function(event,ui){$('.ui-dialog .ui-dialog-content').css('padding','0px');}});return div;}}
EFColorbox=function(options,callback){$.fn.colorbox(options,callback);};

(function($){EFAlert=function(message,title,callback){if(title==null)title="Alert";var popDiv=creatPopDiv(message,title,"alert");popDiv.dialog({height:'auto',minHeight:100,width:350,buttons:{'确认':function(){$(this).dialog("close");if(callback)callback(true);}}}).dialog("open");}
EFConfirm=function(message,title,callback){if(title==null)title='Confirm';var popDiv=creatPopDiv(message,title,"confirm");popDiv.dialog({height:'auto',minHeight:100,width:350,buttons:{'确认':function(){$(this).dialog("close");if(callback)callback(true);},'取消':function(){$(this).dialog("close");if(callback)callback(false);}}}).dialog("open");};EFPrompt=function(message,value,title,callback){if(title==null)title='Prompt';var popDiv=creatPopDiv(message,title,"prompt",value);popDiv.dialog({height:'auto',minHeight:130,width:350,buttons:{'确认':function(){var value=$("#popup_prompt").val();$(this).dialog("close");if(callback)callback(value);},'取消':function(){$(this).dialog("close");if(callback)callback(null);}}}).dialog("open");};creatPopDiv=function(message,title,type,value){var oldWindow=$("#popup_container");if(oldWindow.length==1&&oldWindow.dialog("isOpen")){oldWindow.dialog("close");}
popDiv=document.createElement("div");popDiv.id="popup_container";$(popDiv).append("<div id='popup_content' style ='min-width:35px;min-height:35px;float:left;'></div><div id='popup_message'>"
+message+"</div>");$("BODY").append(popDiv);$("#popup_content").addClass(type);if(type=="prompt"){$("#popup_message").append('<br /><input type="text" size="30" id="popup_prompt" />');if(value)$("#popup_prompt").val(value);}
var popWindow=$(popDiv);popWindow.dialog({autoOpen:false,resizable:false,title:title,open:function(event,ui){$('.ui-dialog-buttonset').css({"float":"none","text-align":"center"});$('.ui-dialog .ui-dialog-buttonpane').css("padding","0px");$('.ui-dialog .ui-dialog-buttonpane button').css("margin","4px");},close:function(event,ui){$("#popup_container").remove();}});return popWindow;}})(jQuery);

var Max_FILE_SIZE="10mb";var Max_FILE_SIZE_DATA=1024*1024*10;var UploadGridManager={containers:{},getUploadGridById:function(id){return this.containers["container_"+id];},setUploadGrid:function(grid){this.containers[grid.settings.divId]=grid;}};var UploadComponent=function(settings){this.settings={fileFilter:"*",fileDescription:"File(*)",uploadUrl:"./EU/AF/EUAF04.jsp",downloadUrl:"./EU/AF/EUAF06.jsp",initUrl:"./EU/AF/EUAF07.jsp",containerId:"",divId:"",inputDiv:"",deleteUrl:"./EU/AF/EUAF08.jsp"};if(settings["fileType"]&&settings["fileType"].indexOf("|")>0){var filters=settings["fileType"].split("|");this.settings.fileDescription=filters[0];this.settings.fileFilter=filters[1];}
$.extend(this.settings,settings);this.settings.readOnly=$("#"+this.settings.divId).attr("readOnly");this.init();UploadGridManager.setUploadGrid(this);};UploadComponent.prototype={init:function(){var g=this;g.fileCounts=0;g.isCanUpload=true;g.buildTable();g.setReadOnly(g.settings.readOnly);g.createUrl();g.uploader=new plupload.Uploader({runtimes:'gears,html5,flash,silverlight,browserplus,html4',browse_button:g.getBrowseButtonId(),container:g.getContainerId(),max_file_size:Max_FILE_SIZE,url:g.settings.uploadUrl,chunk_size:'10gb',flash_swf_url:'./EF/Upload/plupload.flash.swf',silverlight_xap_url:'./EF/Upload/plupload.silverlight.xap',filters:[{title:this.settings.fileDescription,extensions:this.settings.fileFilter}]});this.addEvent();this.uploader.init();this.showFileList();},buildTable:function(){var g=this;var tables=new Array();tables.push("<div id='"+this.getContainerId()+"' >");tables.push("  <div style='float: none;'></div>");tables.push("  <div class='footer' style='float: none;'> <input class='ico_att' style='margin-top: 2px; margin-right: 3px; margin-bottom: 2px; margin-left: 0px;' type='button'/><a href='#' id='"+g.getBrowseButtonId()+"' style='font-size: 12px;'>添加附件</a></div>");tables.push("  <div id='"+this.getFileListId()+"' class='ef-region-content ef-region-border ef-state-default fileList' style='min-height:25px;'></div>");tables.push("</div>");$("#"+this.settings.divId).append(tables.join(""));},addEvent:function(){var g=this;g.uploader.bind('FilesAdded',function(up,files){$('#'+g.getFileListId()).find('.clear').remove();var addFileArray=new Array();var fileCounts=(g.fileCounts+files.length);var maxCount=$("#"+g.settings.divId).attr("maxCount");if(maxCount&&parseInt(maxCount)<fileCounts){g.isCanUpload=false;alert("您最多能上传"+maxCount+"个文件");return;}else{g.fileCounts=fileCounts;g.isCanUpload=true;}
for(var i in files){if(typeof files[i]=="object"&&files[i].name){if(files[i].size>Max_FILE_SIZE_DATA){alert("文件"+files[i].name+"太大,上传附件大小不能超过"+Max_FILE_SIZE);continue;}
addFileArray.push('<div style="float:left;margin-left: 20px;margin-top:2px;font-size: 12px;color: #000000;font-weight: bold;" >');addFileArray.push('   <div id="'+files[i].id+'" ><input class="ico_att" style="margin-top: 2px; margin-right: 3px; margin-bottom: 2px; margin-left: 0px;" type="button"/><span class="fileName">'+files[i].name+"</span>");addFileArray.push('      <span  style="font-size: 12px;color: #808080;">'+"("+plupload.formatSize(files[i].size)+')</span><span class="progress"  style="width: 100px;color: #0000ff;"></span><span class="deleteBtn" style="cursor:hand;margin-left: 12px;">&nbsp;&nbsp;</span>');addFileArray.push('    </div>');addFileArray.push('</div>');}}
$('#'+g.getFileListId()).append(addFileArray.join(""));$('#'+g.getFileListId()).append("<div class='clear' style='clear: both;'></div>");$(files).each(function(index,file){if(typeof file=="object"&&file.name){$('.deleteBtn',"#"+file.id).click(function(){up.removeFile(up.getFile(file.id));$("#"+file.id).parent().remove();});}});g.uploader.trigger("start");addFileArray=null;delete addFileArray;});g.uploader.bind('QueueChanged',function(up){if(!g.isCanUpload){return;}
if(g.uploader.state==1){g.uploader.start();}});g.uploader.bind('UploadProgress',function(up,file){if($('.progress',"#"+file.id)[0]){$('.progress',"#"+file.id)[0].innerHTML=("&nbsp;&nbsp;已上传:"+file.percent+"%");if(file.percent==100){$('.progress',"#"+file.id)[0].innerHTML="";}}});g.uploader.bind('FileUploaded',function(up,file,response){var resp=eval("("+response.response+")");g.afterLoaded(file,resp);if(up.settings.url.indexOf("document_ID")>0){up.settings.url=up.settings.url.substr(0,up.settings.url.indexOf("document_ID")-1);}
up.settings.url=up.settings.url+"&document_ID="+resp["documentID"];});},afterLoaded:function(file,resp){var g=this;$("#"+g.settings.inputDiv,$("#"+g.settings.divId)).val(resp["documentID"]);$('.fileName',$("#"+file.id)).html("<a href='"+g.settings.downloadUrl+"?attachmentId="+resp["attachmentID"]+"'>"+$('.fileName',"#"+file.id).html()+"</a>");$('.deleteBtn',$("#"+file.id)).unbind("click");$('.deleteBtn',$("#"+file.id)).bind("click",function(){if(confirm("您确实要删除附件:"+file.name)){$.ajax({type:"post",url:g.settings.deleteUrl,data:{attachmentId:resp["attachmentID"]},success:function(){$("#"+file.id).parent().remove();g.fileCounts-=1;},fail:function(){alert("文件被使用,删除失败")}});}});},createUrl:function(){var g=this;var documentId=g.settings.documentId||g.getDocId();if(this.settings.uploadUrl.indexOf("?")>0){this.settings.uploadUrl=this.settings.uploadUrl.substr(0,this.settings.uploadUrl.indexOf("?"));}
var hide=$("#"+this.settings.divId).attr("hide")||"";if(hide){hide=9;}
this.settings.uploadUrl+="?code="+this.settings.code||$(".fileUpload","#"+g.settings.divId).attr("code");this.settings.uploadUrl+="&hide="+hide;if(this.settings.uploadUrl.indexOf("document_ID")>0){this.settings.uploadUrl=this.settings.uploadUrl.substr(0,this.settings.uploadUrl.indexOf("document_ID")-1);}
if(documentId&&documentId!="0"){this.settings.uploadUrl=this.settings.uploadUrl+"&document_ID="+documentId;}
if(g.uploader){g.uploader.settings.url=this.settings.uploadUrl;}},startUpload:function(){this.uploader.start();return false;},generateId:function(){return"upload_"+(new Date().getTime()+Math.floor(Math.random()*1000000));},getContainerId:function(){if(!this.containerId){this.containerId=this.generateId();}
return this.containerId;},getFileListId:function(){if(!this.fileListId){this.fileListId=this.generateId();}
return this.fileListId;},getBrowseButtonId:function(){if(!this.BrowserRowId){this.BrowserRowId=this.generateId();}
return this.BrowserRowId;},createDocElement:function(params){var g=this;var addFileArray=new Array();addFileArray.push('<div style="float:left;margin-left: 20px;margin-top:2px;font-size: 12px;color: #000000;font-weight: bold;" >');addFileArray.push('<div id="'+params.attachmentId+'" ><input class="ico_att" style="margin-top: 2px; margin-right: 3px; margin-bottom: 2px; margin-left: 0px;" type="button"/><span class="fileName">'+params.fileName+"</span>");if(!g.settings.readOnly){addFileArray.push('<span class="deleteBtn" style="cursor:hand;margin-left: 12px">&nbsp;&nbsp;</span>');}
addFileArray.push('</div>');addFileArray.push('</div>');$('#'+g.getFileListId()).append(addFileArray.join(""));$('.fileName',$("#"+g.settings.divId).find("#"+params.attachmentId)).html("<a href='"+g.settings.downloadUrl+"?attachmentId="+params["attachmentId"]+"' style='color: grey;'>"+$('.fileName',"#"+params.attachmentId).html()+"</a>");$('.deleteBtn',$("#"+g.settings.divId).find("#"+params.attachmentId)).click(function(){if(confirm("您确实要删除附件:"+params.fileName)){$.ajax({type:"post",url:g.settings.deleteUrl,data:{attachmentId:params["attachmentId"]},success:function(){$("#"+params.attachmentId).parent().remove();g.fileCounts-=1;},fail:function(){alert("文件被使用,删除失败")}});}});addFileArray=null;delete addFileArray;},showFileList:function(docId){var g=this;$('#'+g.getFileListId()).html("");var documentId=docId||g.settings.documentId||this.getDocId();if(documentId&&documentId!="0"){$.ajax({type:"post",url:g.settings.initUrl,data:{documentId:documentId},dataType:'json',success:function(datas){g.fileCounts=datas.length;$('#'+g.getFileListId()).find('.clear').remove();$.each(datas,function(index){var params={attachmentId:this.attachmentID,fileName:this.fileName,deleteUrl:g.settings.deleteUrl,downloadUrl:g.settings.downloadUrl,author:this.author,key:this.key,summary:this.summary,readOnly:this.readOnly};g.createDocElement(params)});$('#'+g.getFileListId()).append("<div class='clear' style='clear: both;'></div>");},error:function(jqXHR,textStatus,errorThrown)
{jqXHR;textStatus;errorThrown;}});}},setReadOnly:function(flag){var g=this;if(flag){$(".footer",$("#"+g.settings.divId)).hide();}else{$(".footer",$("#"+g.settings.divId)).show();}
g.settings.readOnly=flag;},setFileReadOnly:function(flag){this.setReadOnly(flag);this.showFileList();},setDocId:function(docId){var g=this;if(docId==0||docId=="0"){docId="";}
g.settings.documentId=docId;$("#"+g.settings.inputDiv,$("#"+g.settings.divId)).val(docId);this.createUrl();this.showFileList();},getDocId:function(){var g=this;return $("#"+g.settings.inputDiv,$("#"+g.settings.divId)).val();},reset:function(){this.setDocId("");}};

(function(){var f=0,l=[],n={},j={},a={"<":"lt",">":"gt","&":"amp",'"':"quot","'":"#39"},m=/[<>&\"\']/g,b,c=window.setTimeout,d={},e;function h(){this.returnValue=false}function k(){this.cancelBubble=true}(function(o){var p=o.split(/,/),q,s,r;for(q=0;q<p.length;q+=2){r=p[q+1].split(/ /);for(s=0;s<r.length;s++){j[r[s]]=p[q]}}})("application/msword,doc dot,application/pdf,pdf,application/pgp-signature,pgp,application/postscript,ps ai eps,application/rtf,rtf,application/vnd.ms-excel,xls xlb,application/vnd.ms-powerpoint,ppt pps pot,application/zip,zip,application/x-shockwave-flash,swf swfl,application/vnd.openxmlformats-officedocument.wordprocessingml.document,docx,application/vnd.openxmlformats-officedocument.wordprocessingml.template,dotx,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,xlsx,application/vnd.openxmlformats-officedocument.presentationml.presentation,pptx,application/vnd.openxmlformats-officedocument.presentationml.template,potx,application/vnd.openxmlformats-officedocument.presentationml.slideshow,ppsx,application/x-javascript,js,application/json,json,audio/mpeg,mpga mpega mp2 mp3,audio/x-wav,wav,audio/mp4,m4a,image/bmp,bmp,image/gif,gif,image/jpeg,jpeg jpg jpe,image/photoshop,psd,image/png,png,image/svg+xml,svg svgz,image/tiff,tiff tif,text/plain,asc txt text diff log,text/html,htm html xhtml,text/css,css,text/csv,csv,text/rtf,rtf,video/mpeg,mpeg mpg mpe,video/quicktime,qt mov,video/mp4,mp4,video/x-m4v,m4v,video/x-flv,flv,video/x-ms-wmv,wmv,video/avi,avi,video/webm,webm,video/vnd.rn-realvideo,rv,application/vnd.oasis.opendocument.formula-template,otf,application/octet-stream,exe");var g={VERSION:"1.5.4",STOPPED:1,STARTED:2,QUEUED:1,UPLOADING:2,FAILED:4,DONE:5,GENERIC_ERROR:-100,HTTP_ERROR:-200,IO_ERROR:-300,SECURITY_ERROR:-400,INIT_ERROR:-500,FILE_SIZE_ERROR:-600,FILE_EXTENSION_ERROR:-601,IMAGE_FORMAT_ERROR:-700,IMAGE_MEMORY_ERROR:-701,IMAGE_DIMENSIONS_ERROR:-702,mimeTypes:j,ua:(function(){var s=navigator,r=s.userAgent,t=s.vendor,p,o,q;p=/WebKit/.test(r);q=p&&t.indexOf("Apple")!==-1;o=window.opera&&window.opera.buildNumber;return{windows:navigator.platform.indexOf("Win")!==-1,ie:!p&&!o&&(/MSIE/gi).test(r)&&(/Explorer/gi).test(s.appName),webkit:p,gecko:!p&&/Gecko/.test(r),safari:q,opera:!!o}}()),typeOf:function(p){return({}).toString.call(p).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()},extend:function(o){g.each(arguments,function(p,q){if(q>0){g.each(p,function(s,r){o[r]=s})}});return o},cleanName:function(o){var p,q;q=[/[\300-\306]/g,"A",/[\340-\346]/g,"a",/\307/g,"C",/\347/g,"c",/[\310-\313]/g,"E",/[\350-\353]/g,"e",/[\314-\317]/g,"I",/[\354-\357]/g,"i",/\321/g,"N",/\361/g,"n",/[\322-\330]/g,"O",/[\362-\370]/g,"o",/[\331-\334]/g,"U",/[\371-\374]/g,"u"];for(p=0;p<q.length;p+=2){o=o.replace(q[p],q[p+1])}o=o.replace(/\s+/g,"_");o=o.replace(/[^a-z0-9_\-\.]+/gi,"");return o},addRuntime:function(o,p){p.name=o;l[o]=p;l.push(p);return p},guid:function(){var o=new Date().getTime().toString(32),p;for(p=0;p<5;p++){o+=Math.floor(Math.random()*65535).toString(32)}return(g.guidPrefix||"p")+o+(f++).toString(32)},buildUrl:function(p,o){var q="";g.each(o,function(s,r){q+=(q?"&":"")+encodeURIComponent(r)+"="+encodeURIComponent(s)});if(q){p+=(p.indexOf("?")>0?"&":"?")+q}return p},each:function(r,s){var q,p,o;if(r){q=r.length;if(q===b){for(p in r){if(r.hasOwnProperty(p)){if(s(r[p],p)===false){return}}}}else{for(o=0;o<q;o++){if(s(r[o],o)===false){return}}}}},formatSize:function(o){if(o===b||/\D/.test(o)){return g.translate("N/A")}if(o>1073741824){return Math.round(o/1073741824,1)+" GB"}if(o>1048576){return Math.round(o/1048576,1)+" MB"}if(o>1024){return Math.round(o/1024,1)+" KB"}return o+" b"},getPos:function(p,t){var u=0,s=0,w,v=document,q,r;p=p;t=t||v.body;function o(C){var A,B,z=0,D=0;if(C){B=C.getBoundingClientRect();A=v.compatMode==="CSS1Compat"?v.documentElement:v.body;z=B.left+A.scrollLeft;D=B.top+A.scrollTop}return{x:z,y:D}}if(p&&p.getBoundingClientRect&&((navigator.userAgent.indexOf("MSIE")>0)&&(v.documentMode<8))){q=o(p);r=o(t);return{x:q.x-r.x,y:q.y-r.y}}w=p;while(w&&w!=t&&w.nodeType){u+=w.offsetLeft||0;s+=w.offsetTop||0;w=w.offsetParent}w=p.parentNode;while(w&&w!=t&&w.nodeType){u-=w.scrollLeft||0;s-=w.scrollTop||0;w=w.parentNode}return{x:u,y:s}},getSize:function(o){return{w:o.offsetWidth||o.clientWidth,h:o.offsetHeight||o.clientHeight}},parseSize:function(o){var p;if(typeof(o)=="string"){o=/^([0-9]+)([mgk]?)$/.exec(o.toLowerCase().replace(/[^0-9mkg]/g,""));p=o[2];o=+o[1];if(p=="g"){o*=1073741824}if(p=="m"){o*=1048576}if(p=="k"){o*=1024}}return o},xmlEncode:function(o){return o?(""+o).replace(m,function(p){return a[p]?"&"+a[p]+";":p}):o},toArray:function(q){var p,o=[];for(p=0;p<q.length;p++){o[p]=q[p]}return o},inArray:function(q,r){if(r){if(Array.prototype.indexOf){return Array.prototype.indexOf.call(r,q)}for(var o=0,p=r.length;o<p;o++){if(r[o]===q){return o}}}return-1},addI18n:function(o){return g.extend(n,o)},translate:function(o){return n[o]||o},isEmptyObj:function(o){if(o===b){return true}for(var p in o){return false}return true},hasClass:function(q,p){var o;if(q.className==""){return false}o=new RegExp("(^|\\s+)"+p+"(\\s+|$)");return o.test(q.className)},addClass:function(p,o){if(!g.hasClass(p,o)){p.className=p.className==""?o:p.className.replace(/\s+$/,"")+" "+o}},removeClass:function(q,p){var o=new RegExp("(^|\\s+)"+p+"(\\s+|$)");q.className=q.className.replace(o,function(s,r,t){return r===" "&&t===" "?" ":""})},getStyle:function(p,o){if(p.currentStyle){return p.currentStyle[o]}else{if(window.getComputedStyle){return window.getComputedStyle(p,null)[o]}}},addEvent:function(t,o,u){var s,r,q,p;p=arguments[3];o=o.toLowerCase();if(e===b){e="Plupload_"+g.guid()}if(t.addEventListener){s=u;t.addEventListener(o,s,false)}else{if(t.attachEvent){s=function(){var v=window.event;if(!v.target){v.target=v.srcElement}v.preventDefault=h;v.stopPropagation=k;u(v)};t.attachEvent("on"+o,s)}}if(t[e]===b){t[e]=g.guid()}if(!d.hasOwnProperty(t[e])){d[t[e]]={}}r=d[t[e]];if(!r.hasOwnProperty(o)){r[o]=[]}r[o].push({func:s,orig:u,key:p})},removeEvent:function(t,o){var r,u,q;if(typeof(arguments[2])=="function"){u=arguments[2]}else{q=arguments[2]}o=o.toLowerCase();if(t[e]&&d[t[e]]&&d[t[e]][o]){r=d[t[e]][o]}else{return}for(var p=r.length-1;p>=0;p--){if(r[p].key===q||r[p].orig===u){if(t.removeEventListener){t.removeEventListener(o,r[p].func,false)}else{if(t.detachEvent){t.detachEvent("on"+o,r[p].func)}}r[p].orig=null;r[p].func=null;r.splice(p,1);if(u!==b){break}}}if(!r.length){delete d[t[e]][o]}if(g.isEmptyObj(d[t[e]])){delete d[t[e]];try{delete t[e]}catch(s){t[e]=b}}},removeAllEvents:function(p){var o=arguments[1];if(p[e]===b||!p[e]){return}g.each(d[p[e]],function(r,q){g.removeEvent(p,q,o)})}};g.Uploader=function(s){var p={},v,u=[],r,q=false;v=new g.QueueProgress();s=g.extend({chunk_size:0,multipart:true,multi_selection:true,file_data_name:"file",filters:[]},s);function t(){var x,y=0,w;if(this.state==g.STARTED){for(w=0;w<u.length;w++){if(!x&&u[w].status==g.QUEUED){x=u[w];x.status=g.UPLOADING;if(this.trigger("BeforeUpload",x)){this.trigger("UploadFile",x)}}else{y++}}if(y==u.length){this.stop();this.trigger("UploadComplete",u)}}}function o(){var x,w;v.reset();for(x=0;x<u.length;x++){w=u[x];if(w.size!==b){v.size+=w.size;v.loaded+=w.loaded}else{v.size=b}if(w.status==g.DONE){v.uploaded++}else{if(w.status==g.FAILED){v.failed++}else{v.queued++}}}if(v.size===b){v.percent=u.length>0?Math.ceil(v.uploaded/u.length*100):0}else{v.bytesPerSec=Math.ceil(v.loaded/((+new Date()-r||1)/1000));v.percent=v.size>0?Math.ceil(v.loaded/v.size*100):0}}g.extend(this,{state:g.STOPPED,runtime:"",features:{},files:u,settings:s,total:v,id:g.guid(),init:function(){var B=this,C,y,x,A=0,z;if(typeof(s.preinit)=="function"){s.preinit(B)}else{g.each(s.preinit,function(E,D){B.bind(D,E)})}s.page_url=s.page_url||document.location.pathname.replace(/\/[^\/]+$/g,"/");if(!/^(\w+:\/\/|\/)/.test(s.url)){s.url=s.page_url+s.url}s.chunk_size=g.parseSize(s.chunk_size);s.max_file_size=g.parseSize(s.max_file_size);B.bind("FilesAdded",function(D,G){var F,E,I=0,J,H=s.filters;if(H&&H.length){J=[];g.each(H,function(K){g.each(K.extensions.split(/,/),function(L){if(/^\s*\*\s*$/.test(L)){J.push("\\.*")}else{J.push("\\."+L.replace(new RegExp("["+("/^$.*+?|()[]{}\\".replace(/./g,"\\$&"))+"]","g"),"\\$&"))}})});J=new RegExp(J.join("|")+"$","i")}for(F=0;F<G.length;F++){E=G[F];E.loaded=0;E.percent=0;E.status=g.QUEUED;if(J&&!J.test(E.name)){D.trigger("Error",{code:g.FILE_EXTENSION_ERROR,message:g.translate("File extension error."),file:E});continue}if(E.size!==b&&E.size>s.max_file_size){D.trigger("Error",{code:g.FILE_SIZE_ERROR,message:g.translate("File size error."),file:E});continue}u.push(E);I++}if(I){c(function(){B.trigger("QueueChanged");B.refresh()},1)}else{return false}});if(s.unique_names){B.bind("UploadFile",function(D,E){var G=E.name.match(/\.([^.]+)$/),F="tmp";if(G){F=G[1]}E.target_name=E.id+"."+F})}B.bind("UploadProgress",function(D,E){E.percent=E.size>0?Math.ceil(E.loaded/E.size*100):100;o()});B.bind("StateChanged",function(D){if(D.state==g.STARTED){r=(+new Date())}else{if(D.state==g.STOPPED){for(C=D.files.length-1;C>=0;C--){if(D.files[C].status==g.UPLOADING){D.files[C].status=g.QUEUED;o()}}}}});B.bind("QueueChanged",o);B.bind("Error",function(D,E){if(E.file){E.file.status=g.FAILED;o();if(D.state==g.STARTED){c(function(){t.call(B)},1)}}});B.bind("FileUploaded",function(D,E){E.status=g.DONE;E.loaded=E.size;D.trigger("UploadProgress",E);c(function(){t.call(B)},1)});if(s.runtimes){y=[];z=s.runtimes.split(/\s?,\s?/);for(C=0;C<z.length;C++){if(l[z[C]]){y.push(l[z[C]])}}}else{y=l}function w(){var G=y[A++],F,D,E;if(G){F=G.getFeatures();D=B.settings.required_features;if(D){D=D.split(",");for(E=0;E<D.length;E++){if(!F[D[E]]){w();return}}}G.init(B,function(H){if(H&&H.success){B.features=F;B.runtime=G.name;B.trigger("Init",{runtime:G.name});B.trigger("PostInit");B.refresh()}else{w()}})}else{B.trigger("Error",{code:g.INIT_ERROR,message:g.translate("Init error.")})}}w();if(typeof(s.init)=="function"){s.init(B)}else{g.each(s.init,function(E,D){B.bind(D,E)})}},refresh:function(){this.trigger("Refresh")},start:function(){if(u.length&&this.state!=g.STARTED){this.state=g.STARTED;this.trigger("StateChanged");t.call(this)}},stop:function(){if(this.state!=g.STOPPED){this.state=g.STOPPED;this.trigger("CancelUpload");this.trigger("StateChanged")}},disableBrowse:function(){q=arguments[0]!==b?arguments[0]:true;this.trigger("DisableBrowse",q)},getFile:function(x){var w;for(w=u.length-1;w>=0;w--){if(u[w].id===x){return u[w]}}},removeFile:function(x){var w;for(w=u.length-1;w>=0;w--){if(u[w].id===x.id){return this.splice(w,1)[0]}}},splice:function(y,w){var x;x=u.splice(y===b?0:y,w===b?u.length:w);this.trigger("FilesRemoved",x);this.trigger("QueueChanged");return x},trigger:function(x){var z=p[x.toLowerCase()],y,w;if(z){w=Array.prototype.slice.call(arguments);w[0]=this;for(y=0;y<z.length;y++){if(z[y].func.apply(z[y].scope,w)===false){return false}}}return true},hasEventListener:function(w){return!!p[w.toLowerCase()]},bind:function(w,y,x){var z;w=w.toLowerCase();z=p[w]||[];z.push({func:y,scope:x||this});p[w]=z},unbind:function(w){w=w.toLowerCase();var z=p[w],x,y=arguments[1];if(z){if(y!==b){for(x=z.length-1;x>=0;x--){if(z[x].func===y){z.splice(x,1);break}}}else{z=[]}if(!z.length){delete p[w]}}},unbindAll:function(){var w=this;g.each(p,function(y,x){w.unbind(x)})},destroy:function(){this.stop();this.trigger("Destroy");this.unbindAll()}})};g.File=function(r,p,q){var o=this;o.id=r;o.name=p;o.size=q;o.loaded=0;o.percent=0;o.status=0};g.Runtime=function(){this.getFeatures=function(){};this.init=function(o,p){}};g.QueueProgress=function(){var o=this;o.size=0;o.loaded=0;o.uploaded=0;o.failed=0;o.queued=0;o.percent=0;o.bytesPerSec=0;o.reset=function(){o.size=o.loaded=o.uploaded=o.failed=o.queued=o.percent=o.bytesPerSec=0}};g.runtimes={};window.plupload=g})();(function(){if(window.google&&google.gears){return}var a=null;if(typeof GearsFactory!="undefined"){a=new GearsFactory()}else{try{a=new ActiveXObject("Gears.Factory");if(a.getBuildInfo().indexOf("ie_mobile")!=-1){a.privateSetGlobalObject(this)}}catch(b){if((typeof navigator.mimeTypes!="undefined")&&navigator.mimeTypes["application/x-googlegears"]){a=document.createElement("object");a.style.display="none";a.width=0;a.height=0;a.type="application/x-googlegears";document.documentElement.appendChild(a)}}}if(!a){return}if(!window.google){window.google={}}if(!google.gears){google.gears={factory:a}}})();(function(e,b,c,d){var f={};function a(h,k,m){var g,j,l,o;j=google.gears.factory.create("beta.canvas");try{j.decode(h);if(!k.width){k.width=j.width}if(!k.height){k.height=j.height}o=Math.min(width/j.width,height/j.height);if(o<1||(o===1&&m==="image/jpeg")){j.resize(Math.round(j.width*o),Math.round(j.height*o));if(k.quality){return j.encode(m,{quality:k.quality/100})}return j.encode(m)}}catch(n){}return h}c.runtimes.Gears=c.addRuntime("gears",{getFeatures:function(){return{dragdrop:true,jpgresize:true,pngresize:true,chunks:true,progress:true,multipart:true,multi_selection:true}},init:function(l,n){var m,h,g=false;if(!e.google||!google.gears){return n({success:false})}try{m=google.gears.factory.create("beta.desktop")}catch(k){return n({success:false})}function j(q){var p,o,r=[],s;for(o=0;o<q.length;o++){p=q[o];s=c.guid();f[s]=p.blob;r.push(new c.File(s,p.name,p.blob.length))}l.trigger("FilesAdded",r)}l.bind("PostInit",function(){var p=l.settings,o=b.getElementById(p.drop_element);if(o){c.addEvent(o,"dragover",function(q){m.setDropEffect(q,"copy");q.preventDefault()},l.id);c.addEvent(o,"drop",function(r){var q=m.getDragData(r,"application/x-gears-files");if(q){j(q.files)}r.preventDefault()},l.id);o=0}c.addEvent(b.getElementById(p.browse_button),"click",function(u){var t=[],r,q,s;u.preventDefault();if(g){return}no_type_restriction:for(r=0;r<p.filters.length;r++){s=p.filters[r].extensions.split(",");for(q=0;q<s.length;q++){if(s[q]==="*"){t=[];break no_type_restriction}t.push("."+s[q])}}m.openFiles(j,{singleFile:!p.multi_selection,filter:t})},l.id)});l.bind("CancelUpload",function(){if(h.abort){h.abort()}});l.bind("UploadFile",function(u,r){var w=0,v,s,t=0,q=u.settings.resize,o;if(q&&/\.(png|jpg|jpeg)$/i.test(r.name)){f[r.id]=a(f[r.id],q,/\.png$/i.test(r.name)?"image/png":"image/jpeg")}r.size=f[r.id].length;s=u.settings.chunk_size;o=s>0;v=Math.ceil(r.size/s);if(!o){s=r.size;v=1}function p(){var C,y=u.settings.multipart,x=0,B={name:r.target_name||r.name},z=u.settings.url;function A(E){var D,J="----pluploadboundary"+c.guid(),G="--",I="\r\n",F,H;if(y){h.setRequestHeader("Content-Type","multipart/form-data; boundary="+J);D=google.gears.factory.create("beta.blobbuilder");c.each(c.extend(B,u.settings.multipart_params),function(L,K){D.append(G+J+I+'Content-Disposition: form-data; name="'+K+'"'+I+I);D.append(L+I)});H=c.mimeTypes[r.name.replace(/^.+\.([^.]+)/,"$1").toLowerCase()]||"application/octet-stream";D.append(G+J+I+'Content-Disposition: form-data; name="'+u.settings.file_data_name+'"; filename="'+r.name+'"'+I+"Content-Type: "+H+I+I);D.append(E);D.append(I+G+J+G+I);F=D.getAsBlob();x=F.length-E.length;E=F}h.send(E)}if(r.status==c.DONE||r.status==c.FAILED||u.state==c.STOPPED){return}if(o){B.chunk=w;B.chunks=v}C=Math.min(s,r.size-(w*s));if(!y){z=c.buildUrl(u.settings.url,B)}h=google.gears.factory.create("beta.httprequest");h.open("POST",z);if(!y){h.setRequestHeader("Content-Disposition",'attachment; filename="'+r.name+'"');h.setRequestHeader("Content-Type","application/octet-stream")}c.each(u.settings.headers,function(E,D){h.setRequestHeader(D,E)});h.upload.onprogress=function(D){r.loaded=t+D.loaded-x;u.trigger("UploadProgress",r)};h.onreadystatechange=function(){var D;if(h.readyState==4&&u.state!==c.STOPPED){if(h.status==200){D={chunk:w,chunks:v,response:h.responseText,status:h.status};u.trigger("ChunkUploaded",r,D);if(D.cancelled){r.status=c.FAILED;return}t+=C;if(++w>=v){r.status=c.DONE;u.trigger("FileUploaded",r,{response:h.responseText,status:h.status})}else{p()}}else{u.trigger("Error",{code:c.HTTP_ERROR,message:c.translate("HTTP Error."),file:r,chunk:w,chunks:v,status:h.status})}}};if(w<v){A(f[r.id].slice(w*s,C))}}p()});l.bind("DisableBrowse",function(o,p){g=p});l.bind("Destroy",function(o){var p,q,r={browseButton:o.settings.browse_button,dropElm:o.settings.drop_element};for(p in r){q=b.getElementById(r[p]);if(q){c.removeAllEvents(q,o.id)}}});n({success:true})}})})(window,document,plupload);(function(g,b,d,e){var a={},h={};function c(o){var n,m=typeof o,j,l,k;if(o===e||o===null){return"null"}if(m==="string"){n="\bb\tt\nn\ff\rr\"\"''\\\\";return'"'+o.replace(/([\u0080-\uFFFF\x00-\x1f\"])/g,function(r,q){var p=n.indexOf(q);if(p+1){return"\\"+n.charAt(p+1)}r=q.charCodeAt().toString(16);return"\\u"+"0000".substring(r.length)+r})+'"'}if(m=="object"){j=o.length!==e;n="";if(j){for(l=0;l<o.length;l++){if(n){n+=","}n+=c(o[l])}n="["+n+"]"}else{for(k in o){if(o.hasOwnProperty(k)){if(n){n+=","}n+=c(k)+":"+c(o[k])}}n="{"+n+"}"}return n}return""+o}function f(s){var v=false,j=null,o=null,k,l,m,u,n,q=0;try{try{o=new ActiveXObject("AgControl.AgControl");if(o.IsVersionSupported(s)){v=true}o=null}catch(r){var p=navigator.plugins["Silverlight Plug-In"];if(p){k=p.description;if(k==="1.0.30226.2"){k="2.0.30226.2"}l=k.split(".");while(l.length>3){l.pop()}while(l.length<4){l.push(0)}m=s.split(".");while(m.length>4){m.pop()}do{u=parseInt(m[q],10);n=parseInt(l[q],10);q++}while(q<m.length&&u===n);if(u<=n&&!isNaN(u)){v=true}}}}catch(t){v=false}return v}d.silverlight={trigger:function(n,k){var m=a[n],l,j;if(m){j=d.toArray(arguments).slice(1);j[0]="Silverlight:"+k;setTimeout(function(){m.trigger.apply(m,j)},0)}}};d.runtimes.Silverlight=d.addRuntime("silverlight",{getFeatures:function(){return{jpgresize:true,pngresize:true,chunks:true,progress:true,multipart:true,multi_selection:true}},init:function(p,q){var o,m="",n=p.settings.filters,l,k=b.body;if(!f("2.0.31005.0")||(g.opera&&g.opera.buildNumber)){q({success:false});return}h[p.id]=false;a[p.id]=p;o=b.createElement("div");o.id=p.id+"_silverlight_container";d.extend(o.style,{position:"absolute",top:"0px",background:p.settings.shim_bgcolor||"transparent",zIndex:99999,width:"100px",height:"100px",overflow:"hidden",opacity:p.settings.shim_bgcolor||b.documentMode>8?"":0.01});o.className="plupload silverlight";if(p.settings.container){k=b.getElementById(p.settings.container);if(d.getStyle(k,"position")==="static"){k.style.position="relative"}}k.appendChild(o);for(l=0;l<n.length;l++){m+=(m!=""?"|":"")+n[l].title+" | *."+n[l].extensions.replace(/,/g,";*.")}o.innerHTML='<object id="'+p.id+'_silverlight" data="data:application/x-silverlight," type="application/x-silverlight-2" style="outline:none;" width="1024" height="1024"><param name="source" value="'+p.settings.silverlight_xap_url+'"/><param name="background" value="Transparent"/><param name="windowless" value="true"/><param name="enablehtmlaccess" value="true"/><param name="initParams" value="id='+p.id+",filter="+m+",multiselect="+p.settings.multi_selection+'"/></object>';function j(){return b.getElementById(p.id+"_silverlight").content.Upload}p.bind("Silverlight:Init",function(){var r,s={};if(h[p.id]){return}h[p.id]=true;p.bind("Silverlight:StartSelectFiles",function(t){r=[]});p.bind("Silverlight:SelectFile",function(t,w,u,v){var x;x=d.guid();s[x]=w;s[w]=x;r.push(new d.File(x,u,v))});p.bind("Silverlight:SelectSuccessful",function(){if(r.length){p.trigger("FilesAdded",r)}});p.bind("Silverlight:UploadChunkError",function(t,w,u,x,v){p.trigger("Error",{code:d.IO_ERROR,message:"IO Error.",details:v,file:t.getFile(s[w])})});p.bind("Silverlight:UploadFileProgress",function(t,x,u,w){var v=t.getFile(s[x]);if(v.status!=d.FAILED){v.size=w;v.loaded=u;t.trigger("UploadProgress",v)}});p.bind("Refresh",function(t){var u,v,w;u=b.getElementById(t.settings.browse_button);if(u){v=d.getPos(u,b.getElementById(t.settings.container));w=d.getSize(u);d.extend(b.getElementById(t.id+"_silverlight_container").style,{top:v.y+"px",left:v.x+"px",width:w.w+"px",height:w.h+"px"})}});p.bind("Silverlight:UploadChunkSuccessful",function(t,w,u,z,y){var x,v=t.getFile(s[w]);x={chunk:u,chunks:z,response:y};t.trigger("ChunkUploaded",v,x);if(v.status!=d.FAILED&&t.state!==d.STOPPED){j().UploadNextChunk()}if(u==z-1){v.status=d.DONE;t.trigger("FileUploaded",v,{response:y})}});p.bind("Silverlight:UploadSuccessful",function(t,w,u){var v=t.getFile(s[w]);v.status=d.DONE;t.trigger("FileUploaded",v,{response:u})});p.bind("FilesRemoved",function(t,v){var u;for(u=0;u<v.length;u++){j().RemoveFile(s[v[u].id])}});p.bind("UploadFile",function(t,v){var w=t.settings,u=w.resize||{};j().UploadFile(s[v.id],t.settings.url,c({name:v.target_name||v.name,mime:d.mimeTypes[v.name.replace(/^.+\.([^.]+)/,"$1").toLowerCase()]||"application/octet-stream",chunk_size:w.chunk_size,image_width:u.width,image_height:u.height,image_quality:u.quality||90,multipart:!!w.multipart,multipart_params:w.multipart_params||{},file_data_name:w.file_data_name,headers:w.headers}))});p.bind("CancelUpload",function(){j().CancelUpload()});p.bind("Silverlight:MouseEnter",function(t){var u,v;u=b.getElementById(p.settings.browse_button);v=t.settings.browse_button_hover;if(u&&v){d.addClass(u,v)}});p.bind("Silverlight:MouseLeave",function(t){var u,v;u=b.getElementById(p.settings.browse_button);v=t.settings.browse_button_hover;if(u&&v){d.removeClass(u,v)}});p.bind("Silverlight:MouseLeftButtonDown",function(t){var u,v;u=b.getElementById(p.settings.browse_button);v=t.settings.browse_button_active;if(u&&v){d.addClass(u,v);d.addEvent(b.body,"mouseup",function(){d.removeClass(u,v)})}});p.bind("Sliverlight:StartSelectFiles",function(t){var u,v;u=b.getElementById(p.settings.browse_button);v=t.settings.browse_button_active;if(u&&v){d.removeClass(u,v)}});p.bind("DisableBrowse",function(t,u){j().DisableBrowse(u)});p.bind("Destroy",function(t){var u;d.removeAllEvents(b.body,t.id);delete h[t.id];delete a[t.id];u=b.getElementById(t.id+"_silverlight_container");if(u){k.removeChild(u)}});q({success:true})})}})})(window,document,plupload);(function(f,b,d,e){var a={},g={};function c(){var h;try{h=navigator.plugins["Shockwave Flash"];h=h.description}catch(k){try{h=new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version")}catch(j){h="0.0"}}h=h.match(/\d+/g);return parseFloat(h[0]+"."+h[1])}d.flash={trigger:function(k,h,j){setTimeout(function(){var n=a[k],m,l;if(n){n.trigger("Flash:"+h,j)}},0)}};d.runtimes.Flash=d.addRuntime("flash",{getFeatures:function(){return{jpgresize:true,pngresize:true,maxWidth:8091,maxHeight:8091,chunks:true,progress:true,multipart:true,multi_selection:true}},init:function(n,p){var l,m,h=0,j=b.body;if(c()<10){p({success:false});return}g[n.id]=false;a[n.id]=n;l=b.getElementById(n.settings.browse_button);m=b.createElement("div");m.id=n.id+"_flash_container";d.extend(m.style,{position:"absolute",top:"0px",background:n.settings.shim_bgcolor||"transparent",zIndex:99999,width:"100%",height:"100%"});m.className="plupload flash";if(n.settings.container){j=b.getElementById(n.settings.container);if(d.getStyle(j,"position")==="static"){j.style.position="relative"}}j.appendChild(m);(function(){var q,r;q='<object id="'+n.id+'_flash" type="application/x-shockwave-flash" data="'+n.settings.flash_swf_url+'" ';if(d.ua.ie){q+='classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" '}q+='width="100%" height="100%" style="outline:0"><param name="movie" value="'+n.settings.flash_swf_url+'" /><param name="flashvars" value="id='+escape(n.id)+'" /><param name="wmode" value="transparent" /><param name="allowscriptaccess" value="always" /></object>';if(d.ua.ie){r=b.createElement("div");m.appendChild(r);r.outerHTML=q;r=null}else{m.innerHTML=q}}());function o(){return b.getElementById(n.id+"_flash")}function k(){if(h++>5000){p({success:false});return}if(g[n.id]===false){setTimeout(k,1)}}k();l=m=null;n.bind("Destroy",function(q){var r;d.removeAllEvents(b.body,q.id);delete g[q.id];delete a[q.id];r=b.getElementById(q.id+"_flash_container");if(r){j.removeChild(r)}});n.bind("Flash:Init",function(){var s={},r;try{o().setFileFilters(n.settings.filters,n.settings.multi_selection)}catch(q){p({success:false});return}if(g[n.id]){return}g[n.id]=true;n.bind("UploadFile",function(t,v){var w=t.settings,u=n.settings.resize||{};o().uploadFile(s[v.id],w.url,{name:v.target_name||v.name,mime:d.mimeTypes[v.name.replace(/^.+\.([^.]+)/,"$1").toLowerCase()]||"application/octet-stream",chunk_size:w.chunk_size,width:u.width,height:u.height,quality:u.quality,multipart:w.multipart,multipart_params:w.multipart_params||{},file_data_name:w.file_data_name,format:/\.(jpg|jpeg)$/i.test(v.name)?"jpg":"png",headers:w.headers,urlstream_upload:w.urlstream_upload})});n.bind("CancelUpload",function(){o().cancelUpload()});n.bind("Flash:UploadProcess",function(u,t){var v=u.getFile(s[t.id]);if(v.status!=d.FAILED){v.loaded=t.loaded;v.size=t.size;u.trigger("UploadProgress",v)}});n.bind("Flash:UploadChunkComplete",function(t,v){var w,u=t.getFile(s[v.id]);w={chunk:v.chunk,chunks:v.chunks,response:v.text};t.trigger("ChunkUploaded",u,w);if(u.status!==d.FAILED&&t.state!==d.STOPPED){o().uploadNextChunk()}if(v.chunk==v.chunks-1){u.status=d.DONE;t.trigger("FileUploaded",u,{response:v.text})}});n.bind("Flash:SelectFiles",function(t,w){var v,u,x=[],y;for(u=0;u<w.length;u++){v=w[u];y=d.guid();s[y]=v.id;s[v.id]=y;x.push(new d.File(y,v.name,v.size))}if(x.length){n.trigger("FilesAdded",x)}});n.bind("Flash:SecurityError",function(t,u){n.trigger("Error",{code:d.SECURITY_ERROR,message:d.translate("Security error."),details:u.message,file:n.getFile(s[u.id])})});n.bind("Flash:GenericError",function(t,u){n.trigger("Error",{code:d.GENERIC_ERROR,message:d.translate("Generic error."),details:u.message,file:n.getFile(s[u.id])})});n.bind("Flash:IOError",function(t,u){n.trigger("Error",{code:d.IO_ERROR,message:d.translate("IO error."),details:u.message,file:n.getFile(s[u.id])})});n.bind("Flash:ImageError",function(t,u){n.trigger("Error",{code:parseInt(u.code,10),message:d.translate("Image error."),file:n.getFile(s[u.id])})});n.bind("Flash:StageEvent:rollOver",function(t){var u,v;u=b.getElementById(n.settings.browse_button);v=t.settings.browse_button_hover;if(u&&v){d.addClass(u,v)}});n.bind("Flash:StageEvent:rollOut",function(t){var u,v;u=b.getElementById(n.settings.browse_button);v=t.settings.browse_button_hover;if(u&&v){d.removeClass(u,v)}});n.bind("Flash:StageEvent:mouseDown",function(t){var u,v;u=b.getElementById(n.settings.browse_button);v=t.settings.browse_button_active;if(u&&v){d.addClass(u,v);d.addEvent(b.body,"mouseup",function(){d.removeClass(u,v)},t.id)}});n.bind("Flash:StageEvent:mouseUp",function(t){var u,v;u=b.getElementById(n.settings.browse_button);v=t.settings.browse_button_active;if(u&&v){d.removeClass(u,v)}});n.bind("Flash:ExifData",function(t,u){n.trigger("ExifData",n.getFile(s[u.id]),u.data)});n.bind("Flash:GpsData",function(t,u){n.trigger("GpsData",n.getFile(s[u.id]),u.data)});n.bind("QueueChanged",function(t){n.refresh()});n.bind("FilesRemoved",function(t,v){var u;for(u=0;u<v.length;u++){o().removeFile(s[v[u].id])}});n.bind("StateChanged",function(t){n.refresh()});n.bind("Refresh",function(t){var u,v,w;o().setFileFilters(n.settings.filters,n.settings.multi_selection);u=b.getElementById(t.settings.browse_button);if(u){v=d.getPos(u,b.getElementById(t.settings.container));w=d.getSize(u);d.extend(b.getElementById(t.id+"_flash_container").style,{top:v.y+"px",left:v.x+"px",width:w.w+"px",height:w.h+"px"})}});n.bind("DisableBrowse",function(t,u){o().disableBrowse(u)});p({success:true})})}})})(window,document,plupload);(function(a){a.runtimes.BrowserPlus=a.addRuntime("browserplus",{getFeatures:function(){return{dragdrop:true,jpgresize:true,pngresize:true,chunks:true,progress:true,multipart:true,multi_selection:true}},init:function(g,j){var e=window.BrowserPlus,h={},d=g.settings,c=d.resize;function f(o){var n,m,k=[],l,p;for(m=0;m<o.length;m++){l=o[m];p=a.guid();h[p]=l;k.push(new a.File(p,l.name,l.size))}if(m){g.trigger("FilesAdded",k)}}function b(){var k=false;g.bind("PostInit",function(){var o,m=d.drop_element,q=g.id+"_droptarget",l=document.getElementById(m),n;function r(t,s){e.DragAndDrop.AddDropTarget({id:t},function(u){e.DragAndDrop.AttachCallbacks({id:t,hover:function(v){if(!v&&s){s()}},drop:function(v){if(s){s()}f(v)}},function(){})})}function p(){document.getElementById(q).style.top="-1000px"}if(l){if(document.attachEvent&&(/MSIE/gi).test(navigator.userAgent)){o=document.createElement("div");o.setAttribute("id",q);a.extend(o.style,{position:"absolute",top:"-1000px",background:"red",filter:"alpha(opacity=0)",opacity:0});document.body.appendChild(o);a.addEvent(l,"dragenter",function(t){var s,u;s=document.getElementById(m);u=a.getPos(s);a.extend(document.getElementById(q).style,{top:u.y+"px",left:u.x+"px",width:s.offsetWidth+"px",height:s.offsetHeight+"px"})});r(q,p)}else{r(m)}}a.addEvent(document.getElementById(d.browse_button),"click",function(y){var s=[],u,t,x=d.filters,w,v;y.preventDefault();if(k){return}no_type_restriction:for(u=0;u<x.length;u++){w=x[u].extensions.split(",");for(t=0;t<w.length;t++){if(w[t]==="*"){s=[];break no_type_restriction}v=a.mimeTypes[w[t]];if(v&&a.inArray(v,s)===-1){s.push(a.mimeTypes[w[t]])}}}e.FileBrowse.OpenBrowseDialog({mimeTypes:s},function(z){if(z.success){f(z.value)}})});l=o=null});g.bind("CancelUpload",function(){e.Uploader.cancel({},function(){})});g.bind("DisableBrowse",function(l,m){k=m});g.bind("UploadFile",function(o,l){var n=h[l.id],t={},m=o.settings.chunk_size,p,q=[];function s(u,w){var v;if(l.status==a.FAILED){return}t.name=l.target_name||l.name;if(m){t.chunk=""+u;t.chunks=""+w}v=q.shift();e.Uploader.upload({url:o.settings.url,files:{file:v},cookies:document.cookies,postvars:a.extend(t,o.settings.multipart_params),progressCallback:function(z){var y,x=0;p[u]=parseInt(z.filePercent*v.size/100,10);for(y=0;y<p.length;y++){x+=p[y]}l.loaded=x;o.trigger("UploadProgress",l)}},function(y){var x,z;if(y.success){x=y.value.statusCode;if(m){o.trigger("ChunkUploaded",l,{chunk:u,chunks:w,response:y.value.body,status:x})}if(q.length>0){s(++u,w)}else{l.status=a.DONE;o.trigger("FileUploaded",l,{response:y.value.body,status:x});if(x>=400){o.trigger("Error",{code:a.HTTP_ERROR,message:a.translate("HTTP Error."),file:l,status:x})}}}else{o.trigger("Error",{code:a.GENERIC_ERROR,message:a.translate("Generic Error."),file:l,details:y.error})}})}function r(u){l.size=u.size;if(m){e.FileAccess.chunk({file:u,chunkSize:m},function(x){if(x.success){var y=x.value,v=y.length;p=Array(v);for(var w=0;w<v;w++){p[w]=0;q.push(y[w])}s(0,v)}})}else{p=Array(1);q.push(u);s(0,1)}}if(c&&/\.(png|jpg|jpeg)$/i.test(l.name)){BrowserPlus.ImageAlter.transform({file:n,quality:c.quality||90,actions:[{scale:{maxwidth:c.width,maxheight:c.height}}]},function(u){if(u.success){r(u.value.file)}})}else{r(n)}});j({success:true})}if(e){e.init(function(l){var k=[{service:"Uploader",version:"3"},{service:"DragAndDrop",version:"1"},{service:"FileBrowse",version:"1"},{service:"FileAccess",version:"2"}];if(c){k.push({service:"ImageAlter",version:"4"})}if(l.success){e.require({services:k},function(m){if(m.success){b()}else{j()}})}else{j()}})}else{j()}}})})(plupload);(function(h,k,j,e){var c={},g;function m(o,p){var n;if("FileReader"in h){n=new FileReader();n.readAsDataURL(o);n.onload=function(){p(n.result)}}else{return p(o.getAsDataURL())}}function l(o,p){var n;if("FileReader"in h){n=new FileReader();n.readAsBinaryString(o);n.onload=function(){p(n.result)}}else{return p(o.getAsBinary())}}function d(r,p,n,v){var q,o,u,s,t=this;m(c[r.id],function(w){q=k.createElement("canvas");q.style.display="none";k.body.appendChild(q);o=q.getContext("2d");u=new Image();u.onerror=u.onabort=function(){v({success:false})};u.onload=function(){var B,x,z,y,A;if(!p.width){p.width=u.width}if(!p.height){p.height=u.height}s=Math.min(p.width/u.width,p.height/u.height);if(s<1||(s===1&&n==="image/jpeg")){B=Math.round(u.width*s);x=Math.round(u.height*s);q.width=B;q.height=x;o.drawImage(u,0,0,B,x);if(n==="image/jpeg"){y=new f(atob(w.substring(w.indexOf("base64,")+7)));if(y.headers&&y.headers.length){A=new a();if(A.init(y.get("exif")[0])){A.setExif("PixelXDimension",B);A.setExif("PixelYDimension",x);y.set("exif",A.getBinary());if(t.hasEventListener("ExifData")){t.trigger("ExifData",r,A.EXIF())}if(t.hasEventListener("GpsData")){t.trigger("GpsData",r,A.GPS())}}}if(p.quality){try{w=q.toDataURL(n,p.quality/100)}catch(C){w=q.toDataURL(n)}}}else{w=q.toDataURL(n)}w=w.substring(w.indexOf("base64,")+7);w=atob(w);if(y&&y.headers&&y.headers.length){w=y.restore(w);y.purge()}q.parentNode.removeChild(q);v({success:true,data:w})}else{v({success:false})}};u.src=w})}j.runtimes.Html5=j.addRuntime("html5",{getFeatures:function(){var s,o,r,q,p,n;o=r=p=n=false;if(h.XMLHttpRequest){s=new XMLHttpRequest();r=!!s.upload;o=!!(s.sendAsBinary||s.upload)}if(o){q=!!(s.sendAsBinary||(h.Uint8Array&&h.ArrayBuffer));p=!!(File&&(File.prototype.getAsDataURL||h.FileReader)&&q);n=!!(File&&(File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice))}g=j.ua.safari&&j.ua.windows;return{html5:o,dragdrop:(function(){var t=k.createElement("div");return("draggable"in t)||("ondragstart"in t&&"ondrop"in t)}()),jpgresize:p,pngresize:p,multipart:p||!!h.FileReader||!!h.FormData,canSendBinary:q,cantSendBlobInFormData:!!(j.ua.gecko&&h.FormData&&h.FileReader&&!FileReader.prototype.readAsArrayBuffer),progress:r,chunks:n,multi_selection:!(j.ua.safari&&j.ua.windows),triggerDialog:(j.ua.gecko&&h.FormData||j.ua.webkit)}},init:function(p,r){var n,q;function o(w){var u,t,v=[],x,s={};for(t=0;t<w.length;t++){u=w[t];if(s[u.name]){continue}s[u.name]=true;x=j.guid();c[x]=u;v.push(new j.File(x,u.fileName||u.name,u.fileSize||u.size))}if(v.length){p.trigger("FilesAdded",v)}}n=this.getFeatures();if(!n.html5){r({success:false});return}p.bind("Init",function(w){var G,F,C=[],v,D,t=w.settings.filters,u,B,s=k.body,E;G=k.createElement("div");G.id=w.id+"_html5_container";j.extend(G.style,{position:"absolute",background:p.settings.shim_bgcolor||"transparent",width:"100px",height:"100px",overflow:"hidden",zIndex:99999,opacity:p.settings.shim_bgcolor?"":0});G.className="plupload html5";if(p.settings.container){s=k.getElementById(p.settings.container);if(j.getStyle(s,"position")==="static"){s.style.position="relative"}}s.appendChild(G);no_type_restriction:for(v=0;v<t.length;v++){u=t[v].extensions.split(/,/);for(D=0;D<u.length;D++){if(u[D]==="*"){C=[];break no_type_restriction}B=j.mimeTypes[u[D]];if(B&&j.inArray(B,C)===-1){C.push(B)}}}G.innerHTML='<input id="'+p.id+'_html5"  style="font-size:999px" type="file" accept="'+C.join(",")+'" '+(p.settings.multi_selection&&p.features.multi_selection?'multiple="multiple"':"")+" />";G.scrollTop=100;E=k.getElementById(p.id+"_html5");if(w.features.triggerDialog){j.extend(E.style,{position:"absolute",width:"100%",height:"100%"})}else{j.extend(E.style,{cssFloat:"right",styleFloat:"right"})}E.onchange=function(){o(this.files);this.value=""};F=k.getElementById(w.settings.browse_button);if(F){var z=w.settings.browse_button_hover,A=w.settings.browse_button_active,x=w.features.triggerDialog?F:G;if(z){j.addEvent(x,"mouseover",function(){j.addClass(F,z)},w.id);j.addEvent(x,"mouseout",function(){j.removeClass(F,z)},w.id)}if(A){j.addEvent(x,"mousedown",function(){j.addClass(F,A)},w.id);j.addEvent(k.body,"mouseup",function(){j.removeClass(F,A)},w.id)}if(w.features.triggerDialog){j.addEvent(F,"click",function(H){var y=k.getElementById(w.id+"_html5");if(y&&!y.disabled){y.click()}H.preventDefault()},w.id)}}});p.bind("PostInit",function(){var s=k.getElementById(p.settings.drop_element);if(s){if(g){j.addEvent(s,"dragenter",function(w){var v,t,u;v=k.getElementById(p.id+"_drop");if(!v){v=k.createElement("input");v.setAttribute("type","file");v.setAttribute("id",p.id+"_drop");v.setAttribute("multiple","multiple");j.addEvent(v,"change",function(){o(this.files);j.removeEvent(v,"change",p.id);v.parentNode.removeChild(v)},p.id);s.appendChild(v)}t=j.getPos(s,k.getElementById(p.settings.container));u=j.getSize(s);if(j.getStyle(s,"position")==="static"){j.extend(s.style,{position:"relative"})}j.extend(v.style,{position:"absolute",display:"block",top:0,left:0,width:u.w+"px",height:u.h+"px",opacity:0})},p.id);return}j.addEvent(s,"dragover",function(t){t.preventDefault()},p.id);j.addEvent(s,"drop",function(u){var t=u.dataTransfer;if(t&&t.files){o(t.files)}u.preventDefault()},p.id)}});p.bind("Refresh",function(s){var t,u,v,x,w;t=k.getElementById(p.settings.browse_button);if(t){u=j.getPos(t,k.getElementById(s.settings.container));v=j.getSize(t);x=k.getElementById(p.id+"_html5_container");j.extend(x.style,{top:u.y+"px",left:u.x+"px",width:v.w+"px",height:v.h+"px"});if(p.features.triggerDialog){if(j.getStyle(t,"position")==="static"){j.extend(t.style,{position:"relative"})}w=parseInt(j.getStyle(t,"z-index"),10);if(isNaN(w)){w=0}j.extend(t.style,{zIndex:w});j.extend(x.style,{zIndex:w-1})}}});p.bind("DisableBrowse",function(s,u){var t=k.getElementById(s.id+"_html5");if(t){t.disabled=u}});p.bind("CancelUpload",function(){if(q&&q.abort){q.abort()}});p.bind("UploadFile",function(s,u){var v=s.settings,y,t;function x(A,D,z){var B;if(File.prototype.slice){try{A.slice();return A.slice(D,z)}catch(C){return A.slice(D,z-D)}}else{if(B=File.prototype.webkitSlice||File.prototype.mozSlice){return B.call(A,D,z)}else{return null}}}function w(A){var D=0,C=0,z=("FileReader"in h)?new FileReader:null;function B(){var I,M,K,L,H,J,F,E=s.settings.url;function G(V){var T=0,N="----pluploadboundary"+j.guid(),O,P="--",U="\r\n",R="";q=new XMLHttpRequest;if(q.upload){q.upload.onprogress=function(W){u.loaded=Math.min(u.size,C+W.loaded-T);s.trigger("UploadProgress",u)}}q.onreadystatechange=function(){var W,Y;if(q.readyState==4&&s.state!==j.STOPPED){try{W=q.status}catch(X){W=0}if(W>=400){s.trigger("Error",{code:j.HTTP_ERROR,message:j.translate("HTTP Error."),file:u,status:W})}else{if(K){Y={chunk:D,chunks:K,response:q.responseText,status:W};s.trigger("ChunkUploaded",u,Y);C+=J;if(Y.cancelled){u.status=j.FAILED;return}u.loaded=Math.min(u.size,(D+1)*H)}else{u.loaded=u.size}s.trigger("UploadProgress",u);V=I=O=R=null;if(!K||++D>=K){u.status=j.DONE;s.trigger("FileUploaded",u,{response:q.responseText,status:W})}else{B()}}}};if(s.settings.multipart&&n.multipart){L.name=u.target_name||u.name;q.open("post",E,true);j.each(s.settings.headers,function(X,W){q.setRequestHeader(W,X)});if(typeof(V)!=="string"&&!!h.FormData){O=new FormData();j.each(j.extend(L,s.settings.multipart_params),function(X,W){O.append(W,X)});O.append(s.settings.file_data_name,V);q.send(O);return}if(typeof(V)==="string"){q.setRequestHeader("Content-Type","multipart/form-data; boundary="+N);j.each(j.extend(L,s.settings.multipart_params),function(X,W){R+=P+N+U+'Content-Disposition: form-data; name="'+W+'"'+U+U;R+=unescape(encodeURIComponent(X))+U});F=j.mimeTypes[u.name.replace(/^.+\.([^.]+)/,"$1").toLowerCase()]||"application/octet-stream";R+=P+N+U+'Content-Disposition: form-data; name="'+s.settings.file_data_name+'"; filename="'+unescape(encodeURIComponent(u.name))+'"'+U+"Content-Type: "+F+U+U+V+U+P+N+P+U;T=R.length-V.length;V=R;if(q.sendAsBinary){q.sendAsBinary(V)}else{if(n.canSendBinary){var S=new Uint8Array(V.length);for(var Q=0;Q<V.length;Q++){S[Q]=(V.charCodeAt(Q)&255)}q.send(S.buffer)}}return}}E=j.buildUrl(s.settings.url,j.extend(L,s.settings.multipart_params));q.open("post",E,true);q.setRequestHeader("Content-Type","application/octet-stream");j.each(s.settings.headers,function(X,W){q.setRequestHeader(W,X)});q.send(V)}if(u.status==j.DONE||u.status==j.FAILED||s.state==j.STOPPED){return}L={name:u.target_name||u.name};if(v.chunk_size&&u.size>v.chunk_size&&(n.chunks||typeof(A)=="string")){H=v.chunk_size;K=Math.ceil(u.size/H);J=Math.min(H,u.size-(D*H));if(typeof(A)=="string"){I=A.substring(D*H,D*H+J)}else{I=x(A,D*H,D*H+J)}L.chunk=D;L.chunks=K}else{J=u.size;I=A}if(s.settings.multipart&&n.multipart&&typeof(I)!=="string"&&z&&n.cantSendBlobInFormData&&n.chunks&&s.settings.chunk_size){z.onload=function(){G(z.result)};z.readAsBinaryString(I)}else{G(I)}}B()}y=c[u.id];if(n.jpgresize&&s.settings.resize&&/\.(png|jpg|jpeg)$/i.test(u.name)){d.call(s,u,s.settings.resize,/\.png$/i.test(u.name)?"image/png":"image/jpeg",function(z){if(z.success){u.size=z.data.length;w(z.data)}else{if(n.chunks){w(y)}else{l(y,w)}}})}else{if(!n.chunks&&n.jpgresize){l(y,w)}else{w(y)}}});p.bind("Destroy",function(s){var u,v,t=k.body,w={inputContainer:s.id+"_html5_container",inputFile:s.id+"_html5",browseButton:s.settings.browse_button,dropElm:s.settings.drop_element};for(u in w){v=k.getElementById(w[u]);if(v){j.removeAllEvents(v,s.id)}}j.removeAllEvents(k.body,s.id);if(s.settings.container){t=k.getElementById(s.settings.container)}t.removeChild(k.getElementById(w.inputContainer))});r({success:true})}});function b(){var q=false,o;function r(t,v){var s=q?0:-8*(v-1),w=0,u;for(u=0;u<v;u++){w|=(o.charCodeAt(t+u)<<Math.abs(s+u*8))}return w}function n(u,s,t){var t=arguments.length===3?t:o.length-s-1;o=o.substr(0,s)+u+o.substr(t+s)}function p(t,u,w){var x="",s=q?0:-8*(w-1),v;for(v=0;v<w;v++){x+=String.fromCharCode((u>>Math.abs(s+v*8))&255)}n(x,t,w)}return{II:function(s){if(s===e){return q}else{q=s}},init:function(s){q=false;o=s},SEGMENT:function(s,u,t){switch(arguments.length){case 1:return o.substr(s,o.length-s-1);case 2:return o.substr(s,u);case 3:n(t,s,u);break;default:return o}},BYTE:function(s){return r(s,1)},SHORT:function(s){return r(s,2)},LONG:function(s,t){if(t===e){return r(s,4)}else{p(s,t,4)}},SLONG:function(s){var t=r(s,4);return(t>2147483647?t-4294967296:t)},STRING:function(s,t){var u="";for(t+=s;s<t;s++){u+=String.fromCharCode(r(s,1))}return u}}}function f(s){var u={65505:{app:"EXIF",name:"APP1",signature:"Exif\0"},65506:{app:"ICC",name:"APP2",signature:"ICC_PROFILE\0"},65517:{app:"IPTC",name:"APP13",signature:"Photoshop 3.0\0"}},t=[],r,n,p=e,q=0,o;r=new b();r.init(s);if(r.SHORT(0)!==65496){return}n=2;o=Math.min(1048576,s.length);while(n<=o){p=r.SHORT(n);if(p>=65488&&p<=65495){n+=2;continue}if(p===65498||p===65497){break}q=r.SHORT(n+2)+2;if(u[p]&&r.STRING(n+4,u[p].signature.length)===u[p].signature){t.push({hex:p,app:u[p].app.toUpperCase(),name:u[p].name.toUpperCase(),start:n,length:q,segment:r.SEGMENT(n,q)})}n+=q}r.init(null);return{headers:t,restore:function(y){r.init(y);var w=new f(y);if(!w.headers){return false}for(var x=w.headers.length;x>0;x--){var z=w.headers[x-1];r.SEGMENT(z.start,z.length,"")}w.purge();n=r.SHORT(2)==65504?4+r.SHORT(4):2;for(var x=0,v=t.length;x<v;x++){r.SEGMENT(n,0,t[x].segment);n+=t[x].length}return r.SEGMENT()},get:function(x){var y=[];for(var w=0,v=t.length;w<v;w++){if(t[w].app===x.toUpperCase()){y.push(t[w].segment)}}return y},set:function(y,x){var z=[];if(typeof(x)==="string"){z.push(x)}else{z=x}for(var w=ii=0,v=t.length;w<v;w++){if(t[w].app===y.toUpperCase()){t[w].segment=z[ii];t[w].length=z[ii].length;ii++}if(ii>=z.length){break}}},purge:function(){t=[];r.init(null)}}}function a(){var q,n,o={},t;q=new b();n={tiff:{274:"Orientation",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer"},exif:{36864:"ExifVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",36867:"DateTimeOriginal",33434:"ExposureTime",33437:"FNumber",34855:"ISOSpeedRatings",37377:"ShutterSpeedValue",37378:"ApertureValue",37383:"MeteringMode",37384:"LightSource",37385:"Flash",41986:"ExposureMode",41987:"WhiteBalance",41990:"SceneCaptureType",41988:"DigitalZoomRatio",41992:"Contrast",41993:"Saturation",41994:"Sharpness"},gps:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude"}};t={ColorSpace:{1:"sRGB",0:"Uncalibrated"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{1:"Daylight",2:"Fliorescent",3:"Tungsten",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 -5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire.",1:"Flash fired.",5:"Strobe return light not detected.",7:"Strobe return light detected.",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},ExposureMode:{0:"Auto exposure",1:"Manual exposure",2:"Auto bracket"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},GPSLatitudeRef:{N:"North latitude",S:"South latitude"},GPSLongitudeRef:{E:"East longitude",W:"West longitude"}};function p(u,C){var w=q.SHORT(u),z,F,G,B,A,v,x,D,E=[],y={};for(z=0;z<w;z++){x=v=u+12*z+2;G=C[q.SHORT(x)];if(G===e){continue}B=q.SHORT(x+=2);A=q.LONG(x+=2);x+=4;E=[];switch(B){case 1:case 7:if(A>4){x=q.LONG(x)+o.tiffHeader}for(F=0;F<A;F++){E[F]=q.BYTE(x+F)}break;case 2:if(A>4){x=q.LONG(x)+o.tiffHeader}y[G]=q.STRING(x,A-1);continue;case 3:if(A>2){x=q.LONG(x)+o.tiffHeader}for(F=0;F<A;F++){E[F]=q.SHORT(x+F*2)}break;case 4:if(A>1){x=q.LONG(x)+o.tiffHeader}for(F=0;F<A;F++){E[F]=q.LONG(x+F*4)}break;case 5:x=q.LONG(x)+o.tiffHeader;for(F=0;F<A;F++){E[F]=q.LONG(x+F*4)/q.LONG(x+F*4+4)}break;case 9:x=q.LONG(x)+o.tiffHeader;for(F=0;F<A;F++){E[F]=q.SLONG(x+F*4)}break;case 10:x=q.LONG(x)+o.tiffHeader;for(F=0;F<A;F++){E[F]=q.SLONG(x+F*4)/q.SLONG(x+F*4+4)}break;default:continue}D=(A==1?E[0]:E);if(t.hasOwnProperty(G)&&typeof D!="object"){y[G]=t[G][D]}else{y[G]=D}}return y}function s(){var v=e,u=o.tiffHeader;q.II(q.SHORT(u)==18761);if(q.SHORT(u+=2)!==42){return false}o.IFD0=o.tiffHeader+q.LONG(u+=2);v=p(o.IFD0,n.tiff);o.exifIFD=("ExifIFDPointer"in v?o.tiffHeader+v.ExifIFDPointer:e);o.gpsIFD=("GPSInfoIFDPointer"in v?o.tiffHeader+v.GPSInfoIFDPointer:e);return true}function r(w,u,z){var B,y,x,A=0;if(typeof(u)==="string"){var v=n[w.toLowerCase()];for(hex in v){if(v[hex]===u){u=hex;break}}}B=o[w.toLowerCase()+"IFD"];y=q.SHORT(B);for(i=0;i<y;i++){x=B+12*i+2;if(q.SHORT(x)==u){A=x+8;break}}if(!A){return false}q.LONG(A,z);return true}return{init:function(u){o={tiffHeader:10};if(u===e||!u.length){return false}q.init(u);if(q.SHORT(0)===65505&&q.STRING(4,5).toUpperCase()==="EXIF\0"){return s()}return false},EXIF:function(){var v;v=p(o.exifIFD,n.exif);if(v.ExifVersion&&j.typeOf(v.ExifVersion)==="array"){for(var w=0,u="";w<v.ExifVersion.length;w++){u+=String.fromCharCode(v.ExifVersion[w])}v.ExifVersion=u}return v},GPS:function(){var u;u=p(o.gpsIFD,n.gps);if(u.GPSVersionID){u.GPSVersionID=u.GPSVersionID.join(".")}return u},setExif:function(u,v){if(u!=="PixelXDimension"&&u!=="PixelYDimension"){return false}return r("exif",u,v)},getBinary:function(){return q.SEGMENT()}}}})(window,document,plupload);(function(d,a,b,c){function e(f){return a.getElementById(f)}b.runtimes.Html4=b.addRuntime("html4",{getFeatures:function(){return{multipart:true,triggerDialog:(b.ua.gecko&&d.FormData||b.ua.webkit)}},init:function(f,g){f.bind("Init",function(p){var j=a.body,n,h="javascript",k,x,q,z=[],r=/MSIE/.test(navigator.userAgent),t=[],m=p.settings.filters,o,l,s,w;no_type_restriction:for(o=0;o<m.length;o++){l=m[o].extensions.split(/,/);for(w=0;w<l.length;w++){if(l[w]==="*"){t=[];break no_type_restriction}s=b.mimeTypes[l[w]];if(s&&b.inArray(s,t)===-1){t.push(s)}}}t=t.join(",");function v(){var C,A,y,B;q=b.guid();z.push(q);C=a.createElement("form");C.setAttribute("id","form_"+q);C.setAttribute("method","post");C.setAttribute("enctype","multipart/form-data");C.setAttribute("encoding","multipart/form-data");C.setAttribute("target",p.id+"_iframe");C.style.position="absolute";A=a.createElement("input");A.setAttribute("id","input_"+q);A.setAttribute("type","file");A.setAttribute("accept",t);A.setAttribute("size",1);B=e(p.settings.browse_button);if(p.features.triggerDialog&&B){b.addEvent(e(p.settings.browse_button),"click",function(D){if(!A.disabled){A.click()}D.preventDefault()},p.id)}b.extend(A.style,{width:"100%",height:"100%",opacity:0,fontSize:"99px",cursor:"pointer"});b.extend(C.style,{overflow:"hidden"});y=p.settings.shim_bgcolor;if(y){C.style.background=y}if(r){b.extend(A.style,{filter:"alpha(opacity=0)"})}b.addEvent(A,"change",function(G){var E=G.target,D,F=[],H;if(E.value){e("form_"+q).style.top=-1048575+"px";D=E.value.replace(/\\/g,"/");D=D.substring(D.length,D.lastIndexOf("/")+1);F.push(new b.File(q,D));if(!p.features.triggerDialog){b.removeAllEvents(C,p.id)}else{b.removeEvent(B,"click",p.id)}b.removeEvent(A,"change",p.id);v();if(F.length){f.trigger("FilesAdded",F)}}},p.id);C.appendChild(A);j.appendChild(C);p.refresh()}function u(){var y=a.createElement("div");y.innerHTML='<iframe id="'+p.id+'_iframe" name="'+p.id+'_iframe" src="'+h+':&quot;&quot;" style="display:none"></iframe>';n=y.firstChild;j.appendChild(n);b.addEvent(n,"load",function(D){var E=D.target,C,A;if(!k){return}try{C=E.contentWindow.document||E.contentDocument||d.frames[E.id].document}catch(B){p.trigger("Error",{code:b.SECURITY_ERROR,message:b.translate("Security error."),file:k});return}A=C.body.innerHTML;if(A){k.status=b.DONE;k.loaded=1025;k.percent=100;p.trigger("UploadProgress",k);p.trigger("FileUploaded",k,{response:A})}},p.id)}if(p.settings.container){j=e(p.settings.container);if(b.getStyle(j,"position")==="static"){j.style.position="relative"}}p.bind("UploadFile",function(y,B){var C,A;if(B.status==b.DONE||B.status==b.FAILED||y.state==b.STOPPED){return}C=e("form_"+B.id);A=e("input_"+B.id);A.setAttribute("name",y.settings.file_data_name);C.setAttribute("action",y.settings.url);b.each(b.extend({name:B.target_name||B.name},y.settings.multipart_params),function(F,D){var E=a.createElement("input");b.extend(E,{type:"hidden",name:D,value:F});C.insertBefore(E,C.firstChild)});k=B;e("form_"+q).style.top=-1048575+"px";C.submit()});p.bind("FileUploaded",function(y){y.refresh()});p.bind("StateChanged",function(y){if(y.state==b.STARTED){u()}else{if(y.state==b.STOPPED){d.setTimeout(function(){b.removeEvent(n,"load",y.id);if(n.parentNode){n.parentNode.removeChild(n)}},0)}}b.each(y.files,function(B,A){if(B.status===b.DONE||B.status===b.FAILED){var C=e("form_"+B.id);if(C){C.parentNode.removeChild(C)}}})});p.bind("Refresh",function(A){var G,B,C,D,y,H,I,F,E;G=e(A.settings.browse_button);if(G){y=b.getPos(G,e(A.settings.container));H=b.getSize(G);I=e("form_"+q);F=e("input_"+q);b.extend(I.style,{top:y.y+"px",left:y.x+"px",width:H.w+"px",height:H.h+"px"});if(A.features.triggerDialog){if(b.getStyle(G,"position")==="static"){b.extend(G.style,{position:"relative"})}E=parseInt(G.style.zIndex,10);if(isNaN(E)){E=0}b.extend(G.style,{zIndex:E});b.extend(I.style,{zIndex:E-1})}C=A.settings.browse_button_hover;D=A.settings.browse_button_active;B=A.features.triggerDialog?G:I;if(C){b.addEvent(B,"mouseover",function(){b.addClass(G,C)},A.id);b.addEvent(B,"mouseout",function(){b.removeClass(G,C)},A.id)}if(D){b.addEvent(B,"mousedown",function(){b.addClass(G,D)},A.id);b.addEvent(a.body,"mouseup",function(){b.removeClass(G,D)},A.id)}}});f.bind("FilesRemoved",function(y,B){var A,C;for(A=0;A<B.length;A++){C=e("form_"+B[A].id);if(C){C.parentNode.removeChild(C)}}});f.bind("DisableBrowse",function(y,B){var A=a.getElementById("input_"+q);if(A){A.disabled=B}});f.bind("Destroy",function(y){var A,B,C,D={inputContainer:"form_"+q,inputFile:"input_"+q,browseButton:y.settings.browse_button};for(A in D){B=e(D[A]);if(B){b.removeAllEvents(B,y.id)}}b.removeAllEvents(a.body,y.id);b.each(z,function(F,E){C=e("form_"+F);if(C){j.removeChild(C)}})});v()});g({success:true})}})})(window,document,plupload);

efcascadeselect=function(){alert("EF CascadeSelect");}
efcascadeselect.getDivWindowSubNodeId=function(div_id){if(isAvailable(ef.get(div_id+"subNode")))
return ef.get(div_id+"subNode").id;else
return"";}
efcascadeselect.createDivWindow=function(div_id,styleClassName,title,width,height,flage,button)
{if(null==flage)
flage="";var ef_subwindow=$("#"+div_id)[0];if(ef_subwindow)
return ef_subwindow;if(title!=null)
tempTitle=title;else
tempTitle=getI18nMessages("ef.Choose","请选择");if(null!=button)
buttonName=button;else
buttonName=getI18nMessages("ef.Confirm","确定");if(width!=null)
tempWidth=width;else
tempWidth=400;if(height!=null)
tempHeight=height;else
tempHeight=280;ef_subwindow=$("<div />").attr({'id':div_id,'title':tempTitle});var innerStr=$("<table />").attr({'cellspacing':0,'cellpadding':1}).append($("<tr />").append($("<td colspan=2 />").append($("<div />").css({'overflow':'hidden'}).width(tempWidth).height(tempHeight).attr('id',div_id+'subNode'))));ef_subwindow.append(innerStr);$("body").append(ef_subwindow);ef_ajax_subwindow=$("<div />").css('overflow','hidden').attr('title',tempTitle).attr('id',div_id+'_ajax_loading').addClass(styleClassName);ef_ajax_subwindow.append($("<table />").attr({'cellspacing':0,'cellpadding':1}).append($("<tr />").append($("<td colspan=2 />").append($("<div>"+getI18nMessages("ef.Loading","信息加载中")+'.......'+"</div>").width(tempWidth).prepend($("<img />").attr('src',efico.get("efform.statusLoading")))))));$("body").append(ef_ajax_subwindow);var dlgDiv=$("#"+div_id);dlgDiv.dialog({autoOpen:false,height:tempHeight,width:tempWidth+20});return ef_subwindow[0];}
efcascadeselect.createHiddenField=function(div_id)
{var ef_hiddenField=$("#"+div_id)[0];if(ef_hiddenField)
return ef_hiddenField;ef_hiddenField=document.createElement("input");ef_hiddenField.type="text";ef_hiddenField.style.display="none";ef_hiddenField.id=div_id;ef_hiddenField.name=div_id;document.forms[0].appendChild(ef_hiddenField);return ef_hiddenField;}
efcascadeselect.getEiInfo=function(node,id,flage,fixed){var info=new EiInfo();if(null==id){idsNode=$("#cascadeSelect")[0];id="cascadeSelect";}
else
idsNode=$("#"+id)[0];var divWindow=efcascadeselect.createDivWindow("_efselect_divwindow","efwindow");efwindow.show($("#"+node.id)[0],"_efselect_divwindow_ajax_loading",(!!fixed)?"fixed":"");var idsStr=idsNode.getAttribute("cascadeSelectIds");var divWindowId=divWindow.id;var cascadeService=idsNode.getAttribute("cascadeService");var cascadeServiceMethod=idsNode.getAttribute("cascadeServiceMethod");var currentIndex=10000;strArray=idsStr.split(",");for(var index=0;index<strArray.length;index++){info.setById(strArray[index],$("#"+strArray[index])[0].value);if(strArray[index]==node.id)
currentIndex=index;if(index>currentIndex){tempNode=$("#"+strArray[index])[0];if(flage!=false)tempNode.value="";if(null!=tempNode.getAttribute("linkedFiled")){if(flage!=false)$("#"+tempNode.getAttribute("linkedFiled"))[0].value="";}}}
var hiddenNode_currentSelectId=efcascadeselect.createHiddenField("currentSelectId");hiddenNode_currentSelectId.value=node.id;var hiddenNode_idsStr=efcascadeselect.createHiddenField("cascade_idsStr");hiddenNode_idsStr.value=idsStr;var hiddenNode_currentSelectIndex=efcascadeselect.createHiddenField("currentSelectIndex");hiddenNode_currentSelectIndex.value=currentIndex;info.set("cascadeService",cascadeService);info.set("cascadeServiceMethod",cascadeServiceMethod);info.set("currentSelectIndex",currentIndex);info.set("cascade_idsStr",idsStr);info.set("currentSelectId",node.id);info.set("divWindowId",divWindowId);EiCommunicator.send(cascadeService,cascadeServiceMethod,info,efcascadeselect.callback,false,true,true);}
efcascadeselect.callback={onSuccess:function(eiInfo){efcascadeselect.showlist(eiInfo,eiInfo.get("currentSelectId"));},onFail:function(eMsg){alert("failure");}}
efcascadeselect.showlist=function(info,id){var divwindow=$("#"+info.get("divWindowId"))[0];efwindow.hide();var style_config=new Object();style_config["operationBar"]="true";var grid=new efgrid(id,divwindow.id+"subNode");var custom_cols={"index":{},"metas":[]};grid.setEnable(false);grid.setReadonly(true);grid.setAjax(true);grid.setAutoDraw(true);grid.setServiceName(info.get("cascadeService"));grid.setQueryMethod(info.get("cascadeServiceMethod"));grid.setCustomColumns(custom_cols);grid.setData(info);grid.setStyle(style_config);for(i=grid.dataColumns.length;i>=1;i--){column=grid.getColumn(i-1,TYPE_DATA);column.set("width",390/grid.dataColumns.length);}
grid.paint();var button_json=[{text:getI18nMessages("ef.Confirm","确定"),click:function(){efcascadeselect.ensure_onclick();}}];efwindow.show($("#"+id)[0],divwindow.id,"fixed",null,button_json);}
efcascadeselect.ensure_onclick=function(flage){if(flage==false){efwindow.hide();}
else{grid_id=efcascadeselect.getDivWindowSubNodeId("_efselect_divwindow")
var grid=efgrid.getGridObject(grid_id);var index=grid.getCurrentRowIndex();if(index<0){alert(getI18nMessages("ef.NotSelect","未选择记录"));return;}
var type=TYPE_DATA;var cellValue=grid.getCellValue(index,0,type);efwindow.setValue(cellValue);linkedId=showComponent.getAttribute("linkedFiled");if(null!=linkedId){var tempNode=$("#"+linkedId)[0];if(tempNode.getAttribute("valueIndex")!=null)
tempNode.value=grid.getCellValue(index,parseInt(tempNode.getAttribute("valueIndex")),type);else
tempNode.value=grid.getCellValue(index,1,type);}
try{efcascadeselect_ensure_onclick(showComponent.id);}catch(ex){}}}
function efcascadeselect_ensure_onclick(id){};

var ef_nav_bars=new Object();efNavBar=function(bar_id)
{this._id=bar_id;this._callback=new Object();}
efNavBar.prototype.setGoFirst=function(go_first)
{this._callback["first"]=go_first;}
efNavBar.prototype.setGoPrevious=function(go_pre)
{this._callback["previous"]=go_pre;}
efNavBar.prototype.setGoNext=function(go_next)
{this._callback["next"]=go_next;}
efNavBar.prototype.setGoLast=function(go_last)
{this._callback["last"]=go_last;}
efNavBar.prototype.setButtonStatus=function(button_id,button_status)
{var real_button_id=this._id+"_"+button_id;var node=ef.get(real_button_id);if(!isAvailable(this._callback[button_id])||!isAvailable(node))
{throw new Error("Button with id:["+real_button_id+"] not exists!");}
if(button_status==false)
{node.parentNode.className="ef-button-disabled";node.firstChild.src=EF_IMAGES_PATH+"efgrid_page_"+button_id+"_disabled.gif";node.firstChild.onclick=efform.nullfunction;}
else
{node.parentNode.className="ef-button";node.firstChild.src=EF_IMAGES_PATH+"efgrid_page_"+button_id+".gif";node.firstChild.onclick=this._callback[button_id];}}
efNavBar.prototype.paint=function()
{var div_node=ef.get(this._id);if(!div_node)
{alert("Div with id:["+this._id+"] not exists!");return;}
var temp_node=document.createElement("td");temp_node.className="buttonRegular";temp_node.align="center";temp_node.noWrap=true;var inner_html=[];inner_html.push("<table cellspacing=1 cellpadding=1><tr>");var temp_html="<div id='"+this._id+"_first'>"
temp_html+="<IMG src='"+efico.get("efgrid.pageFirst")+"'";temp_html+=" onmouseover=\"this.style.cursor='pointer';\" ></div>";temp_node.innerHTML=temp_html;temp_node.firstChild.onclick=this._callback["first"];inner_html.push(temp_node.outerHTML);temp_html="<div id='"+this._id+"_previous'>"
temp_html+="<IMG src='"+EF_IMAGES_PATH+"efgrid_page_previous.gif'";temp_html+=" onmouseover=\"this.style.cursor='pointer';\" ></div>";temp_node.innerHTML=temp_html;temp_node.firstChild.onclick=this._callback["previous"];inner_html.push(temp_node.outerHTML);temp_html="<div id='"+this._id+"_next'>"
temp_html+="<IMG src='"+efico.get("efgrid.pageNext")+"'";temp_html+=" onmouseover=\"this.style.cursor='pointer';\" ></div>";temp_node.innerHTML=temp_html;temp_node.firstChild.onclick=this._callback["next"];inner_html.push(temp_node.outerHTML);temp_html="<div id='"+this._id+"_last'>"
temp_html+="<IMG src='"+efico.get("efgrid.pageLast")+"'";temp_html+=" onmouseover=\"this.style.cursor='pointer';\" ></div>";temp_node.innerHTML=temp_html;temp_node.firstChild.onclick=this._callback["last"];inner_html.push(temp_node.outerHTML);inner_html.push("</tr></table>");div_node.innerHTML=inner_html.join('');ef_nav_bars[this._id]=this;}
efNavBar.buttonOnMouseMove=function()
{this.style.cursor='pointer';}

ef.initLoad=function()
{efform.init();efvalidator.init();}
ef.initLoad();

efsplitter=function(leftTdId,leftDivId,splitterDivId){return new splitter(leftTdId,leftDivId,splitterDivId);}
splitter=function(leftTdId,leftDivId,splitterDivId){this._splitterDiv=splitterDivId;this.dbClickCount=0;var host=this;if(leftTdId==null){this._leftTd=$("#"+this._splitterDiv).prev("td").attr("id");}else{this._leftTd=leftTdId;}
if(leftDivId==null){this._leftDiv=$("#"+this._leftTd).children("div").eq(0).attr("id");}else{this._leftDiv=leftDivId;}
$("#"+splitterDivId).html("<div class='ef-splitter-vertical'><div class='ef-splitter-stick ui-icon ui-icon-grip-dotted-vertical'></div></div>");$("#"+splitterDivId+"> DIV").height($("#"+splitterDivId).height());$("#"+splitterDivId+"> DIV").draggable({axis:"x",iframeFix:true,zIndex:100,start:function(event,ui){$("#"+splitterDivId).attr("_colOriginPosX",event.screenX);},stop:function(event,ui){var pos_x=event.screenX;var minus_px=pos_x-$("#"+splitterDivId).attr("_colOriginPosX");var _leftDiv=host._leftDiv;var _leftTd=host._leftTd;var divResizeWidth=$("#"+_leftDiv).width();var tdResizeWidth=$("#"+_leftTd).width()+minus_px;divResizeWidth=divResizeWidth+minus_px;tdResizeWidth=tdResizeWidth>divResizeWidth?tdResizeWidth:divResizeWidth;if(divResizeWidth<0)divResizeWidth=1;ef.get(_leftDiv).style.pixelWidth=divResizeWidth;ef.get(_leftTd).style.pixelWidth=tdResizeWidth;efsplitter(_leftTd,_leftDiv,splitterDivId);}});$("#"+splitterDivId).dblclick(function(){host.dbClickCount++;if(host.dbClickCount%2==1)
ef.get(host._leftDiv).style.display="none";else
ef.get(host._leftDiv).style.display="block";});}

EiInfo.prototype.get=function(str){if(!str)
return null;var strArray=str.split("-");if(3==strArray.length){block=this.getBlock(strArray[0]);if(null!=block)
return block.getCell(parseInt(strArray[1]),strArray[2]);else
return null;}else if(2==strArray.length){block=this.getBlock(strArray[0]);if(null!=block)
return block.get(strArray[1]);else
return null;}
return this.extAttr[strArray[0]];}
NODE_TYPE={FORM_TOPNODE:"FormTopNode",FORM_REGION:"FormRegion",FORM_BUTTON:"FormButton",FORM_NESTREGION:"FormNestRegion",FORM_FIELD:"FormField"};NODE_META={FORM_NAME:"formName",CONTROL_NAME:"controlName",CONTROL_TYPE:"controlType",CONTROL_PARENTNAME:"controlParentName",BLOCK_NAME:"blockName",SEQ_NO:"seqNo"};function UIWidget(node,block){this._node=node;this._id=node[NODE_META.CONTROL_NAME];this._type=node[NODE_META.CONTROL_TYPE];this._block=block;this.childWidgets=[];this.parentWidget=null;this._formRender=null;this.META_NAME={FORM_NAME:"formName",CONTROL_NAME:"controlName",CONTROL_ATTR_NAME:"controlAttrName",CONTROL_ATTR_DISPLAYNAME:"controlAttrDisplayName",CONTROL_ATTR_TYPE:"controlAttrType",CONTROL_ATTR_VALUE:"controlAttrValue",CONTROL_ATTR_DESC:"controlAttrDesc",CONTROL_ATTR_CATEGORY:"controlAttrCategory"};}
UIWidget.prototype.callBack=function(){}
UIWidget.prototype.render=function(){}
UIWidget.prototype.bind=function(){}
UIWidget.prototype.putChildWidget=function(UIWidget){this.childWidgets.push(UIWidget);}
UIWidget.prototype.getChildWidget=function(i){return this.childWidgets[i];}
function FormTopNodeWidget(node,block,attr){UIWidget.apply(this,arguments);this._attr=attr;}
FormTopNodeWidget.prototype=new UIWidget("","");FormTopNodeWidget.prototype.render=function(){var formTopNode_html=[];formTopNode_html.push("<div id=\"FormTopDivNode\">");for(var o in this._attr){var value=this._attr[o];if(o=="FormName")
o="form_ename";var hiddenField="<input type=\"hidden\" id=\"inqu_status-0-"+o+"\" name=\"inqu_status-0-"
+o+"\" value=\""+value+"\" class=\"inputField\"></input>";formTopNode_html.push(hiddenField);}
var len=this.childWidgets.length;for(var i=0;i<len;i++){var _node=this.childWidgets[i].render();if(!!_node){formTopNode_html.push(_node);}}
formTopNode_html.push("</div>");return formTopNode_html.join("");}
FormTopNodeWidget.prototype.callBack=function(){var len=this.childWidgets.length;for(var i=0;i<len;i++){this.childWidgets[i].callBack();}}
FormTopNodeWidget.prototype.bind=function(){var block=__uiDataEiInfo.getBlock("result");if(block.rows.length==0){return;}
this._formRender._editStyle="update";var row=block.rows[0];var cols=block.getBlockMeta().getMetas();for(var key in cols){var col=cols[key];try{$("#inqu_status-0-"+col.name)[0].value=row[col.pos]==null?"":row[col.pos];}catch(e){}}
var len=this.childWidgets.length;for(var i=0;i<len;i++){this.childWidgets[i].bind();}}
function FormRegionWidget(){UIWidget.apply(this,arguments);this._buttonData=[];}
FormRegionWidget.prototype=new UIWidget("","");FormRegionWidget.prototype.bind=function(){var len=this.childWidgets.length;for(var i=0;i<len;i++){this.childWidgets[i].bind();}
return;}
FormRegionWidget.prototype.callBack=function(){efregion.show(this._regionId);var ef_region_result_buttonbar=new efbuttonbar();ef_region_result_buttonbar.buttonCount=this._buttonData.length;ef_region_result_buttonbar.buttonData=this._buttonData;ef_region_result_buttonbar.paint(this._regionId);var len=this.childWidgets.length;for(var i=0;i<len;i++){this.childWidgets[i].callBack();}}
FormRegionWidget.prototype.render=function(){var domNode_html=[];this._regionId="ef_region_"+this._id;domNode_html.push("<div id = \""+this._regionId+"\"  efRegionShowClear=true ");this._param={};for(var i=0;i<this._block.rows.length;i++){var name=this._block.getCell(i,this.META_NAME.CONTROL_ATTR_NAME);var value=this._block.getCell(i,this.META_NAME.CONTROL_ATTR_VALUE);this._param[name]=value;domNode_html.push(" "+name+"="+value+" ");}
if(this._param["IsVisible"]=="False"){domNode_html.push("style=\"display:none\" ");}
domNode_html.push("title=\""+this._param["DisplayName"]+"\">");domNode_html.push("<div id=\"ef_div_"+this._id+"\" style=\"overflow:hidden;width:100%\" >");var len=this.childWidgets.length;for(var i=0;i<len;i++){var _node=this.childWidgets[i].render();if(!!_node)
domNode_html.push(_node);}
domNode_html.push("</div></div>");return domNode_html.join("");}
function FormFieldWidget(){UIWidget.apply(this,arguments);}
FormFieldWidget.prototype=new UIWidget("","");FormFieldWidget.prototype.bind=function(){if(this._param["IsPrimaryKey"]=="True"){var block=__uiDataEiInfo.getBlock("result");if(block.rows.length==0){return;}
var row=block.rows[0];if(row==null)
return;var cols=block.getBlockMeta().getMetas();var col=cols["ID"];try{$("#inqu_status-0-"+this._id)[0].value=row[col.pos]==null?"":row[col.pos];$("#inqu_status-0-"+this._id)[0].readOnly=true;}catch(e){}}
var len=this.childWidgets.length;for(var i=0;i<len;i++){this.childWidgets[i].bind();}}
FormFieldWidget.prototype.callBack=function(){var instance=this;if(this._editStyle=="Date"&&!window["efcalendar_click"]){window["efcalendar_click"]=function(control_source,id)
{var node=ef.get(id);efcalendar(control_source,node,'yyyy-mm-dd',true);}
return;}
if(this._editStyle=="ComboGrid"&&!window[this._id+"_combogrid_onclick"]){window[this._id+"_combogrid_onclick"]=function(){var inInfo=new EiInfo();inInfo.setByNode("inqu_status-0-"+instance._id);var bindingInputId="inqu_status-0-"+instance._id;var serviceName="EDFA00";var queryMethod="query";EiCommunicator.send(serviceName,queryMethod,inInfo);if(ajaxEi==null)return;var subGridColumn=new efSubgridColumn();var eiColumn=new EiColumn(bindingInputId);eiColumn.blockName="result";subGridColumn.setEiMeta({},eiColumn);subGridColumn.set("serviceName",serviceName);subGridColumn.set("queryMethod",queryMethod);subGridColumn.set("valueProperty","form_ename");var div=efform.getSubGridDiv();div.efDisplayCol=subGridColumn;efform.showSubGridWindow(bindingInputId,ajaxEi);}
return;}
if(this._editStyle=="ComboTree"&&!window[this._id+"_combotree_onclick"]){window[this._id+"_combotree_onclick"]=function(){alert('hello Tree');}
return;}}
FormFieldWidget.prototype.render=function(){var FormField_html=[];var isParentFormRegion=false;if(this.parentWidget instanceof FormNestRegionWidget){FormField_html.push("<td nowrap>");isParentFormRegion=false;}
if(this.parentWidget instanceof FormRegionWidget){FormField_html.push("<div >");isParentFormRegion=true;}
var DisplayName="";var EditStyle="Text";var IsReadOnly="False";var IsVisible="True";this._param={};for(var i=0;i<this._block.rows.length;i++){var name=this._block.getCell(i,this.META_NAME.CONTROL_ATTR_NAME);var value=this._block.getCell(i,this.META_NAME.CONTROL_ATTR_VALUE);this._param[name]=value;}
FormField_html.push(this._param["DisplayName"]+((isParentFormRegion==false)?"</td>":""));switch(this._param["EditStyle"]){case"Text":if(!isParentFormRegion)
FormField_html.push("<td nowrap><input  type=\"text\"  id=\"inqu_status-0-"+this._id+"\"  name=\"inqu_status-0-"+this._id+"\" class=\"inputField\"  ></input></td>");else
FormField_html.push("<input  type=\"text\"  id=\"inqu_status-0-"+this._id+"\"  name=\"inqu_status-0-"+this._id+"\" class=\"inputField\"  ></input>");this._editStyle="Text";break;case"TextArea":if(!isParentFormRegion)
FormField_html.push("<td nowrap><textarea  type=\"text\"  id=\"inqu_status-0-"+this._id+"\"   name=\"inqu_status-0-"+this._id+"\"  class=\"inputField\"  ></textarea></td>");else
FormField_html.push("<input  type=\"text\"  id=\"inqu_status-0-"+this._id+"\"   name=\"inqu_status-0-"+this._id+"\"  class=\"inputField\"  ></input>");this._editStyle="TextArea";break;case"Date":var date_html=[];date_html.push('<input  type="text"'
+'id=\"inqu_status-0-'+this._id+'\" name=\"inqu_status-0-'+this._id+'\" value="" class="inputField">');date_html.push('<img title="日历选择" '
+'src="./EF/Images/efcalendar_icon.gif" '
+'onmouseover="this.style.cursor="hand"" onclick="efcalendar_click(this,\'inqu_status-0-'+this._id+'\');" '
+'style="cursor: pointer; ">');if(!isParentFormRegion)
FormField_html.push("<td nowrap>"+date_html.join('')+"</td>");else
FormField_html.push(date_html.join(''));this._editStyle="Date";break;case"ComboGrid":var ComboGrid_html=[];ComboGrid_html.push('<input  type="text"'
+'id=\"inqu_status-0-'+this._id+'\" name=\"inqu_status-0-'+this._id+'\" value="" class="inputField">');ComboGrid_html.push('<img title="'+DisplayName+'" '
+'src="./EF/Images/ef_pop_up_window.png" '
+'onmouseover="this.style.cursor="hand"" onclick="'+this._id+'_combogrid_onclick();" '
+'style="cursor: pointer; ">');if(!isParentFormRegion)
FormField_html.push("<td nowrap>"+ComboGrid_html.join('')+"</td>");else
FormField_html.push(ComboGrid_html.join(''));this._editStyle="ComboGrid";break;case"ComboTree":var ComboTree_html=[];ComboTree_html.push('<input  type="text"'
+'id=\"inqu_status-0-'+this._id+'\" name=\"inqu_status-0-'+this._id+'\" value="" class="inputField">');ComboTree_html.push('<img title="'+DisplayName+'" '
+'src="./EF/Images/ef_pop_up_window.png" '
+'onmouseover="this.style.cursor="hand"" onclick="'+this._id+'_combotree_onclick();" '
+'style="cursor: pointer; ">');if(!isParentFormRegion)
FormField_html.push("<td nowrap>"+ComboTree_html.join('')+"</td>");else
FormField_html.push(ComboTree_html.join(''));this._editStyle="ComboTree";break;case"ComboBox":var opts=[];opts.push("<option selected value='"+"baogang"+"'>"+"宝钢股份公司"+"</option>");opts.push("<option selected value='"+"baoxing"+"'>"+"宝信软件公司"+"</option>");opts.push("<option selected value='"+"baoxing"+"'>"+"宝信软件公司"+"</option>");opts.push("<option selected value='"+"baogang"+"'>"+"宝钢股份公司"+"</option>");opts.push("<option selected value='"+"baogang"+"'>"+"宝钢股份公司"+"</option>");opts.push("<option selected value='"+"baogang"+"'>"+"宝钢股份公司"+"</option>");if(!isParentFormRegion)
FormField_html.push("<td nowrap>"+"<select class='pulldown' "+">"+opts.join("")+"</select>"+"</td>");else
FormField_html.push("<select class='pulldown' "+">"+opts.join("")+"</select>");this._editStyle="ComboBox";break;case"CheckBox":if(!isParentFormRegion)
FormField_html.push("<td nowrap><input  type=\"checkbox\"  id=\"inqu_status-0-"+this._id+"\"   name=\"inqu_status-0-"+this._id+"\"  class=\"inputField\"  ></input></td>");else
FormField_html.push("<input  type=\"checkbox\"  id=\"inqu_status-0-"+this._id+"\"   name=\"inqu_status-0-"+this._id+"\"  class=\"inputField\"  ></input>");this._editStyle="CheckBox";break;default:if(!isParentFormRegion)
FormField_html.push("<td nowrap><input  type=\"text\"  id=\"inqu_status-0-"+this._id+"\"   name=\"inqu_status-0-"+this._id+"\"  class=\"inputField\"  ></input></td>");else
FormField_html.push("<input  type=\"text\"  id=\"inqu_status-0-"+this._id+"\"   name=\"inqu_status-0-"+this._id+"\"   class=\"inputField\"  ></input>");this._editStyle="Text";break;}
if(!isParentFormRegion)
FormField_html.push("</td>");else
FormField_html.push("</div>");return FormField_html.join("");}
function FormButtonWidget(){UIWidget.apply(this,arguments);}
FormButtonWidget.prototype=new UIWidget("","");FormButtonWidget.prototype.bind=function(){var len=this.childWidgets.length;for(var i=0;i<len;i++){this.childWidgets[i].bind();}}
FormButtonWidget.prototype.callBack=function(){var instance=this;window["button_"+this._id.toLowerCase()+"_onclick"]=function()
{var inInfo=new EiInfo();inInfo.setByNode("FormTopDivNode");var method="insert";if(instance._formRender._editStyle=="update")
method="update";EiCommunicator.send("EDDF02",method,inInfo,{onSuccess:function(eiInfo){efform.setStatus(0,"保存信息成功！");},onFail:function(eMsg){efform.setStatus(-1,"保存信息失败！");}});}
return;}
FormButtonWidget.prototype.render=function(){if(this.parentWidget instanceof FormRegionWidget){var buttonData=[];var buttonName="",buttonSeqNo="",buttonDisplayName="";this._param={};for(var i=0;i<this._block.rows.length;i++){var name=this._block.getCell(i,this.META_NAME.CONTROL_ATTR_NAME);var value=this._block.getCell(i,this.META_NAME.CONTROL_ATTR_VALUE);this._param[name]=value;}
buttonData.push(this._param["Name"]);buttonData.push(this._param["DisplayName"]);buttonData.push(this._param["SeqNo"]);this.parentWidget._buttonData.push(buttonData);}}
function FormNestRegionWidget(){UIWidget.apply(this,arguments);}
FormNestRegionWidget.prototype=new UIWidget("","");FormNestRegionWidget.prototype.bind=function(){var len=this.childWidgets.length;for(var i=0;i<len;i++){this.childWidgets[i].bind();}}
FormNestRegionWidget.prototype.callBack=function(){var len=this.childWidgets.length;for(var i=0;i<len;i++){this.childWidgets[i].callBack();}}
FormNestRegionWidget.prototype.render=function(){var columnCount=3;this._param={};for(var i=0;i<this._block.rows.length;i++){var name=this._block.getCell(i,this.META_NAME.CONTROL_ATTR_NAME);var value=this._block.getCell(i,this.META_NAME.CONTROL_ATTR_VALUE);this._param[name]=value;}
this._regionId="ef_nestRegion_"+this._id;var FormNest_html=[];FormNest_html.push("<fieldset id=\""+this._regionId+"\""+((this._param["IsVisible"]=="False")?" style=\"display:none\" ":"")
+"><legend>"+this._param["DisplayName"]+"</legend>");columnCount=parseInt(this._param["ColumnCount"]);if(!columnCount)
columnCount=3;FormNest_html.push("<table id=\"ef_nestRegion_table"+this._id+"\">");var len=this.childWidgets.length;for(var i=0;i<len;i++){if(i%columnCount==0){if(i==0)
FormNest_html.push("<tr>");else
FormNest_html.push("</tr><tr>");}
var _node=this.childWidgets[i].render();if(!!_node)
FormNest_html.push(_node);}
FormNest_html.push("</tr></table></fieldset>");return FormNest_html.join("");}
function EFFormRender(paintId){if(paintId=="")
this._paintNode=window.document.body;else
this._paintNode=$("#"+paintId)[0];this.CONSTANT={RESULT:"result",TOPNODE:"topNode"};this.FORM_ATTR={ATTR_ISEXIST:"isExist",ATTR_TYPE:"Type",ATTR_DISPLAYNAME:"DisplayName",ATTR_FORMNAME:"FormName",ATTR_SECONDMODULE:"SecondModule",ATTR_SERVICENAME:"serviceName",ATTR_FIRSTMODULE:"FirstModule",ATTR_USERNAME:"Username",ATTR_SERVICE:"service",ATTR_METHOD:"method",ATTR_PROJECT:"Project",ATTR_RECREATOR:"recCreator",ATTR_METHODNAME:"methodName"};this.parentNode=this._paintNode;this._editStyle="insert";};EFFormRender.prototype.init=function(info){this.eiinfo=info;this.WidgetObjs={};this.generateTree();}
EFFormRender.prototype.generateTree=function(){var result=this.eiinfo.getBlock(this.CONSTANT.RESULT);var resultRows=result.getRows();var count=resultRows.length;for(var i=0;i<count;i++){var node={};node[NODE_META.FORM_NAME]=result.getCell(i,NODE_META.FORM_NAME);node[NODE_META.CONTROL_NAME]=result.getCell(i,NODE_META.CONTROL_NAME);node[NODE_META.CONTROL_TYPE]=result.getCell(i,NODE_META.CONTROL_TYPE);node[NODE_META.CONTROL_PARENTNAME]=result.getCell(i,NODE_META.CONTROL_PARENTNAME);node[NODE_META.BLOCK_NAME]=result.getCell(i,NODE_META.BLOCK_NAME);node[NODE_META.SEQ_NO]=result.getCell(i,NODE_META.SEQ_NO);this.generateWidgetTree(node);}
this.parentNode.appendChild(this.generateUI());this.topUIWidget.bind();this.topUIWidget.callBack();}
EFFormRender.prototype.generateWidgetTree=function(node){var instance=this;switch(node[NODE_META.CONTROL_TYPE]){case NODE_TYPE.FORM_TOPNODE:var attr={};for(var o in this.FORM_ATTR){attr[this.FORM_ATTR[o]]=this.eiinfo.get(this.FORM_ATTR[o]);}
this.topUIWidget=new FormTopNodeWidget(node,this.eiinfo.getBlock(node[NODE_META.BLOCK_NAME]),attr);this.WidgetObjs[node[NODE_META.CONTROL_NAME]]=this.topUIWidget;this.topUIWidget.parentWidget=null;this.topUIWidget._formRender=instance;break;case NODE_TYPE.FORM_REGION:var formRegion=new FormRegionWidget(node,this.eiinfo.getBlock(node[NODE_META.BLOCK_NAME]));this.WidgetObjs[node[NODE_META.CONTROL_NAME]]=formRegion;this.WidgetObjs[node[NODE_META.CONTROL_PARENTNAME]].putChildWidget(formRegion);formRegion.parentWidget=this.WidgetObjs[node[NODE_META.CONTROL_PARENTNAME]];formRegion._formRender=instance;break;case NODE_TYPE.FORM_BUTTON:var formButton=new FormButtonWidget(node,this.eiinfo.getBlock(node[NODE_META.BLOCK_NAME]));this.WidgetObjs[node[NODE_META.CONTROL_NAME]]=formButton;this.WidgetObjs[node[NODE_META.CONTROL_PARENTNAME]].putChildWidget(formButton);formButton.parentWidget=this.WidgetObjs[node[NODE_META.CONTROL_PARENTNAME]];formButton._formRender=instance;break;case NODE_TYPE.FORM_NESTREGION:var formNest=new FormNestRegionWidget(node,this.eiinfo.getBlock(node[NODE_META.BLOCK_NAME]));this.WidgetObjs[node[NODE_META.CONTROL_NAME]]=formNest;this.WidgetObjs[node[NODE_META.CONTROL_PARENTNAME]].putChildWidget(formNest);formNest.parentWidget=this.WidgetObjs[node[NODE_META.CONTROL_PARENTNAME]];formNest._formRender=instance;break;case NODE_TYPE.FORM_FIELD:var formField=new FormFieldWidget(node,this.eiinfo.getBlock(node[NODE_META.BLOCK_NAME]));this.WidgetObjs[node[NODE_META.CONTROL_NAME]]=formField;this.WidgetObjs[node[NODE_META.CONTROL_PARENTNAME]].putChildWidget(formField);formField.parentWidget=this.WidgetObjs[node[NODE_META.CONTROL_PARENTNAME]];formField._formRender=instance;break;}}
EFFormRender.prototype.generateUI=function(){var div=document.createElement("div");div.innerHTML=this.topUIWidget.render();return div;}

var scrolltotop={setting:{startline:1,scrollto:0,scrollduration:80,fadeduration:[500,100]},controlHTML:'<img src="./EF/Images/gotop2.png" style="width:31px; height:31px;" />',controlattrs:{offsetx:20,offsety:20},anchorkeyword:'#top',state:{isvisible:false,shouldvisible:false},scrollup:function(){if(!this.cssfixedsupport)
this.$control.css({opacity:0})
var dest=isNaN(this.setting.scrollto)?this.setting.scrollto:parseInt(this.setting.scrollto)
if(typeof dest=="string"&&jQuery('#'+dest).length==1)
dest=jQuery('#'+dest).offset().top
else
dest=0
this.$body.animate({scrollTop:dest},this.setting.scrollduration);},keepfixed:function(){var $window=jQuery(window);var controlx=$window.scrollLeft()+$window.width()
-this.$control.width()-this.controlattrs.offsetx;var controly=$window.scrollTop()+$window.height()
-this.$control.height()-this.controlattrs.offsety;this.$control.css({left:controlx+'px',top:controly+'px'});},togglecontrol:function(){var scrolltop=jQuery(window).scrollTop();if(!this.cssfixedsupport)
this.keepfixed();this.state.shouldvisible=(scrolltop>=this.setting.startline)?true:false;if(this.state.shouldvisible&&!this.state.isvisible){this.$control.stop().show();this.state.isvisible=true;}else if(this.state.shouldvisible==false&&this.state.isvisible){this.$control.stop().hide();this.state.isvisible=false;}},offset:function(x,y){scrolltotop.controlattrs.offsetx=x;scrolltotop.controlattrs.offsety=y;},init:function(){jQuery(document).ready(function($){var mainobj=scrolltotop;var iebrws=document.all;mainobj.cssfixedsupport=!iebrws||iebrws&&document.compatMode=="CSS1Compat"&&window.XMLHttpRequest;mainobj.$body=(window.opera)?(document.compatMode=="CSS1Compat"?$('html'):$('body')):$('html,body')
mainobj.$control=$('<div id="topcontrol">'
+mainobj.controlHTML+'</div>').css({position:mainobj.cssfixedsupport?'fixed':'absolute',bottom:mainobj.controlattrs.offsety,left:mainobj.controlattrs.offsetx,display:'none',cursor:'pointer'}).attr({title:'回到顶部'}).click(function(){mainobj.scrollup();return false}).appendTo('body');if(document.all&&!window.XMLHttpRequest&&mainobj.$control.text()!='')
mainobj.$control.css({width:mainobj.$control.width()});mainobj.togglecontrol();$('a[href="'+mainobj.anchorkeyword+'"]').click(function(){mainobj.scrollup();return false;});$(window).bind('scroll resize',function(e){mainobj.togglecontrol();});$("#topcontrol").draggable();})}}

var Canvas2Image=(function(){var bHasCanvas=false;try{var oCanvas=document.createElement("canvas");if(oCanvas.getContext("2d"))
bHasCanvas=true;}catch(e){bHasCanvas=false;}
if(!bHasCanvas){return{'scaleCanvas':scaleCanvas,'makeImageObject':makeImageObject,saveAsBMP:function(){},saveAsPNG:function(){},saveAsJPEG:function(){}};}
var bHasImageData=!!(oCanvas.getContext("2d").getImageData);var bHasDataURL=!!(oCanvas.toDataURL);var bHasBase64=!!(window.btoa);var strDownloadMime="image/octet-stream";var readCanvasData=function(oCanvas){var iWidth=parseInt(oCanvas.width);var iHeight=parseInt(oCanvas.height);return oCanvas.getContext("2d").getImageData(0,0,iWidth,iHeight);}
var encodeData=function(data){var strData="";if(typeof data=="string"){strData=data;}else{var aData=data;for(var i=0;i<aData.length;i++){strData+=String.fromCharCode(aData[i]);}}
return btoa(strData);}
var createBMP=function(oData){var aHeader=[];var iWidth=oData.width;var iHeight=oData.height;aHeader.push(0x42);aHeader.push(0x4D);var iFileSize=iWidth*iHeight*3+54;aHeader.push(iFileSize%256);iFileSize=Math.floor(iFileSize/256);aHeader.push(iFileSize%256);iFileSize=Math.floor(iFileSize/256);aHeader.push(iFileSize%256);iFileSize=Math.floor(iFileSize/256);aHeader.push(iFileSize%256);aHeader.push(0);aHeader.push(0);aHeader.push(0);aHeader.push(0);aHeader.push(54);aHeader.push(0);aHeader.push(0);aHeader.push(0);var aInfoHeader=[];aInfoHeader.push(40);aInfoHeader.push(0);aInfoHeader.push(0);aInfoHeader.push(0);var iImageWidth=iWidth;aInfoHeader.push(iImageWidth%256);iImageWidth=Math.floor(iImageWidth/256);aInfoHeader.push(iImageWidth%256);iImageWidth=Math.floor(iImageWidth/256);aInfoHeader.push(iImageWidth%256);iImageWidth=Math.floor(iImageWidth/256);aInfoHeader.push(iImageWidth%256);var iImageHeight=iHeight;aInfoHeader.push(iImageHeight%256);iImageHeight=Math.floor(iImageHeight/256);aInfoHeader.push(iImageHeight%256);iImageHeight=Math.floor(iImageHeight/256);aInfoHeader.push(iImageHeight%256);iImageHeight=Math.floor(iImageHeight/256);aInfoHeader.push(iImageHeight%256);aInfoHeader.push(1);aInfoHeader.push(0);aInfoHeader.push(24);aInfoHeader.push(0);aInfoHeader.push(0);aInfoHeader.push(0);aInfoHeader.push(0);aInfoHeader.push(0);var iDataSize=iWidth*iHeight*3;aInfoHeader.push(iDataSize%256);iDataSize=Math.floor(iDataSize/256);aInfoHeader.push(iDataSize%256);iDataSize=Math.floor(iDataSize/256);aInfoHeader.push(iDataSize%256);iDataSize=Math.floor(iDataSize/256);aInfoHeader.push(iDataSize%256);for(var i=0;i<16;i++){aInfoHeader.push(0);}
var iPadding=(4-((iWidth*3)%4))%4;var aImgData=oData.data;var strPixelData="";var y=iHeight;do{var iOffsetY=iWidth*(y-1)*4;var strPixelRow="";for(var x=0;x<iWidth;x++){var iOffsetX=4*x;strPixelRow+=String.fromCharCode(aImgData[iOffsetY+iOffsetX+2]);strPixelRow+=String.fromCharCode(aImgData[iOffsetY+iOffsetX+1]);strPixelRow+=String.fromCharCode(aImgData[iOffsetY+iOffsetX]);}
for(var c=0;c<iPadding;c++){strPixelRow+=String.fromCharCode(0);}
strPixelData+=strPixelRow;}while(--y);var strEncoded=encodeData(aHeader.concat(aInfoHeader))+encodeData(strPixelData);return strEncoded;}
var saveFile=function(strData){document.location.href=strData;}
var makeDataURI=function(strData,strMime){return"data:"+strMime+";base64,"+strData;}
var makeImageObject=function(strSource){var oImgElement=document.createElement("img");oImgElement.src=strSource;return oImgElement;};var scaleCanvas=function(oCanvas,iWidth,iHeight){if(iWidth&&iHeight){var oSaveCanvas=document.createElement("canvas");oSaveCanvas.width=iWidth;oSaveCanvas.height=iHeight;oSaveCanvas.style.width=iWidth+"px";oSaveCanvas.style.height=iHeight+"px";var oSaveCtx=oSaveCanvas.getContext("2d");oSaveCtx.drawImage(oCanvas,0,0,oCanvas.width,oCanvas.height,0,0,iWidth,iHeight);return oSaveCanvas;}
return oCanvas;};return{'scaleCanvas':scaleCanvas,'makeImageObject':makeImageObject,saveAsPNG:function(oCanvas,bReturnImg,iWidth,iHeight){if(!bHasDataURL){return false;}
var oScaledCanvas=scaleCanvas(oCanvas,iWidth,iHeight);var strData=oScaledCanvas.toDataURL("image/png");if(bReturnImg){return makeImageObject(strData);}else{saveFile(strData.replace("image/png",strDownloadMime));}
return true;},saveAsJPEG:function(oCanvas,bReturnImg,iWidth,iHeight){if(!bHasDataURL){return false;}
var oScaledCanvas=scaleCanvas(oCanvas,iWidth,iHeight);var strMime="image/jpeg";var strData=oScaledCanvas.toDataURL(strMime);if(strData.indexOf(strMime)!=5){return false;}
if(bReturnImg){return makeImageObject(strData);}else{saveFile(strData.replace(strMime,strDownloadMime));}
return true;},saveAsBMP:function(oCanvas,bReturnImg,iWidth,iHeight){if(!(bHasImageData&&bHasBase64)){return false;}
var oScaledCanvas=scaleCanvas(oCanvas,iWidth,iHeight);var oData=readCanvasData(oScaledCanvas);var strImgData=createBMP(oData);if(bReturnImg){return makeImageObject(makeDataURI(strImgData,"image/bmp"));}else{saveFile(makeDataURI(strImgData,strDownloadMime));}
return true;}};})();

(function(win,doc,undefined){if(win.Feedback!==undefined){return;}
var log=function(msg){win.console.log(msg);},removeElements=function(remove){for(var i=0,len=remove.length;i<len;i++){var item=Array.prototype.pop.call(remove);if(item!==undefined){if(item.parentNode!==null){item.parentNode.removeChild(item);}}}},getBounds=function(el){return el.getBoundingClientRect();},emptyElements=function(el){var item;while(((item=el.firstChild)!==null?el.removeChild(item):false)){}},element=function(name,text){var el=doc.createElement(name);el.appendChild(doc.createTextNode(text));return el;},scriptLoader=function(script,func){if(script.onload===undefined){if(script.onreadystatechange!==undefined){var intervalFunc=function(){if(script.readyState!=="loaded"&&script.readyState!=="complete"){win.setTimeout(intervalFunc,250);}else{func();}};win.setTimeout(intervalFunc,250);}else{log("ERROR: We can't track when script is loaded");}}else{return func;}},h2cQueue,h2cCanvas,h2cDone=false,clickDone=false,fcAvailable,html2obj,canvasHolder,blackoutBox,highlightBox,highlightClose,nextButton,body,CANVAS="canvas",DIV="div",H2C_IGNORE="data-html2canvas-ignore",PX="px",highlightContainer,mouseMoveEvent,modalBody,message,mouseClickEvent,dataExclude="data-exclude",h2cAvailable,feedback_params={};win.Feedback={debug:true,log:log,init:function(options){var button,modal,body=doc.body,glass=doc.createElement(DIV),returnMethods={open:function(){var modalHeader=doc.createElement(DIV),modalFooter=doc.createElement(DIV),script,runH2c=function(){try{options.onrendered=options.onrendered||function(canvas){h2cCanvas=canvas;h2cDone=true;nextFunc();};html2obj=win.html2canvas([doc.body],options);}catch(e){h2cDone=true;nextFunc();log("Error in html2canvas: "+e.message);}},a=element("a",options.closeLabel||"×");modalBody=doc.createElement(DIV);body.appendChild(glass);message=$("<textarea id='feedback_info' />")[0];if(win.html2canvas===undefined&&script===undefined){script=doc.createElement("script");script.src=options.h2cPath||"./EF/FeedBack/html2canvas.min.js";script.onerror=function(){h2cAvailable=false;log("Failed to load html2canvas library, check that the path is correctly defined");};script.onload=(scriptLoader)(script,function(){if(win.html2canvas===undefined){log("Loaded html2canvas, but library not found");h2cAvailable=false;return;}
win.html2canvas.logging=win.Feedback.debug;runH2c();h2cAvailable=true;});body.appendChild(script);}else{runH2c();}
a.className=options.closeClass||"close";a.onclick=returnMethods.close;a.href="#";button.disabled=true;modalHeader.appendChild(a);modalHeader.appendChild(element("h3",options.modalHeader||"Send Feedback"));modalHeader.className="feedback-header";modalBody.className="feedback-body";modalBody.appendChild(element("p",options.modalIntro||"Please describe the issue you are experiencing"));modalBody.appendChild(message);nextButton=element("button",options.nextLabel||"Continue");nextButton.className=options.buttonClass||"btn";nextButton.onclick=function(){clickDone=true;nextButton.disabled=true;feedback_params.title=$('#feedback_info').val();emptyElements(modalBody);nextFunc();};function nextFunc(){var progressBar,action=true;if(clickDone){nextButton.onclick=function(e){e.preventDefault();body.removeEventListener("mousemove",mouseMoveEvent,false);body.removeEventListener("click",mouseClickEvent,false);returnMethods.review();};}
if(h2cDone&&clickDone){nextButton.disabled=false;var timer,removeElement,ctx,buttonClickFunction=function(e){e.preventDefault();$(blackoutButton).toggleClass('active');$(highlightButton).toggleClass('active');action=!action;},clearBox=function(){blackoutBox.style.left="-5px";blackoutBox.style.top="-5px";blackoutBox.style.width="0px";blackoutBox.style.height="0px";blackoutBox.setAttribute(dataExclude,true);highlightBox.style.left="-5px";highlightBox.style.top="-5px";highlightBox.style.width="0px";highlightBox.style.height="0px";highlightBox.setAttribute(dataExclude,true);win.clearTimeout(timer);},hideClose=function(){highlightClose.style.left="-50px";highlightClose.style.top="-50px";},blackoutButton=element("a",options.BlackButton||"Blackout"),highlightButton=element("a",options.HighButton||"Highlight"),previousElement;mouseMoveEvent=function(e){if(e.target!==previousElement&&($(e.target).hasClass("feedback-blackedout")||$(e.target).hasClass("feedback-highlighted"))){var left=(parseInt(e.target.style.left,10)+parseInt(e.target.style.width,10));left=Math.max(left,10);left=Math.min(left,win.innerWidth-15);var top=(parseInt(e.target.style.top,10));top=Math.max(top,10);highlightClose.style.left=left+PX;highlightClose.style.top=top+PX;removeElement=e.target;clearBox();previousElement=undefined;return;}
if(e.target.nodeName==="BODY"||e.target===highlightClose||e.target===modal||e.target===nextButton||e.target.parentNode===modal||e.target.parentNode===modalHeader){clearBox();previousElement=e.target;return;}
hideClose();if(e.target!==previousElement){previousElement=e.target;win.clearTimeout(timer);timer=win.setTimeout(function(){var bounds=getBounds(previousElement),item;if(action===false){item=blackoutBox;}else{item=highlightBox;item.width=bounds.width;item.height=bounds.height;ctx.drawImage(h2cCanvas,win.pageXOffset+bounds.left,win.pageYOffset+bounds.top,bounds.width,bounds.height,0,0,bounds.width,bounds.height);}
item.setAttribute(dataExclude,false);item.style.left=win.pageXOffset+bounds.left+PX;item.style.top=win.pageYOffset+bounds.top+PX;item.style.width=bounds.width+PX;item.style.height=bounds.height+PX;},100);}};mouseClickEvent=function(e){if(button.disabled===false){return;}
e.preventDefault();if(action===false){if(blackoutBox.getAttribute(dataExclude)==="false"){var blackout=doc.createElement(DIV);$(blackout).addClass('feedback-blackedout');blackout.style.left=blackoutBox.style.left;blackout.style.top=blackoutBox.style.top;blackout.style.width=blackoutBox.style.width;blackout.style.height=blackoutBox.style.height;body.appendChild(blackout);previousElement=undefined;}}else{if(highlightBox.getAttribute(dataExclude)==="false"){$(highlightBox).addClass('feedback-highlighted');$(highlightBox).removeClass('feedback-highlight-element');highlightBox=doc.createElement('canvas');ctx=highlightBox.getContext("2d");$(highlightBox).addClass("feedback-highlight-element");body.appendChild(highlightBox);clearBox();previousElement=undefined;}}};$(modal).addClass('feedback-animate-toside');blackoutBox=doc.createElement('div');highlightBox=doc.createElement(CANVAS);ctx=highlightBox.getContext("2d");highlightClose=element(DIV,"×");highlightContainer=doc.createElement('div');highlightClose.id="feedback-highlight-close";highlightClose.addEventListener("click",function(){removeElement.parentNode.removeChild(removeElement);hideClose();},false);body.appendChild(highlightClose);$(h2cCanvas).addClass('feedback-canvas');body.appendChild(h2cCanvas);var buttonItem=[highlightButton,blackoutButton];modalBody.appendChild(element("p",options.Highlight||"Highlight or blackout important information"));for(var i=0;i<2;i++){$(buttonItem[i]).addClass('btn');$(buttonItem[i]).addClass('btn-small');$(buttonItem[i]).addClass(i===0?'active':'btn-inverse');buttonItem[i].href="#";buttonItem[i].onclick=buttonClickFunction;modalBody.appendChild(buttonItem[i]);modalBody.appendChild(doc.createTextNode(" "));}
highlightContainer.id="feedback-highlight-container";highlightContainer.style.width=h2cCanvas.width+PX;highlightContainer.style.height=h2cCanvas.height+PX;$(highlightBox).addClass("feedback-highlight-element");blackoutBox.id="feedback-blackout-element";body.appendChild(highlightBox);highlightContainer.appendChild(blackoutBox);body.appendChild(highlightContainer);body.addEventListener("mousemove",mouseMoveEvent,false);body.addEventListener("click",mouseClickEvent,false);}else if(clickDone){}}
modalFooter.className="feedback-footer";modalFooter.appendChild(nextButton);modal=doc.createElement(DIV);modal.className=options.modalClass||"modal";modal.setAttribute(H2C_IGNORE,true);modal.appendChild(modalHeader);modal.appendChild(modalBody);modal.appendChild(modalFooter);body.appendChild(modal);},review:function(){$(message).val('');$(modal).addClass("feedback-animate-review");emptyElements(modalBody);var browserSpecs=doc.createElement(DIV);if(h2cCanvas!==undefined){var ctx=h2cCanvas.getContext("2d"),canvasCopy,copyCtx,radius=5;ctx.fillStyle="#000";Array.prototype.slice.call(doc.getElementsByClassName('feedback-blackedout'),0).forEach(function(item){var bounds=getBounds(item);ctx.fillRect(bounds.left,bounds.top,bounds.width,bounds.height);body.removeChild(item);});var items=Array.prototype.slice.call(doc.getElementsByClassName('feedback-highlighted'),0);if(items.length>0){canvasCopy=doc.createElement(CANVAS);copyCtx=canvasCopy.getContext('2d');canvasCopy.width=h2cCanvas.width;canvasCopy.height=h2cCanvas.height;copyCtx.drawImage(h2cCanvas,0,0);ctx.fillStyle="#777";ctx.globalAlpha=0.5;ctx.fillRect(0,0,h2cCanvas.width,h2cCanvas.height);ctx.beginPath();items.forEach(function(item){var bounds=getBounds(item);var x=parseInt(item.style.left,10),y=parseInt(item.style.top,10),width=parseInt(item.style.width,10),height=parseInt(item.style.height,10);ctx.moveTo(x+radius,y);ctx.lineTo(x+width-radius,y);ctx.quadraticCurveTo(x+width,y,x+width,y+radius);ctx.lineTo(x+width,y+height-radius);ctx.quadraticCurveTo(x+width,y+height,x+width-radius,y+height);ctx.lineTo(x+radius,y+height);ctx.quadraticCurveTo(x,y+height,x,y+height-radius);ctx.lineTo(x,y+radius);ctx.quadraticCurveTo(x,y,x+radius,y);body.removeChild(item);});ctx.closePath();ctx.clip();ctx.globalAlpha=1;ctx.drawImage(canvasCopy,0,0);removeElements([glass]);}
canvasCopy=doc.createElement(CANVAS);copyCtx=canvasCopy.getContext('2d');canvasCopy.width=300;canvasCopy.height=Math.round(h2cCanvas.height*(canvasCopy.width/h2cCanvas.width));copyCtx.drawImage(h2cCanvas,0,0,h2cCanvas.width,h2cCanvas.height,0,0,canvasCopy.width,canvasCopy.height);modalBody.appendChild(canvasCopy);nextButton.firstChild.nodeValue=options.SendForm||"Send form";$(h2cCanvas).addClass("feedback-canvas-complete");browserSpecs.style.height=canvasCopy.height+20+PX;nextButton.onclick=function()
{feedback_params.info=$(message).val();var info=new EiInfo();info.set('efFormEname',__eiInfo.get('efFormEname'));info.set('title',feedback_params.title);info.set('info',feedback_params.info);info.set('data',Canvas2Image.scaleCanvas(h2cCanvas).toDataURL());EiCommunicator.send("EFFB00","saveImageFile",info,null);returnMethods.close();}}
$(browserSpecs).addClass("feedback-browser");browserSpecs.appendChild(element("h3",options.browserInfo||"Browser information"));modalBody.appendChild(browserSpecs);modalBody.appendChild(element("p",options.modalIntro||"Please describe the issue you are experiencing"));modalBody.appendChild(message);},close:function(){button.disabled=false;h2cDone=false;clickDone=false;removeElements([modal,glass,blackoutBox,highlightBox,highlightClose,highlightContainer,h2cCanvas]);removeElements(doc.getElementsByClassName('feedback-blackedout'));removeElements(doc.getElementsByClassName('feedback-highlighted'));body.removeEventListener("mousemove",mouseMoveEvent,false);body.removeEventListener("click",mouseClickEvent,false);h2cCanvas=undefined;return false;}};glass.className="feedback-glass";glass.style.pointerEvents="none";glass.setAttribute(H2C_IGNORE,true);options=options||{};button=options.btn;button.setAttribute(H2C_IGNORE,true);button.onclick=returnMethods.open;}};})(window,document);

(function(u,B,n){function D(c){j.logging&&u.console&&u.console.log&&u.console.log(c)}function T(c,i){var f=[];return{storage:f,width:c,height:i,fillRect:function(){f.push({type:"function",name:"fillRect",arguments:arguments})},drawShape:function(){var a=[];f.push({type:"function",name:"drawShape",arguments:a});return{moveTo:function(){a.push({name:"moveTo",arguments:arguments})},lineTo:function(){a.push({name:"lineTo",arguments:arguments})},bezierCurveTo:function(){a.push({name:"bezierCurveTo",arguments:arguments})},quadraticCurveTo:function(){a.push({name:"quadraticCurveTo",arguments:arguments})}}},drawImage:function(){f.push({type:"function",name:"drawImage",arguments:arguments})},fillText:function(){f.push({type:"function",name:"fillText",arguments:arguments})},setVariable:function(a,c){f.push({type:"variable",name:a,arguments:c})}}}var j={},S,L;j.Util={};j.Util.backgroundImage=function(c){if(/data:image\/.*;base64,/i.test(c)||/^(-webkit|-moz|linear-gradient|-o-)/.test(c))return c;c.toLowerCase().substr(0,5)==='url("'?(c=c.substr(5),c=c.substr(0,c.length-2)):(c=c.substr(4),c=c.substr(0,c.length-1));return c};j.Util.Bounds=function(c){var i={};if(c.getBoundingClientRect)return c=c.getBoundingClientRect(),i.top=c.top,i.bottom=c.bottom||c.top+c.height,i.left=c.left,i.width=c.width||c.right-c.left,i.height=c.height||c.bottom-c.top,i};j.Util.getCSS=function(c,i){function f(a,b){var i=c.runtimeStyle&&c.runtimeStyle[a],d,g=c.style;if(!/^-?[0-9]+\.?[0-9]*(?:px)?$/i.test(b)&&/^-?\d/.test(b)){d=g.left;if(i)c.runtimeStyle.left=c.currentStyle.left;g.left=a==="fontSize"?"1em":b||0;b=g.pixelLeft+"px";g.left=d;if(i)c.runtimeStyle.left=i}return!/^(thin|medium|thick)$/i.test(b)?Math.round(parseFloat(b))+"px":b}var a;if(u.getComputedStyle)void 0!==c&&(S=B.defaultView.getComputedStyle(c,null)),a=S[i],i==="backgroundPosition"?(a=(a.split(",")[0]||"0 0").split(" "),a[0]=a[0].indexOf("%")===-1?f(i+"X",a[0]):a[0],a[1]=a[1]===n?a[0]:a[1],a[1]=a[1].indexOf("%")===-1?f(i+"Y",a[1]):a[1]):/border(Top|Bottom)(Left|Right)Radius/.test(i)&&(a=a.split(" "),a.length<=1&&(a[1]=a[0]),a[0]=parseInt(a[0],10),a[1]=parseInt(a[1],10));else if(c.currentStyle)if(i==="backgroundPosition")a=[f(i+"X",c.currentStyle[i+"X"]),f(i+"Y",c.currentStyle[i+"Y"])];else if(a=f(i,c.currentStyle[i]),/^(border)/i.test(i)&&/^(medium|thin|thick)$/i.test(a))switch(a){case"thin":a="1px";break;case"medium":a="0px";break;case"thick":a="5px"}return a};j.Util.BackgroundPosition=function(c,i,f){var c=j.Util.getCSS(c,"backgroundPosition"),a,e;c.length===1&&(a=c,c=[],c[0]=a,c[1]=a);c[0].toString().indexOf("%")!==-1?(e=parseFloat(c[0])/100,a=i.width*e-f.width*e):a=parseInt(c[0],10);c[1].toString().indexOf("%")!==-1?(e=parseFloat(c[1])/100,i=i.height*e-f.height*e):i=parseInt(c[1],10);return{top:i,left:a}};j.Util.Extend=function(c,i){for(var f in c)c.hasOwnProperty(f)&&(i[f]=c[f]);return i};j.Util.Children=function(c){var i;try{i=c.nodeName&&c.nodeName.toUpperCase()==="IFRAME"?c.contentDocument||c.contentWindow.document:function(a){var c=[];a!==null&&function(a,c){var e=a.length,i=0;if(typeof c.length==="number")for(var f=c.length;i<f;i++)a[e++]=c[i];else for(;c[i]!==n;)a[e++]=c[i++];a.length=e;return a}(c,a);return c}(c.childNodes)}catch(f){D("html2canvas.Util.Children failed with exception: "+f.message),i=[]}return i};(function(){j.Generate={};var c=[/^(-webkit-linear-gradient)\(([a-z\s]+)([\w\d\.\s,%\(\)]+)\)$/,/^(-o-linear-gradient)\(([a-z\s]+)([\w\d\.\s,%\(\)]+)\)$/,/^(-webkit-gradient)\((linear|radial),\s((?:\d{1,3}%?)\s(?:\d{1,3}%?),\s(?:\d{1,3}%?)\s(?:\d{1,3}%?))([\w\d\.\s,%\(\)-]+)\)$/,/^(-moz-linear-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?))([\w\d\.\s,%\(\)]+)\)$/,/^(-webkit-radial-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?)),\s(\w+)\s([a-z-]+)([\w\d\.\s,%\(\)]+)\)$/,/^(-moz-radial-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?)),\s(\w+)\s?([a-z-]*)([\w\d\.\s,%\(\)]+)\)$/,/^(-o-radial-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?)),\s(\w+)\s([a-z-]+)([\w\d\.\s,%\(\)]+)\)$/];j.Generate.parseGradient=function(i,f){var a,e,b=c.length,h,d,g,q;for(e=0;e<b;e+=1)if(h=i.match(c[e]))break;if(h)switch(h[1]){case"-webkit-linear-gradient":case"-o-linear-gradient":a={type:"linear",x0:null,y0:null,x1:null,y1:null,colorStops:[]};if(b=h[2].match(/\w+/g)){d=b.length;for(e=0;e<d;e+=1)switch(b[e]){case"top":a.y0=0;a.y1=f.height;break;case"right":a.x0=f.width;a.x1=0;break;case"bottom":a.y0=f.height;a.y1=0;break;case"left":a.x0=0,a.x1=f.width}}if(a.x0===null&&a.x1===null)a.x0=a.x1=f.width/2;if(a.y0===null&&a.y1===null)a.y0=a.y1=f.height/2;if(b=h[3].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)(?:\s\d{1,3}(?:%|px))?)+/g)){d=b.length;g=1/Math.max(d-
1,1);for(e=0;e<d;e+=1)q=b[e].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\s*(\d{1,3})?(%|px)?/),q[2]?(h=parseFloat(q[2]),h/=q[3]==="%"?100:f.width):h=e*g,a.colorStops.push({color:q[1],stop:h})}break;case"-webkit-gradient":a={type:h[2]==="radial"?"circle":h[2],x0:0,y0:0,x1:0,y1:0,colorStops:[]};if(b=h[3].match(/(\d{1,3})%?\s(\d{1,3})%?,\s(\d{1,3})%?\s(\d{1,3})%?/))a.x0=b[1]*f.width/100,a.y0=b[2]*f.height/100,a.x1=b[3]*f.width/100,a.y1=b[4]*f.height/100;if(b=h[4].match(/((?:from|to|color-stop)\((?:[0-9\.]+,\s)?(?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)\))+/g)){d=b.length;for(e=0;e<d;e+=1)q=b[e].match(/(from|to|color-stop)\(([0-9\.]+)?(?:,\s)?((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\)/),h=parseFloat(q[2]),q[1]==="from"&&(h=0),q[1]==="to"&&(h=1),a.colorStops.push({color:q[3],stop:h})}break;case"-moz-linear-gradient":a={type:"linear",x0:0,y0:0,x1:0,y1:0,colorStops:[]};if(b=h[2].match(/(\d{1,3})%?\s(\d{1,3})%?/))a.x0=b[1]*f.width/100,a.y0=b[2]*f.height/100,a.x1=f.width-a.x0,a.y1=f.height-a.y0;if(b=h[3].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)(?:\s\d{1,3}%)?)+/g)){d=b.length;g=1/Math.max(d-1,1);for(e=0;e<d;e+=1)q=b[e].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\s*(\d{1,3})?(%)?/),q[2]?(h=parseFloat(q[2]),q[3]&&(h/=100)):h=e*g,a.colorStops.push({color:q[1],stop:h})}break;case"-webkit-radial-gradient":case"-moz-radial-gradient":case"-o-radial-gradient":a={type:"circle",x0:0,y0:0,x1:f.width,y1:f.height,cx:0,cy:0,rx:0,ry:0,colorStops:[]};if(b=h[2].match(/(\d{1,3})%?\s(\d{1,3})%?/))a.cx=b[1]*f.width/100,a.cy=b[2]*f.height/100;b=h[3].match(/\w+/);q=h[4].match(/[a-z-]*/);if(b&&q)switch(q[0]){case"farthest-corner":case"cover":case"":e=Math.sqrt(Math.pow(a.cx,2)+Math.pow(a.cy,2));b=Math.sqrt(Math.pow(a.cx,2)+Math.pow(a.y1-a.cy,2));d=Math.sqrt(Math.pow(a.x1-a.cx,2)+Math.pow(a.y1-a.cy,2));q=Math.sqrt(Math.pow(a.x1-a.cx,2)+Math.pow(a.cy,2));a.rx=a.ry=Math.max(e,b,d,q);break;case"closest-corner":e=Math.sqrt(Math.pow(a.cx,2)+Math.pow(a.cy,2));b=Math.sqrt(Math.pow(a.cx,2)+Math.pow(a.y1-a.cy,2));d=Math.sqrt(Math.pow(a.x1-a.cx,2)+Math.pow(a.y1-a.cy,2));q=Math.sqrt(Math.pow(a.x1-a.cx,2)+Math.pow(a.cy,2));a.rx=a.ry=Math.min(e,b,d,q);break;case"farthest-side":b[0]==="circle"?a.rx=a.ry=Math.max(a.cx,a.cy,a.x1-a.cx,a.y1-a.cy):(a.type=b[0],a.rx=Math.max(a.cx,a.x1-a.cx),a.ry=Math.max(a.cy,a.y1-a.cy));break;case"closest-side":case"contain":b[0]==="circle"?a.rx=a.ry=Math.min(a.cx,a.cy,a.x1-a.cx,a.y1-a.cy):(a.type=b[0],a.rx=Math.min(a.cx,a.x1-a.cx),a.ry=Math.min(a.cy,a.y1-a.cy))}if(b=h[5].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)(?:\s\d{1,3}(?:%|px))?)+/g)){d=b.length;g=1/Math.max(d-1,1);for(e=0;e<d;e+=1)q=b[e].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\s*(\d{1,3})?(%|px)?/),q[2]?(h=parseFloat(q[2]),h/=q[3]==="%"?100:f.width):h=e*g,a.colorStops.push({color:q[1],stop:h})}}return a};j.Generate.Gradient=function(c,f){var a=B.createElement("canvas"),e=a.getContext("2d"),b,h,d,g,q;a.width=f.width;a.height=f.height;b=j.Generate.parseGradient(c,f);q=new Image;if(b)if(b.type==="linear"){h=e.createLinearGradient(b.x0,b.y0,b.x1,b.y1);d=0;for(g=b.colorStops.length;d<g;d+=1)try{h.addColorStop(b.colorStops[d].stop,b.colorStops[d].color)}catch(u){D(["failed to add color stop: ",u,"; tried to add: ",b.colorStops[d],"; stop: ",d,"; in: ",c])}e.fillStyle=h;e.fillRect(0,0,f.width,f.height);q.src=a.toDataURL()}else if(b.type==="circle"){h=e.createRadialGradient(b.cx,b.cy,0,b.cx,b.cy,b.rx);d=0;for(g=b.colorStops.length;d<g;d+=1)try{h.addColorStop(b.colorStops[d].stop,b.colorStops[d].color)}catch(n){D(["failed to add color stop: ",n,"; tried to add: ",b.colorStops[d],"; stop: ",d,"; in: ",c])}e.fillStyle=h;e.fillRect(0,0,f.width,f.height);q.src=a.toDataURL()}else if(b.type==="ellipse"){var s=B.createElement("canvas"),v=s.getContext("2d");h=Math.max(b.rx,b.ry);var K=h*2,t;s.width=s.height=K;h=v.createRadialGradient(b.rx,b.ry,0,b.rx,b.ry,h);d=0;for(g=b.colorStops.length;d<g;d+=1)try{h.addColorStop(b.colorStops[d].stop,b.colorStops[d].color)}catch(w){D(["failed to add color stop: ",w,"; tried to add: ",b.colorStops[d],"; stop: ",d,"; in: ",c])}v.fillStyle=h;v.fillRect(0,0,K,K);e.fillStyle=b.colorStops[d-1].color;e.fillRect(0,0,a.width,a.height);t=new Image;t.onload=function(){e.drawImage(t,b.cx-b.rx,b.cy-b.ry,2*b.rx,2*b.ry);q.src=a.toDataURL()};t.src=s.toDataURL()}return q};j.Generate.ListAlpha=function(c){var f="",a;do a=c%26,f=String.fromCharCode(a+64)+f,c/=26;while(c*26>26);return f};j.Generate.ListRoman=function(c){var f=["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"],a=[1E3,900,500,400,100,90,50,40,10,9,5,4,1],e="",b,h=f.length;if(c<=0||c>=4E3)return c;for(b=0;b<h;b+=1)for(;c>=a[b];)c-=a[b],e+=f[b];return e}})();j.Parse=function(c,i){function f(){return{width:Math.max(Math.max(z.body.scrollWidth,z.documentElement.scrollWidth),Math.max(z.body.offsetWidth,z.documentElement.offsetWidth),Math.max(z.body.clientWidth,z.documentElement.clientWidth)),height:Math.max(Math.max(z.body.scrollHeight,z.documentElement.scrollHeight),Math.max(z.body.offsetHeight,z.documentElement.offsetHeight),Math.max(z.body.clientHeight,z.documentElement.clientHeight))}}
function a(a,b){var c=parseInt(y(a,b),10);return isNaN(c)?0:c}function e(a,b,c,e,d,g){g!=="transparent"&&(a.setVariable("fillStyle",g),a.fillRect(b,c,e,d),I+=1)}function b(a,b){switch(b){case"lowercase":return a.toLowerCase();case"capitalize":return a.replace(/(^|\s|:|-|\(|\))([a-z])/g,function(a,b,c){if(a.length>0)return b+c.toUpperCase()});case"uppercase":return a.toUpperCase();default:return a}}function h(a){return a.replace(/^\s*/g,"").replace(/\s*$/g,"")}function d(a,c,d){var d=d.ctx,g=y(a,"fontFamily"),f=y(a,"fontSize"),q=y(a,"color"),o=y(a,"textDecoration"),H=y(a,"textAlign"),m=y(a,"letterSpacing"),J,C,p=y(a,"fontWeight"),k=y(a,"fontStyle"),l=y(a,"fontVariant"),A=0,r;c.nodeValue=b(c.nodeValue,y(a,"textTransform"));if(h(c.nodeValue).length>0){if(o!=="none")if(x[g+"-"+f]!==n)C=x[g+"-"+f];else{C=z.createElement("div");a=z.createElement("img");r=z.createElement("span");var s;C.style.visibility="hidden";C.style.fontFamily=g;C.style.fontSize=f;C.style.margin=0;C.style.padding=0;N.appendChild(C);a.src="data:image/gif;base64,R0lGODlhAQABAIABAP///wAAACwAAAAAAQABAAACAkQBADs=";a.width=1;a.height=1;a.style.margin=0;a.style.padding=0;a.style.verticalAlign="baseline";r.style.fontFamily=g;r.style.fontSize=f;r.style.margin=0;r.style.padding=0;r.appendChild(z.createTextNode("Hidden Text"));C.appendChild(r);C.appendChild(a);s=a.offsetTop-r.offsetTop+1;C.removeChild(r);C.appendChild(z.createTextNode("Hidden Text"));C.style.lineHeight="normal";a.style.verticalAlign="super";a={baseline:s,lineWidth:1,middle:a.offsetTop-
C.offsetTop+1};x[g+"-"+f]=a;N.removeChild(C);C=a}H=H.replace(["-webkit-auto"],["auto"]);H=i.letterRendering===!1&&/^(left|right|justify|auto)$/.test(H)&&/^(normal|none)$/.test(m)?c.nodeValue.split(/(\b| )/):c.nodeValue.split("");switch(parseInt(p,10)){case 401:p="bold";break;case 400:p="normal"}d.setVariable("fillStyle",q);d.setVariable("font",k+" "+l+" "+p+" "+f+" "+g);d.setVariable("textAlign","left");f=c;p=0;for(g=H.length;p<g;p+=1){k=null;if(w.rangeBounds){if(o!=="none"||h(H[p]).length!==0)k=H[p],z.createRange?(J=z.createRange(),J.setStart(c,A),J.setEnd(c,A+k.length)):J=N.createTextRange(),J=J.getBoundingClientRect()?J.getBoundingClientRect():{}}else{if(typeof f.nodeValue!=="string")continue;l=f.splitText(H[p].length);m=f.parentNode;a=z.createElement("wrapper");r=f.cloneNode(!0);a.appendChild(f.cloneNode(!0));m.replaceChild(a,f);J=j.Util.Bounds(a);k=f.nodeValue;f=l;m.replaceChild(r,a)}if(k!==null)l=J.left,m=J.bottom,a=d,h(k).length>0&&(a.fillText(k,l,m),I+=1);switch(o){case"underline":e(d,J.left,Math.round(J.top+C.baseline+C.lineWidth),J.width,1,q);break;case"overline":e(d,J.left,J.top,J.width,1,q);break;case"line-through":e(d,J.left,Math.ceil(J.top+C.middle+C.lineWidth),J.width,1,q)}A+=H[p].length}}}function g(a){return(a=c[a])&&a.succeeded===!0?a.img:!1}function q(a,b){var c=Math.max(a.left,b.left),d=Math.max(a.top,b.top);return{left:c,top:d,width:Math.min(a.left+a.width,b.left+b.width)-c,height:Math.min(a.top+a.height,b.top+b.height)-d}}function P(b,c,d,e){var g=d.left,f=d.top,i=d.width,d=d.height,h,m,o,w,p,k,l,j=function(b){var c=[],d=["Top","Right","Bottom","Left"],e;for(e=0;e<4;e+=1)c.push({width:a(b,"border"+d[e]+"Width"),color:y(b,"border"+d[e]+"Color")});return c}(b);(function(a){var b=[],c=["TopLeft","TopRight","BottomRight","BottomLeft"],d;for(d=0;d<4;d+=1)b.push(y(a,"border"+c[d]+"Radius"));return b})(b);for(b=0;b<4;b+=1)if(h=j[b],l=[],h.width>0){m=g;o=f;w=i;p=d-j[2].width;switch(b){case 0:p=j[0].width;k=0;l[k++]=["line",m,o];l[k++]=["line",m+w,o];l[k++]=["line",m+w-j[1].width,o+p];l[k++]=["line",m+j[3].width,o+p];break;case 1:m=g+i-j[1].width;w=j[1].width;k=0;l[k++]=["line",m,o+j[0].width];l[k++]=["line",m+w,o];l[k++]=["line",m+w,o+p+j[2].width];l[k++]=["line",m,o+p];break;case 2:o=o+d-j[2].width;p=j[2].width;k=0;l[k++]=["line",m+j[3].width,o];l[k++]=["line",m+w-j[2].width,o];l[k++]=["line",m+w,o+p];l[k++]=["line",m,o+p];break;case 3:w=j[3].width,k=0,l[k++]=["line",m,o],l[k++]=["line",m+w,o+j[0].width],l[k++]=["line",m+w,o+p],l[k++]=["line",m,o+p+j[2].width]}k={left:m,top:o,width:w,height:p};e&&(k=q(k,e));if(k.width>0&&k.height>0&&h.color!=="transparent"){c.setVariable("fillStyle",h.color);h=c.drawShape();m=l.length;for(k=0;k<m;k++)h[k===0?"moveTo":l[k][0]+"To"].apply(null,l[k].slice(1));I+=1}}return j}function O(a,b,c){var e=z.createElement("valuewrap"),g=["lineHeight","textAlign","fontFamily","color","fontSize","paddingLeft","paddingTop","width","height","border","borderLeftWidth","borderTopWidth"],f,i,h;f=0;for(i=g.length;f<i;f+=1){h=g[f];try{e.style[h]=y(a,h)}catch(o){D("html2canvas: Parse: Exception caught in renderFormValue: "+o.message)}}e.style.borderColor="black";e.style.borderStyle="solid";e.style.display="block";e.style.position="absolute";if(/^(submit|reset|button|text|password)$/.test(a.type)||a.nodeName==="SELECT")e.style.lineHeight=y(a,"height");e.style.top=b.top+"px";e.style.left=b.left+"px";b=z.createTextNode(a.nodeName==="SELECT"?a.options[a.selectedIndex].text:a.value);e.appendChild(b);N.appendChild(e);d(a,b,c);N.removeChild(e)}function s(a,b,c,e,d,f,g,i){var h=0,o=0;g-c>0&&(h=g-c);i-e>0&&(o=i-e);a.drawImage(b,h,o,d-h,f-o,c+h,e+o,d-h,f-o);I+=1}function v(a,b,c,e,d,f,g){var g=Math.min(b.height,g),i,h;c.left-=Math.ceil(c.left/b.width)*b.width;for(h=e+c.left;h<f+e;)i=Math.floor(h+b.width)>f+e?f+e-h:b.width,s(a,b,h,d+c.top,i,g,e,d),h=Math.floor(h+b.width)}function K(b,c){var d=j.Util.Bounds(b),o=d.left,w=d.top,x=d.width,E=d.height,H,m=y(b,"backgroundColor"),u=y(b,"position"),C,p=y(b,"opacity"),k,l;c?L={}:(L=f(),c={opacity:1});l=y(b,"zIndex");(C=c.zIndex)?l!=="auto"&&(l={zindex:l,children:[]},C.children.push(l),C=l):C=l={zindex:0,children:[]};k={ctx:T(L.width||x,L.height||E),zIndex:C,opacity:p*c.opacity,cssPosition:u};if(c.clip)k.clip=j.Util.Extend({},c.clip);if(i.useOverflow===!0&&/(hidden|scroll|auto)/.test(y(b,"overflow"))===!0&&/(BODY)/i.test(b.nodeName)===!1)k.clip=k.clip?q(k.clip,d):d;u=C.children.push(k);l=C.children[u-1].ctx;l.setVariable("globalAlpha",k.opacity);p=P(b,l,d,!1);k.borders=p;F.test(b.nodeName)&&i.iframeDefault!=="transparent"&&(m=i.iframeDefault==="default"?"#efefef":i.iframeDefault);x={left:o+p[3].width,top:w+p[0].width,width:x-(p[1].width+p[3].width),height:E-(p[0].width+p[2].width)};k.clip&&(x=q(x,k.clip));if(x.height>0&&x.width>0){e(l,x.left,x.top,x.width,x.height,m);var A=x,r=y(b,"backgroundImage"),n=y(b,"backgroundRepeat").split(",")[0],t,B,G;!/data:image\/.*;base64,/i.test(r) && !/^(-webkit|-moz|linear-gradient|-o-)/.test(r)&&(r=r.split(",")[0]);if(typeof r!=="undefined"&&/^(1|none)$/.test(r)===!1)if(r=j.Util.backgroundImage(r),m=g(r),E=j.Util.BackgroundPosition(b,A,m),m)switch(n){case"repeat-x":v(l,m,E,A.left,A.top,A.width,A.height);break;case"repeat-y":r=A.left;n=A.top;t=A.height;B=Math.min(m.width,A.width);E.top-=Math.ceil(E.top/m.height)*m.height;for(G=n+E.top;G<t+n;)A=Math.floor(G+m.height)>t+n?t+n-G:m.height,s(l,m,r+E.left,G,B,A,r,n),G=Math.floor(G+m.height);break;case"no-repeat":r=A.width-E.left;G=A.height-E.top;n=E.left;t=E.top;B=E.left+A.left;E=E.top+A.top;n<0?(n=Math.abs(n),B+=n,r=Math.min(A.width,m.width-n)):(r=Math.min(r,m.width),n=0);t<0?(t=Math.abs(t),E+=t,G=Math.min(A.height,m.height-t)):(G=Math.min(G,m.height),t=0);G>0&&r>0&&(l.drawImage(m,n,t,r,G,B,E,r,G),I+=1);break;default:E.top-=Math.ceil(E.top/m.height)*m.height;for(r=A.top+E.top;r<A.height+A.top;)n=Math.min(m.height,A.height+A.top-r),n=Math.floor(r+m.height)>n+r?n+r-r:m.height,r<A.top?(t=A.top-r,r=A.top):t=0,v(l,m,E,A.left,r,A.width,n),t>0&&(E.top+=t),r=Math.floor(r+m.height)-t}else D("html2canvas: Error loading background:"+
r)}switch(b.nodeName){case"IMG":k=b.getAttribute("src");(H=g(k))?(k=a(b,"paddingLeft"),x=a(b,"paddingTop"),m=a(b,"paddingRight"),E=a(b,"paddingBottom"),l.drawImage(H,0,0,H.width,H.height,o+k+p[3].width,w+x+p[0].width,d.width-(p[1].width+p[3].width+k+m),d.height-(p[0].width+p[2].width+x+E)),I+=1):D("html2canvas: Error loading <img>:"+k);break;case"INPUT":/^(text|url|email|submit|button|reset)$/.test(b.type)&&b.value.length>0&&O(b,d,k);break;case"TEXTAREA":b.value.length>0&&O(b,d,k);break;case"SELECT":b.options.length>0&&O(b,d,k);break;case"LI":d=x;o=y(b,"listStylePosition");p=y(b,"listStyleType");w=y(b,"fontWeight");if(/^(decimal|decimal-leading-zero|upper-alpha|upper-latin|upper-roman|lower-alpha|lower-greek|lower-latin|lower-roman)$/i.test(p)){l=-1;k=1;x=b.parentNode.childNodes;if(b.parentNode){for(;x[++l]!==b;)x[l].nodeType===1&&k++;l=k}else l=-1;switch(p){case"decimal":H=l;break;case"decimal-leading-zero":H=l.toString().length===1?"0"+l.toString():l.toString();break;case"upper-roman":H=j.Generate.ListRoman(l);break;case"lower-roman":H=j.Generate.ListRoman(l).toLowerCase();break;case"lower-alpha":H=j.Generate.ListAlpha(l).toLowerCase();break;case"upper-alpha":H=j.Generate.ListAlpha(l)}H+=". ";k=H;p=z.createElement("boundelement");p.style.display="inline";l=b.style.listStyleType;b.style.listStyleType="none";p.appendChild(z.createTextNode(k));b.insertBefore(p,b.firstChild);k=j.Util.Bounds(p);b.removeChild(p);b.style.listStyleType=l;switch(w){case 401:w="bold";break;case 400:w="normal"}Q.setVariable("fillStyle",y(b,"color"));Q.setVariable("font",y(b,"fontVariant")+" "+w+" "+y(b,"fontStyle")+" "+y(b,"fontSize")+" "+y(b,"fontFamily"));if(o==="inside")Q.setVariable("textAlign","left"),d=d.left,o=k.bottom,w=Q,h(H).length>0&&(w.fillText(H,d,o),I+=1)}break;case"CANVAS":k=a(b,"paddingLeft"),x=a(b,"paddingTop"),m=a(b,"paddingRight"),E=a(b,"paddingBottom"),l.drawImage(b,0,0,b.width,b.height,o+k+p[3].width,w+x+p[0].width,d.width-(p[1].width+p[3].width+k+m),d.height-(p[0].width+p[2].width+x+E)),I+=1}return C.children[u-
1]}function t(a,b){if(y(a,"display")!=="none"&&y(a,"visibility")!=="hidden"&&!a.hasAttribute("data-html2canvas-ignore")&&(b=K(a,b)||b,Q=b.ctx,!F.test(a.nodeName))){var c=j.Util.Children(a),e,f,g;e=0;for(g=c.length;e<g;e+=1)f=c[e],f.nodeType===1?t(f,b):f.nodeType===3&&d(a,f,b)}}u.scroll(0,0);var w={rangeBounds:!1,svgRendering:i.svgRendering&&function(){var a=new Image,b=B.createElement("canvas"),c=b.getContext===n?!1:b.getContext("2d");if(c===!1)return!1;b.width=b.height=10;a.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' width='10' height='10'><foreignObject width='10' height='10'><div xmlns='http://www.w3.org/1999/xhtml' style='width:10;height:10;'>sup</div></foreignObject></svg>";try{c.drawImage(a,0,0),b.toDataURL()}catch(d){return!1}D("html2canvas: Parse: SVG powered rendering available");return!0}()},o=i.elements===n?B.body:i.elements[0],I=0,x={},z=o.ownerDocument,F=RegExp("("+i.ignoreElements+")"),N=z.body,M,G,R,Q,L,c=c||{};if(z.createRange&&(M=z.createRange(),M.getBoundingClientRect)){G=z.createElement("boundtest");G.style.height="123px";G.style.display="block";N.appendChild(G);M.selectNode(G);M=M.getBoundingClientRect();M=M.height;if(M===123)w.rangeBounds=!0;N.removeChild(G)}var y=j.Util.getCSS;R=K(o,null);w.svgRendering&&function(a){function b(a){var a=j.Util.Children(a),c=a.length,d,f,g,h,i;for(i=0;i<c;i+=1)if(h=a[i],h.nodeType===3)e+=h.nodeValue.replace(/\</g,"&lt;").replace(/\>/g,"&gt;");else if(h.nodeType===1&&!/^(script|meta|title)$/.test(h.nodeName.toLowerCase())){e+="<"+h.nodeName.toLowerCase();if(h.hasAttributes()){d=h.attributes;g=d.length;for(f=0;f<g;f+=1)e+=" "+d[f].name+'="'+d[f].value+'"'}e+=">";b(h);e+="</"+h.nodeName.toLowerCase()+">"}}var c=new Image,d=f(),e="";b(a);c.src=["data:image/svg+xml,","<svg xmlns='http://www.w3.org/2000/svg' version='1.1' width='"+d.width+"' height='"+d.height+"'>","<foreignObject width='"+d.width+"' height='"+d.height+"'>","<html xmlns='http://www.w3.org/1999/xhtml' style='margin:0;'>",e.replace(/\#/g,"%23"),"</html></foreignObject></svg>"].join("");c.onload=function(){R.svgRender=c}}(B.documentElement);G=0;o=o.children;for(M=o.length;G<M;G+=1)t(o[G],R);R.backgroundColor=y(B.documentElement,"backgroundColor");return R};j.Preload=function(c){function i(){D("html2canvas: start: images: "+b.numLoaded+" / "+b.numTotal+" (failed: "+b.numFailed+")");!b.firstRun&&b.numLoaded>=b.numTotal&&(D("Finished loading images: # "+b.numTotal+" (failed: "+b.numFailed+")"),typeof c.complete==="function"&&c.complete(b))}function f(a,d,f){var g,h=c.proxy,j;v.href=a;a=v.href;g="html2canvas_"+q++;f.callbackname=g;h+=h.indexOf("?")>-1?"&":"?";h+="url="+encodeURIComponent(a)+"&callback="+g;j=P.createElement("script");u[g]=function(a){a.substring(0,6)==="error:"?(f.succeeded=!1,b.numLoaded++,b.numFailed++,i()):(e(d,f),d.src=a);u[g]=n;try{delete u[g]}catch(c){}j.parentNode.removeChild(j);j=null;delete f.script;delete f.callbackname};j.setAttribute("type","text/javascript");j.setAttribute("src",h);f.script=j;u.document.body.appendChild(j)}function a(c){var e=j.Util.Children(c),f,g,h=!1;try{var q=e.length;for(f=0;f<q;f+=1)a(e[f])}catch(s){}try{h=c.nodeType}catch(t){h=!1,D("html2canvas: failed to access some element's nodeType - Exception: "+t.message)}if(h===1||h===n){try{g=j.Util.getCSS(c,"backgroundImage")}catch(v){D("html2canvas: failed to get background-image - Exception: "+v.message)}g&&g!=="1"&&g!=="none"&&(/^(-webkit|-o|-moz|-ms|linear)-/.test(g)?(c=j.Generate.Gradient(g,j.Util.Bounds(c)),c!==n&&(b[g]={img:c,succeeded:!0},b.numTotal++,b.numLoaded++,i())):(g=j.Util.backgroundImage(g.match(/data:image\/.*;base64,/i)?g:g.split(",")[0]),d.loadImage(g)))}}function e(a,d){a.onload=function(){d.timer!==n&&u.clearTimeout(d.timer);b.numLoaded++;d.succeeded=!0;a.onerror=a.onload=null;i()};a.onerror=function(){if(a.crossOrigin==="anonymous"&&(u.clearTimeout(d.timer),c.proxy)){var e=a.src;a=new Image;d.img=a;a.src=e;f(a.src,a,d);return}b.numLoaded++;b.numFailed++;d.succeeded=!1;a.onerror=a.onload=null;i()}}var b={numLoaded:0,numFailed:0,numTotal:0,cleanupDone:!1},h,d,g,q=0;g=c.elements[0]||B.body;var P=g.ownerDocument,O=P.images,s=O.length,v=P.createElement("a"),K=function(a){return a.crossOrigin!==n}(new Image),t;v.href=u.location.href;h=v.protocol+v.host;d={loadImage:function(a){var d,g;if(a&&b[a]===n)d=new Image,a.match(/data:image\/.*;base64,/i)?(d.src=a.replace(/url\(['"]{0,}|['"]{0,}\)$/ig,""),g=b[a]={img:d},b.numTotal++,e(d,g)):(v.href=a,v.href=v.href,v.protocol+v.host===h||c.allowTaint===!0?(g=b[a]={img:d},b.numTotal++,e(d,g),d.src=a):K&&!c.allowTaint&&c.useCORS?(d.crossOrigin="anonymous",g=b[a]={img:d},b.numTotal++,e(d,g),d.src=a,d.customComplete=function(){if(this.img.complete)this.img.onerror();else this.timer=u.setTimeout(this.img.customComplete,100)}.bind(g),d.customComplete()):c.proxy&&(g=b[a]={img:d},b.numTotal++,f(a,d,g)))},cleanupDOM:function(a){var d,e;if(!b.cleanupDone){a&&typeof a==="string"?D("html2canvas: Cleanup because: "+a):D("html2canvas: Cleanup after timeout: "+c.timeout+" ms.");for(e in b)if(b.hasOwnProperty(e)&&(d=b[e],typeof d==="object"&&d.callbackname&&d.succeeded===n)){u[d.callbackname]=n;try{delete u[d.callbackname]}catch(g){}d.script&&d.script.parentNode&&(d.script.setAttribute("src","about:blank"),d.script.parentNode.removeChild(d.script));b.numLoaded++;b.numFailed++;D("html2canvas: Cleaned up failed img: '"+e+"' Steps: "+b.numLoaded+" / "+b.numTotal)}u.stop!==n?u.stop():B.execCommand!==n&&B.execCommand("Stop",!1);B.close!==n&&B.close();b.cleanupDone=!0;a&&typeof a==="string"||i()}},renderingDone:function(){t&&u.clearTimeout(t)}};c.timeout>0&&(t=u.setTimeout(d.cleanupDOM,c.timeout));D("html2canvas: Preload starts: finding background-images");b.firstRun=!0;a(g);D("html2canvas: Preload: Finding images");for(g=0;g<s;g+=1)d.loadImage(O[g].getAttribute("src"));b.firstRun=!1;D("html2canvas: Preload: Done.");b.numTotal===b.numLoaded&&i();return d};j.Renderer=function(c,i){function f(c){var b=[],h=[],c=c.children,d,g,i,j;d=0;for(i=c.length;d<i;d+=1)g=c[d],g.children&&g.children.length>0?(b.push(g),h.push(g.zindex)):a.push(g);h.sort(function(a,b){return a-b});c=0;for(d=h.length;c<d;c+=1){g=h[c];i=0;for(j=b.length;i<=j;i+=1)if(b[i].zindex===g){g=b.splice(i,1);f(g[0]);break}}}var a=[];f(c.zIndex);if(typeof i._renderer._create!=="function")throw Error("Invalid renderer defined");return i._renderer._create(c,i,B,a,j)};L=function(c,i){var f,a,e={logging:!1,elements:c,proxy:"http://html2canvas.appspot.com/",timeout:0,useCORS:!1,allowTaint:!1,svgRendering:!1,iframeDefault:"default",ignoreElements:"IFRAME|OBJECT|PARAM",useOverflow:!0,letterRendering:!1,flashcanvas:n,width:null,height:null,taintTest:!0,renderer:"Canvas"},e=j.Util.Extend(i,e);if(typeof e.renderer==="string"&&j.Renderer[e.renderer]!==n)e._renderer=j.Renderer[e.renderer](e);else if(typeof e.renderer==="function")e._renderer=e.renderer(e);else throw"Unknown renderer";j.logging=e.logging;e.complete=function(b){if(!(typeof e.onpreloaded==="function"&&e.onpreloaded(b)===!1)&&(f=j.Parse(b,e),!(typeof e.onparsed==="function"&&e.onparsed(f)===!1)&&(a=j.Renderer(f,e),typeof e.onrendered==="function")))e.onrendered(a)};u.setTimeout(function(){j.Preload(e)},0);return{render:function(a,c){return j.Renderer(a,j.Util.Extend(c,e))},parse:function(a,c){return j.Parse(a,j.Util.Extend(c,e))},preload:function(a){return j.Preload(j.Util.Extend(a,e))},log:D}};L.log=D;L.Renderer={Canvas:n};j.Renderer.Canvas=function(c){var c=c||{},i=c.canvas||B.createElement("canvas"),f=!1,a=!1,e=!1,b;if(i.getContext)D("html2canvas: Renderer: using canvas renderer"),e=!0;else if(c.flashcanvas!==n){f=!0;D("html2canvas: Renderer: canvas not available, using flashcanvas");var h=B.createElement("script");h.src=c.flashcanvas;h.onload=function(a,b){var c;if(a.onload===n)a.onreadystatechange!==n?(c=function(){a.readyState!=="loaded"&&a.readyState!=="complete"?u.setTimeout(c,250):b()},u.setTimeout(c,250)):D("html2canvas: Renderer: Can't track when flashcanvas is loaded");else return b}(h,function(){typeof u.FlashCanvas!=="undefined"&&(D("html2canvas: Renderer: Flashcanvas initialized"),u.FlashCanvas.initElement(i),e=!0,a!==!1&&b._create.apply(null,a))});B.body.appendChild(h)}return b={_create:function(b,c,h,j,u){if(!e)return a=arguments,i;var s=i.getContext("2d"),v,K,t,w,o,I,x=B.createElement("canvas");o=x.getContext!==n;var z,F,x=o?x.getContext("2d"):{};I=[];i.width=i.style.width=!f?c.width||b.ctx.width:Math.min(2880,c.width||b.ctx.width);i.height=i.style.height=!f?c.height||b.ctx.height:Math.min(2880,c.height||b.ctx.height);v=s.fillStyle;s.fillStyle=b.backgroundColor;s.fillRect(0,0,i.width,i.height);s.fillStyle=v;if(c.svgRendering&&b.svgRender!==n)s.drawImage(b.svgRender,0,0);else{K=0;for(t=j.length;K<t;K+=1){v=j.splice(0,1)[0];v.canvasPosition=v.canvasPosition||{};s.textBaseline="bottom";v.clip&&(s.save(),s.beginPath(),s.rect(v.clip.left,v.clip.top,v.clip.width,v.clip.height),s.clip());if(v.ctx.storage){w=0;for(z=v.ctx.storage.length;w<z;w+=1)switch(F=v.ctx.storage[w],F.type){case"variable":s[F.name]=F.arguments;break;case"function":if(F.name==="fillRect")(!f||F.arguments[0]+F.arguments[2]<2880&&F.arguments[1]+F.arguments[3]<2880)&&s.fillRect.apply(s,F.arguments);else if(F.name==="drawShape")(function(a){var b,c=a.length;s.beginPath();for(b=0;b<c;b++)s[a[b].name].apply(s,a[b].arguments);s.closePath();s.fill()})(F.arguments);else if(F.name==="fillText")(!f||F.arguments[1]<2880&&F.arguments[2]<2880)&&s.fillText.apply(s,F.arguments);else if(F.name==="drawImage"&&F.arguments[8]>0&&F.arguments[7]){if(o&&c.taintTest&&I.indexOf(F.arguments[0].src)===-1){x.drawImage(F.arguments[0],0,0);try{x.getImageData(0,0,1,1)}catch(L){x=h.createElement("canvas");x=x.getContext("2d");continue}I.push(F.arguments[0].src)}s.drawImage.apply(s,F.arguments)}}}v.clip&&s.restore()}}D("html2canvas: Renderer: Canvas renderer done - returning canvas obj");t=c.elements.length;return t===1&&typeof c.elements[0]==="object"&&c.elements[0].nodeName!=="BODY"&&f===!1?(I=u.Util.Bounds(c.elements[0]),o=h.createElement("canvas"),o.width=I.width,o.height=I.height,s=o.getContext("2d"),s.drawImage(i,I.left,I.top,I.width,I.height,0,0,I.width,I.height),i=null,o):i}}};j.Renderer.SVG=function(){var c=B.createElementNS("http://www.w3.org/2000/svg","svg"),i=B.createElementNS("http://www.w3.org/2000/svg","defs"),f,a,e,b,h,d,g,j={},n,u,s=0;return{_create:function(v,B,t,w){c.setAttribute("version","1.1");c.setAttribute("baseProfile","full");c.setAttribute("viewBox","0 0 "+Math.max(v.ctx.width,B.width)+" "+Math.max(v.ctx.height,B.height));c.setAttribute("width",Math.max(v.ctx.width,B.width)+"px");c.setAttribute("height",Math.max(v.ctx.height,B.height)+"px");c.setAttribute("preserveAspectRatio","none");c.appendChild(i);f=0;for(e=w.length;f<e;f+=1)if(h=w.splice(0,1)[0],h.canvasPosition=h.canvasPosition||{},h.ctx.storage){a=0;for(b=h.ctx.storage.length;a<b;a+=1)switch(d=h.ctx.storage[a],d.type){case"variable":j[d.name]=d.arguments;break;case"function":d.name==="fillRect"?(g=t.createElementNS("http://www.w3.org/2000/svg","rect"),g.setAttribute("x",d.arguments[0]),g.setAttribute("y",d.arguments[1]),g.setAttribute("width",d.arguments[2]),g.setAttribute("height",d.arguments[3]),g.setAttribute("fill",j.fillStyle),c.appendChild(g)):d.name==="fillText"?(g=t.createElementNS("http://www.w3.org/2000/svg","text"),u=j.font.split(" "),g.style.fontVariant=u.splice(0,1)[0],g.style.fontWeight=u.splice(0,1)[0],g.style.fontStyle=u.splice(0,1)[0],g.style.fontSize=u.splice(0,1)[0],g.setAttribute("x",d.arguments[1]),g.setAttribute("y",d.arguments[2]-(parseInt(g.style.fontSize,10)+3)),g.setAttribute("fill",j.fillStyle),g.style.dominantBaseline="text-before-edge",g.style.fontFamily=u.join(" "),n=t.createTextNode(d.arguments[0]),g.appendChild(n),c.appendChild(g)):d.name==="drawImage"&&d.arguments[8]>0&&d.arguments[7]&&(g=t.createElementNS("http://www.w3.org/2000/svg","clipPath"),g.setAttribute("id","clipId"+s),n=t.createElementNS("http://www.w3.org/2000/svg","rect"),n.setAttribute("x",d.arguments[5]),n.setAttribute("y",d.arguments[6]),n.setAttribute("width",d.arguments[3]),n.setAttribute("height",d.arguments[4]),g.appendChild(n),i.appendChild(g),g=t.createElementNS("http://www.w3.org/2000/svg","image"),g.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",d.arguments[0].src),g.setAttribute("width",d.arguments[7]),g.setAttribute("height",d.arguments[8]),g.setAttribute("x",d.arguments[5]),g.setAttribute("y",d.arguments[6]),g.setAttribute("clip-path","url(#clipId"+s+")"),g.setAttribute("preserveAspectRatio","none"),c.appendChild(g),s+=1)}}D("html2canvas: Renderer: SVG Renderer done - returning SVG DOM obj");return c}}};u.html2canvas=L})(window,document);
